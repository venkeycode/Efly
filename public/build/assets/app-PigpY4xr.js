var IA=Object.defineProperty;var qg=r=>{throw TypeError(r)};var SA=(r,e,t)=>e in r?IA(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var F=(r,e,t)=>SA(r,typeof e!="symbol"?e+"":e,t),Fh=(r,e,t)=>e.has(r)||qg("Cannot "+t);var y=(r,e,t)=>(Fh(r,e,"read from private field"),t?t.call(r):e.get(r)),M=(r,e,t)=>e.has(r)?qg("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),P=(r,e,t,n)=>(Fh(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t),K=(r,e,t)=>(Fh(r,e,"access private method"),t);var Wa=(r,e,t,n)=>({set _(s){P(r,e,s,t)},get _(){return y(r,e,n)}});const PA="6.15.0";function OA(r,e,t){const n=e.split("|").map(i=>i.trim());for(let i=0;i<n.length;i++)switch(e){case"any":return;case"bigint":case"boolean":case"number":case"string":if(typeof r===e)return}const s=new Error(`invalid value for type ${e}`);throw s.code="INVALID_ARGUMENT",s.argument=`value.${t}`,s.value=r,s}async function Ot(r){const e=Object.keys(r);return(await Promise.all(e.map(n=>Promise.resolve(r[n])))).reduce((n,s,i)=>(n[e[i]]=s,n),{})}function ie(r,e,t){for(let n in e){let s=e[n];const i=t?t[n]:null;i&&OA(s,i,n),Object.defineProperty(r,n,{enumerable:!0,value:s,writable:!1})}}function Oo(r,e){if(r==null)return"null";if(e==null&&(e=new Set),typeof r=="object"){if(e.has(r))return"[Circular]";e.add(r)}if(Array.isArray(r))return"[ "+r.map(t=>Oo(t,e)).join(", ")+" ]";if(r instanceof Uint8Array){const t="0123456789abcdef";let n="0x";for(let s=0;s<r.length;s++)n+=t[r[s]>>4],n+=t[r[s]&15];return n}if(typeof r=="object"&&typeof r.toJSON=="function")return Oo(r.toJSON(),e);switch(typeof r){case"boolean":case"number":case"symbol":return r.toString();case"bigint":return BigInt(r).toString();case"string":return JSON.stringify(r);case"object":{const t=Object.keys(r);return t.sort(),"{ "+t.map(n=>`${Oo(n,e)}: ${Oo(r[n],e)}`).join(", ")+" }"}}return"[ COULD NOT SERIALIZE ]"}function lt(r,e){return r&&r.code===e}function Up(r){return lt(r,"CALL_EXCEPTION")}function Te(r,e,t){let n=r;{const i=[];if(t){if("message"in t||"code"in t||"name"in t)throw new Error(`value will overwrite populated values: ${Oo(t)}`);for(const o in t){if(o==="shortMessage")continue;const a=t[o];i.push(o+"="+Oo(a))}}i.push(`code=${e}`),i.push(`version=${PA}`),i.length&&(r+=" ("+i.join(", ")+")")}let s;switch(e){case"INVALID_ARGUMENT":s=new TypeError(r);break;case"NUMERIC_FAULT":case"BUFFER_OVERRUN":s=new RangeError(r);break;default:s=new Error(r)}return ie(s,{code:e}),t&&Object.assign(s,t),s.shortMessage==null&&ie(s,{shortMessage:n}),s}function q(r,e,t,n){if(!r)throw Te(e,t,n)}function R(r,e,t,n){q(r,e,"INVALID_ARGUMENT",{argument:t,value:n})}function xb(r,e,t){t==null&&(t=""),t&&(t=": "+t),q(r>=e,"missing argument"+t,"MISSING_ARGUMENT",{count:r,expectedCount:e}),q(r<=e,"too many arguments"+t,"UNEXPECTED_ARGUMENT",{count:r,expectedCount:e})}["NFD","NFC","NFKD","NFKC"].reduce((r,e)=>{try{if("test".normalize(e)!=="test")throw new Error("bad");if(e==="NFD"&&"é".normalize("NFD")!=="é")throw new Error("broken");r.push(e)}catch{}return r},[]);function ll(r,e,t){if(t==null&&(t=""),r!==e){let n=t,s="new";t&&(n+=".",s+=" "+t),q(!1,`private constructor; use ${n}from* methods`,"UNSUPPORTED_OPERATION",{operation:s})}}function Ib(r,e,t){if(r instanceof Uint8Array)return t?new Uint8Array(r):r;if(typeof r=="string"&&r.match(/^0x(?:[0-9a-f][0-9a-f])*$/i)){const n=new Uint8Array((r.length-2)/2);let s=2;for(let i=0;i<n.length;i++)n[i]=parseInt(r.substring(s,s+2),16),s+=2;return n}R(!1,"invalid BytesLike value",e||"value",r)}function ue(r,e){return Ib(r,e,!1)}function Dt(r,e){return Ib(r,e,!0)}function Ce(r,e){return!(typeof r!="string"||!r.match(/^0x[0-9A-Fa-f]*$/)||typeof e=="number"&&r.length!==2+2*e||e===!0&&r.length%2!==0)}function kp(r){return Ce(r,!0)||r instanceof Uint8Array}const Vg="0123456789abcdef";function X(r){const e=ue(r);let t="0x";for(let n=0;n<e.length;n++){const s=e[n];t+=Vg[(s&240)>>4]+Vg[s&15]}return t}function $e(r){return"0x"+r.map(e=>X(e).substring(2)).join("")}function $o(r){return Ce(r,!0)?(r.length-2)/2:ue(r).length}function ke(r,e,t){const n=ue(r);return t!=null&&t>n.length&&q(!1,"cannot slice beyond data bounds","BUFFER_OVERRUN",{buffer:n,length:n.length,offset:t}),X(n.slice(e??0,t??n.length))}function Sb(r,e,t){const n=ue(r);q(e>=n.length,"padding exceeds data length","BUFFER_OVERRUN",{buffer:new Uint8Array(n),length:e,offset:e+1});const s=new Uint8Array(e);return s.fill(0),t?s.set(n,e-n.length):s.set(n,0),X(s)}function Xn(r,e){return Sb(r,e,!0)}function DA(r,e){return Sb(r,e,!1)}const ih=BigInt(0),jr=BigInt(1),Do=9007199254740991;function Eu(r,e){const t=oh(r,"value"),n=BigInt(ce(e,"width"));if(q(t>>n===ih,"overflow","NUMERIC_FAULT",{operation:"fromTwos",fault:"overflow",value:r}),t>>n-jr){const s=(jr<<n)-jr;return-((~t&s)+jr)}return t}function Pb(r,e){let t=re(r,"value");const n=BigInt(ce(e,"width")),s=jr<<n-jr;if(t<ih){t=-t,q(t<=s,"too low","NUMERIC_FAULT",{operation:"toTwos",fault:"overflow",value:r});const i=(jr<<n)-jr;return(~t&i)+jr}else q(t<s,"too high","NUMERIC_FAULT",{operation:"toTwos",fault:"overflow",value:r});return t}function mi(r,e){const t=oh(r,"value"),n=BigInt(ce(e,"bits"));return t&(jr<<n)-jr}function re(r,e){switch(typeof r){case"bigint":return r;case"number":return R(Number.isInteger(r),"underflow",e||"value",r),R(r>=-Do&&r<=Do,"overflow",e||"value",r),BigInt(r);case"string":try{if(r==="")throw new Error("empty string");return r[0]==="-"&&r[1]!=="-"?-BigInt(r.substring(1)):BigInt(r)}catch(t){R(!1,`invalid BigNumberish string: ${t.message}`,e||"value",r)}}R(!1,"invalid BigNumberish value",e||"value",r)}function oh(r,e){const t=re(r,e);return q(t>=ih,"unsigned value cannot be negative","NUMERIC_FAULT",{fault:"overflow",operation:"getUint",value:r}),t}const Kg="0123456789abcdef";function ah(r){if(r instanceof Uint8Array){let e="0x0";for(const t of r)e+=Kg[t>>4],e+=Kg[t&15];return BigInt(e)}return re(r)}function ce(r,e){switch(typeof r){case"bigint":return R(r>=-Do&&r<=Do,"overflow",e||"value",r),Number(r);case"number":return R(Number.isInteger(r),"underflow",e||"value",r),R(r>=-Do&&r<=Do,"overflow",e||"value",r),r;case"string":try{if(r==="")throw new Error("empty string");return ce(BigInt(r),e)}catch(t){R(!1,`invalid numeric string: ${t.message}`,e||"value",r)}}R(!1,"invalid numeric value",e||"value",r)}function CA(r){return ce(ah(r))}function Vs(r,e){let n=oh(r,"value").toString(16);if(e==null)n.length%2&&(n="0"+n);else{const s=ce(e,"width");for(q(s*2>=n.length,`value exceeds width (${s} bytes)`,"NUMERIC_FAULT",{operation:"toBeHex",fault:"overflow",value:r});n.length<s*2;)n="0"+n}return"0x"+n}function Je(r){const e=oh(r,"value");if(e===ih)return new Uint8Array([]);let t=e.toString(16);t.length%2&&(t="0"+t);const n=new Uint8Array(t.length/2);for(let s=0;s<n.length;s++){const i=s*2;n[s]=parseInt(t.substring(i,i+2),16)}return n}function Fr(r){let e=X(kp(r)?r:Je(r)).substring(2);for(;e.startsWith("0");)e=e.substring(1);return e===""&&(e="0"),"0x"+e}const Gg="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";BigInt(0);const Qg=BigInt(58);function BA(r){const e=ue(r);let t=ah(e),n="";for(;t;)n=Gg[Number(t%Qg)]+n,t/=Qg;for(let s=0;s<e.length&&!e[s];s++)n=Gg[0]+n;return n}function _A(r){r=atob(r);const e=new Uint8Array(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return ue(e)}function TA(r){const e=ue(r);let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return btoa(t)}var Vo;class Ob{constructor(e,t,n){F(this,"filter");F(this,"emitter");M(this,Vo);P(this,Vo,t),ie(this,{emitter:e,filter:n})}async removeListener(){y(this,Vo)!=null&&await this.emitter.off(this.filter,y(this,Vo))}}Vo=new WeakMap;function NA(r,e,t,n,s){R(!1,`invalid codepoint at offset ${e}; ${r}`,"bytes",t)}function Db(r,e,t,n,s){if(r==="BAD_PREFIX"||r==="UNEXPECTED_CONTINUE"){let i=0;for(let o=e+1;o<t.length&&t[o]>>6===2;o++)i++;return i}return r==="OVERRUN"?t.length-e-1:0}function RA(r,e,t,n,s){return r==="OVERLONG"?(R(typeof s=="number","invalid bad code point for replacement","badCodepoint",s),n.push(s),0):(n.push(65533),Db(r,e,t))}const UA=Object.freeze({error:NA,ignore:Db,replace:RA});function kA(r,e){e==null&&(e=UA.error);const t=ue(r,"bytes"),n=[];let s=0;for(;s<t.length;){const i=t[s++];if(i>>7===0){n.push(i);continue}let o=null,a=null;if((i&224)===192)o=1,a=127;else if((i&240)===224)o=2,a=2047;else if((i&248)===240)o=3,a=65535;else{(i&192)===128?s+=e("UNEXPECTED_CONTINUE",s-1,t,n):s+=e("BAD_PREFIX",s-1,t,n);continue}if(s-1+o>=t.length){s+=e("OVERRUN",s-1,t,n);continue}let c=i&(1<<8-o-1)-1;for(let l=0;l<o;l++){let u=t[s];if((u&192)!=128){s+=e("MISSING_CONTINUE",s,t,n),c=null;break}c=c<<6|u&63,s++}if(c!==null){if(c>1114111){s+=e("OUT_OF_RANGE",s-1-o,t,n,c);continue}if(c>=55296&&c<=57343){s+=e("UTF16_SURROGATE",s-1-o,t,n,c);continue}if(c<=a){s+=e("OVERLONG",s-1-o,t,n,c);continue}n.push(c)}}return n}function Wn(r,e){R(typeof r=="string","invalid string value","str",r);let t=[];for(let n=0;n<r.length;n++){const s=r.charCodeAt(n);if(s<128)t.push(s);else if(s<2048)t.push(s>>6|192),t.push(s&63|128);else if((s&64512)==55296){n++;const i=r.charCodeAt(n);R(n<r.length&&(i&64512)===56320,"invalid surrogate pair","str",r);const o=65536+((s&1023)<<10)+(i&1023);t.push(o>>18|240),t.push(o>>12&63|128),t.push(o>>6&63|128),t.push(o&63|128)}else t.push(s>>12|224),t.push(s>>6&63|128),t.push(s&63|128)}return new Uint8Array(t)}function $A(r){return r.map(e=>e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode((e>>10&1023)+55296,(e&1023)+56320))).join("")}function Au(r,e){return $A(kA(r,e))}function Cb(r){async function e(t,n){q(n==null||!n.cancelled,"request cancelled before sending","CANCELLED");const s=t.url.split(":")[0].toLowerCase();q(s==="http"||s==="https",`unsupported protocol ${s}`,"UNSUPPORTED_OPERATION",{info:{protocol:s},operation:"request"}),q(s==="https"||!t.credentials||t.allowInsecureAuthentication,"insecure authorized connections unsupported","UNSUPPORTED_OPERATION",{operation:"request"});let i=null;const o=new AbortController,a=setTimeout(()=>{i=Te("request timeout","TIMEOUT"),o.abort()},t.timeout);n&&n.addListener(()=>{i=Te("request cancelled","CANCELLED"),o.abort()});const c=Object.assign({},r,{method:t.method,headers:new Headers(Array.from(t)),body:t.body||void 0,signal:o.signal});let l;try{l=await fetch(t.url,c)}catch(d){throw clearTimeout(a),i||d}clearTimeout(a);const u={};l.headers.forEach((d,p)=>{u[p.toLowerCase()]=d});const h=await l.arrayBuffer(),f=h==null?null:new Uint8Array(h);return{statusCode:l.status,statusMessage:l.statusText,headers:u,body:f}}return e}const LA=12,FA=250;let Wg=Cb();const MA=new RegExp("^data:([^;:]*)?(;base64)?,(.*)$","i"),jA=new RegExp("^ipfs://(ipfs/)?(.*)$","i");let Mh=!1;async function Bb(r,e){try{const t=r.match(MA);if(!t)throw new Error("invalid data");return new Hs(200,"OK",{"content-type":t[1]||"text/plain"},t[2]?_A(t[3]):HA(t[3]))}catch{return new Hs(599,"BAD REQUEST (invalid data: URI)",{},null,new Ks(r))}}function _b(r){async function e(t,n){try{const s=t.match(jA);if(!s)throw new Error("invalid link");return new Ks(`${r}${s[2]}`)}catch{return new Hs(599,"BAD REQUEST (invalid IPFS URI)",{},null,new Ks(t))}}return e}const Cl={data:Bb,ipfs:_b("https://gateway.ipfs.io/ipfs/")},Tb=new WeakMap;var Si,Ss;class zA{constructor(e){M(this,Si);M(this,Ss);P(this,Si,[]),P(this,Ss,!1),Tb.set(e,()=>{if(!y(this,Ss)){P(this,Ss,!0);for(const t of y(this,Si))setTimeout(()=>{t()},0);P(this,Si,[])}})}addListener(e){q(!y(this,Ss),"singal already cancelled","UNSUPPORTED_OPERATION",{operation:"fetchCancelSignal.addCancelListener"}),y(this,Si).push(e)}get cancelled(){return y(this,Ss)}checkSignal(){q(!this.cancelled,"cancelled","CANCELLED",{})}}Si=new WeakMap,Ss=new WeakMap;function Bl(r){if(r==null)throw new Error("missing signal; should not happen");return r.checkSignal(),r}var Ko,Go,Nr,Un,Qo,Wo,Xe,tr,kn,Pi,Oi,Di,tn,Rr,Ps,Ci,mc;const Zu=class Zu{constructor(e){M(this,Ci);M(this,Ko);M(this,Go);M(this,Nr);M(this,Un);M(this,Qo);M(this,Wo);M(this,Xe);M(this,tr);M(this,kn);M(this,Pi);M(this,Oi);M(this,Di);M(this,tn);M(this,Rr);M(this,Ps);P(this,Wo,String(e)),P(this,Ko,!1),P(this,Go,!0),P(this,Nr,{}),P(this,Un,""),P(this,Qo,3e5),P(this,Rr,{slotInterval:FA,maxAttempts:LA}),P(this,Ps,null)}get url(){return y(this,Wo)}set url(e){P(this,Wo,String(e))}get body(){return y(this,Xe)==null?null:new Uint8Array(y(this,Xe))}set body(e){if(e==null)P(this,Xe,void 0),P(this,tr,void 0);else if(typeof e=="string")P(this,Xe,Wn(e)),P(this,tr,"text/plain");else if(e instanceof Uint8Array)P(this,Xe,e),P(this,tr,"application/octet-stream");else if(typeof e=="object")P(this,Xe,Wn(JSON.stringify(e))),P(this,tr,"application/json");else throw new Error("invalid body")}hasBody(){return y(this,Xe)!=null}get method(){return y(this,Un)?y(this,Un):this.hasBody()?"POST":"GET"}set method(e){e==null&&(e=""),P(this,Un,String(e).toUpperCase())}get headers(){const e=Object.assign({},y(this,Nr));return y(this,kn)&&(e.authorization=`Basic ${TA(Wn(y(this,kn)))}`),this.allowGzip&&(e["accept-encoding"]="gzip"),e["content-type"]==null&&y(this,tr)&&(e["content-type"]=y(this,tr)),this.body&&(e["content-length"]=String(this.body.length)),e}getHeader(e){return this.headers[e.toLowerCase()]}setHeader(e,t){y(this,Nr)[String(e).toLowerCase()]=String(t)}clearHeaders(){P(this,Nr,{})}[Symbol.iterator](){const e=this.headers,t=Object.keys(e);let n=0;return{next:()=>{if(n<t.length){const s=t[n++];return{value:[s,e[s]],done:!1}}return{value:void 0,done:!0}}}}get credentials(){return y(this,kn)||null}setCredentials(e,t){R(!e.match(/:/),"invalid basic authentication username","username","[REDACTED]"),P(this,kn,`${e}:${t}`)}get allowGzip(){return y(this,Go)}set allowGzip(e){P(this,Go,!!e)}get allowInsecureAuthentication(){return!!y(this,Ko)}set allowInsecureAuthentication(e){P(this,Ko,!!e)}get timeout(){return y(this,Qo)}set timeout(e){R(e>=0,"timeout must be non-zero","timeout",e),P(this,Qo,e)}get preflightFunc(){return y(this,Pi)||null}set preflightFunc(e){P(this,Pi,e)}get processFunc(){return y(this,Oi)||null}set processFunc(e){P(this,Oi,e)}get retryFunc(){return y(this,Di)||null}set retryFunc(e){P(this,Di,e)}get getUrlFunc(){return y(this,Ps)||Wg}set getUrlFunc(e){P(this,Ps,e)}toString(){return`<FetchRequest method=${JSON.stringify(this.method)} url=${JSON.stringify(this.url)} headers=${JSON.stringify(this.headers)} body=${y(this,Xe)?X(y(this,Xe)):"null"}>`}setThrottleParams(e){e.slotInterval!=null&&(y(this,Rr).slotInterval=e.slotInterval),e.maxAttempts!=null&&(y(this,Rr).maxAttempts=e.maxAttempts)}send(){return q(y(this,tn)==null,"request already sent","UNSUPPORTED_OPERATION",{operation:"fetchRequest.send"}),P(this,tn,new zA(this)),K(this,Ci,mc).call(this,0,Jg()+this.timeout,0,this,new Hs(0,"",{},null,this))}cancel(){q(y(this,tn)!=null,"request has not been sent","UNSUPPORTED_OPERATION",{operation:"fetchRequest.cancel"});const e=Tb.get(this);if(!e)throw new Error("missing signal; should not happen");e()}redirect(e){const t=this.url.split(":")[0].toLowerCase(),n=e.split(":")[0].toLowerCase();q(this.method==="GET"&&(t!=="https"||n!=="http")&&e.match(/^https?:/),"unsupported redirect","UNSUPPORTED_OPERATION",{operation:`redirect(${this.method} ${JSON.stringify(this.url)} => ${JSON.stringify(e)})`});const s=new Zu(e);return s.method="GET",s.allowGzip=this.allowGzip,s.timeout=this.timeout,P(s,Nr,Object.assign({},y(this,Nr))),y(this,Xe)&&P(s,Xe,new Uint8Array(y(this,Xe))),P(s,tr,y(this,tr)),s}clone(){const e=new Zu(this.url);return P(e,Un,y(this,Un)),y(this,Xe)&&P(e,Xe,y(this,Xe)),P(e,tr,y(this,tr)),P(e,Nr,Object.assign({},y(this,Nr))),P(e,kn,y(this,kn)),this.allowGzip&&(e.allowGzip=!0),e.timeout=this.timeout,this.allowInsecureAuthentication&&(e.allowInsecureAuthentication=!0),P(e,Pi,y(this,Pi)),P(e,Oi,y(this,Oi)),P(e,Di,y(this,Di)),P(e,Rr,Object.assign({},y(this,Rr))),P(e,Ps,y(this,Ps)),e}static lockConfig(){Mh=!0}static getGateway(e){return Cl[e.toLowerCase()]||null}static registerGateway(e,t){if(e=e.toLowerCase(),e==="http"||e==="https")throw new Error(`cannot intercept ${e}; use registerGetUrl`);if(Mh)throw new Error("gateways locked");Cl[e]=t}static registerGetUrl(e){if(Mh)throw new Error("gateways locked");Wg=e}static createGetUrlFunc(e){return Cb(e)}static createDataGateway(){return Bb}static createIpfsGatewayFunc(e){return _b(e)}};Ko=new WeakMap,Go=new WeakMap,Nr=new WeakMap,Un=new WeakMap,Qo=new WeakMap,Wo=new WeakMap,Xe=new WeakMap,tr=new WeakMap,kn=new WeakMap,Pi=new WeakMap,Oi=new WeakMap,Di=new WeakMap,tn=new WeakMap,Rr=new WeakMap,Ps=new WeakMap,Ci=new WeakSet,mc=async function(e,t,n,s,i){var u,h,f;if(e>=y(this,Rr).maxAttempts)return i.makeServerError("exceeded maximum retry limit");q(Jg()<=t,"timeout","TIMEOUT",{operation:"request.send",reason:"timeout",request:s}),n>0&&await qA(n);let o=this.clone();const a=(o.url.split(":")[0]||"").toLowerCase();if(a in Cl){const d=await Cl[a](o.url,Bl(y(s,tn)));if(d instanceof Hs){let p=d;if(this.processFunc){Bl(y(s,tn));try{p=await this.processFunc(o,p)}catch(g){(g.throttle==null||typeof g.stall!="number")&&p.makeServerError("error in post-processing function",g).assertOk()}}return p}o=d}this.preflightFunc&&(o=await this.preflightFunc(o));const c=await this.getUrlFunc(o,Bl(y(s,tn)));let l=new Hs(c.statusCode,c.statusMessage,c.headers,c.body,s);if(l.statusCode===301||l.statusCode===302){try{const d=l.headers.location||"";return K(u=o.redirect(d),Ci,mc).call(u,e+1,t,0,s,l)}catch{}return l}else if(l.statusCode===429&&(this.retryFunc==null||await this.retryFunc(o,l,e))){const d=l.headers["retry-after"];let p=y(this,Rr).slotInterval*Math.trunc(Math.random()*Math.pow(2,e));return typeof d=="string"&&d.match(/^[1-9][0-9]*$/)&&(p=parseInt(d)),K(h=o.clone(),Ci,mc).call(h,e+1,t,p,s,l)}if(this.processFunc){Bl(y(s,tn));try{l=await this.processFunc(o,l)}catch(d){(d.throttle==null||typeof d.stall!="number")&&l.makeServerError("error in post-processing function",d).assertOk();let p=y(this,Rr).slotInterval*Math.trunc(Math.random()*Math.pow(2,e));return d.stall>=0&&(p=d.stall),K(f=o.clone(),Ci,mc).call(f,e+1,t,p,s,l)}}return l};let Ks=Zu;var Yc,Zc,Xc,rr,Jo,Bi;const Rg=class Rg{constructor(e,t,n,s,i){M(this,Yc);M(this,Zc);M(this,Xc);M(this,rr);M(this,Jo);M(this,Bi);P(this,Yc,e),P(this,Zc,t),P(this,Xc,Object.keys(n).reduce((o,a)=>(o[a.toLowerCase()]=String(n[a]),o),{})),P(this,rr,s==null?null:new Uint8Array(s)),P(this,Jo,i||null),P(this,Bi,{message:""})}toString(){return`<FetchResponse status=${this.statusCode} body=${y(this,rr)?X(y(this,rr)):"null"}>`}get statusCode(){return y(this,Yc)}get statusMessage(){return y(this,Zc)}get headers(){return Object.assign({},y(this,Xc))}get body(){return y(this,rr)==null?null:new Uint8Array(y(this,rr))}get bodyText(){try{return y(this,rr)==null?"":Au(y(this,rr))}catch{q(!1,"response body is not valid UTF-8 data","UNSUPPORTED_OPERATION",{operation:"bodyText",info:{response:this}})}}get bodyJson(){try{return JSON.parse(this.bodyText)}catch{q(!1,"response body is not valid JSON","UNSUPPORTED_OPERATION",{operation:"bodyJson",info:{response:this}})}}[Symbol.iterator](){const e=this.headers,t=Object.keys(e);let n=0;return{next:()=>{if(n<t.length){const s=t[n++];return{value:[s,e[s]],done:!1}}return{value:void 0,done:!0}}}}makeServerError(e,t){let n;e?n=`CLIENT ESCALATED SERVER ERROR (${this.statusCode} ${this.statusMessage}; ${e})`:(e=`${this.statusCode} ${this.statusMessage}`,n=`CLIENT ESCALATED SERVER ERROR (${e})`);const s=new Rg(599,n,this.headers,this.body,y(this,Jo)||void 0);return P(s,Bi,{message:e,error:t}),s}throwThrottleError(e,t){t==null?t=-1:R(Number.isInteger(t)&&t>=0,"invalid stall timeout","stall",t);const n=new Error(e||"throttling requests");throw ie(n,{stall:t,throttle:!0}),n}getHeader(e){return this.headers[e.toLowerCase()]}hasBody(){return y(this,rr)!=null}get request(){return y(this,Jo)}ok(){return y(this,Bi).message===""&&this.statusCode>=200&&this.statusCode<300}assertOk(){if(this.ok())return;let{message:e,error:t}=y(this,Bi);e===""&&(e=`server response ${this.statusCode} ${this.statusMessage}`);let n=null;this.request&&(n=this.request.url);let s=null;try{y(this,rr)&&(s=Au(y(this,rr)))}catch{}q(!1,e,"SERVER_ERROR",{request:this.request||"unknown request",response:this,error:t,info:{requestUrl:n,responseBody:s,responseStatus:`${this.statusCode} ${this.statusMessage}`}})}};Yc=new WeakMap,Zc=new WeakMap,Xc=new WeakMap,rr=new WeakMap,Jo=new WeakMap,Bi=new WeakMap;let Hs=Rg;function Jg(){return new Date().getTime()}function HA(r){return Wn(r.replace(/%([0-9a-f][0-9a-f])/gi,(e,t)=>String.fromCharCode(parseInt(t,16))))}function qA(r){return new Promise(e=>setTimeout(e,r))}const VA=BigInt(-1),Cr=BigInt(0),Co=BigInt(1),KA=BigInt(5),uo={};let Lo="0000";for(;Lo.length<80;)Lo+=Lo;function Xs(r){let e=Lo;for(;e.length<r;)e+=e;return BigInt("1"+e.substring(0,r))}function Ja(r,e,t){const n=BigInt(e.width);if(e.signed){const s=Co<<n-Co;q(t==null||r>=-s&&r<s,"overflow","NUMERIC_FAULT",{operation:t,fault:"overflow",value:r}),r>Cr?r=Eu(mi(r,n),n):r=-Eu(mi(-r,n),n)}else{const s=Co<<n;q(t==null||r>=0&&r<s,"overflow","NUMERIC_FAULT",{operation:t,fault:"overflow",value:r}),r=(r%s+s)%s&s-Co}return r}function jh(r){typeof r=="number"&&(r=`fixed128x${r}`);let e=!0,t=128,n=18;if(typeof r=="string"){if(r!=="fixed")if(r==="ufixed")e=!1;else{const i=r.match(/^(u?)fixed([0-9]+)x([0-9]+)$/);R(i,"invalid fixed format","format",r),e=i[1]!=="u",t=parseInt(i[2]),n=parseInt(i[3])}}else if(r){const i=r,o=(a,c,l)=>i[a]==null?l:(R(typeof i[a]===c,"invalid fixed format ("+a+" not "+c+")","format."+a,i[a]),i[a]);e=o("signed","boolean",e),t=o("width","number",t),n=o("decimals","number",n)}R(t%8===0,"invalid FixedNumber width (not byte aligned)","format.width",t),R(n<=80,"invalid FixedNumber decimals (too large)","format.decimals",n);const s=(e?"":"u")+"fixed"+String(t)+"x"+String(n);return{signed:e,width:t,decimals:n,name:s}}function GA(r,e){let t="";r<Cr&&(t="-",r*=VA);let n=r.toString();if(e===0)return t+n;for(;n.length<=e;)n=Lo+n;const s=n.length-e;for(n=n.substring(0,s)+"."+n.substring(s);n[0]==="0"&&n[1]!==".";)n=n.substring(1);for(;n[n.length-1]==="0"&&n[n.length-2]!==".";)n=n.substring(0,n.length-1);return t+n}var Ur,Ie,St,Ee,ii,Dn,nd,sd,id,od;const As=class As{constructor(e,t,n){M(this,Ee);F(this,"format");M(this,Ur);M(this,Ie);M(this,St);F(this,"_value");ll(e,uo,"FixedNumber"),P(this,Ie,t),P(this,Ur,n);const s=GA(t,n.decimals);ie(this,{format:n.name,_value:s}),P(this,St,Xs(n.decimals))}get signed(){return y(this,Ur).signed}get width(){return y(this,Ur).width}get decimals(){return y(this,Ur).decimals}get value(){return y(this,Ie)}addUnsafe(e){return K(this,Ee,nd).call(this,e)}add(e){return K(this,Ee,nd).call(this,e,"add")}subUnsafe(e){return K(this,Ee,sd).call(this,e)}sub(e){return K(this,Ee,sd).call(this,e,"sub")}mulUnsafe(e){return K(this,Ee,id).call(this,e)}mul(e){return K(this,Ee,id).call(this,e,"mul")}mulSignal(e){K(this,Ee,ii).call(this,e);const t=y(this,Ie)*y(e,Ie);return q(t%y(this,St)===Cr,"precision lost during signalling mul","NUMERIC_FAULT",{operation:"mulSignal",fault:"underflow",value:this}),K(this,Ee,Dn).call(this,t/y(this,St),"mulSignal")}divUnsafe(e){return K(this,Ee,od).call(this,e)}div(e){return K(this,Ee,od).call(this,e,"div")}divSignal(e){q(y(e,Ie)!==Cr,"division by zero","NUMERIC_FAULT",{operation:"div",fault:"divide-by-zero",value:this}),K(this,Ee,ii).call(this,e);const t=y(this,Ie)*y(this,St);return q(t%y(e,Ie)===Cr,"precision lost during signalling div","NUMERIC_FAULT",{operation:"divSignal",fault:"underflow",value:this}),K(this,Ee,Dn).call(this,t/y(e,Ie),"divSignal")}cmp(e){let t=this.value,n=e.value;const s=this.decimals-e.decimals;return s>0?n*=Xs(s):s<0&&(t*=Xs(-s)),t<n?-1:t>n?1:0}eq(e){return this.cmp(e)===0}lt(e){return this.cmp(e)<0}lte(e){return this.cmp(e)<=0}gt(e){return this.cmp(e)>0}gte(e){return this.cmp(e)>=0}floor(){let e=y(this,Ie);return y(this,Ie)<Cr&&(e-=y(this,St)-Co),e=y(this,Ie)/y(this,St)*y(this,St),K(this,Ee,Dn).call(this,e,"floor")}ceiling(){let e=y(this,Ie);return y(this,Ie)>Cr&&(e+=y(this,St)-Co),e=y(this,Ie)/y(this,St)*y(this,St),K(this,Ee,Dn).call(this,e,"ceiling")}round(e){if(e==null&&(e=0),e>=this.decimals)return this;const t=this.decimals-e,n=KA*Xs(t-1);let s=this.value+n;const i=Xs(t);return s=s/i*i,Ja(s,y(this,Ur),"round"),new As(uo,s,y(this,Ur))}isZero(){return y(this,Ie)===Cr}isNegative(){return y(this,Ie)<Cr}toString(){return this._value}toUnsafeFloat(){return parseFloat(this.toString())}toFormat(e){return As.fromString(this.toString(),e)}static fromValue(e,t,n){const s=t==null?0:ce(t),i=jh(n);let o=re(e,"value");const a=s-i.decimals;if(a>0){const c=Xs(a);q(o%c===Cr,"value loses precision for format","NUMERIC_FAULT",{operation:"fromValue",fault:"underflow",value:e}),o/=c}else a<0&&(o*=Xs(-a));return Ja(o,i,"fromValue"),new As(uo,o,i)}static fromString(e,t){const n=e.match(/^(-?)([0-9]*)\.?([0-9]*)$/);R(n&&n[2].length+n[3].length>0,"invalid FixedNumber string value","value",e);const s=jh(t);let i=n[2]||"0",o=n[3]||"";for(;o.length<s.decimals;)o+=Lo;q(o.substring(s.decimals).match(/^0*$/),"too many decimals for format","NUMERIC_FAULT",{operation:"fromString",fault:"underflow",value:e}),o=o.substring(0,s.decimals);const a=BigInt(n[1]+i+o);return Ja(a,s,"fromString"),new As(uo,a,s)}static fromBytes(e,t){let n=ah(ue(e,"value"));const s=jh(t);return s.signed&&(n=Eu(n,s.width)),Ja(n,s,"fromBytes"),new As(uo,n,s)}};Ur=new WeakMap,Ie=new WeakMap,St=new WeakMap,Ee=new WeakSet,ii=function(e){R(this.format===e.format,"incompatible format; use fixedNumber.toFormat","other",e)},Dn=function(e,t){return e=Ja(e,y(this,Ur),t),new As(uo,e,y(this,Ur))},nd=function(e,t){return K(this,Ee,ii).call(this,e),K(this,Ee,Dn).call(this,y(this,Ie)+y(e,Ie),t)},sd=function(e,t){return K(this,Ee,ii).call(this,e),K(this,Ee,Dn).call(this,y(this,Ie)-y(e,Ie),t)},id=function(e,t){return K(this,Ee,ii).call(this,e),K(this,Ee,Dn).call(this,y(this,Ie)*y(e,Ie)/y(this,St),t)},od=function(e,t){return q(y(e,Ie)!==Cr,"division by zero","NUMERIC_FAULT",{operation:"div",fault:"divide-by-zero",value:this}),K(this,Ee,ii).call(this,e),K(this,Ee,Dn).call(this,y(this,Ie)*y(this,St)/y(e,Ie),t)};let rd=As;function QA(r){let e=r.toString(16);for(;e.length<2;)e="0"+e;return"0x"+e}function Yg(r,e,t){let n=0;for(let s=0;s<t;s++)n=n*256+r[e+s];return n}function Zg(r,e,t,n){const s=[];for(;t<e+1+n;){const i=Nb(r,t);s.push(i.result),t+=i.consumed,q(t<=e+1+n,"child data too short","BUFFER_OVERRUN",{buffer:r,length:n,offset:e})}return{consumed:1+n,result:s}}function Nb(r,e){q(r.length!==0,"data too short","BUFFER_OVERRUN",{buffer:r,length:0,offset:1});const t=n=>{q(n<=r.length,"data short segment too short","BUFFER_OVERRUN",{buffer:r,length:r.length,offset:n})};if(r[e]>=248){const n=r[e]-247;t(e+1+n);const s=Yg(r,e+1,n);return t(e+1+n+s),Zg(r,e,e+1+n,n+s)}else if(r[e]>=192){const n=r[e]-192;return t(e+1+n),Zg(r,e,e+1,n)}else if(r[e]>=184){const n=r[e]-183;t(e+1+n);const s=Yg(r,e+1,n);t(e+1+n+s);const i=X(r.slice(e+1+n,e+1+n+s));return{consumed:1+n+s,result:i}}else if(r[e]>=128){const n=r[e]-128;t(e+1+n);const s=X(r.slice(e+1,e+1+n));return{consumed:1+n,result:s}}return{consumed:1,result:QA(r[e])}}function ul(r){const e=ue(r,"data"),t=Nb(e,0);return R(t.consumed===e.length,"unexpected junk after rlp payload","data",r),t.result}function Xg(r){const e=[];for(;r;)e.unshift(r&255),r>>=8;return e}function Rb(r){if(Array.isArray(r)){let n=[];if(r.forEach(function(i){n=n.concat(Rb(i))}),n.length<=55)return n.unshift(192+n.length),n;const s=Xg(n.length);return s.unshift(247+s.length),s.concat(n)}const e=Array.prototype.slice.call(ue(r,"object"));if(e.length===1&&e[0]<=127)return e;if(e.length<=55)return e.unshift(128+e.length),e;const t=Xg(e.length);return t.unshift(183+t.length),t.concat(e)}const ey="0123456789abcdef";function Gs(r){let e="0x";for(const t of Rb(r))e+=ey[t>>4],e+=ey[t&15];return e}function WA(r,e){let t=18;return t=ce(e,"unit"),rd.fromValue(r,t,{decimals:t,width:512}).toString()}function JA(r){return WA(r,18)}const Ct=32,ad=new Uint8Array(Ct),YA=["then"],_l={},Ub=new WeakMap;function li(r){return Ub.get(r)}function ty(r,e){Ub.set(r,e)}function Ya(r,e){const t=new Error(`deferred error during ABI decoding triggered accessing ${r}`);throw t.error=e,t}function cd(r,e,t){return r.indexOf(null)>=0?e.map((n,s)=>n instanceof _a?cd(li(n),n,t):n):r.reduce((n,s,i)=>{let o=e.getValue(s);return s in n||(t&&o instanceof _a&&(o=cd(li(o),o,t)),n[s]=o),n},{})}var Yo;const Ro=class Ro extends Array{constructor(...t){const n=t[0];let s=t[1],i=(t[2]||[]).slice(),o=!0;n!==_l&&(s=t,i=[],o=!1);super(s.length);M(this,Yo);s.forEach((l,u)=>{this[u]=l});const a=i.reduce((l,u)=>(typeof u=="string"&&l.set(u,(l.get(u)||0)+1),l),new Map);if(ty(this,Object.freeze(s.map((l,u)=>{const h=i[u];return h!=null&&a.get(h)===1?h:null}))),P(this,Yo,[]),y(this,Yo)==null&&y(this,Yo),!o)return;Object.freeze(this);const c=new Proxy(this,{get:(l,u,h)=>{if(typeof u=="string"){if(u.match(/^[0-9]+$/)){const d=ce(u,"%index");if(d<0||d>=this.length)throw new RangeError("out of result range");const p=l[d];return p instanceof Error&&Ya(`index ${d}`,p),p}if(YA.indexOf(u)>=0)return Reflect.get(l,u,h);const f=l[u];if(f instanceof Function)return function(...d){return f.apply(this===h?l:this,d)};if(!(u in l))return l.getValue.apply(this===h?l:this,[u])}return Reflect.get(l,u,h)}});return ty(c,li(this)),c}toArray(t){const n=[];return this.forEach((s,i)=>{s instanceof Error&&Ya(`index ${i}`,s),t&&s instanceof Ro&&(s=s.toArray(t)),n.push(s)}),n}toObject(t){const n=li(this);return n.reduce((s,i,o)=>(q(i!=null,`value at index ${o} unnamed`,"UNSUPPORTED_OPERATION",{operation:"toObject()"}),cd(n,this,t)),{})}slice(t,n){t==null&&(t=0),t<0&&(t+=this.length,t<0&&(t=0)),n==null&&(n=this.length),n<0&&(n+=this.length,n<0&&(n=0)),n>this.length&&(n=this.length);const s=li(this),i=[],o=[];for(let a=t;a<n;a++)i.push(this[a]),o.push(s[a]);return new Ro(_l,i,o)}filter(t,n){const s=li(this),i=[],o=[];for(let a=0;a<this.length;a++){const c=this[a];c instanceof Error&&Ya(`index ${a}`,c),t.call(n,c,a,this)&&(i.push(c),o.push(s[a]))}return new Ro(_l,i,o)}map(t,n){const s=[];for(let i=0;i<this.length;i++){const o=this[i];o instanceof Error&&Ya(`index ${i}`,o),s.push(t.call(n,o,i,this))}return s}getValue(t){const n=li(this).indexOf(t);if(n===-1)return;const s=this[n];return s instanceof Error&&Ya(`property ${JSON.stringify(t)}`,s.error),s}static fromItems(t,n){return new Ro(_l,t,n)}};Yo=new WeakMap;let _a=Ro;function ry(r){let e=Je(r);return q(e.length<=Ct,"value out-of-bounds","BUFFER_OVERRUN",{buffer:e,length:Ct,offset:e.length}),e.length!==Ct&&(e=Dt($e([ad.slice(e.length%Ct),e]))),e}class ss{constructor(e,t,n,s){F(this,"name");F(this,"type");F(this,"localName");F(this,"dynamic");ie(this,{name:e,type:t,localName:n,dynamic:s},{name:"string",type:"string",localName:"string",dynamic:"boolean"})}_throwError(e,t){R(!1,e,this.localName,t)}}var $n,_i,Zo,su;class ld{constructor(){M(this,Zo);M(this,$n);M(this,_i);P(this,$n,[]),P(this,_i,0)}get data(){return $e(y(this,$n))}get length(){return y(this,_i)}appendWriter(e){return K(this,Zo,su).call(this,Dt(e.data))}writeBytes(e){let t=Dt(e);const n=t.length%Ct;return n&&(t=Dt($e([t,ad.slice(n)]))),K(this,Zo,su).call(this,t)}writeValue(e){return K(this,Zo,su).call(this,ry(e))}writeUpdatableValue(){const e=y(this,$n).length;return y(this,$n).push(ad),P(this,_i,y(this,_i)+Ct),t=>{y(this,$n)[e]=ry(t)}}}$n=new WeakMap,_i=new WeakMap,Zo=new WeakSet,su=function(e){return y(this,$n).push(e),P(this,_i,y(this,_i)+e.length),e.length};var Ft,nr,Ti,Ni,Os,to,hd,kb;const Ug=class Ug{constructor(e,t,n){M(this,to);F(this,"allowLoose");M(this,Ft);M(this,nr);M(this,Ti);M(this,Ni);M(this,Os);ie(this,{allowLoose:!!t}),P(this,Ft,Dt(e)),P(this,Ti,0),P(this,Ni,null),P(this,Os,n??1024),P(this,nr,0)}get data(){return X(y(this,Ft))}get dataLength(){return y(this,Ft).length}get consumed(){return y(this,nr)}get bytes(){return new Uint8Array(y(this,Ft))}subReader(e){const t=new Ug(y(this,Ft).slice(y(this,nr)+e),this.allowLoose,y(this,Os));return P(t,Ni,this),t}readBytes(e,t){let n=K(this,to,kb).call(this,0,e,!!t);return K(this,to,hd).call(this,e),P(this,nr,y(this,nr)+n.length),n.slice(0,e)}readValue(){return ah(this.readBytes(Ct))}readIndex(){return CA(this.readBytes(Ct))}};Ft=new WeakMap,nr=new WeakMap,Ti=new WeakMap,Ni=new WeakMap,Os=new WeakMap,to=new WeakSet,hd=function(e){var t;if(y(this,Ni))return K(t=y(this,Ni),to,hd).call(t,e);P(this,Ti,y(this,Ti)+e),q(y(this,Os)<1||y(this,Ti)<=y(this,Os)*this.dataLength,`compressed ABI data exceeds inflation ratio of ${y(this,Os)} ( see: https://github.com/ethers-io/ethers.js/issues/4537 )`,"BUFFER_OVERRUN",{buffer:Dt(y(this,Ft)),offset:y(this,nr),length:e,info:{bytesRead:y(this,Ti),dataLength:this.dataLength}})},kb=function(e,t,n){let s=Math.ceil(t/Ct)*Ct;return y(this,nr)+s>y(this,Ft).length&&(this.allowLoose&&n&&y(this,nr)+t<=y(this,Ft).length?s=t:q(!1,"data out-of-bounds","BUFFER_OVERRUN",{buffer:Dt(y(this,Ft)),length:y(this,Ft).length,offset:y(this,nr)+s})),y(this,Ft).slice(y(this,nr),y(this,nr)+s)};let ud=Ug;function xu(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`Wrong positive integer: ${r}`)}function $p(r,...e){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(r.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${r.length}`)}function ZA(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");xu(r.outputLen),xu(r.blockLen)}function Ta(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function $b(r,e){$p(r);const t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}const zh=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Lb=r=>r instanceof Uint8Array,XA=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),Hh=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),Kr=(r,e)=>r<<32-e|r>>>e,ex=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!ex)throw new Error("Non little-endian hardware is not supported");function tx(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function ch(r){if(typeof r=="string"&&(r=tx(r)),!Lb(r))throw new Error(`expected Uint8Array, got ${typeof r}`);return r}function rx(...r){const e=new Uint8Array(r.reduce((n,s)=>n+s.length,0));let t=0;return r.forEach(n=>{if(!Lb(n))throw new Error("Uint8Array expected");e.set(n,t),t+=n.length}),e}let Lp=class{clone(){return this._cloneInto()}};function Fp(r){const e=n=>r().update(ch(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function nx(r=32){if(zh&&typeof zh.getRandomValues=="function")return zh.getRandomValues(new Uint8Array(r));throw new Error("crypto.getRandomValues must be defined")}class Fb extends Lp{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,ZA(e);const n=ch(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,i=new Uint8Array(s);i.set(n.length>s?e.create().update(n).digest():n);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),i.fill(0)}update(e){return Ta(this),this.iHash.update(e),this}digestInto(e){Ta(this),$p(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:s,destroyed:i,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=i,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Mb=(r,e,t)=>new Fb(r,e).update(t).digest();Mb.create=(r,e)=>new Fb(r,e);function sx(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(t>>s&i),a=Number(t&i),c=n?4:0,l=n?0:4;r.setUint32(e+c,o,n),r.setUint32(e+l,a,n)}class jb extends Lp{constructor(e,t,n,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Hh(this.buffer)}update(e){Ta(this);const{view:t,buffer:n,blockLen:s}=this;e=ch(e);const i=e.length;for(let o=0;o<i;){const a=Math.min(s-this.pos,i-o);if(a===s){const c=Hh(e);for(;s<=i-o;o+=s)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Ta(this),$b(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:s,isLE:i}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(n,0),o=0);for(let h=o;h<s;h++)t[h]=0;sx(n,s-8,BigInt(this.length*8),i),this.process(n,0);const a=Hh(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return e.length=s,e.pos=a,e.finished=i,e.destroyed=o,s%t&&e.buffer.set(n),e}}const ix=(r,e,t)=>r&e^~r&t,ox=(r,e,t)=>r&e^r&t^e&t,ax=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),is=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),os=new Uint32Array(64);class cx extends jb{constructor(){super(64,32,8,!1),this.A=is[0]|0,this.B=is[1]|0,this.C=is[2]|0,this.D=is[3]|0,this.E=is[4]|0,this.F=is[5]|0,this.G=is[6]|0,this.H=is[7]|0}get(){const{A:e,B:t,C:n,D:s,E:i,F:o,G:a,H:c}=this;return[e,t,n,s,i,o,a,c]}set(e,t,n,s,i,o,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let h=0;h<16;h++,t+=4)os[h]=e.getUint32(t,!1);for(let h=16;h<64;h++){const f=os[h-15],d=os[h-2],p=Kr(f,7)^Kr(f,18)^f>>>3,g=Kr(d,17)^Kr(d,19)^d>>>10;os[h]=g+os[h-7]+p+os[h-16]|0}let{A:n,B:s,C:i,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){const f=Kr(a,6)^Kr(a,11)^Kr(a,25),d=u+f+ix(a,c,l)+ax[h]+os[h]|0,g=(Kr(n,2)^Kr(n,13)^Kr(n,22))+ox(n,s,i)|0;u=l,l=c,c=a,a=o+d|0,o=i,i=s,s=n,n=d+g|0}n=n+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(n,s,i,o,a,c,l,u)}roundClean(){os.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const zb=Fp(()=>new cx),Tl=BigInt(2**32-1),fd=BigInt(32);function Hb(r,e=!1){return e?{h:Number(r&Tl),l:Number(r>>fd&Tl)}:{h:Number(r>>fd&Tl)|0,l:Number(r&Tl)|0}}function qb(r,e=!1){let t=new Uint32Array(r.length),n=new Uint32Array(r.length);for(let s=0;s<r.length;s++){const{h:i,l:o}=Hb(r[s],e);[t[s],n[s]]=[i,o]}return[t,n]}const lx=(r,e)=>BigInt(r>>>0)<<fd|BigInt(e>>>0),ux=(r,e,t)=>r>>>t,hx=(r,e,t)=>r<<32-t|e>>>t,fx=(r,e,t)=>r>>>t|e<<32-t,dx=(r,e,t)=>r<<32-t|e>>>t,px=(r,e,t)=>r<<64-t|e>>>t-32,gx=(r,e,t)=>r>>>t-32|e<<64-t,yx=(r,e)=>e,mx=(r,e)=>r,Vb=(r,e,t)=>r<<t|e>>>32-t,Kb=(r,e,t)=>e<<t|r>>>32-t,Gb=(r,e,t)=>e<<t-32|r>>>64-t,Qb=(r,e,t)=>r<<t-32|e>>>64-t;function wx(r,e,t,n){const s=(e>>>0)+(n>>>0);return{h:r+t+(s/2**32|0)|0,l:s|0}}const bx=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),vx=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,Ex=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),Ax=(r,e,t,n,s)=>e+t+n+s+(r/2**32|0)|0,xx=(r,e,t,n,s)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(s>>>0),Ix=(r,e,t,n,s,i)=>e+t+n+s+i+(r/2**32|0)|0,oe={fromBig:Hb,split:qb,toBig:lx,shrSH:ux,shrSL:hx,rotrSH:fx,rotrSL:dx,rotrBH:px,rotrBL:gx,rotr32H:yx,rotr32L:mx,rotlSH:Vb,rotlSL:Kb,rotlBH:Gb,rotlBL:Qb,add:wx,add3L:bx,add3H:vx,add4L:Ex,add4H:Ax,add5H:Ix,add5L:xx},[Sx,Px]=oe.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),as=new Uint32Array(80),cs=new Uint32Array(80);class Ox extends jb{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:n,Bl:s,Ch:i,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:f,Gh:d,Gl:p,Hh:g,Hl:m}=this;return[e,t,n,s,i,o,a,c,l,u,h,f,d,p,g,m]}set(e,t,n,s,i,o,a,c,l,u,h,f,d,p,g,m){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=f|0,this.Gh=d|0,this.Gl=p|0,this.Hh=g|0,this.Hl=m|0}process(e,t){for(let v=0;v<16;v++,t+=4)as[v]=e.getUint32(t),cs[v]=e.getUint32(t+=4);for(let v=16;v<80;v++){const S=as[v-15]|0,I=cs[v-15]|0,A=oe.rotrSH(S,I,1)^oe.rotrSH(S,I,8)^oe.shrSH(S,I,7),O=oe.rotrSL(S,I,1)^oe.rotrSL(S,I,8)^oe.shrSL(S,I,7),D=as[v-2]|0,B=cs[v-2]|0,L=oe.rotrSH(D,B,19)^oe.rotrBH(D,B,61)^oe.shrSH(D,B,6),j=oe.rotrSL(D,B,19)^oe.rotrBL(D,B,61)^oe.shrSL(D,B,6),$=oe.add4L(O,j,cs[v-7],cs[v-16]),U=oe.add4H($,A,L,as[v-7],as[v-16]);as[v]=U|0,cs[v]=$|0}let{Ah:n,Al:s,Bh:i,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:f,Fh:d,Fl:p,Gh:g,Gl:m,Hh:b,Hl:x}=this;for(let v=0;v<80;v++){const S=oe.rotrSH(h,f,14)^oe.rotrSH(h,f,18)^oe.rotrBH(h,f,41),I=oe.rotrSL(h,f,14)^oe.rotrSL(h,f,18)^oe.rotrBL(h,f,41),A=h&d^~h&g,O=f&p^~f&m,D=oe.add5L(x,I,O,Px[v],cs[v]),B=oe.add5H(D,b,S,A,Sx[v],as[v]),L=D|0,j=oe.rotrSH(n,s,28)^oe.rotrBH(n,s,34)^oe.rotrBH(n,s,39),$=oe.rotrSL(n,s,28)^oe.rotrBL(n,s,34)^oe.rotrBL(n,s,39),U=n&i^n&a^i&a,T=s&o^s&c^o&c;b=g|0,x=m|0,g=d|0,m=p|0,d=h|0,p=f|0,{h,l:f}=oe.add(l|0,u|0,B|0,L|0),l=a|0,u=c|0,a=i|0,c=o|0,i=n|0,o=s|0;const w=oe.add3L(L,$,T);n=oe.add3H(w,B,j,U),s=w|0}({h:n,l:s}=oe.add(this.Ah|0,this.Al|0,n|0,s|0)),{h:i,l:o}=oe.add(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=oe.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=oe.add(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:f}=oe.add(this.Eh|0,this.El|0,h|0,f|0),{h:d,l:p}=oe.add(this.Fh|0,this.Fl|0,d|0,p|0),{h:g,l:m}=oe.add(this.Gh|0,this.Gl|0,g|0,m|0),{h:b,l:x}=oe.add(this.Hh|0,this.Hl|0,b|0,x|0),this.set(n,s,i,o,a,c,l,u,h,f,d,p,g,m,b,x)}roundClean(){as.fill(0),cs.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const Dx=Fp(()=>new Ox);function Cx(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}const ny=Cx();ny.crypto||ny.msCrypto;function Bx(r){switch(r){case"sha256":return zb.create();case"sha512":return Dx.create()}R(!1,"invalid hashing algorithm name","algorithm",r)}const[Wb,Jb,Yb]=[[],[],[]],_x=BigInt(0),Za=BigInt(1),Tx=BigInt(2),Nx=BigInt(7),Rx=BigInt(256),Ux=BigInt(113);for(let r=0,e=Za,t=1,n=0;r<24;r++){[t,n]=[n,(2*t+3*n)%5],Wb.push(2*(5*n+t)),Jb.push((r+1)*(r+2)/2%64);let s=_x;for(let i=0;i<7;i++)e=(e<<Za^(e>>Nx)*Ux)%Rx,e&Tx&&(s^=Za<<(Za<<BigInt(i))-Za);Yb.push(s)}const[kx,$x]=qb(Yb,!0),sy=(r,e,t)=>t>32?Gb(r,e,t):Vb(r,e,t),iy=(r,e,t)=>t>32?Qb(r,e,t):Kb(r,e,t);function Lx(r,e=24){const t=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)t[o]=r[o]^r[o+10]^r[o+20]^r[o+30]^r[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=t[c],u=t[c+1],h=sy(l,u,1)^t[a],f=iy(l,u,1)^t[a+1];for(let d=0;d<50;d+=10)r[o+d]^=h,r[o+d+1]^=f}let s=r[2],i=r[3];for(let o=0;o<24;o++){const a=Jb[o],c=sy(s,i,a),l=iy(s,i,a),u=Wb[o];s=r[u],i=r[u+1],r[u]=c,r[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)t[a]=r[o+a];for(let a=0;a<10;a++)r[o+a]^=~t[(a+2)%10]&t[(a+4)%10]}r[0]^=kx[n],r[1]^=$x[n]}t.fill(0)}let Fx=class Zb extends Lp{constructor(e,t,n,s=!1,i=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=n,this.enableXOF=s,this.rounds=i,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,xu(n),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=XA(this.state)}keccak(){Lx(this.state32,this.rounds),this.posOut=0,this.pos=0}update(e){Ta(this);const{blockLen:t,state:n}=this;e=ch(e);const s=e.length;for(let i=0;i<s;){const o=Math.min(t-this.pos,s-i);for(let a=0;a<o;a++)n[this.pos++]^=e[i++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:n,blockLen:s}=this;e[n]^=t,(t&128)!==0&&n===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){Ta(this,!1),$p(e),this.finish();const t=this.state,{blockLen:n}=this;for(let s=0,i=e.length;s<i;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,i-s);e.set(t.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return xu(e),this.xofInto(new Uint8Array(e))}digestInto(e){if($b(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:n,outputLen:s,rounds:i,enableXOF:o}=this;return e||(e=new Zb(t,n,s,o,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=n,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}};const Mx=(r,e,t)=>Fp(()=>new Fx(e,r,t)),jx=Mx(1,136,256/8);let Xb=!1;const e1=function(r){return jx(r)};let t1=e1;function Ke(r){const e=ue(r,"data");return X(t1(e))}Ke._=e1;Ke.lock=function(){Xb=!0};Ke.register=function(r){if(Xb)throw new TypeError("keccak256 is locked");t1=r};Object.freeze(Ke);const r1=function(r){return Bx("sha256").update(r).digest()};let n1=r1,s1=!1;function za(r){const e=ue(r,"data");return X(n1(e))}za._=r1;za.lock=function(){s1=!0};za.register=function(r){if(s1)throw new Error("sha256 is locked");n1=r};Object.freeze(za);Object.freeze(za);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const i1=BigInt(0),lh=BigInt(1),zx=BigInt(2),uh=r=>r instanceof Uint8Array,Hx=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function Na(r){if(!uh(r))throw new Error("Uint8Array expected");let e="";for(let t=0;t<r.length;t++)e+=Hx[r[t]];return e}function o1(r){const e=r.toString(16);return e.length&1?`0${e}`:e}function Mp(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return BigInt(r===""?"0":`0x${r}`)}function Ra(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);const e=r.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const t=new Uint8Array(e/2);for(let n=0;n<t.length;n++){const s=n*2,i=r.slice(s,s+2),o=Number.parseInt(i,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");t[n]=o}return t}function Vi(r){return Mp(Na(r))}function jp(r){if(!uh(r))throw new Error("Uint8Array expected");return Mp(Na(Uint8Array.from(r).reverse()))}function Ua(r,e){return Ra(r.toString(16).padStart(e*2,"0"))}function zp(r,e){return Ua(r,e).reverse()}function qx(r){return Ra(o1(r))}function Tr(r,e,t){let n;if(typeof e=="string")try{n=Ra(e)}catch(i){throw new Error(`${r} must be valid hex string, got "${e}". Cause: ${i}`)}else if(uh(e))n=Uint8Array.from(e);else throw new Error(`${r} must be hex string or Uint8Array`);const s=n.length;if(typeof t=="number"&&s!==t)throw new Error(`${r} expected ${t} bytes, got ${s}`);return n}function Rc(...r){const e=new Uint8Array(r.reduce((n,s)=>n+s.length,0));let t=0;return r.forEach(n=>{if(!uh(n))throw new Error("Uint8Array expected");e.set(n,t),t+=n.length}),e}function Vx(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function Kx(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function Gx(r){let e;for(e=0;r>i1;r>>=lh,e+=1);return e}function Qx(r,e){return r>>BigInt(e)&lh}const Wx=(r,e,t)=>r|(t?lh:i1)<<BigInt(e),Hp=r=>(zx<<BigInt(r-1))-lh,qh=r=>new Uint8Array(r),oy=r=>Uint8Array.from(r);function a1(r,e,t){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let n=qh(r),s=qh(r),i=0;const o=()=>{n.fill(1),s.fill(0),i=0},a=(...h)=>t(s,n,...h),c=(h=qh())=>{s=a(oy([0]),h),n=a(),h.length!==0&&(s=a(oy([1]),h),n=a())},l=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const f=[];for(;h<e;){n=a();const d=n.slice();f.push(d),h+=n.length}return Rc(...f)};return(h,f)=>{o(),c(h);let d;for(;!(d=f(l()));)c();return o(),d}}const Jx={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||r instanceof Uint8Array,isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function hl(r,e,t={}){const n=(s,i,o)=>{const a=Jx[i];if(typeof a!="function")throw new Error(`Invalid validator "${i}", expected function`);const c=r[s];if(!(o&&c===void 0)&&!a(c,r))throw new Error(`Invalid param ${String(s)}=${c} (${typeof c}), expected ${i}`)};for(const[s,i]of Object.entries(e))n(s,i,!1);for(const[s,i]of Object.entries(t))n(s,i,!0);return r}const Yx=Object.freeze(Object.defineProperty({__proto__:null,bitGet:Qx,bitLen:Gx,bitMask:Hp,bitSet:Wx,bytesToHex:Na,bytesToNumberBE:Vi,bytesToNumberLE:jp,concatBytes:Rc,createHmacDrbg:a1,ensureBytes:Tr,equalBytes:Vx,hexToBytes:Ra,hexToNumber:Mp,numberToBytesBE:Ua,numberToBytesLE:zp,numberToHexUnpadded:o1,numberToVarBytesBE:qx,utf8ToBytes:Kx,validateObject:hl},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const tt=BigInt(0),Me=BigInt(1),ui=BigInt(2),Zx=BigInt(3),dd=BigInt(4),ay=BigInt(5),cy=BigInt(8);BigInt(9);BigInt(16);function jt(r,e){const t=r%e;return t>=tt?t:e+t}function Xx(r,e,t){if(t<=tt||e<tt)throw new Error("Expected power/modulo > 0");if(t===Me)return tt;let n=Me;for(;e>tt;)e&Me&&(n=n*r%t),r=r*r%t,e>>=Me;return n}function lr(r,e,t){let n=r;for(;e-- >tt;)n*=n,n%=t;return n}function pd(r,e){if(r===tt||e<=tt)throw new Error(`invert: expected positive integers, got n=${r} mod=${e}`);let t=jt(r,e),n=e,s=tt,i=Me;for(;t!==tt;){const a=n/t,c=n%t,l=s-i*a;n=t,t=c,s=i,i=l}if(n!==Me)throw new Error("invert: does not exist");return jt(s,e)}function eI(r){const e=(r-Me)/ui;let t,n,s;for(t=r-Me,n=0;t%ui===tt;t/=ui,n++);for(s=ui;s<r&&Xx(s,e,r)!==r-Me;s++);if(n===1){const o=(r+Me)/dd;return function(c,l){const u=c.pow(l,o);if(!c.eql(c.sqr(u),l))throw new Error("Cannot find square root");return u}}const i=(t+Me)/ui;return function(a,c){if(a.pow(c,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let l=n,u=a.pow(a.mul(a.ONE,s),t),h=a.pow(c,i),f=a.pow(c,t);for(;!a.eql(f,a.ONE);){if(a.eql(f,a.ZERO))return a.ZERO;let d=1;for(let g=a.sqr(f);d<l&&!a.eql(g,a.ONE);d++)g=a.sqr(g);const p=a.pow(u,Me<<BigInt(l-d-1));u=a.sqr(p),h=a.mul(h,p),f=a.mul(f,u),l=d}return h}}function tI(r){if(r%dd===Zx){const e=(r+Me)/dd;return function(n,s){const i=n.pow(s,e);if(!n.eql(n.sqr(i),s))throw new Error("Cannot find square root");return i}}if(r%cy===ay){const e=(r-ay)/cy;return function(n,s){const i=n.mul(s,ui),o=n.pow(i,e),a=n.mul(s,o),c=n.mul(n.mul(a,ui),o),l=n.mul(a,n.sub(c,n.ONE));if(!n.eql(n.sqr(l),s))throw new Error("Cannot find square root");return l}}return eI(r)}const rI=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function nI(r){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=rI.reduce((n,s)=>(n[s]="function",n),e);return hl(r,t)}function sI(r,e,t){if(t<tt)throw new Error("Expected power > 0");if(t===tt)return r.ONE;if(t===Me)return e;let n=r.ONE,s=e;for(;t>tt;)t&Me&&(n=r.mul(n,s)),s=r.sqr(s),t>>=Me;return n}function iI(r,e){const t=new Array(e.length),n=e.reduce((i,o,a)=>r.is0(o)?i:(t[a]=i,r.mul(i,o)),r.ONE),s=r.inv(n);return e.reduceRight((i,o,a)=>r.is0(o)?i:(t[a]=r.mul(i,t[a]),r.mul(i,o)),s),t}function c1(r,e){const t=e!==void 0?e:r.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}function oI(r,e,t=!1,n={}){if(r<=tt)throw new Error(`Expected Field ORDER > 0, got ${r}`);const{nBitLength:s,nByteLength:i}=c1(r,e);if(i>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=tI(r),a=Object.freeze({ORDER:r,BITS:s,BYTES:i,MASK:Hp(s),ZERO:tt,ONE:Me,create:c=>jt(c,r),isValid:c=>{if(typeof c!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof c}`);return tt<=c&&c<r},is0:c=>c===tt,isOdd:c=>(c&Me)===Me,neg:c=>jt(-c,r),eql:(c,l)=>c===l,sqr:c=>jt(c*c,r),add:(c,l)=>jt(c+l,r),sub:(c,l)=>jt(c-l,r),mul:(c,l)=>jt(c*l,r),pow:(c,l)=>sI(a,c,l),div:(c,l)=>jt(c*pd(l,r),r),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>pd(c,r),sqrt:n.sqrt||(c=>o(a,c)),invertBatch:c=>iI(a,c),cmov:(c,l,u)=>u?l:c,toBytes:c=>t?zp(c,i):Ua(c,i),fromBytes:c=>{if(c.length!==i)throw new Error(`Fp.fromBytes: expected ${i}, got ${c.length}`);return t?jp(c):Vi(c)}});return Object.freeze(a)}function l1(r){if(typeof r!="bigint")throw new Error("field order must be bigint");const e=r.toString(2).length;return Math.ceil(e/8)}function u1(r){const e=l1(r);return e+Math.ceil(e/2)}function aI(r,e,t=!1){const n=r.length,s=l1(e),i=u1(e);if(n<16||n<i||n>1024)throw new Error(`expected ${i}-1024 bytes of input, got ${n}`);const o=t?Vi(r):jp(r),a=jt(o,e-Me)+Me;return t?zp(a,s):Ua(a,s)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const cI=BigInt(0),Vh=BigInt(1);function lI(r,e){const t=(s,i)=>{const o=i.negate();return s?o:i},n=s=>{const i=Math.ceil(e/s)+1,o=2**(s-1);return{windows:i,windowSize:o}};return{constTimeNegate:t,unsafeLadder(s,i){let o=r.ZERO,a=s;for(;i>cI;)i&Vh&&(o=o.add(a)),a=a.double(),i>>=Vh;return o},precomputeWindow(s,i){const{windows:o,windowSize:a}=n(i),c=[];let l=s,u=l;for(let h=0;h<o;h++){u=l,c.push(u);for(let f=1;f<a;f++)u=u.add(l),c.push(u);l=u.double()}return c},wNAF(s,i,o){const{windows:a,windowSize:c}=n(s);let l=r.ZERO,u=r.BASE;const h=BigInt(2**s-1),f=2**s,d=BigInt(s);for(let p=0;p<a;p++){const g=p*c;let m=Number(o&h);o>>=d,m>c&&(m-=f,o+=Vh);const b=g,x=g+Math.abs(m)-1,v=p%2!==0,S=m<0;m===0?u=u.add(t(v,i[b])):l=l.add(t(S,i[x]))}return{p:l,f:u}},wNAFCached(s,i,o,a){const c=s._WINDOW_SIZE||1;let l=i.get(s);return l||(l=this.precomputeWindow(s,c),c!==1&&i.set(s,a(l))),this.wNAF(c,l,o)}}}function h1(r){return nI(r.Fp),hl(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...c1(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function uI(r){const e=h1(r);hl(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:t,Fp:n,a:s}=e;if(t){if(!n.eql(s,n.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:hI,hexToBytes:fI}=Yx,wi={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(r){const{Err:e}=wi;if(r.length<2||r[0]!==2)throw new e("Invalid signature integer tag");const t=r[1],n=r.subarray(2,t+2);if(!t||n.length!==t)throw new e("Invalid signature integer: wrong length");if(n[0]&128)throw new e("Invalid signature integer: negative");if(n[0]===0&&!(n[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:hI(n),l:r.subarray(t+2)}},toSig(r){const{Err:e}=wi,t=typeof r=="string"?fI(r):r;if(!(t instanceof Uint8Array))throw new Error("ui8a expected");let n=t.length;if(n<2||t[0]!=48)throw new e("Invalid signature tag");if(t[1]!==n-2)throw new e("Invalid signature: incorrect length");const{d:s,l:i}=wi._parseInt(t.subarray(2)),{d:o,l:a}=wi._parseInt(i);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:s,s:o}},hexFromSig(r){const e=l=>Number.parseInt(l[0],16)&8?"00"+l:l,t=l=>{const u=l.toString(16);return u.length&1?`0${u}`:u},n=e(t(r.s)),s=e(t(r.r)),i=n.length/2,o=s.length/2,a=t(i),c=t(o);return`30${t(o+i+4)}02${c}${s}02${a}${n}`}},Kn=BigInt(0),vr=BigInt(1);BigInt(2);const ly=BigInt(3);BigInt(4);function dI(r){const e=uI(r),{Fp:t}=e,n=e.toBytes||((p,g,m)=>{const b=g.toAffine();return Rc(Uint8Array.from([4]),t.toBytes(b.x),t.toBytes(b.y))}),s=e.fromBytes||(p=>{const g=p.subarray(1),m=t.fromBytes(g.subarray(0,t.BYTES)),b=t.fromBytes(g.subarray(t.BYTES,2*t.BYTES));return{x:m,y:b}});function i(p){const{a:g,b:m}=e,b=t.sqr(p),x=t.mul(b,p);return t.add(t.add(x,t.mul(p,g)),m)}if(!t.eql(t.sqr(e.Gy),i(e.Gx)))throw new Error("bad generator point: equation left != right");function o(p){return typeof p=="bigint"&&Kn<p&&p<e.n}function a(p){if(!o(p))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(p){const{allowedPrivateKeyLengths:g,nByteLength:m,wrapPrivateKey:b,n:x}=e;if(g&&typeof p!="bigint"){if(p instanceof Uint8Array&&(p=Na(p)),typeof p!="string"||!g.includes(p.length))throw new Error("Invalid key");p=p.padStart(m*2,"0")}let v;try{v=typeof p=="bigint"?p:Vi(Tr("private key",p,m))}catch{throw new Error(`private key must be ${m} bytes, hex or bigint, not ${typeof p}`)}return b&&(v=jt(v,x)),a(v),v}const l=new Map;function u(p){if(!(p instanceof h))throw new Error("ProjectivePoint expected")}class h{constructor(g,m,b){if(this.px=g,this.py=m,this.pz=b,g==null||!t.isValid(g))throw new Error("x required");if(m==null||!t.isValid(m))throw new Error("y required");if(b==null||!t.isValid(b))throw new Error("z required")}static fromAffine(g){const{x:m,y:b}=g||{};if(!g||!t.isValid(m)||!t.isValid(b))throw new Error("invalid affine point");if(g instanceof h)throw new Error("projective point not allowed");const x=v=>t.eql(v,t.ZERO);return x(m)&&x(b)?h.ZERO:new h(m,b,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(g){const m=t.invertBatch(g.map(b=>b.pz));return g.map((b,x)=>b.toAffine(m[x])).map(h.fromAffine)}static fromHex(g){const m=h.fromAffine(s(Tr("pointHex",g)));return m.assertValidity(),m}static fromPrivateKey(g){return h.BASE.multiply(c(g))}_setWindowSize(g){this._WINDOW_SIZE=g,l.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!t.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:g,y:m}=this.toAffine();if(!t.isValid(g)||!t.isValid(m))throw new Error("bad point: x or y not FE");const b=t.sqr(m),x=i(g);if(!t.eql(b,x))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:g}=this.toAffine();if(t.isOdd)return!t.isOdd(g);throw new Error("Field doesn't support isOdd")}equals(g){u(g);const{px:m,py:b,pz:x}=this,{px:v,py:S,pz:I}=g,A=t.eql(t.mul(m,I),t.mul(v,x)),O=t.eql(t.mul(b,I),t.mul(S,x));return A&&O}negate(){return new h(this.px,t.neg(this.py),this.pz)}double(){const{a:g,b:m}=e,b=t.mul(m,ly),{px:x,py:v,pz:S}=this;let I=t.ZERO,A=t.ZERO,O=t.ZERO,D=t.mul(x,x),B=t.mul(v,v),L=t.mul(S,S),j=t.mul(x,v);return j=t.add(j,j),O=t.mul(x,S),O=t.add(O,O),I=t.mul(g,O),A=t.mul(b,L),A=t.add(I,A),I=t.sub(B,A),A=t.add(B,A),A=t.mul(I,A),I=t.mul(j,I),O=t.mul(b,O),L=t.mul(g,L),j=t.sub(D,L),j=t.mul(g,j),j=t.add(j,O),O=t.add(D,D),D=t.add(O,D),D=t.add(D,L),D=t.mul(D,j),A=t.add(A,D),L=t.mul(v,S),L=t.add(L,L),D=t.mul(L,j),I=t.sub(I,D),O=t.mul(L,B),O=t.add(O,O),O=t.add(O,O),new h(I,A,O)}add(g){u(g);const{px:m,py:b,pz:x}=this,{px:v,py:S,pz:I}=g;let A=t.ZERO,O=t.ZERO,D=t.ZERO;const B=e.a,L=t.mul(e.b,ly);let j=t.mul(m,v),$=t.mul(b,S),U=t.mul(x,I),T=t.add(m,b),w=t.add(v,S);T=t.mul(T,w),w=t.add(j,$),T=t.sub(T,w),w=t.add(m,x);let E=t.add(v,I);return w=t.mul(w,E),E=t.add(j,U),w=t.sub(w,E),E=t.add(b,x),A=t.add(S,I),E=t.mul(E,A),A=t.add($,U),E=t.sub(E,A),D=t.mul(B,w),A=t.mul(L,U),D=t.add(A,D),A=t.sub($,D),D=t.add($,D),O=t.mul(A,D),$=t.add(j,j),$=t.add($,j),U=t.mul(B,U),w=t.mul(L,w),$=t.add($,U),U=t.sub(j,U),U=t.mul(B,U),w=t.add(w,U),j=t.mul($,w),O=t.add(O,j),j=t.mul(E,w),A=t.mul(T,A),A=t.sub(A,j),j=t.mul(T,$),D=t.mul(E,D),D=t.add(D,j),new h(A,O,D)}subtract(g){return this.add(g.negate())}is0(){return this.equals(h.ZERO)}wNAF(g){return d.wNAFCached(this,l,g,m=>{const b=t.invertBatch(m.map(x=>x.pz));return m.map((x,v)=>x.toAffine(b[v])).map(h.fromAffine)})}multiplyUnsafe(g){const m=h.ZERO;if(g===Kn)return m;if(a(g),g===vr)return this;const{endo:b}=e;if(!b)return d.unsafeLadder(this,g);let{k1neg:x,k1:v,k2neg:S,k2:I}=b.splitScalar(g),A=m,O=m,D=this;for(;v>Kn||I>Kn;)v&vr&&(A=A.add(D)),I&vr&&(O=O.add(D)),D=D.double(),v>>=vr,I>>=vr;return x&&(A=A.negate()),S&&(O=O.negate()),O=new h(t.mul(O.px,b.beta),O.py,O.pz),A.add(O)}multiply(g){a(g);let m=g,b,x;const{endo:v}=e;if(v){const{k1neg:S,k1:I,k2neg:A,k2:O}=v.splitScalar(m);let{p:D,f:B}=this.wNAF(I),{p:L,f:j}=this.wNAF(O);D=d.constTimeNegate(S,D),L=d.constTimeNegate(A,L),L=new h(t.mul(L.px,v.beta),L.py,L.pz),b=D.add(L),x=B.add(j)}else{const{p:S,f:I}=this.wNAF(m);b=S,x=I}return h.normalizeZ([b,x])[0]}multiplyAndAddUnsafe(g,m,b){const x=h.BASE,v=(I,A)=>A===Kn||A===vr||!I.equals(x)?I.multiplyUnsafe(A):I.multiply(A),S=v(this,m).add(v(g,b));return S.is0()?void 0:S}toAffine(g){const{px:m,py:b,pz:x}=this,v=this.is0();g==null&&(g=v?t.ONE:t.inv(x));const S=t.mul(m,g),I=t.mul(b,g),A=t.mul(x,g);if(v)return{x:t.ZERO,y:t.ZERO};if(!t.eql(A,t.ONE))throw new Error("invZ was invalid");return{x:S,y:I}}isTorsionFree(){const{h:g,isTorsionFree:m}=e;if(g===vr)return!0;if(m)return m(h,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:g,clearCofactor:m}=e;return g===vr?this:m?m(h,this):this.multiplyUnsafe(e.h)}toRawBytes(g=!0){return this.assertValidity(),n(h,this,g)}toHex(g=!0){return Na(this.toRawBytes(g))}}h.BASE=new h(e.Gx,e.Gy,t.ONE),h.ZERO=new h(t.ZERO,t.ONE,t.ZERO);const f=e.nBitLength,d=lI(h,e.endo?Math.ceil(f/2):f);return{CURVE:e,ProjectivePoint:h,normPrivateKeyToScalar:c,weierstrassEquation:i,isWithinCurveOrder:o}}function pI(r){const e=h1(r);return hl(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function gI(r){const e=pI(r),{Fp:t,n}=e,s=t.BYTES+1,i=2*t.BYTES+1;function o(w){return Kn<w&&w<t.ORDER}function a(w){return jt(w,n)}function c(w){return pd(w,n)}const{ProjectivePoint:l,normPrivateKeyToScalar:u,weierstrassEquation:h,isWithinCurveOrder:f}=dI({...e,toBytes(w,E,C){const k=E.toAffine(),_=t.toBytes(k.x),N=Rc;return C?N(Uint8Array.from([E.hasEvenY()?2:3]),_):N(Uint8Array.from([4]),_,t.toBytes(k.y))},fromBytes(w){const E=w.length,C=w[0],k=w.subarray(1);if(E===s&&(C===2||C===3)){const _=Vi(k);if(!o(_))throw new Error("Point is not on curve");const N=h(_);let z=t.sqrt(N);const H=(z&vr)===vr;return(C&1)===1!==H&&(z=t.neg(z)),{x:_,y:z}}else if(E===i&&C===4){const _=t.fromBytes(k.subarray(0,t.BYTES)),N=t.fromBytes(k.subarray(t.BYTES,2*t.BYTES));return{x:_,y:N}}else throw new Error(`Point of length ${E} was invalid. Expected ${s} compressed bytes or ${i} uncompressed bytes`)}}),d=w=>Na(Ua(w,e.nByteLength));function p(w){const E=n>>vr;return w>E}function g(w){return p(w)?a(-w):w}const m=(w,E,C)=>Vi(w.slice(E,C));class b{constructor(E,C,k){this.r=E,this.s=C,this.recovery=k,this.assertValidity()}static fromCompact(E){const C=e.nByteLength;return E=Tr("compactSignature",E,C*2),new b(m(E,0,C),m(E,C,2*C))}static fromDER(E){const{r:C,s:k}=wi.toSig(Tr("DER",E));return new b(C,k)}assertValidity(){if(!f(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!f(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(E){return new b(this.r,this.s,E)}recoverPublicKey(E){const{r:C,s:k,recovery:_}=this,N=O(Tr("msgHash",E));if(_==null||![0,1,2,3].includes(_))throw new Error("recovery id invalid");const z=_===2||_===3?C+e.n:C;if(z>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const H=(_&1)===0?"02":"03",Y=l.fromHex(H+d(z)),G=c(z),Q=a(-N*G),ee=a(k*G),se=l.BASE.multiplyAndAddUnsafe(Y,Q,ee);if(!se)throw new Error("point at infinify");return se.assertValidity(),se}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new b(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return Ra(this.toDERHex())}toDERHex(){return wi.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return Ra(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const x={isValidPrivateKey(w){try{return u(w),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const w=u1(e.n);return aI(e.randomBytes(w),e.n)},precompute(w=8,E=l.BASE){return E._setWindowSize(w),E.multiply(BigInt(3)),E}};function v(w,E=!0){return l.fromPrivateKey(w).toRawBytes(E)}function S(w){const E=w instanceof Uint8Array,C=typeof w=="string",k=(E||C)&&w.length;return E?k===s||k===i:C?k===2*s||k===2*i:w instanceof l}function I(w,E,C=!0){if(S(w))throw new Error("first arg must be private key");if(!S(E))throw new Error("second arg must be public key");return l.fromHex(E).multiply(u(w)).toRawBytes(C)}const A=e.bits2int||function(w){const E=Vi(w),C=w.length*8-e.nBitLength;return C>0?E>>BigInt(C):E},O=e.bits2int_modN||function(w){return a(A(w))},D=Hp(e.nBitLength);function B(w){if(typeof w!="bigint")throw new Error("bigint expected");if(!(Kn<=w&&w<D))throw new Error(`bigint expected < 2^${e.nBitLength}`);return Ua(w,e.nByteLength)}function L(w,E,C=j){if(["recovered","canonical"].some(ne=>ne in C))throw new Error("sign() legacy options not supported");const{hash:k,randomBytes:_}=e;let{lowS:N,prehash:z,extraEntropy:H}=C;N==null&&(N=!0),w=Tr("msgHash",w),z&&(w=Tr("prehashed msgHash",k(w)));const Y=O(w),G=u(E),Q=[B(G),B(Y)];if(H!=null){const ne=H===!0?_(t.BYTES):H;Q.push(Tr("extraEntropy",ne))}const ee=Rc(...Q),se=Y;function le(ne){const fe=A(ne);if(!f(fe))return;const Re=c(fe),ze=l.BASE.multiply(fe).toAffine(),Ue=a(ze.x);if(Ue===Kn)return;const pt=a(Re*a(se+Ue*G));if(pt===Kn)return;let lo=(ze.x===Ue?0:2)|Number(ze.y&vr),Dl=pt;return N&&p(pt)&&(Dl=g(pt),lo^=1),new b(Ue,Dl,lo)}return{seed:ee,k2sig:le}}const j={lowS:e.lowS,prehash:!1},$={lowS:e.lowS,prehash:!1};function U(w,E,C=j){const{seed:k,k2sig:_}=L(w,E,C),N=e;return a1(N.hash.outputLen,N.nByteLength,N.hmac)(k,_)}l.BASE._setWindowSize(8);function T(w,E,C,k=$){var ze;const _=w;if(E=Tr("msgHash",E),C=Tr("publicKey",C),"strict"in k)throw new Error("options.strict was renamed to lowS");const{lowS:N,prehash:z}=k;let H,Y;try{if(typeof _=="string"||_ instanceof Uint8Array)try{H=b.fromDER(_)}catch(Ue){if(!(Ue instanceof wi.Err))throw Ue;H=b.fromCompact(_)}else if(typeof _=="object"&&typeof _.r=="bigint"&&typeof _.s=="bigint"){const{r:Ue,s:pt}=_;H=new b(Ue,pt)}else throw new Error("PARSE");Y=l.fromHex(C)}catch(Ue){if(Ue.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(N&&H.hasHighS())return!1;z&&(E=e.hash(E));const{r:G,s:Q}=H,ee=O(E),se=c(Q),le=a(ee*se),ne=a(G*se),fe=(ze=l.BASE.multiplyAndAddUnsafe(Y,le,ne))==null?void 0:ze.toAffine();return fe?a(fe.x)===G:!1}return{CURVE:e,getPublicKey:v,getSharedSecret:I,sign:U,verify:T,ProjectivePoint:l,Signature:b,utils:x}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function yI(r){return{hash:r,hmac:(e,...t)=>Mb(r,e,rx(...t)),randomBytes:nx}}function mI(r,e){const t=n=>gI({...r,...yI(n)});return Object.freeze({...t(e),create:t})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const f1=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),uy=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),wI=BigInt(1),gd=BigInt(2),hy=(r,e)=>(r+e/gd)/e;function bI(r){const e=f1,t=BigInt(3),n=BigInt(6),s=BigInt(11),i=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=r*r*r%e,u=l*l*r%e,h=lr(u,t,e)*u%e,f=lr(h,t,e)*u%e,d=lr(f,gd,e)*l%e,p=lr(d,s,e)*d%e,g=lr(p,i,e)*p%e,m=lr(g,a,e)*g%e,b=lr(m,c,e)*m%e,x=lr(b,a,e)*g%e,v=lr(x,t,e)*u%e,S=lr(v,o,e)*p%e,I=lr(S,n,e)*l%e,A=lr(I,gd,e);if(!yd.eql(yd.sqr(A),r))throw new Error("Cannot find square root");return A}const yd=oI(f1,void 0,void 0,{sqrt:bI}),ws=mI({a:BigInt(0),b:BigInt(7),Fp:yd,n:uy,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:r=>{const e=uy,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-wI*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=t,o=BigInt("0x100000000000000000000000000000000"),a=hy(i*r,e),c=hy(-n*r,e);let l=jt(r-a*t-c*s,e),u=jt(-a*n-c*i,e);const h=l>o,f=u>o;if(h&&(l=e-l),f&&(u=e-u),l>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+r);return{k1neg:h,k1:l,k2neg:f,k2:u}}}},zb);BigInt(0);ws.ProjectivePoint;const Uc="0x0000000000000000000000000000000000000000",fy="0x0000000000000000000000000000000000000000000000000000000000000000",dy=BigInt(0),py=BigInt(1),gy=BigInt(2),yy=BigInt(27),my=BigInt(28),Nl=BigInt(35),ho={};function wy(r){return Xn(Je(r),32)}var Xo,rn,ea,Ri;const _r=class _r{constructor(e,t,n,s){M(this,Xo);M(this,rn);M(this,ea);M(this,Ri);ll(e,ho,"Signature"),P(this,Xo,t),P(this,rn,n),P(this,ea,s),P(this,Ri,null)}get r(){return y(this,Xo)}set r(e){R($o(e)===32,"invalid r","value",e),P(this,Xo,X(e))}get s(){return R(parseInt(y(this,rn).substring(0,3))<8,"non-canonical s; use ._s","s",y(this,rn)),y(this,rn)}set s(e){R($o(e)===32,"invalid s","value",e),P(this,rn,X(e))}get _s(){return y(this,rn)}isValid(){return parseInt(y(this,rn).substring(0,3))<8}get v(){return y(this,ea)}set v(e){const t=ce(e,"value");R(t===27||t===28,"invalid v","v",e),P(this,ea,t)}get networkV(){return y(this,Ri)}get legacyChainId(){const e=this.networkV;return e==null?null:_r.getChainId(e)}get yParity(){return this.v===27?0:1}get yParityAndS(){const e=ue(this.s);return this.yParity&&(e[0]|=128),X(e)}get compactSerialized(){return $e([this.r,this.yParityAndS])}get serialized(){return $e([this.r,this.s,this.yParity?"0x1c":"0x1b"])}[Symbol.for("nodejs.util.inspect.custom")](){return`Signature { r: "${this.r}", s: "${this._s}"${this.isValid()?"":', valid: "false"'}, yParity: ${this.yParity}, networkV: ${this.networkV} }`}clone(){const e=new _r(ho,this.r,this._s,this.v);return this.networkV&&P(e,Ri,this.networkV),e}toJSON(){const e=this.networkV;return{_type:"signature",networkV:e!=null?e.toString():null,r:this.r,s:this._s,v:this.v}}static getChainId(e){const t=re(e,"v");return t==yy||t==my?dy:(R(t>=Nl,"invalid EIP-155 v","v",e),(t-Nl)/gy)}static getChainIdV(e,t){return re(e)*gy+BigInt(35+t-27)}static getNormalizedV(e){const t=re(e);return t===dy||t===yy?27:t===py||t===my?28:(R(t>=Nl,"invalid v","v",e),t&py?27:28)}static from(e){function t(l,u){R(l,u,"signature",e)}if(e==null)return new _r(ho,fy,fy,27);if(typeof e=="string"){const l=ue(e,"signature");if(l.length===64){const u=X(l.slice(0,32)),h=l.slice(32,64),f=h[0]&128?28:27;return h[0]&=127,new _r(ho,u,X(h),f)}if(l.length===65){const u=X(l.slice(0,32)),h=X(l.slice(32,64)),f=_r.getNormalizedV(l[64]);return new _r(ho,u,h,f)}t(!1,"invalid raw signature length")}if(e instanceof _r)return e.clone();const n=e.r;t(n!=null,"missing r");const s=wy(n),i=(function(l,u){if(l!=null)return wy(l);if(u!=null){t(Ce(u,32),"invalid yParityAndS");const h=ue(u);return h[0]&=127,X(h)}t(!1,"missing s")})(e.s,e.yParityAndS),{networkV:o,v:a}=(function(l,u,h){if(l!=null){const f=re(l);return{networkV:f>=Nl?f:void 0,v:_r.getNormalizedV(f)}}if(u!=null)return t(Ce(u,32),"invalid yParityAndS"),{v:ue(u)[0]&128?28:27};if(h!=null){switch(ce(h,"sig.yParity")){case 0:return{v:27};case 1:return{v:28}}t(!1,"invalid yParity")}t(!1,"missing v")})(e.v,e.yParityAndS,e.yParity),c=new _r(ho,s,i,a);return o&&P(c,Ri,o),t(e.yParity==null||ce(e.yParity,"sig.yParity")===c.yParity,"yParity mismatch"),t(e.yParityAndS==null||e.yParityAndS===c.yParityAndS,"yParityAndS mismatch"),c}};Xo=new WeakMap,rn=new WeakMap,ea=new WeakMap,Ri=new WeakMap;let Kt=_r;var Ln;const pi=class pi{constructor(e){M(this,Ln);R($o(e)===32,"invalid private key","privateKey","[REDACTED]"),P(this,Ln,X(e))}get privateKey(){return y(this,Ln)}get publicKey(){return pi.computePublicKey(y(this,Ln))}get compressedPublicKey(){return pi.computePublicKey(y(this,Ln),!0)}sign(e){R($o(e)===32,"invalid digest length","digest",e);const t=ws.sign(Dt(e),Dt(y(this,Ln)),{lowS:!0});return Kt.from({r:Vs(t.r,32),s:Vs(t.s,32),v:t.recovery?28:27})}computeSharedSecret(e){const t=pi.computePublicKey(e);return X(ws.getSharedSecret(Dt(y(this,Ln)),ue(t),!1))}static computePublicKey(e,t){let n=ue(e,"key");if(n.length===32){const i=ws.getPublicKey(n,!!t);return X(i)}if(n.length===64){const i=new Uint8Array(65);i[0]=4,i.set(n,1),n=i}const s=ws.ProjectivePoint.fromHex(n);return X(s.toRawBytes(t))}static recoverPublicKey(e,t){R($o(e)===32,"invalid digest length","digest",e);const n=Kt.from(t);let s=ws.Signature.fromCompact(Dt($e([n.r,n.s])));s=s.addRecoveryBit(n.yParity);const i=s.recoverPublicKey(Dt(e));return R(i!=null,"invalid signature for digest","signature",t),"0x"+i.toHex(!1)}static addPoints(e,t,n){const s=ws.ProjectivePoint.fromHex(pi.computePublicKey(e).substring(2)),i=ws.ProjectivePoint.fromHex(pi.computePublicKey(t).substring(2));return"0x"+s.add(i).toHex(!!n)}};Ln=new WeakMap;let kc=pi;const vI=BigInt(0),EI=BigInt(36);function by(r){r=r.toLowerCase();const e=r.substring(2).split(""),t=new Uint8Array(40);for(let s=0;s<40;s++)t[s]=e[s].charCodeAt(0);const n=ue(Ke(t));for(let s=0;s<40;s+=2)n[s>>1]>>4>=8&&(e[s]=e[s].toUpperCase()),(n[s>>1]&15)>=8&&(e[s+1]=e[s+1].toUpperCase());return"0x"+e.join("")}const qp={};for(let r=0;r<10;r++)qp[String(r)]=String(r);for(let r=0;r<26;r++)qp[String.fromCharCode(65+r)]=String(10+r);const vy=15;function AI(r){r=r.toUpperCase(),r=r.substring(4)+r.substring(0,2)+"00";let e=r.split("").map(n=>qp[n]).join("");for(;e.length>=vy;){let n=e.substring(0,vy);e=parseInt(n,10)%97+e.substring(n.length)}let t=String(98-parseInt(e,10)%97);for(;t.length<2;)t="0"+t;return t}const xI=(function(){const r={};for(let e=0;e<36;e++){const t="0123456789abcdefghijklmnopqrstuvwxyz"[e];r[t]=BigInt(e)}return r})();function II(r){r=r.toLowerCase();let e=vI;for(let t=0;t<r.length;t++)e=e*EI+xI[r[t]];return e}function Ae(r){if(R(typeof r=="string","invalid address","address",r),r.match(/^(0x)?[0-9a-fA-F]{40}$/)){r.startsWith("0x")||(r="0x"+r);const e=by(r);return R(!r.match(/([A-F].*[a-f])|([a-f].*[A-F])/)||e===r,"bad address checksum","address",r),e}if(r.match(/^XE[0-9]{2}[0-9A-Za-z]{30,31}$/)){R(r.substring(2,4)===AI(r),"bad icap checksum","address",r);let e=II(r.substring(4)).toString(16);for(;e.length<40;)e="0"+e;return by("0x"+e)}R(!1,"invalid address","address",r)}function SI(r){const e=Ae(r.from);let n=re(r.nonce,"tx.nonce").toString(16);return n==="0"?n="0x":n.length%2?n="0x0"+n:n="0x"+n,Ae(ke(Ke(Gs([e,n])),12))}function d1(r){return r&&typeof r.getAddress=="function"}async function Kh(r,e){const t=await e;return(t==null||t==="0x0000000000000000000000000000000000000000")&&(q(typeof r!="string","unconfigured name","UNCONFIGURED_NAME",{value:r}),R(!1,"invalid AddressLike value; did not resolve to a value address","target",r)),Ae(t)}function Bt(r,e){if(typeof r=="string")return r.match(/^0x[0-9a-f]{40}$/i)?Ae(r):(q(e!=null,"ENS resolution requires a provider","UNSUPPORTED_OPERATION",{operation:"resolveName"}),Kh(r,e.resolveName(r)));if(d1(r))return Kh(r,r.getAddress());if(r&&typeof r.then=="function")return Kh(r,r);R(!1,"unsupported addressable value","target",r)}const _n={};function te(r,e){let t=!1;return e<0&&(t=!0,e*=-1),new It(_n,`${t?"":"u"}int${e}`,r,{signed:t,width:e})}function me(r,e){return new It(_n,`bytes${e||""}`,r,{size:e})}const Ey=Symbol.for("_ethers_typed");var Ui;const Tn=class Tn{constructor(e,t,n,s){F(this,"type");F(this,"value");M(this,Ui);F(this,"_typedSymbol");s==null&&(s=null),ll(_n,e,"Typed"),ie(this,{_typedSymbol:Ey,type:t,value:n}),P(this,Ui,s),this.format()}format(){if(this.type==="array")throw new Error("");if(this.type==="dynamicArray")throw new Error("");return this.type==="tuple"?`tuple(${this.value.map(e=>e.format()).join(",")})`:this.type}defaultValue(){return 0}minValue(){return 0}maxValue(){return 0}isBigInt(){return!!this.type.match(/^u?int[0-9]+$/)}isData(){return this.type.startsWith("bytes")}isString(){return this.type==="string"}get tupleName(){if(this.type!=="tuple")throw TypeError("not a tuple");return y(this,Ui)}get arrayLength(){if(this.type!=="array")throw TypeError("not an array");return y(this,Ui)===!0?-1:y(this,Ui)===!1?this.value.length:null}static from(e,t){return new Tn(_n,e,t)}static uint8(e){return te(e,8)}static uint16(e){return te(e,16)}static uint24(e){return te(e,24)}static uint32(e){return te(e,32)}static uint40(e){return te(e,40)}static uint48(e){return te(e,48)}static uint56(e){return te(e,56)}static uint64(e){return te(e,64)}static uint72(e){return te(e,72)}static uint80(e){return te(e,80)}static uint88(e){return te(e,88)}static uint96(e){return te(e,96)}static uint104(e){return te(e,104)}static uint112(e){return te(e,112)}static uint120(e){return te(e,120)}static uint128(e){return te(e,128)}static uint136(e){return te(e,136)}static uint144(e){return te(e,144)}static uint152(e){return te(e,152)}static uint160(e){return te(e,160)}static uint168(e){return te(e,168)}static uint176(e){return te(e,176)}static uint184(e){return te(e,184)}static uint192(e){return te(e,192)}static uint200(e){return te(e,200)}static uint208(e){return te(e,208)}static uint216(e){return te(e,216)}static uint224(e){return te(e,224)}static uint232(e){return te(e,232)}static uint240(e){return te(e,240)}static uint248(e){return te(e,248)}static uint256(e){return te(e,256)}static uint(e){return te(e,256)}static int8(e){return te(e,-8)}static int16(e){return te(e,-16)}static int24(e){return te(e,-24)}static int32(e){return te(e,-32)}static int40(e){return te(e,-40)}static int48(e){return te(e,-48)}static int56(e){return te(e,-56)}static int64(e){return te(e,-64)}static int72(e){return te(e,-72)}static int80(e){return te(e,-80)}static int88(e){return te(e,-88)}static int96(e){return te(e,-96)}static int104(e){return te(e,-104)}static int112(e){return te(e,-112)}static int120(e){return te(e,-120)}static int128(e){return te(e,-128)}static int136(e){return te(e,-136)}static int144(e){return te(e,-144)}static int152(e){return te(e,-152)}static int160(e){return te(e,-160)}static int168(e){return te(e,-168)}static int176(e){return te(e,-176)}static int184(e){return te(e,-184)}static int192(e){return te(e,-192)}static int200(e){return te(e,-200)}static int208(e){return te(e,-208)}static int216(e){return te(e,-216)}static int224(e){return te(e,-224)}static int232(e){return te(e,-232)}static int240(e){return te(e,-240)}static int248(e){return te(e,-248)}static int256(e){return te(e,-256)}static int(e){return te(e,-256)}static bytes1(e){return me(e,1)}static bytes2(e){return me(e,2)}static bytes3(e){return me(e,3)}static bytes4(e){return me(e,4)}static bytes5(e){return me(e,5)}static bytes6(e){return me(e,6)}static bytes7(e){return me(e,7)}static bytes8(e){return me(e,8)}static bytes9(e){return me(e,9)}static bytes10(e){return me(e,10)}static bytes11(e){return me(e,11)}static bytes12(e){return me(e,12)}static bytes13(e){return me(e,13)}static bytes14(e){return me(e,14)}static bytes15(e){return me(e,15)}static bytes16(e){return me(e,16)}static bytes17(e){return me(e,17)}static bytes18(e){return me(e,18)}static bytes19(e){return me(e,19)}static bytes20(e){return me(e,20)}static bytes21(e){return me(e,21)}static bytes22(e){return me(e,22)}static bytes23(e){return me(e,23)}static bytes24(e){return me(e,24)}static bytes25(e){return me(e,25)}static bytes26(e){return me(e,26)}static bytes27(e){return me(e,27)}static bytes28(e){return me(e,28)}static bytes29(e){return me(e,29)}static bytes30(e){return me(e,30)}static bytes31(e){return me(e,31)}static bytes32(e){return me(e,32)}static address(e){return new Tn(_n,"address",e)}static bool(e){return new Tn(_n,"bool",!!e)}static bytes(e){return new Tn(_n,"bytes",e)}static string(e){return new Tn(_n,"string",e)}static array(e,t){throw new Error("not implemented yet")}static tuple(e,t){throw new Error("not implemented yet")}static overrides(e){return new Tn(_n,"overrides",Object.assign({},e))}static isTyped(e){return e&&typeof e=="object"&&"_typedSymbol"in e&&e._typedSymbol===Ey}static dereference(e,t){if(Tn.isTyped(e)){if(e.type!==t)throw new Error(`invalid type: expecetd ${t}, got ${e.type}`);return e.value}return e}};Ui=new WeakMap;let It=Tn;class PI extends ss{constructor(e){super("address","address",e,!1)}defaultValue(){return"0x0000000000000000000000000000000000000000"}encode(e,t){let n=It.dereference(t,"string");try{n=Ae(n)}catch(s){return this._throwError(s.message,t)}return e.writeValue(n)}decode(e){return Ae(Vs(e.readValue(),20))}}class OI extends ss{constructor(t){super(t.name,t.type,"_",t.dynamic);F(this,"coder");this.coder=t}defaultValue(){return this.coder.defaultValue()}encode(t,n){return this.coder.encode(t,n)}decode(t){return this.coder.decode(t)}}function p1(r,e,t){let n=[];if(Array.isArray(t))n=t;else if(t&&typeof t=="object"){let c={};n=e.map(l=>{const u=l.localName;return q(u,"cannot encode object for signature with missing names","INVALID_ARGUMENT",{argument:"values",info:{coder:l},value:t}),q(!c[u],"cannot encode object for signature with duplicate names","INVALID_ARGUMENT",{argument:"values",info:{coder:l},value:t}),c[u]=!0,t[u]})}else R(!1,"invalid tuple value","tuple",t);R(e.length===n.length,"types/value length mismatch","tuple",t);let s=new ld,i=new ld,o=[];e.forEach((c,l)=>{let u=n[l];if(c.dynamic){let h=i.length;c.encode(i,u);let f=s.writeUpdatableValue();o.push(d=>{f(d+h)})}else c.encode(s,u)}),o.forEach(c=>{c(s.length)});let a=r.appendWriter(s);return a+=r.appendWriter(i),a}function g1(r,e){let t=[],n=[],s=r.subReader(0);return e.forEach(i=>{let o=null;if(i.dynamic){let a=r.readIndex(),c=s.subReader(a);try{o=i.decode(c)}catch(l){if(lt(l,"BUFFER_OVERRUN"))throw l;o=l,o.baseType=i.name,o.name=i.localName,o.type=i.type}}else try{o=i.decode(r)}catch(a){if(lt(a,"BUFFER_OVERRUN"))throw a;o=a,o.baseType=i.name,o.name=i.localName,o.type=i.type}if(o==null)throw new Error("investigate");t.push(o),n.push(i.localName||null)}),_a.fromItems(t,n)}class DI extends ss{constructor(t,n,s){const i=t.type+"["+(n>=0?n:"")+"]",o=n===-1||t.dynamic;super("array",i,s,o);F(this,"coder");F(this,"length");ie(this,{coder:t,length:n})}defaultValue(){const t=this.coder.defaultValue(),n=[];for(let s=0;s<this.length;s++)n.push(t);return n}encode(t,n){const s=It.dereference(n,"array");Array.isArray(s)||this._throwError("expected array value",s);let i=this.length;i===-1&&(i=s.length,t.writeValue(s.length)),xb(s.length,i,"coder array"+(this.localName?" "+this.localName:""));let o=[];for(let a=0;a<s.length;a++)o.push(this.coder);return p1(t,o,s)}decode(t){let n=this.length;n===-1&&(n=t.readIndex(),q(n*Ct<=t.dataLength,"insufficient data length","BUFFER_OVERRUN",{buffer:t.bytes,offset:n*Ct,length:t.dataLength}));let s=[];for(let i=0;i<n;i++)s.push(new OI(this.coder));return g1(t,s)}}class CI extends ss{constructor(e){super("bool","bool",e,!1)}defaultValue(){return!1}encode(e,t){const n=It.dereference(t,"bool");return e.writeValue(n?1:0)}decode(e){return!!e.readValue()}}class y1 extends ss{constructor(e,t){super(e,e,t,!0)}defaultValue(){return"0x"}encode(e,t){t=Dt(t);let n=e.writeValue(t.length);return n+=e.writeBytes(t),n}decode(e){return e.readBytes(e.readIndex(),!0)}}class BI extends y1{constructor(e){super("bytes",e)}decode(e){return X(super.decode(e))}}class _I extends ss{constructor(t,n){let s="bytes"+String(t);super(s,s,n,!1);F(this,"size");ie(this,{size:t},{size:"number"})}defaultValue(){return"0x0000000000000000000000000000000000000000000000000000000000000000".substring(0,2+this.size*2)}encode(t,n){let s=Dt(It.dereference(n,this.type));return s.length!==this.size&&this._throwError("incorrect data length",n),t.writeBytes(s)}decode(t){return X(t.readBytes(this.size))}}const TI=new Uint8Array([]);class NI extends ss{constructor(e){super("null","",e,!1)}defaultValue(){return null}encode(e,t){return t!=null&&this._throwError("not null",t),e.writeBytes(TI)}decode(e){return e.readBytes(0),null}}const RI=BigInt(0),UI=BigInt(1),kI=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");class $I extends ss{constructor(t,n,s){const i=(n?"int":"uint")+t*8;super(i,i,s,!1);F(this,"size");F(this,"signed");ie(this,{size:t,signed:n},{size:"number",signed:"boolean"})}defaultValue(){return 0}encode(t,n){let s=re(It.dereference(n,this.type)),i=mi(kI,Ct*8);if(this.signed){let o=mi(i,this.size*8-1);(s>o||s<-(o+UI))&&this._throwError("value out-of-bounds",n),s=Pb(s,8*Ct)}else(s<RI||s>mi(i,this.size*8))&&this._throwError("value out-of-bounds",n);return t.writeValue(s)}decode(t){let n=mi(t.readValue(),this.size*8);return this.signed&&(n=Eu(n,this.size*8)),n}}class LI extends y1{constructor(e){super("string",e)}defaultValue(){return""}encode(e,t){return super.encode(e,Wn(It.dereference(t,"string")))}decode(e){return Au(super.decode(e))}}class Rl extends ss{constructor(t,n){let s=!1;const i=[];t.forEach(a=>{a.dynamic&&(s=!0),i.push(a.type)});const o="tuple("+i.join(",")+")";super("tuple",o,n,s);F(this,"coders");ie(this,{coders:Object.freeze(t.slice())})}defaultValue(){const t=[];this.coders.forEach(s=>{t.push(s.defaultValue())});const n=this.coders.reduce((s,i)=>{const o=i.localName;return o&&(s[o]||(s[o]=0),s[o]++),s},{});return this.coders.forEach((s,i)=>{let o=s.localName;!o||n[o]!==1||(o==="length"&&(o="_length"),t[o]==null&&(t[o]=t[i]))}),Object.freeze(t)}encode(t,n){const s=It.dereference(n,"tuple");return p1(t,this.coders,s)}decode(t){return g1(t,this.coders)}}function Gh(r,e){return{address:Ae(r),storageKeys:e.map((t,n)=>(R(Ce(t,32),"invalid slot",`storageKeys[${n}]`,t),t.toLowerCase()))}}function ro(r){if(Array.isArray(r))return r.map((t,n)=>Array.isArray(t)?(R(t.length===2,"invalid slot set",`value[${n}]`,t),Gh(t[0],t[1])):(R(t!=null&&typeof t=="object","invalid address-slot set","value",r),Gh(t.address,t.storageKeys)));R(r!=null&&typeof r=="object","invalid access list","value",r);const e=Object.keys(r).map(t=>{const n=r[t].reduce((s,i)=>(s[i]=!0,s),{});return Gh(t,Object.keys(n).sort())});return e.sort((t,n)=>t.address.localeCompare(n.address)),e}function m1(r){return{address:Ae(r.address),nonce:re(r.nonce!=null?r.nonce:0),chainId:re(r.chainId!=null?r.chainId:0),signature:Kt.from(r.signature)}}function FI(r){let e;return typeof r=="string"?e=kc.computePublicKey(r,!1):e=r.publicKey,Ae(Ke("0x"+e.substring(4)).substring(26))}function MI(r,e){return FI(kc.recoverPublicKey(r,e))}const et=BigInt(0),jI=BigInt(2),zI=BigInt(27),HI=BigInt(28),qI=BigInt(35),VI=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),Qh=4096*32;function KI(r){return{blobToKzgCommitment:n=>{if("computeBlobProof"in r){if("blobToKzgCommitment"in r&&typeof r.blobToKzgCommitment=="function")return ue(r.blobToKzgCommitment(X(n)))}else if("blobToKzgCommitment"in r&&typeof r.blobToKzgCommitment=="function")return ue(r.blobToKzgCommitment(n));if("blobToKZGCommitment"in r&&typeof r.blobToKZGCommitment=="function")return ue(r.blobToKZGCommitment(X(n)));R(!1,"unsupported KZG library","kzg",r)},computeBlobKzgProof:(n,s)=>{if("computeBlobProof"in r&&typeof r.computeBlobProof=="function")return ue(r.computeBlobProof(X(n),X(s)));if("computeBlobKzgProof"in r&&typeof r.computeBlobKzgProof=="function")return r.computeBlobKzgProof(n,s);if("computeBlobKZGProof"in r&&typeof r.computeBlobKZGProof=="function")return ue(r.computeBlobKZGProof(X(n),X(s)));R(!1,"unsupported KZG library","kzg",r)}}}function Ay(r,e){let t=r.toString(16);for(;t.length<2;)t="0"+t;return t+=za(e).substring(4),"0x"+t}function Ha(r){return r==="0x"?null:Ae(r)}function hh(r,e){try{return ro(r)}catch(t){R(!1,t.message,e,r)}}function GI(r,e){try{if(!Array.isArray(r))throw new Error("authorizationList: invalid array");const t=[];for(let n=0;n<r.length;n++){const s=r[n];if(!Array.isArray(s))throw new Error(`authorization[${n}]: invalid array`);if(s.length!==6)throw new Error(`authorization[${n}]: wrong length`);if(!s[1])throw new Error(`authorization[${n}]: null address`);t.push({address:Ha(s[1]),nonce:Se(s[2],"nonce"),chainId:Se(s[0],"chainId"),signature:Kt.from({yParity:no(s[3],"yParity"),r:Xn(s[4],32),s:Xn(s[5],32)})})}return t}catch(t){R(!1,t.message,e,r)}}function no(r,e){return r==="0x"?0:ce(r,e)}function Se(r,e){if(r==="0x")return et;const t=re(r,e);return R(t<=VI,"value exceeds uint size",e,t),t}function ye(r,e){const t=re(r,"value"),n=Je(t);return R(n.length<=32,"value too large",`tx.${e}`,t),n}function fh(r){return ro(r).map(e=>[e.address,e.storageKeys])}function QI(r){return r.map(e=>[ye(e.chainId,"chainId"),e.address,ye(e.nonce,"nonce"),ye(e.signature.yParity,"yParity"),Je(e.signature.r),Je(e.signature.s)])}function WI(r,e){R(Array.isArray(r),`invalid ${e}`,"value",r);for(let t=0;t<r.length;t++)R(Ce(r[t],32),"invalid ${ param } hash",`value[${t}]`,r[t]);return r}function JI(r){const e=ul(r);R(Array.isArray(e)&&(e.length===9||e.length===6),"invalid field count for legacy transaction","data",r);const t={type:0,nonce:no(e[0],"nonce"),gasPrice:Se(e[1],"gasPrice"),gasLimit:Se(e[2],"gasLimit"),to:Ha(e[3]),value:Se(e[4],"value"),data:X(e[5]),chainId:et};if(e.length===6)return t;const n=Se(e[6],"v"),s=Se(e[7],"r"),i=Se(e[8],"s");if(s===et&&i===et)t.chainId=n;else{let o=(n-qI)/jI;o<et&&(o=et),t.chainId=o,R(o!==et||n===zI||n===HI,"non-canonical legacy v","v",e[6]),t.signature=Kt.from({r:Xn(e[7],32),s:Xn(e[8],32),v:n})}return t}function YI(r,e){const t=[ye(r.nonce,"nonce"),ye(r.gasPrice||0,"gasPrice"),ye(r.gasLimit,"gasLimit"),r.to||"0x",ye(r.value,"value"),r.data];let n=et;if(r.chainId!=et)n=re(r.chainId,"tx.chainId"),R(!e||e.networkV==null||e.legacyChainId===n,"tx.chainId/sig.v mismatch","sig",e);else if(r.signature){const i=r.signature.legacyChainId;i!=null&&(n=i)}if(!e)return n!==et&&(t.push(Je(n)),t.push("0x"),t.push("0x")),Gs(t);let s=BigInt(27+e.yParity);return n!==et?s=Kt.getChainIdV(n,e.v):BigInt(e.v)!==s&&R(!1,"tx.chainId/sig.v mismatch","sig",e),t.push(Je(s)),t.push(Je(e.r)),t.push(Je(e.s)),Gs(t)}function dh(r,e){let t;try{if(t=no(e[0],"yParity"),t!==0&&t!==1)throw new Error("bad yParity")}catch{R(!1,"invalid yParity","yParity",e[0])}const n=Xn(e[1],32),s=Xn(e[2],32),i=Kt.from({r:n,s,yParity:t});r.signature=i}function ZI(r){const e=ul(ue(r).slice(1));R(Array.isArray(e)&&(e.length===9||e.length===12),"invalid field count for transaction type: 2","data",X(r));const t={type:2,chainId:Se(e[0],"chainId"),nonce:no(e[1],"nonce"),maxPriorityFeePerGas:Se(e[2],"maxPriorityFeePerGas"),maxFeePerGas:Se(e[3],"maxFeePerGas"),gasPrice:null,gasLimit:Se(e[4],"gasLimit"),to:Ha(e[5]),value:Se(e[6],"value"),data:X(e[7]),accessList:hh(e[8],"accessList")};return e.length===9||dh(t,e.slice(9)),t}function XI(r,e){const t=[ye(r.chainId,"chainId"),ye(r.nonce,"nonce"),ye(r.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),ye(r.maxFeePerGas||0,"maxFeePerGas"),ye(r.gasLimit,"gasLimit"),r.to||"0x",ye(r.value,"value"),r.data,fh(r.accessList||[])];return e&&(t.push(ye(e.yParity,"yParity")),t.push(Je(e.r)),t.push(Je(e.s))),$e(["0x02",Gs(t)])}function e3(r){const e=ul(ue(r).slice(1));R(Array.isArray(e)&&(e.length===8||e.length===11),"invalid field count for transaction type: 1","data",X(r));const t={type:1,chainId:Se(e[0],"chainId"),nonce:no(e[1],"nonce"),gasPrice:Se(e[2],"gasPrice"),gasLimit:Se(e[3],"gasLimit"),to:Ha(e[4]),value:Se(e[5],"value"),data:X(e[6]),accessList:hh(e[7],"accessList")};return e.length===8||dh(t,e.slice(8)),t}function t3(r,e){const t=[ye(r.chainId,"chainId"),ye(r.nonce,"nonce"),ye(r.gasPrice||0,"gasPrice"),ye(r.gasLimit,"gasLimit"),r.to||"0x",ye(r.value,"value"),r.data,fh(r.accessList||[])];return e&&(t.push(ye(e.yParity,"recoveryParam")),t.push(Je(e.r)),t.push(Je(e.s))),$e(["0x01",Gs(t)])}function r3(r){let e=ul(ue(r).slice(1)),t="3",n=null;if(e.length===4&&Array.isArray(e[0])){t="3 (network format)";const i=e[1],o=e[2],a=e[3];R(Array.isArray(i),"invalid network format: blobs not an array","fields[1]",i),R(Array.isArray(o),"invalid network format: commitments not an array","fields[2]",o),R(Array.isArray(a),"invalid network format: proofs not an array","fields[3]",a),R(i.length===o.length,"invalid network format: blobs/commitments length mismatch","fields",e),R(i.length===a.length,"invalid network format: blobs/proofs length mismatch","fields",e),n=[];for(let c=0;c<e[1].length;c++)n.push({data:i[c],commitment:o[c],proof:a[c]});e=e[0]}R(Array.isArray(e)&&(e.length===11||e.length===14),`invalid field count for transaction type: ${t}`,"data",X(r));const s={type:3,chainId:Se(e[0],"chainId"),nonce:no(e[1],"nonce"),maxPriorityFeePerGas:Se(e[2],"maxPriorityFeePerGas"),maxFeePerGas:Se(e[3],"maxFeePerGas"),gasPrice:null,gasLimit:Se(e[4],"gasLimit"),to:Ha(e[5]),value:Se(e[6],"value"),data:X(e[7]),accessList:hh(e[8],"accessList"),maxFeePerBlobGas:Se(e[9],"maxFeePerBlobGas"),blobVersionedHashes:e[10]};n&&(s.blobs=n),R(s.to!=null,`invalid address for transaction type: ${t}`,"data",r),R(Array.isArray(s.blobVersionedHashes),"invalid blobVersionedHashes: must be an array","data",r);for(let i=0;i<s.blobVersionedHashes.length;i++)R(Ce(s.blobVersionedHashes[i],32),`invalid blobVersionedHash at index ${i}: must be length 32`,"data",r);return e.length===11||dh(s,e.slice(11)),s}function n3(r,e,t){const n=[ye(r.chainId,"chainId"),ye(r.nonce,"nonce"),ye(r.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),ye(r.maxFeePerGas||0,"maxFeePerGas"),ye(r.gasLimit,"gasLimit"),r.to||Uc,ye(r.value,"value"),r.data,fh(r.accessList||[]),ye(r.maxFeePerBlobGas||0,"maxFeePerBlobGas"),WI(r.blobVersionedHashes||[],"blobVersionedHashes")];return e&&(n.push(ye(e.yParity,"yParity")),n.push(Je(e.r)),n.push(Je(e.s)),t)?$e(["0x03",Gs([n,t.map(s=>s.data),t.map(s=>s.commitment),t.map(s=>s.proof)])]):$e(["0x03",Gs(n)])}function s3(r){const e=ul(ue(r).slice(1));R(Array.isArray(e)&&(e.length===10||e.length===13),"invalid field count for transaction type: 4","data",X(r));const t={type:4,chainId:Se(e[0],"chainId"),nonce:no(e[1],"nonce"),maxPriorityFeePerGas:Se(e[2],"maxPriorityFeePerGas"),maxFeePerGas:Se(e[3],"maxFeePerGas"),gasPrice:null,gasLimit:Se(e[4],"gasLimit"),to:Ha(e[5]),value:Se(e[6],"value"),data:X(e[7]),accessList:hh(e[8],"accessList"),authorizationList:GI(e[9],"authorizationList")};return e.length===10||dh(t,e.slice(10)),t}function i3(r,e){const t=[ye(r.chainId,"chainId"),ye(r.nonce,"nonce"),ye(r.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),ye(r.maxFeePerGas||0,"maxFeePerGas"),ye(r.gasLimit,"gasLimit"),r.to||"0x",ye(r.value,"value"),r.data,fh(r.accessList||[]),QI(r.authorizationList||[])];return e&&(t.push(ye(e.yParity,"yParity")),t.push(Je(e.r)),t.push(Je(e.s))),$e(["0x04",Gs(t)])}var kr,ta,ra,na,sa,ia,oa,aa,ca,la,ua,ha,ki,Ds,nn,Cs,fa,da,iu;const en=class en{constructor(){M(this,da);M(this,kr);M(this,ta);M(this,ra);M(this,na);M(this,sa);M(this,ia);M(this,oa);M(this,aa);M(this,ca);M(this,la);M(this,ua);M(this,ha);M(this,ki);M(this,Ds);M(this,nn);M(this,Cs);M(this,fa);P(this,kr,null),P(this,ta,null),P(this,na,0),P(this,sa,et),P(this,ia,null),P(this,oa,null),P(this,aa,null),P(this,ra,"0x"),P(this,ca,et),P(this,la,et),P(this,ua,null),P(this,ha,null),P(this,ki,null),P(this,Ds,null),P(this,nn,null),P(this,Cs,null),P(this,fa,null)}get type(){return y(this,kr)}set type(e){switch(e){case null:P(this,kr,null);break;case 0:case"legacy":P(this,kr,0);break;case 1:case"berlin":case"eip-2930":P(this,kr,1);break;case 2:case"london":case"eip-1559":P(this,kr,2);break;case 3:case"cancun":case"eip-4844":P(this,kr,3);break;case 4:case"pectra":case"eip-7702":P(this,kr,4);break;default:R(!1,"unsupported transaction type","type",e)}}get typeName(){switch(this.type){case 0:return"legacy";case 1:return"eip-2930";case 2:return"eip-1559";case 3:return"eip-4844";case 4:return"eip-7702"}return null}get to(){const e=y(this,ta);return e==null&&this.type===3?Uc:e}set to(e){P(this,ta,e==null?null:Ae(e))}get nonce(){return y(this,na)}set nonce(e){P(this,na,ce(e,"value"))}get gasLimit(){return y(this,sa)}set gasLimit(e){P(this,sa,re(e))}get gasPrice(){const e=y(this,ia);return e==null&&(this.type===0||this.type===1)?et:e}set gasPrice(e){P(this,ia,e==null?null:re(e,"gasPrice"))}get maxPriorityFeePerGas(){const e=y(this,oa);return e??(this.type===2||this.type===3?et:null)}set maxPriorityFeePerGas(e){P(this,oa,e==null?null:re(e,"maxPriorityFeePerGas"))}get maxFeePerGas(){const e=y(this,aa);return e??(this.type===2||this.type===3?et:null)}set maxFeePerGas(e){P(this,aa,e==null?null:re(e,"maxFeePerGas"))}get data(){return y(this,ra)}set data(e){P(this,ra,X(e))}get value(){return y(this,ca)}set value(e){P(this,ca,re(e,"value"))}get chainId(){return y(this,la)}set chainId(e){P(this,la,re(e))}get signature(){return y(this,ua)||null}set signature(e){P(this,ua,e==null?null:Kt.from(e))}get accessList(){const e=y(this,ha)||null;return e??(this.type===1||this.type===2||this.type===3?[]:null)}set accessList(e){P(this,ha,e==null?null:ro(e))}get authorizationList(){const e=y(this,fa)||null;return e==null&&this.type===4?[]:e}set authorizationList(e){P(this,fa,e==null?null:e.map(t=>m1(t)))}get maxFeePerBlobGas(){const e=y(this,ki);return e==null&&this.type===3?et:e}set maxFeePerBlobGas(e){P(this,ki,e==null?null:re(e,"maxFeePerBlobGas"))}get blobVersionedHashes(){let e=y(this,Ds);return e==null&&this.type===3?[]:e}set blobVersionedHashes(e){if(e!=null){R(Array.isArray(e),"blobVersionedHashes must be an Array","value",e),e=e.slice();for(let t=0;t<e.length;t++)R(Ce(e[t],32),"invalid blobVersionedHash",`value[${t}]`,e[t])}P(this,Ds,e)}get blobs(){return y(this,Cs)==null?null:y(this,Cs).map(e=>Object.assign({},e))}set blobs(e){if(e==null){P(this,Cs,null);return}const t=[],n=[];for(let s=0;s<e.length;s++){const i=e[s];if(kp(i)){q(y(this,nn),"adding a raw blob requires a KZG library","UNSUPPORTED_OPERATION",{operation:"set blobs()"});let o=ue(i);if(R(o.length<=Qh,"blob is too large",`blobs[${s}]`,i),o.length!==Qh){const l=new Uint8Array(Qh);l.set(o),o=l}const a=y(this,nn).blobToKzgCommitment(o),c=X(y(this,nn).computeBlobKzgProof(o,a));t.push({data:X(o),commitment:X(a),proof:c}),n.push(Ay(1,a))}else{const o=X(i.commitment);t.push({data:X(i.data),commitment:o,proof:X(i.proof)}),n.push(Ay(1,o))}}P(this,Cs,t),P(this,Ds,n)}get kzg(){return y(this,nn)}set kzg(e){e==null?P(this,nn,null):P(this,nn,KI(e))}get hash(){return this.signature==null?null:Ke(K(this,da,iu).call(this,!0,!1))}get unsignedHash(){return Ke(this.unsignedSerialized)}get from(){return this.signature==null?null:MI(this.unsignedHash,this.signature)}get fromPublicKey(){return this.signature==null?null:kc.recoverPublicKey(this.unsignedHash,this.signature)}isSigned(){return this.signature!=null}get serialized(){return K(this,da,iu).call(this,!0,!0)}get unsignedSerialized(){return K(this,da,iu).call(this,!1,!1)}inferType(){const e=this.inferTypes();return e.indexOf(2)>=0?2:e.pop()}inferTypes(){const e=this.gasPrice!=null,t=this.maxFeePerGas!=null||this.maxPriorityFeePerGas!=null,n=this.accessList!=null,s=y(this,ki)!=null||y(this,Ds);this.maxFeePerGas!=null&&this.maxPriorityFeePerGas!=null&&q(this.maxFeePerGas>=this.maxPriorityFeePerGas,"priorityFee cannot be more than maxFee","BAD_DATA",{value:this}),q(!t||this.type!==0&&this.type!==1,"transaction type cannot have maxFeePerGas or maxPriorityFeePerGas","BAD_DATA",{value:this}),q(this.type!==0||!n,"legacy transaction cannot have accessList","BAD_DATA",{value:this});const i=[];return this.type!=null?i.push(this.type):this.authorizationList&&this.authorizationList.length?i.push(4):t?i.push(2):e?(i.push(1),n||i.push(0)):n?(i.push(1),i.push(2)):(s&&this.to||(i.push(0),i.push(1),i.push(2)),i.push(3)),i.sort(),i}isLegacy(){return this.type===0}isBerlin(){return this.type===1}isLondon(){return this.type===2}isCancun(){return this.type===3}clone(){return en.from(this)}toJSON(){const e=t=>t==null?null:t.toString();return{type:this.type,to:this.to,data:this.data,nonce:this.nonce,gasLimit:e(this.gasLimit),gasPrice:e(this.gasPrice),maxPriorityFeePerGas:e(this.maxPriorityFeePerGas),maxFeePerGas:e(this.maxFeePerGas),value:e(this.value),chainId:e(this.chainId),sig:this.signature?this.signature.toJSON():null,accessList:this.accessList}}static from(e){if(e==null)return new en;if(typeof e=="string"){const n=ue(e);if(n[0]>=127)return en.from(JI(n));switch(n[0]){case 1:return en.from(e3(n));case 2:return en.from(ZI(n));case 3:return en.from(r3(n));case 4:return en.from(s3(n))}q(!1,"unsupported transaction type","UNSUPPORTED_OPERATION",{operation:"from"})}const t=new en;return e.type!=null&&(t.type=e.type),e.to!=null&&(t.to=e.to),e.nonce!=null&&(t.nonce=e.nonce),e.gasLimit!=null&&(t.gasLimit=e.gasLimit),e.gasPrice!=null&&(t.gasPrice=e.gasPrice),e.maxPriorityFeePerGas!=null&&(t.maxPriorityFeePerGas=e.maxPriorityFeePerGas),e.maxFeePerGas!=null&&(t.maxFeePerGas=e.maxFeePerGas),e.maxFeePerBlobGas!=null&&(t.maxFeePerBlobGas=e.maxFeePerBlobGas),e.data!=null&&(t.data=e.data),e.value!=null&&(t.value=e.value),e.chainId!=null&&(t.chainId=e.chainId),e.signature!=null&&(t.signature=Kt.from(e.signature)),e.accessList!=null&&(t.accessList=e.accessList),e.authorizationList!=null&&(t.authorizationList=e.authorizationList),e.blobVersionedHashes!=null&&(t.blobVersionedHashes=e.blobVersionedHashes),e.kzg!=null&&(t.kzg=e.kzg),e.blobs!=null&&(t.blobs=e.blobs),e.hash!=null&&(R(t.isSigned(),"unsigned transaction cannot define '.hash'","tx",e),R(t.hash===e.hash,"hash mismatch","tx",e)),e.from!=null&&(R(t.isSigned(),"unsigned transaction cannot define '.from'","tx",e),R(t.from.toLowerCase()===(e.from||"").toLowerCase(),"from mismatch","tx",e)),t}};kr=new WeakMap,ta=new WeakMap,ra=new WeakMap,na=new WeakMap,sa=new WeakMap,ia=new WeakMap,oa=new WeakMap,aa=new WeakMap,ca=new WeakMap,la=new WeakMap,ua=new WeakMap,ha=new WeakMap,ki=new WeakMap,Ds=new WeakMap,nn=new WeakMap,Cs=new WeakMap,fa=new WeakMap,da=new WeakSet,iu=function(e,t){q(!e||this.signature!=null,"cannot serialize unsigned transaction; maybe you meant .unsignedSerialized","UNSUPPORTED_OPERATION",{operation:".serialized"});const n=e?this.signature:null;switch(this.inferType()){case 0:return YI(this,n);case 1:return t3(this,n);case 2:return XI(this,n);case 3:return n3(this,n,t?this.blobs:null);case 4:return i3(this,n)}q(!1,"unsupported transaction type","UNSUPPORTED_OPERATION",{operation:".serialized"})};let Iu=en;function Gi(r){return Ke(Wn(r))}var o3="AEEUdwmgDS8BxQKKAP4BOgDjATAAngDUAIMAoABoAOAAagCOAEQAhABMAHIAOwA9ACsANgAmAGIAHgAuACgAJwAXAC0AGgAjAB8ALwAUACkAEgAeAAkAGwARABkAFgA5ACgALQArADcAFQApABAAHgAiABAAGgAeABMAGAUhBe8BFxREN8sF2wC5AK5HAW8ArQkDzQCuhzc3NzcBP68NEfMABQdHBuw5BV8FYAA9MzkI9r4ZBg7QyQAWA9CeOwLNCjcCjqkChuA/lm+RAsXTAoP6ASfnEQDytQFJAjWVCkeXAOsA6godAB/cwdAUE0WlBCN/AQUCQRjFD/MRBjHxDQSJbw0jBzUAswBxme+tnIcAYwabAysG8QAjAEMMmxcDqgPKQyDXCMMxA7kUQwD3NXOrAKmFIAAfBC0D3x4BJQDBGdUFAhEgVD8JnwmQJiNWYUzrg0oAGwAUAB0AFnNcACkAFgBP9h3gPfsDOWDKneY2ChglX1UDYD30ABsAFAAdABZzIGRAnwDD8wAjAEEMzRbDqgMB2sAFYwXqAtCnAsS4AwpUJKRtFHsadUz9AMMVbwLpABM1NJEX0ZkCgYMBEyMAxRVvAukAEzUBUFAtmUwSAy4DBTER33EftQHfSwB5MxJ/AjkWKQLzL8E/cwBB6QH9LQDPDtO9ASNriQC5DQANAwCK21EFI91zHwCoL9kBqQcHBwcHKzUDowBvAQohPvU3fAQgHwCyAc8CKQMA5zMSezr7ULgFmDp/LzVQBgEGAi8FYQVgt8AFcTtlQhpCWEmfe5tmZ6IAExsDzQ8t+X8rBKtTAltbAn0jsy8Bl6utPWMDTR8Ei2kRANkDBrNHNysDBzECQWUAcwFpJ3kAiyUhAJ0BUb8AL3EfAbfNAz81KUsFWwF3YQZtAm0A+VEfAzEJDQBRSQCzAQBlAHsAM70GD/v3IZWHBwARKQAxALsjTwHZAeMPEzmXgIHwABIAGQA8AEUAQDt3gdvIEGcQZAkGTRFMdEIVEwK0D64L7REdDNkq09PgADSxB/MDWwfzA1sDWwfzB/MDWwfzA1sDWwNbA1scEvAi28gQZw9QBHUFlgWTBN4IiyZREYkHMAjaVBV0JhxPA00BBCMtSSQ7mzMTJUpMFE0LCAQ2SmyvfUADTzGzVP2QqgPTMlc5dAkGHnkSqAAyD3skNb1OhnpPcagKU0+2tYdJak5vAsY6sEAACikJm2/Dd1YGRRAfJ6kQ+ww3AbkBPw3xS9wE9QY/BM0fgRkdD9GVoAipLeEM8SbnLqWAXiP5KocF8Uv4POELUVFsD10LaQnnOmeBUgMlAREijwrhDT0IcRD3Cs1vDekRSQc9A9lJngCpBwULFR05FbkmFGKwCw05ewb/GvoLkyazEy17AAXXGiUGUQEtGwMA0y7rhbRaNVwgT2MGBwspI8sUrFAkDSlAu3hMGh8HGSWtApVDdEqLUToelyH6PEENai4XUYAH+TwJGVMLhTyiRq9FEhHWPpE9TCJNTDAEOYMsMyePCdMPiQy9fHYBXQklCbUMdRM1ERs3yQg9Bx0xlygnGQglRplgngT7owP3E9UDDwVDCUUHFwO5HDETMhUtBRGBKNsC9zbZLrcCk1aEARsFzw8pH+MQVEfkDu0InwJpA4cl7wAxFSUAGyKfCEdnAGOP3FMJLs8Iy2pwI3gDaxTrZRF3B5UOWwerHDcVwxzlcMxeD4YMKKezCV8BeQmdAWME5wgNNV+MpCBFZ1eLXBifIGVBQ14AAjUMaRWjRMGHfAKPD28SHwE5AXcHPQ0FAnsR8RFvEJkI74YINbkz/DopBFMhhyAVCisDU2zSCysm/Qz8bQGnEmYDEDRBd/Jnr2C6KBgBBx0yyUFkIfULlk/RDKAaxRhGVDIZ6AfDA/ca9yfuQVsGAwOnBxc6UTPyBMELbQiPCUMATQ6nGwfbGG4KdYzUATWPAbudA1uVhwJzkwY7Bw8Aaw+LBX3pACECqwinAAkA0wNbAD0CsQehAB0AiUUBQQMrMwEl6QKTA5cINc8BmTMB9y0EH8cMGQD7O25OAsO1AoBuZqYF4VwCkgJNOQFRKQQJUktVA7N15QDfAE8GF+NLARmvTs8e50cB43MvAMsA/wAJOQcJRQHRAfdxALsBYws1Caa3uQFR7S0AhwAZbwHbAo0A4QA5AIP1AVcAUQVd/QXXAlNNARU1HC9bZQG/AyMBNwERAH0Gz5GpzQsjBHEH1wIQHxXlAu8yB7kFAyLjE9FCyQK94lkAMhoKPAqrCqpgX2Q3CjV2PVQAEh+sPss/UgVVO1c7XDtXO1w7VztcO1c7XDtXO1wDm8Pmw+YKcF9JYe8Mqg3YRMw6TRPfYFVgNhPMLbsUxRXSJVoZQRrAJwkl6FUNDwgt12Y0CDA0eRfAAEMpbINFY4oeNApPHOtTlVT8LR8AtUumM7MNsBsZREQFS3XxYi4WEgomAmSFAmJGX1GzAV83JAKh+wJonAJmDQKfiDgfDwJmPwJmKgRyBIMDfxcDfpY5Cjl7GzmGOicnAmwhAjI6OA4CbcsCbbLzjgM3a0kvAWsA4gDlAE4JB5wMkQECD8YAEbkCdzMCdqZDAnlPRwJ4viFg30WyRvcCfEMCeswCfQ0CfPRIBEiBZygALxlJXEpfGRtK0ALRBQLQ0EsrA4hTA4fqRMmRNgLypV0HAwOyS9JMMSkH001QTbMCi0MCitzFHwshR2sJuwKOOwKOYESbhQKO3QKOYHxRuFM5AQ5S2FSJApP/ApMQAO0AIFUiVbNV1AosHymZijLleGpFPz0Cl6MC77ZYJawAXSkClpMCloCgAK1ZsFoNhVEAPwKWuQKWUlxIXNUCmc8CmWhczl0LHQKcnznGOqECnBoCn58CnryOACETNS4TAp31Ap6WALlBYThh8wKe1wKgcgGtAp6jIwKeUqljzGQrKS8CJ7MCJoICoP8CoFDbAqYzAqXSAqgDAIECp/ZogGi1AAdNaiBq1QKs5wKssgKtawKtBgJXIQJV4AKx5dsDH1JsmwKywRECsuwbbORtZ21MYwMl0QK2YD9DbpQDKUkCuGICuUsZArkue3A6cOUCvR0DLbYDMhUCvoxyBgMzdQK+HnMmc1MCw88CwwhzhnRPOUl05AM8qwEDPJ4DPcMCxYACxksCxhSNAshtVQLISALJUwLJMgJkoQLd1nh9ZXiyeSlL1AMYp2cGAmH4GfeVKHsPXpZevxUCz28Cz3AzT1fW9xejAMqxAs93AS3uA04Wfk8JAtwrAtuOAtJTA1JgA1NjAQUDVZCAjUMEzxrxZEl5A4LSg5EC2ssC2eKEFIRNp0ADhqkAMwNkEoZ1Xf0AWQLfaQLevHd7AuIz7RgB8zQrAfSfAfLWiwLr9wLpdH0DAur9AuroAP1LAb0C7o0C66CWrpcHAu5DA4XkmH1w5HGlAvMHAG0DjhqZlwL3FwORcgOSiwL3nAL53QL4apogmq+/O5siA52HAv7+AR8APZ8gAZ+3AwWRA6ZuA6bdANXJAwZuoYyiCQ0DDE0BEwEjB3EGZb1rCQC/BG/DFY8etxEAG3k9ACcDNxJRA42DAWcrJQCM8wAlAOanC6OVCLsGI6fJBgCvBRnDBvElRUYFFoAFcD9GSDNCKUK8X3kZX8QAls0FOgCQVCGbwTsuYDoZutcONxjOGJHJ/gVfBWAFXwVgBWsFYAVfBWAFXwVgBV8FYAVfBWBOHQjfjW8KCgoKbF7xMwTRA7kGN8PDAMMEr8MA70gxFroFTj5xPnhCR0K+X30/X/AAWBkzswCNBsxzzASm70aCRS4rDDMeLz49fnXfcsH5GcoscQFz13Y4HwVnBXLJycnACNdRYwgICAqEXoWTxgA7P4kACxbZBu21Kw0AjMsTAwkVAOVtJUUsJ1JCuULESUArXy9gPi9AKwnJRQYKTD9LPoA+iT54PnkCkULEUUpDX9NWV3JVEjQAc1w3A3IBE3YnX+g7QiMJb6MKaiszRCUuQrNCxDPMCcwEX9EWJzYREBEEBwIHKn6l33JCNVIfybPJtAltydPUCmhBZw/tEKsZAJOVJU1CLRuxbUHOQAo7P0s+eEJHHA8SJVRPdGM0NVrpvBoKhfUlM0JHHGUQUhEWO1xLSj8MO0ucNAqJIzVCRxv9EFsqKyA4OQgNj2nwZgp5ZNFgE2A1K3YHS2AhQQojJmC7DgpzGG1WYFUZCQYHZO9gHWCdYIVgu2BTYJlwFh8GvRbcXbG8YgtDHrMBwzPVyQonHQgkCyYBgQJ0Ajc4nVqIAwGSCsBPIgDsK3SWEtIVBa5N8gGjAo+kVwVIZwD/AEUSCDweX4ITrRQsJ8K3TwBXFDwEAB0TvzVcAtoTS20RIwDgVgZ9BBImYgA5AL4Coi8LFnezOkCnIQFjAY4KBAPh9RcGsgZSBsEAJctdsWIRu2kTkQstRw7DAcMBKgpPBGIGMDAwKCYnKTQaLg4AKRSVAFwCdl+YUZ0JdicFD3lPAdt1F9ZZKCGxuE3yBxkFVGcA/wBFEgiCBwAOLHQSjxOtQDg1z7deFRMAZ8QTAGtKb1ApIiPHADkAvgKiLy1DFtYCmBiDAlDDWNB0eo7fpaMO/aEVRRv0ATEQZBIODyMEAc8JQhCbDRgzFD4TAEMAu9YBCgCsAOkAm5I3ABwAYxvONnR+MhXJAxgKQyxL2+kkJhMbhQKDBMkSsvF0AD9BNQ6uQC7WqSQHwxEAEEIu1hkhAH2z4iQPwyJPHNWpdyYBRSpnJALzoBAEVPPsH20MxA0CCEQKRgAFyAtFAlMNwwjEDUQJRArELtapMg7DDZgJIw+TGukEIwvDFkMAqAtDEMMMBhioe+QAO3MMRAACrgnEBSPY9Q0FDnbSBoMAB8MSYxkSxAEJAPIJAAB8FWMOFtMc/HcXwxhDAC7DAvOowwAewwJdKDKHAAHDAALrFUQVwwAbwyvzpWMWv8wA/ABpAy++bcYDUKPD0KhDCwKmJ1MAAmMA5+UZwxAagwipBRL/eADfw6fDGOMCGsOjk3l6BwOpo4sAEsMOGxMAA5sAbcMOAAvDp0MJGkMDwgipnNIPAwfIqUMGAOGDAAPzABXDAAcDAAnDAGmTABrDAA7DChjDjnEWAwABYwAOcwAuUyYABsMAF8MIKQANUgC6wy4AA8MADqMq8wCyYgAcIwAB8wqpAAXOCx0V4wAHowBCwwEKAGnDAAuDAB3DAAjDCakABdIAbqcZ3QCZCCkABdIAAAFDAAfjAB2jCCkABqIACYMAGzMAbSMA5sOIAAhjAAhDABTDBAkpAAbSAOOTAAlDC6kOzPtnAAdDAG6kQFAATwAKwwwAA0MACbUDPwAHIwAZgwACE6cDAAojAApDAAoDp/MGwwAJIwADEwAQQwgAFEMAEXMAD5MADfMADcMAGRMOFiMAFUMAbqMWuwHDAMIAE0MLAGkzEgDhUwACQwAEWgAXgwUjAAbYABjDBSYBgzBaAEFNALcQBxUMegAwMngBrA0IZgJ0KxQHBREPd1N0ZzKRJwaIHAZqNT4DqQq8BwngAB4DAwt2AX56T1ocKQNXAh1GATQGC3tOxYNagkgAMQA5CQADAQEAWxLjAIOYNAEzAH7tFRk6TglSAF8NAAlYAQ+S1ACAQwQorQBiAN4dAJ1wPyeTANVzuQDX3AIeEMp9eyMgXiUAEdkBkJizKltbVVAaRMqRAAEAhyQ/SDEz6BmfVwB6ATEsOClKIRcDOF0E/832AFNt5AByAnkCRxGCOs94NjXdAwINGBonDBwPALW2AwICAgAAAAAAAAYDBQMDARrUAwAtAAAAAgEGBgYGBgYFBQUFBQUEBQYHCAkEBQUFBQQAAAICAAAAIgCNAJAAlT0A6gC7ANwApEQAwgCyAK0AqADuAKYA2gCjAOcBCAEDAMcAgQBiANIA1AEDAN4A8gCQAKkBMQDqAN8A3AsBCQ8yO9ra2tq8xuLT1tRJOB0BUgFcNU0BWgFpAWgBWwFMUUlLbhMBUxsNEAs6PhMOACcUKy0vMj5AQENDQ0RFFEYGJFdXV1dZWVhZL1pbXVxcI2NnZ2ZoZypsbnZ1eHh4eHh4enp6enp6enp6enp8fH18e2IARPIASQCaAHgAMgBm+ACOAFcAVwA3AnbvAIsABfj4AGQAk/IAnwBPAGIAZP//sACFAIUAaQBWALEAJAC2AIMCQAJDAPwA5wD+AP4A6AD/AOkA6QDoAOYALwJ7AVEBQAE+AVQBPgE+AT4BOQE4ATgBOAEcAVgXADEQCAEAUx8SHgsdHhYAjgCWAKYAUQBqIAIxAHYAbwCXAxUDJzIDIUlGTzEAkQJPAMcCVwKkAMAClgKWApYClgKWApYCiwKWApYClgKWApYClgKVApUCmAKgApcClgKWApQClAKUApQCkgKVAnUB1AKXAp8ClgKWApUeAIETBQD+DQOfAmECOh8BVBg9AuIZEjMbAU4/G1WZAXusRAFpYQEFA0FPAQYAmTEeIJdyADFoAHEANgCRA5zMk/C2jGINwjMWygIZCaXdfDILBCs5dAE7YnQBugDlhoiHhoiGiYqKhouOjIaNkI6Ij4qQipGGkoaThpSSlYaWhpeKmIaZhpqGm4aci52QnoqfhuIC4XTpAt90AIp0LHSoAIsAdHQEQwRABEIERQRDBEkERgRBBEcESQRIBEQERgRJAJ5udACrA490ALxuAQ10ANFZdHQA13QCFHQA/mJ0AP4BIQD+APwA/AD9APwDhGZ03ASMK23HAP4A/AD8AP0A/CR0dACRYnQA/gCRASEA/gCRAvQA/gCRA4RmdNwEjCttxyR0AP9idAEhAP4A/gD8APwA/QD8AP8A/AD8AP0A/AOEZnTcBIwrbcckdHQAkWJ0ASEA/gCRAP4AkQL0AP4AkQOEZnTcBIwrbcckdAJLAT50AlIBQXQCU8l0dAJfdHQDpgL0A6YDpgOnA6cDpwOnA4RmdNwEjCttxyR0dACRYnQBIQOmAJEDpgCRAvQDpgCRA4RmdNwEjCttxyR0BDh0AJEEOQCRDpU5dSgCADR03gV2CwArdAEFAM5iCnR0AF1iAAYcOgp0dACRCnQAXAEIwWZ0CnRmdHQAkWZ0CnRmdEXgAFF03gp0dEY0tlT2u3SOAQTwscwhjZZKrhYcBSfFp9XNbKiVDOD2b+cpe4/Z17mQnbtzzhaeQtE2GGj0IDNTjRUSyTxxw/RPHW/+vS7d1NfRt9z9QPZg4X7QFfhCnkvgNPIItOsC2eV6hPannZNHlZ9xrwZXIMOlu3jSoQSq78WEjwLjw1ELSlF1aBvfzwk5ZX7AUvQzjPQKbDuQ+sm4wNOp4A6AdVuRS0t1y/DZpg4R6m7FNjM9HgvW7Bi88zaMjOo6lM8wtBBdj8LP4ylv3zCXPhebMKJc066o9sF71oFW/8JXu86HJbwDID5lzw5GWLR/LhT0Qqnp2JQxNZNfcbLIzPy+YypqRm/lBmGmex+82+PisxUumSeJkALIT6rJezxMH+CTJmQtt5uwTVbL3ptmjDUQzlSIvWi8Tl7ng1NpuRn1Ng4n14Qc+3Iil7OwkvNWogLSPkn3pihIFytyIGmMhOe3n1tWsuMy9BdKyqF4Z3v2SgggTL9KVvMXPnCbRe+oOuFFP3HejBG/w9gvmfNYvg6JuWia2lcSSN1uIjBktzoIazOHPJZ7kKHPz8mRWVdW3lA8WGF9dQF6Bm673boov3BUWDU2JNcahR23GtfHKLOz/viZ+rYnZFaIznXO67CYEJ1fXuTRpZhYZkKe54xeoagkNGLs+NTZHE0rX45/XvQ2RGADX6vcAvdxIUBV27wxGm2zjZo4X3ILgAlrOFheuZ6wtsvaIj4yLY7qqawlliaIcrz2G+c3vscAnCkCuMzMmZvMfu9lLwTvfX+3cVSyPdN9ZwgDZhfjRgNJcLiJ67b9xx8JHswprbiE3v9UphotAPIgnXVIN5KmMc0piXhc6cChPnN+MRhG9adtdttQTTwSIpl8I4/j//d3sz1326qTBTpPRM/Hgh3kzqEXs8ZAk4ErQhNO8hzrQ0DLkWMA/N+91tn2MdOJnWC2FCZehkQrwzwbKOjhvZsbM95QoeL9skYyMf4srVPVJSgg7pOLUtr/n9eT99oe9nLtFRpjA9okV2Kj8h9k5HaC0oivRD8VyXkJ81tcd4fHNXPCfloIQasxsuO18/46dR2jgul/UIet2G0kRvnyONMKhHs6J26FEoqSqd+rfYjeEGwHWVDpX1fh1jBBcKGMqRepju9Y00mDVHC+Xdij/j44rKfvfjGinNs1jO/0F3jB83XCDINN/HB84axlP+3E/klktRo+vl3U/aiyMJbIodE1XSsDn6UAzIoMtUObY2+k/4gY/l+AkZJ5Sj2vQrkyLm3FoxjhDX+31UXBFf9XrAH31fFqoBmDEZvhvvpnZ87N+oZEu7U9O/nnk+QWj3x8uyoRbEnf+O5UMr9i0nHP38IF5AvzrBW8YWBUR0mIAzIvndQq9N3v/Jto3aPjPXUPl8ASdPPyAp7jENf8bk7VMM9ol9XGmlBmeDMuGqt+WzuL6CXAxXjIhCPM5vACchgMJ/8XBGLO/D1isVvGhwwHHr1DLaI5mn2Jr/b1pUD90uciDaS8cXNDzCWvNmT/PhQe5e8nTnnnkt8Ds/SIjibcum/fqDhKopxAY8AkSrPn+IGDEKOO+U3XOP6djFs2H5N9+orhOahiQk5KnEUWa+CzkVzhp8bMHRbg81qhjjXuIKbHjSLSIBKWqockGtKinY+z4/RdBUF6pcc3JmnlxVcNgrI4SEzKUZSwcD2QCyxzKve+gAmg6ZuSRkpPFa6mfThu7LJNu3H5K42uCpNvPAsoedolKV/LHe/eJ+BbaG5MG0NaSGVPRUmNFMFFSSpXEcXwbVh7UETOZZtoVNRGOIbbkig3McEtR68cG0RZAoJevWYo7Dg/lZ1CQzblWeUvVHmr8fY4Nqd9JJiH/zEX24mJviH60fAyFr0A3c4bC1j3yZU60VgJxXn8JgJXLUIsiBnmKmMYz+7yBQFBvqb2eYnuW59joZBf56/wXvWIR4R8wTmV80i1mZy+S4+BUES+hzjk0uXpC///z/IlqHZ1monzlXp8aCfhGKMti73FI1KbL1q6IKO4fuBuZ59gagjn5xU79muMpHXg6S+e+gDM/U9BKLHbl9l6o8czQKl4RUkJJiqftQG2i3BMg/TQlUYFkJDYBOOvAugYuzYSDnZbDDd/aSd9x0Oe6F+bJcHfl9+gp6L5/TgA+BdFFovbfCrQ40s5vMPw8866pNX8zyFGeFWdxIpPVp9Rg1UPOVFbFZrvaFq/YAzHQgqMWpahMYfqHpmwXfHL1/kpYmGuHFwT55mQu0dylfNuq2Oq0hTMCPwqfxnuBIPLXfci4Y1ANy+1CUipQxld/izVh16WyG2Q0CQQ9NqtAnx1HCHwDj7sYxOSB0wopZSnOzxQOcExmxrVTF2BkOthVpGfuhaGECfCJpJKpjnihY+xOT2QJxN61+9K6QSqtv2Shr82I3jgJrqBg0wELFZPjvHpvzTtaJnLK6Vb97Yn933koO/saN7fsjwNKzp4l2lJVx2orjCGzC/4ZL4zCver6aQYtC5sdoychuFE6ufOiog+VWi5UDkbmvmtah/3aArEBIi39s5ILUnlFLgilcGuz9CQshEY7fw2ouoILAYPVT/gyAIq3TFAIwVsl+ktkRz/qGfnCDGrm5gsl/l9QdvCWGsjPz3dU7XuqKfdUrr/6XIgjp4rey6AJBmCmUJMjITHVdFb5m1p+dLMCL8t55zD42cmftmLEJC0Da04YiRCVUBLLa8D071/N5UBNBXDh0LFsmhV/5B5ExOB4j3WVG/S3lfK5o+V6ELHvy6RR9n4ac+VsK4VE4yphPvV+kG9FegTBH4ZRXL2HytUHCduJazB/KykjfetYxOXTLws267aGOd+I+JhKP//+VnXmS90OD/jvLcVu0asyqcuYN1mSb6XTlCkqv1vigZPIYwNF/zpWcT1GR/6aEIRjkh0yhg4LXJfaGobYJTY4JI58KiAKgmmgAKWdl5nYCeLqavRJGQNuYuZtZFGx+IkI4w4NS2xwbetNMunOjBu/hmKCI/w7tfiiyUd//4rbTeWt4izBY8YvGIN6vyKYmP/8X8wHKCeN+WRcKM70+tXKNGyevU9H2Dg5BsljnTf8YbsJ1TmMs74Ce2XlHisleguhyeg44rQOHZuw/6HTkhnnurK2d62q6yS7210SsAIaR+jXMQA+svkrLpsUY+F30Uw89uOdGAR6vo4FIME0EfVVeHTu6eKicfhSqOeXJhbftcd08sWEnNUL1C9fnprTgd83IMut8onVUF0hvqzZfHduPjbjwEXIcoYmy+P6tcJZHmeOv6VrvEdkHDJecjHuHeWANe79VG662qTjA/HCvumVv3qL+LrOcpqGps2ZGwQdFJ7PU4iuyRlBrwfO+xnPyr47s2cXVbWzAyznDiBGjCM3ksxjjqM62GE9C8f5U38kB3VjtabKp/nRdvMESPGDG90bWRLAt1Qk5DyLuazRR1YzdC1c+hZXvAWV8xA72S4A8B67vjVhbba3MMop293FeEXpe7zItMWrJG/LOH9ByOXmYnNJfjmfuX9KbrpgLOba4nZ+fl8Gbdv/ihv+6wFGKHCYrVwmhFC0J3V2bn2tIB1wCc1CST3d3X2OyxhguXcs4sm679UngzofuSeBewMFJboIQHbUh/m2JhW2hG9DIvG2t7yZIzKBTz9wBtnNC+2pCRYhSIuQ1j8xsz5VvqnyUIthvuoyyu7fNIrg/KQUVmGQaqkqZk/Vx5b33/gsEs8yX7SC1J+NV4icz6bvIE7C5G6McBaI8rVg56q5QBJWxn/87Q1sPK4+sQa8fLU5gXo4paaq4cOcQ4wR0VBHPGjKh+UlPCbA1nLXyEUX45qZ8J7/Ln4FPJE2TdzD0Z8MLSNQiykMMmSyOCiFfy84Rq60emYB2vD09KjYwsoIpeDcBDTElBbXxND72yhd9pC/1CMid/5HUMvAL27OtcIJDzNKpRPNqPOpyt2aPGz9QWIs9hQ9LiX5s8m9hjTUu/f7MyIatjjd+tSfQ3ufZxPpmJhTaBtZtKLUcfOCUqADuO+QoH8B9v6U+P0HV1GLQmtoNFTb3s74ivZgjES0qfK+8RdGgBbcCMSy8eBvh98+et1KIFqSe1KQPyXULBMTsIYnysIwiZBJYdI20vseV+wuJkcqGemehKjaAb9L57xZm3g2zX0bZ2xk/fU+bCo7TlnbW7JuF1YdURo/2Gw7VclDG1W7LOtas2LX4upifZ/23rzpsnY/ALfRgrcWP5hYmV9VxVOQA1fZvp9F2UNU+7d7xRyVm5wiLp3/0dlV7vdw1PMiZrbDAYzIVqEjRY2YU03sJhPnlwIPcZUG5ltL6S8XCxU1eYS5cjr34veBmXAvy7yN4ZjArIG0dfD/5UpBNlX1ZPoxJOwyqRi3wQWtOzd4oNKh0LkoTm8cwqgIfKhqqGOhwo71I+zXnMemTv2B2AUzABWyFztGgGULjDDzWYwJUVBTjKCn5K2QGMK1CQT7SzziOjo+BhAmqBjzuc3xYym2eedGeOIRJVyTwDw37iCMe4g5Vbnsb5ZBdxOAnMT7HU4DHpxWGuQ7GeiY30Cpbvzss55+5Km1YsbD5ea3NI9QNYIXol5apgSu9dZ8f8xS5dtHpido5BclDuLWY4lhik0tbJa07yJhH0BOyEut/GRbYTS6RfiTYWGMCkNpfSHi7HvdiTglEVHKZXaVhezH4kkXiIvKopYAlPusftpE4a5IZwvw1x/eLvoDIh/zpo9FiQInsTb2SAkKHV42XYBjpJDg4374XiVb3ws4qM0s9eSQ5HzsMU4OZJKuopFjBM+dAZEl8RUMx5uU2N486Kr141tVsGQfGjORYMCJAMsxELeNT4RmWjRcpdTGBwcx6XN9drWqPmJzcrGrH4+DRc7+n1w3kPZwu0BkNr6hQrqgo7JTB9A5kdJ/H7P4cWBMwsmuixAzJB3yrQpnGIq90lxAXLzDCdn1LPibsRt7rHNjgQBklRgPZ8vTbjXdgXrTWQsK5MdrXXQVPp0Rinq3frzZKJ0qD6Qhc40VzAraUXlob1gvkhK3vpmHgI6FRlQZNx6eRqkp0zy4AQlX813fAPtL3jMRaitGFFjo0zmErloC+h+YYdVQ6k4F/epxAoF0BmqEoKNTt6j4vQZNQ2BoqF9Vj53TOIoNmDiu9Xp15RkIgQIGcoLpfoIbenzpGUAtqFJp5W+LLnx38jHeECTJ/navKY1NWfN0sY1T8/pB8kIH3DU3DX+u6W3YwpypBMYOhbSxGjq84RZ84fWJow8pyHqn4S/9J15EcCMsXqrfwyd9mhiu3+rEo9pPpoJkdZqHjra4NvzFwuThNKy6hao/SlLw3ZADUcUp3w3SRVfW2rhl80zOgTYnKE0Hs2qp1J6H3xqPqIkvUDRMFDYyRbsFI3M9MEyovPk8rlw7/0a81cDVLmBsR2ze2pBuKb23fbeZC0uXoIvDppfTwIDxk1Oq2dGesGc+oJXWJLGkOha3CX+DUnzgAp9HGH9RsPZN63Hn4RMA5eSVhPHO+9RcRb/IOgtW31V1Q5IPGtoxPjC+MEJbVlIMYADd9aHYWUIQKopuPOHmoqSkubnAKnzgKHqgIOfW5RdAgotN6BN+O2ZYHkuemLnvQ8U9THVrS1RtLmKbcC7PeeDsYznvqzeg6VCNwmr0Yyx1wnLjyT84BZz3EJyCptD3yeueAyDWIs0L2qs/VQ3HUyqfrja0V1LdDzqAikeWuV4sc7RLIB69jEIBjCkyZedoUHqCrOvShVzyd73OdrJW0hPOuQv2qOoHDc9xVb6Yu6uq3Xqp2ZaH46A7lzevbxQEmfrzvAYSJuZ4WDk1Hz3QX1LVdiUK0EvlAGAYlG3Md30r7dcPN63yqBCIj25prpvZP0nI4+EgWoFG95V596CurXpKRBGRjQlHCvy5Ib/iW8nZJWwrET3mgd6mEhfP4KCuaLjopWs7h+MdXFdIv8dHQJgg1xi1eYqB0uDYjxwVmri0Sv5XKut/onqapC+FQiC2C1lvYJ9MVco6yDYsS3AANUfMtvtbYI2hfwZatiSsnoUeMZd34GVjkMMKA+XnjJpXgRW2SHTZplVowPmJsvXy6w3cfO1AK2dvtZEKTkC/TY9LFiKHCG0DnrMQdGm2lzlBHM9iEYynH2UcVMhUEjsc0oDBTgo2ZSQ1gzkAHeWeBXYFjYLuuf8yzTCy7/RFR81WDjXMbq2BOH5dURnxo6oivmxL3cKzKInlZkD31nvpHB9Kk7GfcfE1t+1V64b9LtgeJGlpRFxQCAqWJ5DoY77ski8gsOEOr2uywZaoO/NGa0X0y1pNQHBi3b2SUGNpcZxDT7rLbBf1FSnQ8guxGW3W+36BW0gBje4DOz6Ba6SVk0xiKgt+q2JOFyr4SYfnu+Ic1QZYIuwHBrgzr6UvOcSCzPTOo7D6IC4ISeS7zkl4h+2VoeHpnG/uWR3+ysNgPcOIXQbv0n4mr3BwQcdKJxgPSeyuP/z1Jjg4e9nUvoXegqQVIE30EHx5GHv+FAVUNTowYDJgyFhf5IvlYmEqRif6+WN1MkEJmDcQITx9FX23a4mxy1AQRsOHO/+eImX9l8EMJI3oPWzVXxSOeHU1dUWYr2uAA7AMb+vAEZSbU3qob9ibCyXeypEMpZ6863o6QPqlqGHZkuWABSTVNd4cOh9hv3qEpSx2Zy/DJMP6cItEmiBJ5PFqQnDEIt3NrA3COlOSgz43D7gpNFNJ5MBh4oFzhDPiglC2ypsNU4ISywY2erkyb1NC3Qh/IfWj0eDgZI4/ln8WPfBsT3meTjq1Uqt1E7Zl/qftqkx6aM9KueMCekSnMrcHj1CqTWWzEzPsZGcDe3Ue4Ws+XFYVxNbOFF8ezkvQGR6ZOtOLU2lQEnMBStx47vE6Pb7AYMBRj2OOfZXfisjJnpTfSNjo6sZ6qSvNxZNmDeS7Gk3yYyCk1HtKN2UnhMIjOXUzAqDv90lx9O/q/AT1ZMnit5XQe9wmQxnE/WSH0CqZ9/2Hy+Sfmpeg8RwsHI5Z8kC8H293m/LHVVM/BA7HaTJYg5Enk7M/xWpq0192ACfBai2LA/qrCjCr6Dh1BIMzMXINBmX96MJ5Hn2nxln/RXPFhwHxUmSV0EV2V0jm86/dxxuYSU1W7sVkEbN9EzkG0QFwPhyHKyb3t+Fj5WoUUTErcazE/N6EW6Lvp0d//SDPj7EV9UdJN+Amnf3Wwk3A0SlJ9Z00yvXZ7n3z70G47Hfsow8Wq1JXcfwnA+Yxa5mFsgV464KKP4T31wqIgzFPd3eCe3j5ory5fBF2hgCFyVFrLzI9eetNXvM7oQqyFgDo4CTp/hDV9NMX9JDHQ/nyHTLvZLNLF6ftn2OxjGm8+PqOwhxnPHWipkE/8wbtyri80Sr7pMNkQGMfo4ZYK9OcCC4ESVFFbLMIvlxSoRqWie0wxqnLfcLSXMSpMMQEJYDVObYsXIQNv4TGNwjq1kvT1UOkicTrG3IaBZ3XdScS3u8sgeZPVpOLkbiF940FjbCeNRINNvDbd01EPBrTCPpm12m43ze1bBB59Ia6Ovhnur/Nvx3IxwSWol+3H2qfCJR8df6aQf4v6WiONxkK+IqT4pKQrZK/LplgDI/PJZbOep8dtbV7oCr6CgfpWa8NczOkPx81iSHbsNhVSJBOtrLIMrL31LK9TqHqAbAHe0RLmmV806kRLDLNEhUEJfm9u0sxpkL93Zgd6rw+tqBfTMi59xqXHLXSHwSbSBl0EK0+loECOPtrl+/nsaFe197di4yUgoe4jKoAJDXc6DGDjrQOoFDWZJ9HXwt8xDrQP+7aRwWKWI1GF8s8O4KzxWBBcwnl3vnl1Oez3oh6Ea1vjR7/z7DDTrFtqU2W/KAEzAuXDNZ7MY73MF216dzdSbWmUp4lcm7keJfWaMHgut9x5C9mj66Z0lJ+yhsjVvyiWrfk1lzPOTdhG15Y7gQlXtacvI7qv/XNSscDwqkgwHT/gUsD5yB7LdRRvJxQGYINn9hTpodKFVSTPrtGvyQw+HlRFXIkodErAGu9Iy1YpfSPc3jkFh5CX3lPxv7aqjE/JAfTIpEjGb/H7MO0e2vsViSW1qa/Lmi4/n4DEI3g7lYrcanspDfEpKkdV1OjSLOy0BCUqVoECaB55vs06rXl4jqmLsPsFM/7vYJ0vrBhDCm/00A/H81l1uekJ/6Lml3Hb9+NKiLqATJmDpyzfYZFHumEjC662L0Bwkxi7E9U4cQA0XMVDuMYAIeLMPgQaMVOd8fmt5SflFIfuBoszeAw7ow5gXPE2Y/yBc/7jExARUf/BxIHQBF5Sn3i61w4z5xJdCyO1F1X3+3ax+JSvMeZ7S6QSKp1Fp/sjYz6Z+VgCZzibGeEoujryfMulH7Rai5kAft9ebcW50DyJr2uo2z97mTWIu45YsSnNSMrrNUuG1XsYBtD9TDYzQffKB87vWbkM4EbPAFgoBV4GQS+vtFDUqOFAoi1nTtmIOvg38N4hT2Sn8r8clmBCXspBlMBYTnrqFJGBT3wZOzAyJDre9dHH7+x7qaaKDOB4UQALD5ecS0DE4obubQEiuJZ0EpBVpLuYcce8Aa4PYd/V4DLDAJBYKQPCWTcrEaZ5HYbJi11Gd6hjGom1ii18VHYnG28NKpkz2UKVPxlhYSp8uZr367iOmoy7zsxehW9wzcy2zG0a80PBMCRQMb32hnaHeOR8fnNDzZhaNYhkOdDsBUZ3loDMa1YP0uS0cjUP3b/6DBlqmZOeNABDsLl5BI5QJups8uxAuWJdkUB/pO6Zax6tsg7fN5mjjDgMGngO+DPcKqiHIDbFIGudxtPTIyDi9SFMKBDcfdGQRv41q1AqmxgkVfJMnP8w/Bc7N9/TR6C7mGObFqFkIEom8sKi2xYqJLTCHK7cxzaZvqODo22c3wisBCP4HeAgcRbNPAsBkNRhSmD48dHupdBRw4mIvtS5oeF6zeT1KMCyhMnmhpkFAGWnGscoNkwvQ8ZM5lE/vgTHFYL99OuNxdFBxTEDd5v2qLR8y9WkXsWgG6kZNndFG+pO/UAkOCipqIhL3hq7cRSdrCq7YhUsTocEcnaFa6nVkhnSeRYUA1YO0z5itF9Sly3VlxYDw239TJJH6f3EUfYO5lb7bcFcz8Bp7Oo8QmnsUHOz/fagVUBtKEw1iT88j+aKkv8cscKNkMxjYr8344D1kFoZ7/td1W6LCNYN594301tUGRmFjAzeRg5vyoM1F6+bJZ/Q54jN/k8SFd3DxPTYaAUsivsBfgTn7Mx8H2SpPt4GOdYRnEJOH6jHM2p6SgB0gzIRq6fHxGMmSmqaPCmlfwxiuloaVIitLGN8wie2CDWhkzLoCJcODh7KIOAqbHEvXdUxaS4TTTs07Clzj/6GmVs9kiZDerMxEnhUB6QQPlcfqkG9882RqHoLiHGBoHfQuXIsAG8GTAtao2KVwRnvvam8jo1e312GQAKWEa4sUVEAMG4G6ckcONDwRcg1e2D3+ohXgY4UAWF8wHKQMrSnzCgfFpsxh+aHXMGtPQroQasRY4U6UdG0rz1Vjbka0MekOGRZQEvqQFlxseFor8zWFgHek3v29+WqN6gaK5gZOTOMZzpQIC1201LkMCXild3vWXSc5UX9xcFYfbRPzGFa1FDcPfPB/jUEq/FeGt419CI3YmBlVoHsa4KdcwQP5ZSwHHhFJ7/Ph/Rap/4vmG91eDwPP0lDfCDRCLszTqfzM71xpmiKi2HwS4WlqvGNwtvwF5Dqpn6KTq8ax00UMPkxDcZrEEEsIvHiUXXEphdb4GB4FymlPwBz4Gperqq5pW7TQ6/yNRhW8VT5NhuP0udlxo4gILq5ZxAZk8ZGh3g4CqxJlPKY7AQxupfUcVpWT5VItp1+30UqoyP4wWsRo3olRRgkWZZ2ZN6VC3OZFeXB8NbnUrSdikNptD1QiGuKkr8EmSR/AK9Rw+FF3s5uwuPbvHGiPeFOViltMK7AUaOsq9+x9cndk3iJEE5LKZRlWJbKOZweROzmPNVPkjE3K/TyA57Rs68TkZ3MR8akKpm7cFjnjPd/DdkWjgYoKHSr5Wu5ssoBYU4acRs5g2DHxUmdq8VXOXRbunD8QN0LhgkssgahcdoYsNvuXGUK/KXD/7oFb+VGdhqIn02veuM5bLudJOc2Ky0GMaG4W/xWBxIJcL7yliJOXOpx0AkBqUgzlDczmLT4iILXDxxtRR1oZa2JWFgiAb43obrJnG/TZC2KSK2wqOzRZTXavZZFMb1f3bXvVaNaK828w9TO610gk8JNf3gMfETzXXsbcvRGCG9JWQZ6+cDPqc4466Yo2RcKH+PILeKOqtnlbInR3MmBeGG3FH10yzkybuqEC2HSQwpA0An7d9+73BkDUTm30bZmoP/RGbgFN+GrCOfADgqr0WbI1a1okpFms8iHYw9hm0zUvlEMivBRxModrbJJ+9/p3jUdQQ9BCtQdxnOGrT5dzRUmw0593/mbRSdBg0nRvRZM5/E16m7ZHmDEtWhwvfdZCZ8J8M12W0yRMszXamWfQTwIZ4ayYktrnscQuWr8idp3PjT2eF/jmtdhIfcpMnb+IfZY2FebW6UY/AK3jP4u3Tu4zE4qlnQgLFbM19EBIsNf7KhjdbqQ/D6yiDb+NlEi2SKD+ivXVUK8ib0oBo366gXkR8ZxGjpJIDcEgZPa9TcYe0TIbiPl/rPUQDu3XBJ9X/GNq3FAUsKsll57DzaGMrjcT+gctp+9MLYXCq+sqP81eVQ0r9lt+gcQfZbACRbEjvlMskztZG8gbC8Qn9tt26Q7y7nDrbZq/LEz7kR6Jc6pg3N9rVX8Y5MJrGlML9p9lU4jbTkKqCveeZUJjHB03m2KRKR2TytoFkTXOLg7keU1s1lrPMQJpoOKLuAAC+y1HlJucU6ysB5hsXhvSPPLq5J7JtnqHKZ4vYjC4Vy8153QY+6780xDuGARsGbOs1WqzH0QS765rnSKEbbKlkO8oI/VDwUd0is13tKpqILu1mDJFNy/iJAWcvDgjxvusIT+PGz3ST/J9r9Mtfd0jpaGeiLYIqXc7DiHSS8TcjFVksi66PEkxW1z6ujbLLUGNNYnzOWpH8BZGK4bCK7iR+MbIv8ncDAz1u4StN3vTTzewr9IQjk9wxFxn+6N1ddKs0vffJiS08N3a4G1SVrlZ97Q/M+8G9fe5AP6d9/Qq4WRnORVhofPIKEdCr3llspUfE0oKIIYoByBRPh+bX1HLS3JWGJRhIvE1aW4NTd8ePi4Z+kXb+Z8snYfSNcqijhAgVsx4RCM54cXUiYkjeBmmC4ajOHrChoELscJJC7+9jjMjw5BagZKlgRMiSNYz7h7vvZIoQqbtQmspc0cUk1G/73iXtSpROl5wtLgQi0mW2Ex8i3WULhcggx6E1LMVHUsdc9GHI1PH3U2Ko0PyGdn9KdVOLm7FPBui0i9a0HpA60MsewVE4z8CAt5d401Gv6zXlIT5Ybit1VIA0FCs7wtvYreru1fUyW3oLAZ/+aTnZrOcYRNVA8spoRtlRoWflsRClFcgzkqiHOrf0/SVw+EpVaFlJ0g4Kxq1MMOmiQdpMNpte8lMMQqm6cIFXlnGbfJllysKDi+0JJMotkqgIxOSQgU9dn/lWkeVf8nUm3iwX2Nl3WDw9i6AUK3vBAbZZrcJpDQ/N64AVwjT07Jef30GSSmtNu2WlW7YoyW2FlWfZFQUwk867EdLYKk9VG6JgEnBiBxkY7LMo4YLQJJlAo9l/oTvJkSARDF/XtyAzM8O2t3eT/iXa6wDN3WewNmQHdPfsxChU/KtLG2Mn8i4ZqKdSlIaBZadxJmRzVS/o4yA65RTSViq60oa395Lqw0pzY4SipwE0SXXsKV+GZraGSkr/RW08wPRvqvSUkYBMA9lPx4m24az+IHmCbXA+0faxTRE9wuGeO06DIXa6QlKJ3puIyiuAVfPr736vzo2pBirS+Vxel3TMm3JKhz9o2ZoRvaFVpIkykb0Hcm4oHFBMcNSNj7/4GJt43ogonY2Vg4nsDQIWxAcorpXACzgBqQPjYsE/VUpXpwNManEru4NwMCFPkXvMoqvoeLN3qyu/N1eWEHttMD65v19l/0kH2mR35iv/FI+yjoHJ9gPMz67af3Mq/BoWXqu3rphiWMXVkmnPSEkpGpUI2h1MThideGFEOK6YZHPwYzMBvpNC7+ZHxPb7epfefGyIB4JzO9DTNEYnDLVVHdQyvOEVefrk6Uv5kTQYVYWWdqrdcIl7yljwwIWdfQ/y+2QB3eR/qxYObuYyB4gTbo2in4PzarU1sO9nETkmj9/AoxDA+JM3GMqQtJR4jtduHtnoCLxd1gQUscHRB/MoRYIEsP2pDZ9KvHgtlk1iTbWWbHhohwFEYX7y51fUV2nuUmnoUcqnWIQAAgl9LTVX+Bc0QGNEhChxHR4YjfE51PUdGfsSFE6ck7BL3/hTf9jLq4G1IafINxOLKeAtO7quulYvH5YOBc+zX7CrMgWnW47/jfRsWnJjYYoE7xMfWV2HN2iyIqLI";const xy=new Map([[8217,"apostrophe"],[8260,"fraction slash"],[12539,"middle dot"]]),Iy=4;function a3(r){let e=0;function t(){return r[e++]<<8|r[e++]}let n=t(),s=1,i=[0,1];for(let I=1;I<n;I++)i.push(s+=t());let o=t(),a=e;e+=o;let c=0,l=0;function u(){return c==0&&(l=l<<8|r[e++],c=8),l>>--c&1}const h=31,f=2**h,d=f>>>1,p=d>>1,g=f-1;let m=0;for(let I=0;I<h;I++)m=m<<1|u();let b=[],x=0,v=f;for(;;){let I=Math.floor(((m-x+1)*s-1)/v),A=0,O=n;for(;O-A>1;){let L=A+O>>>1;I<i[L]?O=L:A=L}if(A==0)break;b.push(A);let D=x+Math.floor(v*i[A]/s),B=x+Math.floor(v*i[A+1]/s)-1;for(;((D^B)&d)==0;)m=m<<1&g|u(),D=D<<1&g,B=B<<1&g|1;for(;D&~B&p;)m=m&d|m<<1&g>>>1|u(),D=D<<1^d,B=(B^d)<<1|d|1;x=D,v=1+B-D}let S=n-4;return b.map(I=>{switch(I-S){case 3:return S+65792+(r[a++]<<16|r[a++]<<8|r[a++]);case 2:return S+256+(r[a++]<<8|r[a++]);case 1:return S+r[a++];default:return I-1}})}function c3(r){let e=0;return()=>r[e++]}function w1(r){return c3(a3(l3(r)))}function l3(r){let e=[];[..."ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"].forEach((s,i)=>e[s.charCodeAt(0)]=i);let t=r.length,n=new Uint8Array(6*t>>3);for(let s=0,i=0,o=0,a=0;s<t;s++)a=a<<6|e[r.charCodeAt(s)],o+=6,o>=8&&(n[i++]=a>>(o-=8));return n}function u3(r){return r&1?~r>>1:r>>1}function h3(r,e){let t=Array(r);for(let n=0,s=0;n<r;n++)t[n]=s+=u3(e());return t}function $c(r,e=0){let t=[];for(;;){let n=r(),s=r();if(!s)break;e+=n;for(let i=0;i<s;i++)t.push(e+i);e+=s+1}return t}function b1(r){return Lc(()=>{let e=$c(r);if(e.length)return e})}function v1(r){let e=[];for(;;){let t=r();if(t==0)break;e.push(f3(t,r))}for(;;){let t=r()-1;if(t<0)break;e.push(d3(t,r))}return e.flat()}function Lc(r){let e=[];for(;;){let t=r(e.length);if(!t)break;e.push(t)}return e}function E1(r,e,t){let n=Array(r).fill().map(()=>[]);for(let s=0;s<e;s++)h3(r,t).forEach((i,o)=>n[o].push(i));return n}function f3(r,e){let t=1+e(),n=e(),s=Lc(e);return E1(s.length,1+r,e).flatMap((o,a)=>{let[c,...l]=o;return Array(s[a]).fill().map((u,h)=>{let f=h*n;return[c+h*t,l.map(d=>d+f)]})})}function d3(r,e){let t=1+e();return E1(t,1+r,e).map(s=>[s[0],s.slice(1)])}function p3(r){let e=[],t=$c(r);return s(n([]),[]),e;function n(i){let o=r(),a=Lc(()=>{let c=$c(r).map(l=>t[l]);if(c.length)return n(c)});return{S:o,B:a,Q:i}}function s({S:i,B:o},a,c){if(!(i&4&&c===a[a.length-1])){i&2&&(c=a[a.length-1]),i&1&&e.push(a);for(let l of o)for(let u of l.Q)s(l,[...a,u],c)}}}function g3(r){return r.toString(16).toUpperCase().padStart(2,"0")}function A1(r){return`{${g3(r)}}`}function y3(r){let e=[];for(let t=0,n=r.length;t<n;){let s=r.codePointAt(t);t+=s<65536?1:2,e.push(s)}return e}function ka(r){let t=r.length;if(t<4096)return String.fromCodePoint(...r);let n=[];for(let s=0;s<t;)n.push(String.fromCodePoint(...r.slice(s,s+=4096)));return n.join("")}function m3(r,e){let t=r.length,n=t-e.length;for(let s=0;n==0&&s<t;s++)n=r[s]-e[s];return n}var w3="AEUDTAHBCFQATQDRADAAcgAgADQAFAAsABQAHwAOACQADQARAAoAFwAHABIACAAPAAUACwAFAAwABAAQAAMABwAEAAoABQAIAAIACgABAAQAFAALAAIACwABAAIAAQAHAAMAAwAEAAsADAAMAAwACgANAA0AAwAKAAkABAAdAAYAZwDSAdsDJgC0CkMB8xhZAqfoC190UGcThgBurwf7PT09Pb09AjgJum8OjDllxHYUKXAPxzq6tABAxgK8ysUvWAgMPT09PT09PSs6LT2HcgWXWwFLoSMEEEl5RFVMKvO0XQ8ExDdJMnIgsj26PTQyy8FfEQ8AY8IPAGcEbwRwBHEEcgRzBHQEdQR2BHcEeAR6BHsEfAR+BIAEgfndBQoBYgULAWIFDAFiBNcE2ATZBRAFEQUvBdALFAsVDPcNBw13DYcOMA4xDjMB4BllHI0B2grbAMDpHLkQ7QHVAPRNQQFnGRUEg0yEB2uaJF8AJpIBpob5AERSMAKNoAXqaQLUBMCzEiACnwRZEkkVsS7tANAsBG0RuAQLEPABv9HICTUBXigPZwRBApMDOwAamhtaABqEAY8KvKx3LQ4ArAB8UhwEBAVSagD8AEFZADkBIadVj2UMUgx5Il4ANQC9AxIB1BlbEPMAs30CGxlXAhwZKQIECBc6EbsCoxngzv7UzRQA8M0BawL6ZwkN7wABAD33OQRcsgLJCjMCjqUChtw/km+NAsXPAoP2BT84PwURAK0RAvptb6cApQS/OMMey5HJS84UdxpxTPkCogVFITaTOwERAK5pAvkNBOVyA7q3BKlOJSALAgUIBRcEdASpBXqzABXFSWZOawLCOqw//AolCZdvv3dSBkEQGyelEPcMMwG1ATsN7UvYBPEGOwTJH30ZGQ/NlZwIpS3dDO0m4y6hgFoj9SqDBe1L9DzdC01RaA9ZC2UJ4zpjgU4DIQENIosK3Q05CG0Q8wrJaw3lEUUHOQPVSZoApQcBCxEdNRW1JhBirAsJOXcG+xr2C48mrxMpevwF0xohBk0BKRr/AM8u54WwWjFcHE9fBgMLJSPHFKhQIA0lQLd4SBobBxUlqQKRQ3BKh1E2HpMh9jw9DWYuE1F8B/U8BRlPC4E8nkarRQ4R0j6NPUgiSUwsBDV/LC8niwnPD4UMuXxyAVkJIQmxDHETMREXN8UIOQcZLZckJxUIIUaVYJoE958D8xPRAwsFPwlBBxMDtRwtEy4VKQUNgSTXAvM21S6zAo9WgAEXBcsPJR/fEFBH4A7pCJsCZQODJesALRUhABcimwhDYwBfj9hTBS7LCMdqbCN0A2cU52ERcweRDlcHpxwzFb8c4XDIXguGCCijrwlbAXUJmQFfBOMICTVbjKAgQWdTi1gYmyBhQT9d/AIxDGUVn0S9h3gCiw9rEhsBNQFzBzkNAQJ3Ee0RaxCVCOuGBDW1M/g6JQRPIYMgEQonA09szgsnJvkM+GkBoxJiAww0PXfuZ6tgtiQX/QcZMsVBYCHxC5JPzQycGsEYQlQuGeQHvwPzGvMn6kFXBf8DowMTOk0z7gS9C2kIiwk/AEkOoxcH1xhqCnGM0AExiwG3mQNXkYMCb48GNwcLAGcLhwV55QAdAqcIowAFAM8DVwA5Aq0HnQAZAIVBAT0DJy8BIeUCjwOTCDHLAZUvAfMpBBvDDBUA9zduSgLDsQKAamaiBd1YAo4CSTUBTSUEBU5HUQOvceEA2wBLBhPfRwEVq0rLGuNDAd9vKwDHAPsABTUHBUEBzQHzbQC3AV8LMQmis7UBTekpAIMAFWsB1wKJAN0ANQB/8QFTAE0FWfkF0wJPSQERMRgrV2EBuwMfATMBDQB5BsuNpckHHwRtB9MCEBsV4QLvLge1AQMi3xPNQsUCvd5VoWACZIECYkJbTa9bNyACofcCaJgCZgkCn4Q4GwsCZjsCZiYEbgR/A38TA36SOQY5dxc5gjojIwJsHQIyNjgKAm3HAm2u74ozZ0UrAWcA3gDhAEoFB5gMjQD+C8IADbUCdy8CdqI/AnlLQwJ4uh1c20WuRtcCfD8CesgCfQkCfPAFWQUgSABIfWMkAoFtAoAAAoAFAn+uSVhKWxUXSswC0QEC0MxLJwOITwOH5kTFkTIC8qFdAwMDrkvOTC0lA89NTE2vAos/AorYwRsHHUNnBbcCjjcCjlxAl4ECjtkCjlx4UbRTNQpS1FSFApP7ApMMAOkAHFUeVa9V0AYsGymVhjLheGZFOzkCl58C77JYIagAWSUClo8ClnycAKlZrFoJgU0AOwKWtQKWTlxEXNECmcsCmWRcyl0HGQKcmznCOp0CnBYCn5sCnriKAB0PMSoPAp3xAp6SALU9YTRh7wKe0wKgbgGpAp6fHwKeTqVjyGQnJSsCJ68CJn4CoPsCoEwCot0CocQCpi8Cpc4Cp/8AfQKn8mh8aLEAA0lqHGrRAqzjAqyuAq1nAq0CAlcdAlXcArHh1wMfTmyXArK9DQKy6Bds4G1jbUhfAyXNArZcOz9ukAMpRQK4XgK5RxUCuSp3cDZw4QK9GQK72nCWAzIRAr6IcgIDM3ECvhpzInNPAsPLAsMEc4J0SzVFdOADPKcDPJoDPb8CxXwCxkcCxhCJAshpUQLIRALJTwLJLgJknQLd0nh5YXiueSVL0AMYo2cCAmH0GfOVJHsLXpJeuxECz2sCz2wvS1PS8xOfAMatAs9zASnqA04SfksFAtwnAtuKAtJPA1JcA1NfAQEDVYyAiT8AyxbtYEWCHILTgs6DjQLaxwLZ3oQQhEmnPAOGpQAvA2QOhnFZ+QBVAt9lAt64c3cC4i/tFAHzMCcB9JsB8tKHAuvzAulweQLq+QLq5AD5RwG5Au6JAuuclqqXAwLuPwOF4Jh5cOBxoQLzAwBpA44WmZMC9xMDkW4DkocC95gC+dkC+GaaHJqruzebHgOdgwL++gEbADmfHJ+zAwWNA6ZqA6bZANHFAwZqoYiiBQkDDEkCwAA/AwDhQRdTARHzA2sHl2cFAJMtK7evvdsBiZkUfxEEOQH7KQUhDp0JnwCS/SlXxQL3AZ0AtwW5AG8LbUEuFCaNLgFDAYD8AbUmAHUDDgRtACwCFgyhAAAKAj0CagPdA34EkQEgRQUhfAoABQBEABMANhICdwEABdUDa+8KxQIA9wqfJ7+xt+UBkSFBQgHpFH8RNMCJAAQAGwBaAkUChIsABjpTOpSNbQC4Oo860ACNOME63AClAOgAywE6gTo7Ofw5+Tt2iTpbO56JOm85GAFWATMBbAUvNV01njWtNWY1dTW2NcU1gjWRNdI14TWeNa017jX9NbI1wTYCNhE1xjXVNhY2JzXeNe02LjY9Ni41LSE2OjY9Njw2yTcIBJA8VzY4Nt03IDcPNsogN4k3MAoEsDxnNiQ3GTdsOo03IULUQwdC4EMLHA8PCZsobShRVQYA6X8A6bABFCnXAukBowC9BbcAbwNzBL8MDAMMAQgDAAkKCwsLCQoGBAVVBI/DvwDz9b29kaUCb0QtsRTNLt4eGBcSHAMZFhYZEhYEARAEBUEcQRxBHEEcQRxBHEEaQRxBHEFCSTxBPElISUhBNkM2QTYbNklISVmBVIgBFLWZAu0BhQCjBcEAbykBvwGJAaQcEZ0ePCklMAAhMvAIMAL54gC7Bm8EescjzQMpARQpKgDUABavAj626xQAJP0A3etzuf4NNRA7efy2Z9NQrCnC0OSyANz5BBIbJ5IFDR6miIavYS6tprjjmuKebxm5C74Q225X1pkaYYPb6f1DK4k3xMEBb9S2WMjEibTNWhsRJIA+vwNVEiXTE5iXs/wezV66oFLfp9NZGYW+Gk19J2+bCT6Ye2w6LDYdgzKMUabk595eLBCXANz9HUpWbATq9vqXVx9XDg+Pc9Xp4+bsS005SVM/BJBM4687WUuf+Uj9dEi8aDNaPxtpbDxcG1THTImUMZq4UCaaNYpsVqraNyKLJXDYsFZ/5jl7bLRtO88t7P3xZaAxhb5OdPMXqsSkp1WCieG8jXm1U99+blvLlXzPCS+M93VnJCiK+09LfaSaBAVBomyDgJua8dfUzR7ga34IvR2Nvj+A9heJ6lsl1KG4NkI1032Cnff1m1wof2B9oHJK4bi6JkEdSqeNeiuo6QoZZincoc73/TH9SXF8sCE7XyuYyW8WSgbGFCjPV0ihLKhdPs08Tx82fYAkLLc4I2wdl4apY7GU5lHRFzRWJep7Ww3wbeA3qmd59/86P4xuNaqDpygXt6M85glSBHOCGgJDnt+pN9bK7HApMguX6+06RZNjzVmcZJ+wcUrJ9//bpRNxNuKpNl9uFds+S9tdx7LaM5ZkIrPj6nIU9mnbFtVbs9s/uLgl8MVczAwet+iOEzzBlYW7RCMgE6gyNLeq6+1tIx4dpgZnd0DksJS5f+JNDpwwcPNXaaVspq1fbQajOrJgK0ofKtJ1Ne90L6VO4MOl5S886p7u6xo7OLjG8TGL+HU1JXGJgppg4nNbNJ5nlzSpuPYy21JUEcUA94PoFiZfjZue+QnyQ80ekOuZVkxx4g+cvhJfHgNl4hy1/a6+RKcKlar/J29y//EztlbVPHVUeQ1zX86eQVAjR/M3dA9w4W8LfaXp4EgM85wOWasli837PzVMOnsLzR+k3o75/lRPAJSE1xAKQzEi5v10ke+VBvRt1cwQRMd+U5mLCTGVd6XiZtgBG5cDi0w22GKcVNvHiu5LQbZEDVtz0onn7k5+heuKXVsZtSzilkLRAUmjMXEMB3J9YC50XBxPiz53SC+EhnPl9WsKCv92SM/OFFIMJZYfl0WW8tIO3UxYcwdMAj7FSmgrsZ2aAZO03BOhP1bNNZItyXYQFTpC3SG1VuPDqH9GkiCDmE+JwxyIVSO5siDErAOpEXFgjy6PQtOVDj+s6e1r8heWVvmZnTciuf4EiNZzCAd7SOMhXERIOlsHIMG399i9aLTy3m2hRLZjJVDNLS53iGIK11dPqQt0zBDyg6qc7YqkDm2M5Ve6dCWCaCbTXX2rToaIgz6+zh4lYUi/+6nqcFMAkQJKHYLK0wYk5N9szV6xihDbDDFr45lN1K4aCXBq/FitPSud9gLt5ZVn+ZqGX7cwm2z5EGMgfFpIFyhGGuDPmso6TItTMwny+7uPnLCf4W6goFQFV0oQSsc9VfMmVLcLr6ZetDZbaSFTLqnSO/bIPjA3/zAUoqgGFAEQS4IhuMzEp2I3jJzbzkk/IEmyax+rhZTwd6f+CGtwPixu8IvzACquPWPREu9ZvGkUzpRwvRRuaNN6cr0W1wWits9ICdYJ7ltbgMiSL3sTPeufgNcVqMVWFkCPDH4jG2jA0XcVgQj62Cb29v9f/z/+2KbYvIv/zzjpQAPkliaVDzNrW57TZ/ZOyZD0nlfMmAIBIAGAI0D3k/mdN4xr9v85ZbZbbqfH2jGd5hUqNZWwl5SPfoGmfElmazUIeNL1j/mkF7VNAzTq4jNt8JoQ11NQOcmhprXoxSxfRGJ9LDEOAQ+dmxAQH90iti9e2u/MoeuaGcDTHoC+xsmEeWmxEKefQuIzHbpw5Tc5cEocboAD09oipWQhtTO1wivf/O+DRe2rpl/E9wlrzBorjJsOeG1B/XPW4EaJEFdNlECEZga5ZoGRHXgYouGRuVkm8tDESiEyFNo+3s5M5puSdTyUL2llnINVHEt91XUNW4ewdMgJ4boJfEyt/iY5WXqbA+A2Fkt5Z0lutiWhe9nZIyIUjyXDC3UsaG1t+eNx6z4W/OYoTB7A6x+dNSTOi9AInctbESqm5gvOLww7OWXPrmHwVZasrl4eD113pm+JtT7JVOvnCXqdzzdTRHgJ0PiGTFYW5Gvt9R9LD6Lzfs0v/TZZHSmyVNq7viIHE6DBK7Qp07Iz55EM8SYtQvZf/obBniTWi5C2/ovHfw4VndkE5XYdjOhCMRjDeOEfXeN/CwfGduiUIfsoFeUxXeQXba7c7972XNv8w+dTjjUM0QeNAReW+J014dKAD/McQYXT7c0GQPIkn3Ll6R7gGjuiQoZD0TEeEqQpKoZ15g/0OPQI17QiSv9AUROa/V/TQN3dvLArec3RrsYlvBm1b8LWzltdugsC50lNKYLEp2a+ZZYqPejULRlOJh5zj/LVMyTDvwKhMxxwuDkxJ1QpoNI0OTWLom4Z71SNzI9TV1iXJrIu9Wcnd+MCaAw8o1jSXd94YU/1gnkrC9BUEOtQvEIQ7g0i6h+KL2JKk8Ydl7HruvgWMSAmNe+LshGhV4qnWHhO9/RIPQzY1tHRj2VqOyNsDpK0cww+56AdDC4gsWwY0XxoucIWIqs/GcwnWqlaT0KPr8mbK5U94/301i1WLt4YINTVvCFBrFZbIbY8eycOdeJ2teD5IfPLCRg7jjcFTwlMFNl9zdh/o3E/hHPwj7BWg0MU09pPrBLbrCgm54A6H+I6v27+jL5gkjWg/iYdks9jbfVP5y/n0dlgWEMlKasl7JvFZd56LfybW1eeaVO0gxTfXZwD8G4SI116yx7UKVRgui6Ya1YpixqXeNLc8IxtAwCU5IhwQgn+NqHnRaDv61CxKhOq4pOX7M6pkA+Pmpd4j1vn6ACUALoLLc4vpXci8VidLxzm7qFBe7s+quuJs6ETYmnpgS3LwSZxPIltgBDXz8M1k/W2ySNv2f9/NPhxLGK2D21dkHeSGmenRT3Yqcdl0m/h3OYr8V+lXNYGf8aCCpd4bWjE4QIPj7vUKN4Nrfs7ML6Y2OyS830JCnofg/k7lpFpt4SqZc5HGg1HCOrHvOdC8bP6FGDbE/VV0mX4IakzbdS/op+Kt3G24/8QbBV7y86sGSQ/vZzU8FXs7u6jIvwchsEP2BpIhW3G8uWNwa3HmjfH/ZjhhCWvluAcF+nMf14ClKg5hGgtPLJ98ueNAkc5Hs2WZlk2QHvfreCK1CCGO6nMZVSb99VM/ajr8WHTte9JSmkXq/i/U943HEbdzW6Re/S88dKgg8pGOLlAeNiqrcLkUR3/aClFpMXcOUP3rmETcWSfMXZE3TUOi8i+fqRnTYLflVx/Vb/6GJ7eIRZUA6k3RYR3iFSK9c4iDdNwJuZL2FKz/IK5VimcNWEqdXjSoxSgmF0UPlDoUlNrPcM7ftmA8Y9gKiqKEHuWN+AZRIwtVSxye2Kf8rM3lhJ5XcBXU9n4v0Oy1RU2M+4qM8AQPVwse8ErNSob5oFPWxuqZnVzo1qB/IBxkM3EVUKFUUlO3e51259GgNcJbCmlvrdjtoTW7rChm1wyCKzpCTwozUUEOIcWLneRLgMXh+SjGSFkAllzbGS5HK7LlfCMRNRDSvbQPjcXaenNYxCvu2Qyznz6StuxVj66SgI0T8B6/sfHAJYZaZ78thjOSIFumNWLQbeZixDCCC+v0YBtkxiBB3jefHqZ/dFHU+crbj6OvS1x/JDD7vlm7zOVPwpUC01nhxZuY/63E7g";const Fc=44032,Su=4352,Pu=4449,Ou=4519,x1=19,I1=21,$a=28,Du=I1*$a,b3=x1*Du,v3=Fc+b3,E3=Su+x1,A3=Pu+I1,x3=Ou+$a;function wc(r){return r>>24&255}function S1(r){return r&16777215}let md,Sy,wd,ou;function I3(){let r=w1(w3);md=new Map(b1(r).flatMap((e,t)=>e.map(n=>[n,t+1<<24]))),Sy=new Set($c(r)),wd=new Map,ou=new Map;for(let[e,t]of v1(r)){if(!Sy.has(e)&&t.length==2){let[n,s]=t,i=ou.get(n);i||(i=new Map,ou.set(n,i)),i.set(s,e)}wd.set(e,t.reverse())}}function P1(r){return r>=Fc&&r<v3}function S3(r,e){if(r>=Su&&r<E3&&e>=Pu&&e<A3)return Fc+(r-Su)*Du+(e-Pu)*$a;if(P1(r)&&e>Ou&&e<x3&&(r-Fc)%$a==0)return r+(e-Ou);{let t=ou.get(r);return t&&(t=t.get(e),t)?t:-1}}function O1(r){md||I3();let e=[],t=[],n=!1;function s(i){let o=md.get(i);o&&(n=!0,i|=o),e.push(i)}for(let i of r)for(;;){if(i<128)e.push(i);else if(P1(i)){let o=i-Fc,a=o/Du|0,c=o%Du/$a|0,l=o%$a;s(Su+a),s(Pu+c),l>0&&s(Ou+l)}else{let o=wd.get(i);o?t.push(...o):s(i)}if(!t.length)break;i=t.pop()}if(n&&e.length>1){let i=wc(e[0]);for(let o=1;o<e.length;o++){let a=wc(e[o]);if(a==0||i<=a){i=a;continue}let c=o-1;for(;;){let l=e[c+1];if(e[c+1]=e[c],e[c]=l,!c||(i=wc(e[--c]),i<=a))break}i=wc(e[o])}}return e}function P3(r){let e=[],t=[],n=-1,s=0;for(let i of r){let o=wc(i),a=S1(i);if(n==-1)o==0?n=a:e.push(a);else if(s>0&&s>=o)o==0?(e.push(n,...t),t.length=0,n=a):t.push(a),s=o;else{let c=S3(n,a);c>=0?n=c:s==0&&o==0?(e.push(n),n=a):(t.push(a),s=o)}}return n>=0&&e.push(n,...t),e}function D1(r){return O1(r).map(S1)}function O3(r){return P3(O1(r))}const Py=45,C1=".",B1=65039,_1=1,Cu=r=>Array.from(r);function Mc(r,e){return r.P.has(e)||r.Q.has(e)}class D3 extends Array{get is_emoji(){return!0}}let bd,T1,bi,vd,N1,Fo,Wh,xo,oi,Oy,Ed;function Vp(){if(bd)return;let r=w1(o3);const e=()=>$c(r),t=()=>new Set(e()),n=(u,h)=>h.forEach(f=>u.add(f));bd=new Map(v1(r)),T1=t(),bi=e(),vd=new Set(e().map(u=>bi[u])),bi=new Set(bi),N1=t(),t();let s=b1(r),i=r();const o=()=>{let u=new Set;return e().forEach(h=>n(u,s[h])),n(u,e()),u};Fo=Lc(u=>{let h=Lc(r).map(f=>f+96);if(h.length){let f=u>=i;h[0]-=32,h=ka(h),f&&(h=`Restricted[${h}]`);let d=o(),p=o(),g=!r();return{N:h,P:d,Q:p,M:g,R:f}}}),Wh=t(),xo=new Map;let a=e().concat(Cu(Wh)).sort((u,h)=>u-h);a.forEach((u,h)=>{let f=r(),d=a[h]=f?a[h-f]:{V:[],M:new Map};d.V.push(u),Wh.has(u)||xo.set(u,d)});for(let{V:u,M:h}of new Set(xo.values())){let f=[];for(let p of u){let g=Fo.filter(b=>Mc(b,p)),m=f.find(({G:b})=>g.some(x=>b.has(x)));m||(m={G:new Set,V:[]},f.push(m)),m.V.push(p),n(m.G,g)}let d=f.flatMap(p=>Cu(p.G));for(let{G:p,V:g}of f){let m=new Set(d.filter(b=>!p.has(b)));for(let b of g)h.set(b,m)}}oi=new Set;let c=new Set;const l=u=>oi.has(u)?c.add(u):oi.add(u);for(let u of Fo){for(let h of u.P)l(h);for(let h of u.Q)l(h)}for(let u of oi)!xo.has(u)&&!c.has(u)&&xo.set(u,_1);n(oi,D1(oi)),Oy=p3(r).map(u=>D3.from(u)).sort(m3),Ed=new Map;for(let u of Oy){let h=[Ed];for(let f of u){let d=h.map(p=>{let g=p.get(f);return g||(g=new Map,p.set(f,g)),g});f===B1?h.push(...d):h=d}for(let f of h)f.V=u}}function Kp(r){return(R1(r)?"":`${Gp(ph([r]))} `)+A1(r)}function Gp(r){return`"${r}"‎`}function C3(r){if(r.length>=4&&r[2]==Py&&r[3]==Py)throw new Error(`invalid label extension: "${ka(r.slice(0,4))}"`)}function B3(r){for(let t=r.lastIndexOf(95);t>0;)if(r[--t]!==95)throw new Error("underscore allowed only at start")}function _3(r){let e=r[0],t=xy.get(e);if(t)throw Sc(`leading ${t}`);let n=r.length,s=-1;for(let i=1;i<n;i++){e=r[i];let o=xy.get(e);if(o){if(s==i)throw Sc(`${t} + ${o}`);s=i+1,t=o}}if(s==n)throw Sc(`trailing ${t}`)}function ph(r,e=1/0,t=A1){let n=[];T3(r[0])&&n.push("◌"),r.length>e&&(e>>=1,r=[...r.slice(0,e),8230,...r.slice(-e)]);let s=0,i=r.length;for(let o=0;o<i;o++){let a=r[o];R1(a)&&(n.push(ka(r.slice(s,o))),n.push(t(a)),s=o+1)}return n.push(ka(r.slice(s,i))),n.join("")}function T3(r){return Vp(),bi.has(r)}function R1(r){return Vp(),N1.has(r)}function N3(r){return $3(R3(r,O3,M3))}function R3(r,e,t){if(!r)return[];Vp();let n=0;return r.split(C1).map(s=>{let i=y3(s),o={input:i,offset:n};n+=i.length+1;try{let a=o.tokens=F3(i,e,t),c=a.length,l;if(!c)throw new Error("empty label");let u=o.output=a.flat();if(B3(u),!(o.emoji=c>1||a[0].is_emoji)&&u.every(f=>f<128))C3(u),l="ASCII";else{let f=a.flatMap(d=>d.is_emoji?[]:d);if(!f.length)l="Emoji";else{if(bi.has(u[0]))throw Sc("leading combining mark");for(let g=1;g<c;g++){let m=a[g];if(!m.is_emoji&&bi.has(m[0]))throw Sc(`emoji + combining mark: "${ka(a[g-1])} + ${ph([m[0]])}"`)}_3(u);let d=Cu(new Set(f)),[p]=k3(d);L3(p,f),U3(p,d),l=p.N}}o.type=l}catch(a){o.error=a}return o})}function U3(r,e){let t,n=[];for(let s of e){let i=xo.get(s);if(i===_1)return;if(i){let o=i.M.get(s);if(t=t?t.filter(a=>o.has(a)):Cu(o),!t.length)return}else n.push(s)}if(t){for(let s of t)if(n.every(i=>Mc(s,i)))throw new Error(`whole-script confusable: ${r.N}/${s.N}`)}}function k3(r){let e=Fo;for(let t of r){let n=e.filter(s=>Mc(s,t));if(!n.length)throw Fo.some(s=>Mc(s,t))?k1(e[0],t):U1(t);if(e=n,n.length==1)break}return e}function $3(r){return r.map(({input:e,error:t,output:n})=>{if(t){let s=t.message;throw new Error(r.length==1?s:`Invalid label ${Gp(ph(e,63))}: ${s}`)}return ka(n)}).join(C1)}function U1(r){return new Error(`disallowed character: ${Kp(r)}`)}function k1(r,e){let t=Kp(e),n=Fo.find(s=>s.P.has(e));return n&&(t=`${n.N} ${t}`),new Error(`illegal mixture: ${r.N} + ${t}`)}function Sc(r){return new Error(`illegal placement: ${r}`)}function L3(r,e){for(let t of e)if(!Mc(r,t))throw k1(r,t);if(r.M){let t=D1(e);for(let n=1,s=t.length;n<s;n++)if(vd.has(t[n])){let i=n+1;for(let o;i<s&&vd.has(o=t[i]);i++)for(let a=n;a<i;a++)if(t[a]==o)throw new Error(`duplicate non-spacing marks: ${Kp(o)}`);if(i-n>Iy)throw new Error(`excessive non-spacing marks: ${Gp(ph(t.slice(n-1,i)))} (${i-n}/${Iy})`);n=i}}}function F3(r,e,t){let n=[],s=[];for(r=r.slice().reverse();r.length;){let i=j3(r);if(i)s.length&&(n.push(e(s)),s=[]),n.push(t(i));else{let o=r.pop();if(oi.has(o))s.push(o);else{let a=bd.get(o);if(a)s.push(...a);else if(!T1.has(o))throw U1(o)}}}return s.length&&n.push(e(s)),n}function M3(r){return r.filter(e=>e!=B1)}function j3(r,e){let t=Ed,n,s=r.length;for(;s&&(t=t.get(r[--s]),!!t);){let{V:i}=t;i&&(n=i,r.length=s)}return n}const $1=new Uint8Array(32);$1.fill(0);function Dy(r){return R(r.length!==0,"invalid ENS name; empty component","comp",r),r}function L1(r){const e=Wn(z3(r)),t=[];if(r.length===0)return t;let n=0;for(let s=0;s<e.length;s++)e[s]===46&&(t.push(Dy(e.slice(n,s))),n=s+1);return R(n<e.length,"invalid ENS name; empty component","name",r),t.push(Dy(e.slice(n))),t}function z3(r){try{if(r.length===0)throw new Error("empty label");return N3(r)}catch(e){R(!1,`invalid ENS name (${e.message})`,"name",r)}}function Ad(r){R(typeof r=="string","invalid ENS name; not a string","name",r),R(r.length,"invalid ENS name (empty label)","name",r);let e=$1;const t=L1(r);for(;t.length;)e=Ke($e([e,Ke(t.pop())]));return X(e)}function H3(r,e){const t=e;return R(t<=255,"DNS encoded label cannot exceed 255","length",t),X($e(L1(r).map(n=>{R(n.length<=t,`label ${JSON.stringify(r)} exceeds ${t} bytes`,"name",r);const s=new Uint8Array(n.length+1);return s.set(n,1),s[0]=s.length-1,s})))+"00"}const F1=new Uint8Array(32);F1.fill(0);const q3=BigInt(-1),M1=BigInt(0),j1=BigInt(1),V3=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");function K3(r){const e=ue(r),t=e.length%32;return t?$e([e,F1.slice(t)]):X(e)}const G3=Vs(j1,32),Q3=Vs(M1,32),Cy={name:"string",version:"string",chainId:"uint256",verifyingContract:"address",salt:"bytes32"},Jh=["name","version","chainId","verifyingContract","salt"];function By(r){return function(e){return R(typeof e=="string",`invalid domain value for ${JSON.stringify(r)}`,`domain.${r}`,e),e}}const W3={name:By("name"),version:By("version"),chainId:function(r){const e=re(r,"domain.chainId");return R(e>=0,"invalid chain ID","domain.chainId",r),Number.isSafeInteger(e)?Number(e):Fr(e)},verifyingContract:function(r){try{return Ae(r).toLowerCase()}catch{}R(!1,'invalid domain value "verifyingContract"',"domain.verifyingContract",r)},salt:function(r){const e=ue(r,"domain.salt");return R(e.length===32,'invalid domain value "salt"',"domain.salt",r),X(e)}};function Yh(r){{const e=r.match(/^(u?)int(\d+)$/);if(e){const t=e[1]==="",n=parseInt(e[2]);R(n%8===0&&n!==0&&n<=256&&e[2]===String(n),"invalid numeric width","type",r);const s=mi(V3,t?n-1:n),i=t?(s+j1)*q3:M1;return function(o){const a=re(o,"value");return R(a>=i&&a<=s,`value out-of-bounds for ${r}`,"value",a),Vs(t?Pb(a,256):a,32)}}}{const e=r.match(/^bytes(\d+)$/);if(e){const t=parseInt(e[1]);return R(t!==0&&t<=32&&e[1]===String(t),"invalid bytes width","type",r),function(n){const s=ue(n);return R(s.length===t,`invalid length for ${r}`,"value",n),K3(n)}}}switch(r){case"address":return function(e){return Xn(Ae(e),32)};case"bool":return function(e){return e?G3:Q3};case"bytes":return function(e){return Ke(e)};case"string":return function(e){return Gi(e)}}return null}function _y(r,e){return`${r}(${e.map(({name:t,type:n})=>n+" "+t).join(",")})`}function Ul(r){const e=r.match(/^([^\x5b]*)((\x5b\d*\x5d)*)(\x5b(\d*)\x5d)$/);return e?{base:e[1],index:e[2]+e[4],array:{base:e[1],prefix:e[1]+e[2],count:e[5]?parseInt(e[5]):-1}}:{base:r}}var el,Fn,pa,Xu,z1;const pr=class pr{constructor(e){M(this,Xu);F(this,"primaryType");M(this,el);M(this,Fn);M(this,pa);P(this,Fn,new Map),P(this,pa,new Map);const t=new Map,n=new Map,s=new Map,i={};Object.keys(e).forEach(c=>{i[c]=e[c].map(({name:l,type:u})=>{let{base:h,index:f}=Ul(u);return h==="int"&&!e.int&&(h="int256"),h==="uint"&&!e.uint&&(h="uint256"),{name:l,type:h+(f||"")}}),t.set(c,new Set),n.set(c,[]),s.set(c,new Set)}),P(this,el,JSON.stringify(i));for(const c in i){const l=new Set;for(const u of i[c]){R(!l.has(u.name),`duplicate variable name ${JSON.stringify(u.name)} in ${JSON.stringify(c)}`,"types",e),l.add(u.name);const h=Ul(u.type).base;R(h!==c,`circular type reference to ${JSON.stringify(h)}`,"types",e),!Yh(h)&&(R(n.has(h),`unknown type ${JSON.stringify(h)}`,"types",e),n.get(h).push(c),t.get(c).add(h))}}const o=Array.from(n.keys()).filter(c=>n.get(c).length===0);R(o.length!==0,"missing primary type","types",e),R(o.length===1,`ambiguous primary types or unused types: ${o.map(c=>JSON.stringify(c)).join(", ")}`,"types",e),ie(this,{primaryType:o[0]});function a(c,l){R(!l.has(c),`circular type reference to ${JSON.stringify(c)}`,"types",e),l.add(c);for(const u of t.get(c))if(n.has(u)){a(u,l);for(const h of l)s.get(h).add(u)}l.delete(c)}a(this.primaryType,new Set);for(const[c,l]of s){const u=Array.from(l);u.sort(),y(this,Fn).set(c,_y(c,i[c])+u.map(h=>_y(h,i[h])).join(""))}}get types(){return JSON.parse(y(this,el))}getEncoder(e){let t=y(this,pa).get(e);return t||(t=K(this,Xu,z1).call(this,e),y(this,pa).set(e,t)),t}encodeType(e){const t=y(this,Fn).get(e);return R(t,`unknown type: ${JSON.stringify(e)}`,"name",e),t}encodeData(e,t){return this.getEncoder(e)(t)}hashStruct(e,t){return Ke(this.encodeData(e,t))}encode(e){return this.encodeData(this.primaryType,e)}hash(e){return this.hashStruct(this.primaryType,e)}_visit(e,t,n){if(Yh(e))return n(e,t);const s=Ul(e).array;if(s)return R(s.count===-1||s.count===t.length,`array length mismatch; expected length ${s.count}`,"value",t),t.map(o=>this._visit(s.prefix,o,n));const i=this.types[e];if(i)return i.reduce((o,{name:a,type:c})=>(o[a]=this._visit(c,t[a],n),o),{});R(!1,`unknown type: ${e}`,"type",e)}visit(e,t){return this._visit(this.primaryType,e,t)}static from(e){return new pr(e)}static getPrimaryType(e){return pr.from(e).primaryType}static hashStruct(e,t,n){return pr.from(t).hashStruct(e,n)}static hashDomain(e){const t=[];for(const n in e){if(e[n]==null)continue;const s=Cy[n];R(s,`invalid typed-data domain key: ${JSON.stringify(n)}`,"domain",e),t.push({name:n,type:s})}return t.sort((n,s)=>Jh.indexOf(n.name)-Jh.indexOf(s.name)),pr.hashStruct("EIP712Domain",{EIP712Domain:t},e)}static encode(e,t,n){return $e(["0x1901",pr.hashDomain(e),pr.from(t).hash(n)])}static hash(e,t,n){return Ke(pr.encode(e,t,n))}static async resolveNames(e,t,n,s){e=Object.assign({},e);for(const a in e)e[a]==null&&delete e[a];const i={};e.verifyingContract&&!Ce(e.verifyingContract,20)&&(i[e.verifyingContract]="0x");const o=pr.from(t);o.visit(n,(a,c)=>(a==="address"&&!Ce(c,20)&&(i[c]="0x"),c));for(const a in i)i[a]=await s(a);return e.verifyingContract&&i[e.verifyingContract]&&(e.verifyingContract=i[e.verifyingContract]),n=o.visit(n,(a,c)=>a==="address"&&i[c]?i[c]:c),{domain:e,value:n}}static getPayload(e,t,n){pr.hashDomain(e);const s={},i=[];Jh.forEach(c=>{const l=e[c];l!=null&&(s[c]=W3[c](l),i.push({name:c,type:Cy[c]}))});const o=pr.from(t);t=o.types;const a=Object.assign({},t);return R(a.EIP712Domain==null,"types must not contain EIP712Domain type","types.EIP712Domain",t),a.EIP712Domain=i,o.encode(n),{types:a,domain:s,primaryType:o.primaryType,message:o.visit(n,(c,l)=>{if(c.match(/^bytes(\d*)/))return X(ue(l));if(c.match(/^u?int/))return re(l).toString();switch(c){case"address":return l.toLowerCase();case"bool":return!!l;case"string":return R(typeof l=="string","invalid string","value",l),l}R(!1,"unsupported type","type",c)})}}};el=new WeakMap,Fn=new WeakMap,pa=new WeakMap,Xu=new WeakSet,z1=function(e){{const s=Yh(e);if(s)return s}const t=Ul(e).array;if(t){const s=t.prefix,i=this.getEncoder(s);return o=>{R(t.count===-1||t.count===o.length,`array length mismatch; expected length ${t.count}`,"value",o);let a=o.map(i);return y(this,Fn).has(s)&&(a=a.map(Ke)),Ke($e(a))}}const n=this.types[e];if(n){const s=Gi(y(this,Fn).get(e));return i=>{const o=n.map(({name:a,type:c})=>{const l=this.getEncoder(c)(i[a]);return y(this,Fn).has(c)?Ke(l):l});return o.unshift(s),$e(o)}}R(!1,`unknown type: ${e}`,"type",e)};let Bu=pr;function _t(r){const e=new Set;return r.forEach(t=>e.add(t)),Object.freeze(e)}const J3="external public payable override",Y3=_t(J3.split(" ")),H1="constant external internal payable private public pure view override",Z3=_t(H1.split(" ")),q1="constructor error event fallback function receive struct",V1=_t(q1.split(" ")),K1="calldata memory storage payable indexed",X3=_t(K1.split(" ")),eS="tuple returns",tS=[q1,K1,eS,H1].join(" "),rS=_t(tS.split(" ")),nS={"(":"OPEN_PAREN",")":"CLOSE_PAREN","[":"OPEN_BRACKET","]":"CLOSE_BRACKET",",":"COMMA","@":"AT"},sS=new RegExp("^(\\s*)"),iS=new RegExp("^([0-9]+)"),oS=new RegExp("^([a-zA-Z$_][a-zA-Z0-9$_]*)"),G1=new RegExp("^([a-zA-Z$_][a-zA-Z0-9$_]*)$"),Q1=new RegExp("^(address|bool|bytes([0-9]*)|string|u?int([0-9]*))$");var at,$r,tl,xd;const eh=class eh{constructor(e){M(this,tl);M(this,at);M(this,$r);P(this,at,0),P(this,$r,e.slice())}get offset(){return y(this,at)}get length(){return y(this,$r).length-y(this,at)}clone(){return new eh(y(this,$r))}reset(){P(this,at,0)}popKeyword(e){const t=this.peek();if(t.type!=="KEYWORD"||!e.has(t.text))throw new Error(`expected keyword ${t.text}`);return this.pop().text}popType(e){if(this.peek().type!==e){const t=this.peek();throw new Error(`expected ${e}; got ${t.type} ${JSON.stringify(t.text)}`)}return this.pop().text}popParen(){const e=this.peek();if(e.type!=="OPEN_PAREN")throw new Error("bad start");const t=K(this,tl,xd).call(this,y(this,at)+1,e.match+1);return P(this,at,e.match+1),t}popParams(){const e=this.peek();if(e.type!=="OPEN_PAREN")throw new Error("bad start");const t=[];for(;y(this,at)<e.match-1;){const n=this.peek().linkNext;t.push(K(this,tl,xd).call(this,y(this,at)+1,n)),P(this,at,n)}return P(this,at,e.match+1),t}peek(){if(y(this,at)>=y(this,$r).length)throw new Error("out-of-bounds");return y(this,$r)[y(this,at)]}peekKeyword(e){const t=this.peekType("KEYWORD");return t!=null&&e.has(t)?t:null}peekType(e){if(this.length===0)return null;const t=this.peek();return t.type===e?t.text:null}pop(){const e=this.peek();return Wa(this,at)._++,e}toString(){const e=[];for(let t=y(this,at);t<y(this,$r).length;t++){const n=y(this,$r)[t];e.push(`${n.type}:${n.text}`)}return`<TokenString ${e.join(" ")}>`}};at=new WeakMap,$r=new WeakMap,tl=new WeakSet,xd=function(e=0,t=0){return new eh(y(this,$r).slice(e,t).map(n=>Object.freeze(Object.assign({},n,{match:n.match-e,linkBack:n.linkBack-e,linkNext:n.linkNext-e}))))};let Hr=eh;function Js(r){const e=[],t=o=>{const a=i<r.length?JSON.stringify(r[i]):"$EOI";throw new Error(`invalid token ${a} at ${i}: ${o}`)};let n=[],s=[],i=0;for(;i<r.length;){let o=r.substring(i),a=o.match(sS);a&&(i+=a[1].length,o=r.substring(i));const c={depth:n.length,linkBack:-1,linkNext:-1,match:-1,type:"",text:"",offset:i,value:-1};e.push(c);let l=nS[o[0]]||"";if(l){if(c.type=l,c.text=o[0],i++,l==="OPEN_PAREN")n.push(e.length-1),s.push(e.length-1);else if(l=="CLOSE_PAREN")n.length===0&&t("no matching open bracket"),c.match=n.pop(),e[c.match].match=e.length-1,c.depth--,c.linkBack=s.pop(),e[c.linkBack].linkNext=e.length-1;else if(l==="COMMA")c.linkBack=s.pop(),e[c.linkBack].linkNext=e.length-1,s.push(e.length-1);else if(l==="OPEN_BRACKET")c.type="BRACKET";else if(l==="CLOSE_BRACKET"){let u=e.pop().text;if(e.length>0&&e[e.length-1].type==="NUMBER"){const h=e.pop().text;u=h+u,e[e.length-1].value=ce(h)}if(e.length===0||e[e.length-1].type!=="BRACKET")throw new Error("missing opening bracket");e[e.length-1].text+=u}continue}if(a=o.match(oS),a){if(c.text=a[1],i+=c.text.length,rS.has(c.text)){c.type="KEYWORD";continue}if(c.text.match(Q1)){c.type="TYPE";continue}c.type="ID";continue}if(a=o.match(iS),a){c.text=a[1],c.type="NUMBER",i+=c.text.length;continue}throw new Error(`unexpected token ${JSON.stringify(o[0])} at position ${i}`)}return new Hr(e.map(o=>Object.freeze(o)))}function Ty(r,e){let t=[];for(const n in e.keys())r.has(n)&&t.push(n);if(t.length>1)throw new Error(`conflicting types: ${t.join(", ")}`)}function gh(r,e){if(e.peekKeyword(V1)){const t=e.pop().text;if(t!==r)throw new Error(`expected ${r}, got ${t}`)}return e.popType("ID")}function es(r,e){const t=new Set;for(;;){const n=r.peekType("KEYWORD");if(n==null||e&&!e.has(n))break;if(r.pop(),t.has(n))throw new Error(`duplicate keywords: ${JSON.stringify(n)}`);t.add(n)}return Object.freeze(t)}function W1(r){let e=es(r,Z3);return Ty(e,_t("constant payable nonpayable".split(" "))),Ty(e,_t("pure view payable nonpayable".split(" "))),e.has("view")?"view":e.has("pure")?"pure":e.has("payable")?"payable":e.has("nonpayable")?"nonpayable":e.has("constant")?"view":"nonpayable"}function Jn(r,e){return r.popParams().map(t=>ut.from(t,e))}function J1(r){if(r.peekType("AT")){if(r.pop(),r.peekType("NUMBER"))return re(r.pop().text);throw new Error("invalid gas")}return null}function Qi(r){if(r.length)throw new Error(`unexpected tokens at offset ${r.offset}: ${r.toString()}`)}const aS=new RegExp(/^(.*)\[([0-9]*)\]$/);function Ny(r){const e=r.match(Q1);if(R(e,"invalid type","type",r),r==="uint")return"uint256";if(r==="int")return"int256";if(e[2]){const t=parseInt(e[2]);R(t!==0&&t<=32,"invalid bytes length","type",r)}else if(e[3]){const t=parseInt(e[3]);R(t!==0&&t<=256&&t%8===0,"invalid numeric width","type",r)}return r}const Ne={},Qt=Symbol.for("_ethers_internal"),Ry="_ParamTypeInternal",Uy="_ErrorInternal",ky="_EventInternal",$y="_ConstructorInternal",Ly="_FallbackInternal",Fy="_FunctionInternal",My="_StructInternal";var ga,au;const gr=class gr{constructor(e,t,n,s,i,o,a,c){M(this,ga);F(this,"name");F(this,"type");F(this,"baseType");F(this,"indexed");F(this,"components");F(this,"arrayLength");F(this,"arrayChildren");if(ll(e,Ne,"ParamType"),Object.defineProperty(this,Qt,{value:Ry}),o&&(o=Object.freeze(o.slice())),s==="array"){if(a==null||c==null)throw new Error("")}else if(a!=null||c!=null)throw new Error("");if(s==="tuple"){if(o==null)throw new Error("")}else if(o!=null)throw new Error("");ie(this,{name:t,type:n,baseType:s,indexed:i,components:o,arrayLength:a,arrayChildren:c})}format(e){if(e==null&&(e="sighash"),e==="json"){const n=this.name||"";if(this.isArray()){const i=JSON.parse(this.arrayChildren.format("json"));return i.name=n,i.type+=`[${this.arrayLength<0?"":String(this.arrayLength)}]`,JSON.stringify(i)}const s={type:this.baseType==="tuple"?"tuple":this.type,name:n};return typeof this.indexed=="boolean"&&(s.indexed=this.indexed),this.isTuple()&&(s.components=this.components.map(i=>JSON.parse(i.format(e)))),JSON.stringify(s)}let t="";return this.isArray()?(t+=this.arrayChildren.format(e),t+=`[${this.arrayLength<0?"":String(this.arrayLength)}]`):this.isTuple()?t+="("+this.components.map(n=>n.format(e)).join(e==="full"?", ":",")+")":t+=this.type,e!=="sighash"&&(this.indexed===!0&&(t+=" indexed"),e==="full"&&this.name&&(t+=" "+this.name)),t}isArray(){return this.baseType==="array"}isTuple(){return this.baseType==="tuple"}isIndexable(){return this.indexed!=null}walk(e,t){if(this.isArray()){if(!Array.isArray(e))throw new Error("invalid array value");if(this.arrayLength!==-1&&e.length!==this.arrayLength)throw new Error("array is wrong length");const n=this;return e.map(s=>n.arrayChildren.walk(s,t))}if(this.isTuple()){if(!Array.isArray(e))throw new Error("invalid tuple value");if(e.length!==this.components.length)throw new Error("array is wrong length");const n=this;return e.map((s,i)=>n.components[i].walk(s,t))}return t(this.type,e)}async walkAsync(e,t){const n=[],s=[e];return K(this,ga,au).call(this,n,e,t,i=>{s[0]=i}),n.length&&await Promise.all(n),s[0]}static from(e,t){if(gr.isParamType(e))return e;if(typeof e=="string")try{return gr.from(Js(e),t)}catch{R(!1,"invalid param type","obj",e)}else if(e instanceof Hr){let a="",c="",l=null;es(e,_t(["tuple"])).has("tuple")||e.peekType("OPEN_PAREN")?(c="tuple",l=e.popParams().map(g=>gr.from(g)),a=`tuple(${l.map(g=>g.format()).join(",")})`):(a=Ny(e.popType("TYPE")),c=a);let u=null,h=null;for(;e.length&&e.peekType("BRACKET");){const g=e.pop();u=new gr(Ne,"",a,c,null,l,h,u),h=g.value,a+=g.text,c="array",l=null}let f=null;if(es(e,X3).has("indexed")){if(!t)throw new Error("");f=!0}const p=e.peekType("ID")?e.pop().text:"";if(e.length)throw new Error("leftover tokens");return new gr(Ne,p,a,c,f,l,h,u)}const n=e.name;R(!n||typeof n=="string"&&n.match(G1),"invalid name","obj.name",n);let s=e.indexed;s!=null&&(R(t,"parameter cannot be indexed","obj.indexed",e.indexed),s=!!s);let i=e.type,o=i.match(aS);if(o){const a=parseInt(o[2]||"-1"),c=gr.from({type:o[1],components:e.components});return new gr(Ne,n||"",i,"array",s,null,a,c)}if(i==="tuple"||i.startsWith("tuple(")||i.startsWith("(")){const a=e.components!=null?e.components.map(l=>gr.from(l)):null;return new gr(Ne,n||"",i,"tuple",s,a,null,null)}return i=Ny(e.type),new gr(Ne,n||"",i,i,s,null,null,null)}static isParamType(e){return e&&e[Qt]===Ry}};ga=new WeakSet,au=function(e,t,n,s){if(this.isArray()){if(!Array.isArray(t))throw new Error("invalid array value");if(this.arrayLength!==-1&&t.length!==this.arrayLength)throw new Error("array is wrong length");const o=this.arrayChildren,a=t.slice();a.forEach((c,l)=>{var u;K(u=o,ga,au).call(u,e,c,n,h=>{a[l]=h})}),s(a);return}if(this.isTuple()){const o=this.components;let a;if(Array.isArray(t))a=t.slice();else{if(t==null||typeof t!="object")throw new Error("invalid tuple value");a=o.map(c=>{if(!c.name)throw new Error("cannot use object value with unnamed components");if(!(c.name in t))throw new Error(`missing value for component ${c.name}`);return t[c.name]})}if(a.length!==this.components.length)throw new Error("array is wrong length");a.forEach((c,l)=>{var u;K(u=o[l],ga,au).call(u,e,c,n,h=>{a[l]=h})}),s(a);return}const i=n(this.type,t);i.then?e.push((async function(){s(await i)})()):s(i)};let ut=gr;class Wi{constructor(e,t,n){F(this,"type");F(this,"inputs");ll(e,Ne,"Fragment"),n=Object.freeze(n.slice()),ie(this,{type:t,inputs:n})}static from(e){if(typeof e=="string"){try{Wi.from(JSON.parse(e))}catch{}return Wi.from(Js(e))}if(e instanceof Hr)switch(e.peekKeyword(V1)){case"constructor":return Gn.from(e);case"error":return qt.from(e);case"event":return dn.from(e);case"fallback":case"receive":return Nn.from(e);case"function":return pn.from(e);case"struct":return Ki.from(e)}else if(typeof e=="object"){switch(e.type){case"constructor":return Gn.from(e);case"error":return qt.from(e);case"event":return dn.from(e);case"fallback":case"receive":return Nn.from(e);case"function":return pn.from(e);case"struct":return Ki.from(e)}q(!1,`unsupported type: ${e.type}`,"UNSUPPORTED_OPERATION",{operation:"Fragment.from"})}R(!1,"unsupported frgament object","obj",e)}static isConstructor(e){return Gn.isFragment(e)}static isError(e){return qt.isFragment(e)}static isEvent(e){return dn.isFragment(e)}static isFunction(e){return pn.isFragment(e)}static isStruct(e){return Ki.isFragment(e)}}class yh extends Wi{constructor(t,n,s,i){super(t,n,i);F(this,"name");R(typeof s=="string"&&s.match(G1),"invalid identifier","name",s),i=Object.freeze(i.slice()),ie(this,{name:s})}}function jc(r,e){return"("+e.map(t=>t.format(r)).join(r==="full"?", ":",")+")"}class qt extends yh{constructor(e,t,n){super(e,"error",t,n),Object.defineProperty(this,Qt,{value:Uy})}get selector(){return Gi(this.format("sighash")).substring(0,10)}format(e){if(e==null&&(e="sighash"),e==="json")return JSON.stringify({type:"error",name:this.name,inputs:this.inputs.map(n=>JSON.parse(n.format(e)))});const t=[];return e!=="sighash"&&t.push("error"),t.push(this.name+jc(e,this.inputs)),t.join(" ")}static from(e){if(qt.isFragment(e))return e;if(typeof e=="string")return qt.from(Js(e));if(e instanceof Hr){const t=gh("error",e),n=Jn(e);return Qi(e),new qt(Ne,t,n)}return new qt(Ne,e.name,e.inputs?e.inputs.map(ut.from):[])}static isFragment(e){return e&&e[Qt]===Uy}}class dn extends yh{constructor(t,n,s,i){super(t,"event",n,s);F(this,"anonymous");Object.defineProperty(this,Qt,{value:ky}),ie(this,{anonymous:i})}get topicHash(){return Gi(this.format("sighash"))}format(t){if(t==null&&(t="sighash"),t==="json")return JSON.stringify({type:"event",anonymous:this.anonymous,name:this.name,inputs:this.inputs.map(s=>JSON.parse(s.format(t)))});const n=[];return t!=="sighash"&&n.push("event"),n.push(this.name+jc(t,this.inputs)),t!=="sighash"&&this.anonymous&&n.push("anonymous"),n.join(" ")}static getTopicHash(t,n){return n=(n||[]).map(i=>ut.from(i)),new dn(Ne,t,n,!1).topicHash}static from(t){if(dn.isFragment(t))return t;if(typeof t=="string")try{return dn.from(Js(t))}catch{R(!1,"invalid event fragment","obj",t)}else if(t instanceof Hr){const n=gh("event",t),s=Jn(t,!0),i=!!es(t,_t(["anonymous"])).has("anonymous");return Qi(t),new dn(Ne,n,s,i)}return new dn(Ne,t.name,t.inputs?t.inputs.map(n=>ut.from(n,!0)):[],!!t.anonymous)}static isFragment(t){return t&&t[Qt]===ky}}class Gn extends Wi{constructor(t,n,s,i,o){super(t,n,s);F(this,"payable");F(this,"gas");Object.defineProperty(this,Qt,{value:$y}),ie(this,{payable:i,gas:o})}format(t){if(q(t!=null&&t!=="sighash","cannot format a constructor for sighash","UNSUPPORTED_OPERATION",{operation:"format(sighash)"}),t==="json")return JSON.stringify({type:"constructor",stateMutability:this.payable?"payable":"undefined",payable:this.payable,gas:this.gas!=null?this.gas:void 0,inputs:this.inputs.map(s=>JSON.parse(s.format(t)))});const n=[`constructor${jc(t,this.inputs)}`];return this.payable&&n.push("payable"),this.gas!=null&&n.push(`@${this.gas.toString()}`),n.join(" ")}static from(t){if(Gn.isFragment(t))return t;if(typeof t=="string")try{return Gn.from(Js(t))}catch{R(!1,"invalid constuctor fragment","obj",t)}else if(t instanceof Hr){es(t,_t(["constructor"]));const n=Jn(t),s=!!es(t,Y3).has("payable"),i=J1(t);return Qi(t),new Gn(Ne,"constructor",n,s,i)}return new Gn(Ne,"constructor",t.inputs?t.inputs.map(ut.from):[],!!t.payable,t.gas!=null?t.gas:null)}static isFragment(t){return t&&t[Qt]===$y}}class Nn extends Wi{constructor(t,n,s){super(t,"fallback",n);F(this,"payable");Object.defineProperty(this,Qt,{value:Ly}),ie(this,{payable:s})}format(t){const n=this.inputs.length===0?"receive":"fallback";if(t==="json"){const s=this.payable?"payable":"nonpayable";return JSON.stringify({type:n,stateMutability:s})}return`${n}()${this.payable?" payable":""}`}static from(t){if(Nn.isFragment(t))return t;if(typeof t=="string")try{return Nn.from(Js(t))}catch{R(!1,"invalid fallback fragment","obj",t)}else if(t instanceof Hr){const n=t.toString(),s=t.peekKeyword(_t(["fallback","receive"]));if(R(s,"type must be fallback or receive","obj",n),t.popKeyword(_t(["fallback","receive"]))==="receive"){const c=Jn(t);return R(c.length===0,"receive cannot have arguments","obj.inputs",c),es(t,_t(["payable"])),Qi(t),new Nn(Ne,[],!0)}let o=Jn(t);o.length?R(o.length===1&&o[0].type==="bytes","invalid fallback inputs","obj.inputs",o.map(c=>c.format("minimal")).join(", ")):o=[ut.from("bytes")];const a=W1(t);if(R(a==="nonpayable"||a==="payable","fallback cannot be constants","obj.stateMutability",a),es(t,_t(["returns"])).has("returns")){const c=Jn(t);R(c.length===1&&c[0].type==="bytes","invalid fallback outputs","obj.outputs",c.map(l=>l.format("minimal")).join(", "))}return Qi(t),new Nn(Ne,o,a==="payable")}if(t.type==="receive")return new Nn(Ne,[],!0);if(t.type==="fallback"){const n=[ut.from("bytes")],s=t.stateMutability==="payable";return new Nn(Ne,n,s)}R(!1,"invalid fallback description","obj",t)}static isFragment(t){return t&&t[Qt]===Ly}}class pn extends yh{constructor(t,n,s,i,o,a){super(t,"function",n,i);F(this,"constant");F(this,"outputs");F(this,"stateMutability");F(this,"payable");F(this,"gas");Object.defineProperty(this,Qt,{value:Fy}),o=Object.freeze(o.slice()),ie(this,{constant:s==="view"||s==="pure",gas:a,outputs:o,payable:s==="payable",stateMutability:s})}get selector(){return Gi(this.format("sighash")).substring(0,10)}format(t){if(t==null&&(t="sighash"),t==="json")return JSON.stringify({type:"function",name:this.name,constant:this.constant,stateMutability:this.stateMutability!=="nonpayable"?this.stateMutability:void 0,payable:this.payable,gas:this.gas!=null?this.gas:void 0,inputs:this.inputs.map(s=>JSON.parse(s.format(t))),outputs:this.outputs.map(s=>JSON.parse(s.format(t)))});const n=[];return t!=="sighash"&&n.push("function"),n.push(this.name+jc(t,this.inputs)),t!=="sighash"&&(this.stateMutability!=="nonpayable"&&n.push(this.stateMutability),this.outputs&&this.outputs.length&&(n.push("returns"),n.push(jc(t,this.outputs))),this.gas!=null&&n.push(`@${this.gas.toString()}`)),n.join(" ")}static getSelector(t,n){return n=(n||[]).map(i=>ut.from(i)),new pn(Ne,t,"view",n,[],null).selector}static from(t){if(pn.isFragment(t))return t;if(typeof t=="string")try{return pn.from(Js(t))}catch{R(!1,"invalid function fragment","obj",t)}else if(t instanceof Hr){const s=gh("function",t),i=Jn(t),o=W1(t);let a=[];es(t,_t(["returns"])).has("returns")&&(a=Jn(t));const c=J1(t);return Qi(t),new pn(Ne,s,o,i,a,c)}let n=t.stateMutability;return n==null&&(n="payable",typeof t.constant=="boolean"?(n="view",t.constant||(n="payable",typeof t.payable=="boolean"&&!t.payable&&(n="nonpayable"))):typeof t.payable=="boolean"&&!t.payable&&(n="nonpayable")),new pn(Ne,t.name,n,t.inputs?t.inputs.map(ut.from):[],t.outputs?t.outputs.map(ut.from):[],t.gas!=null?t.gas:null)}static isFragment(t){return t&&t[Qt]===Fy}}class Ki extends yh{constructor(e,t,n){super(e,"struct",t,n),Object.defineProperty(this,Qt,{value:My})}format(){throw new Error("@TODO")}static from(e){if(typeof e=="string")try{return Ki.from(Js(e))}catch{R(!1,"invalid struct fragment","obj",e)}else if(e instanceof Hr){const t=gh("struct",e),n=Jn(e);return Qi(e),new Ki(Ne,t,n)}return new Ki(Ne,e.name,e.inputs?e.inputs.map(ut.from):[])}static isFragment(e){return e&&e[Qt]===My}}const Vr=new Map;Vr.set(0,"GENERIC_PANIC");Vr.set(1,"ASSERT_FALSE");Vr.set(17,"OVERFLOW");Vr.set(18,"DIVIDE_BY_ZERO");Vr.set(33,"ENUM_RANGE_ERROR");Vr.set(34,"BAD_STORAGE_DATA");Vr.set(49,"STACK_UNDERFLOW");Vr.set(50,"ARRAY_RANGE_ERROR");Vr.set(65,"OUT_OF_MEMORY");Vr.set(81,"UNINITIALIZED_FUNCTION_CALL");const cS=new RegExp(/^bytes([0-9]*)$/),lS=new RegExp(/^(u?int)([0-9]*)$/);let Zh=null,jy=1024;function uS(r,e,t,n){let s="missing revert data",i=null;const o=null;let a=null;if(t){s="execution reverted";const l=ue(t);if(t=X(t),l.length===0)s+=" (no data present; likely require(false) occurred",i="require(false)";else if(l.length%32!==4)s+=" (could not decode reason; invalid data length)";else if(X(l.slice(0,4))==="0x08c379a0")try{i=n.decode(["string"],l.slice(4))[0],a={signature:"Error(string)",name:"Error",args:[i]},s+=`: ${JSON.stringify(i)}`}catch{s+=" (could not decode reason; invalid string data)"}else if(X(l.slice(0,4))==="0x4e487b71")try{const u=Number(n.decode(["uint256"],l.slice(4))[0]);a={signature:"Panic(uint256)",name:"Panic",args:[u]},i=`Panic due to ${Vr.get(u)||"UNKNOWN"}(${u})`,s+=`: ${i}`}catch{s+=" (could not decode panic code)"}else s+=" (unknown custom error)"}const c={to:e.to?Ae(e.to):null,data:e.data||"0x"};return e.from&&(c.from=Ae(e.from)),Te(s,"CALL_EXCEPTION",{action:r,data:t,reason:i,transaction:c,invocation:o,revert:a})}var Bs,Io;const th=class th{constructor(){M(this,Bs)}getDefaultValue(e){const t=e.map(s=>K(this,Bs,Io).call(this,ut.from(s)));return new Rl(t,"_").defaultValue()}encode(e,t){xb(t.length,e.length,"types/values length mismatch");const n=e.map(o=>K(this,Bs,Io).call(this,ut.from(o))),s=new Rl(n,"_"),i=new ld;return s.encode(i,t),i.data}decode(e,t,n){const s=e.map(o=>K(this,Bs,Io).call(this,ut.from(o)));return new Rl(s,"_").decode(new ud(t,n,jy))}static _setDefaultMaxInflation(e){R(typeof e=="number"&&Number.isInteger(e),"invalid defaultMaxInflation factor","value",e),jy=e}static defaultAbiCoder(){return Zh==null&&(Zh=new th),Zh}static getBuiltinCallException(e,t,n){return uS(e,t,n,th.defaultAbiCoder())}};Bs=new WeakSet,Io=function(e){if(e.isArray())return new DI(K(this,Bs,Io).call(this,e.arrayChildren),e.arrayLength,e.name);if(e.isTuple())return new Rl(e.components.map(n=>K(this,Bs,Io).call(this,n)),e.name);switch(e.baseType){case"address":return new PI(e.name);case"bool":return new CI(e.name);case"string":return new LI(e.name);case"bytes":return new BI(e.name);case"":return new NI(e.name)}let t=e.type.match(lS);if(t){let n=parseInt(t[2]||"256");return R(n!==0&&n<=256&&n%8===0,"invalid "+t[1]+" bit length","param",e),new $I(n/8,t[1]==="int",e.name)}if(t=e.type.match(cS),t){let n=parseInt(t[1]);return R(n!==0&&n<=32,"invalid bytes length","param",e),new _I(n,e.name)}R(!1,"invalid type","type",e.type)};let zc=th;class hS{constructor(e,t,n){F(this,"fragment");F(this,"name");F(this,"signature");F(this,"topic");F(this,"args");const s=e.name,i=e.format();ie(this,{fragment:e,name:s,signature:i,topic:t,args:n})}}class fS{constructor(e,t,n,s){F(this,"fragment");F(this,"name");F(this,"args");F(this,"signature");F(this,"selector");F(this,"value");const i=e.name,o=e.format();ie(this,{fragment:e,name:i,args:n,signature:o,selector:t,value:s})}}class dS{constructor(e,t,n){F(this,"fragment");F(this,"name");F(this,"args");F(this,"signature");F(this,"selector");const s=e.name,i=e.format();ie(this,{fragment:e,name:s,args:n,signature:i,selector:t})}}class zy{constructor(e){F(this,"hash");F(this,"_isIndexed");ie(this,{hash:e,_isIndexed:!0})}static isIndexed(e){return!!(e&&e._isIndexed)}}const Hy={0:"generic panic",1:"assert(false)",17:"arithmetic overflow",18:"division or modulo by zero",33:"enum overflow",34:"invalid encoded storage byte array accessed",49:"out-of-bounds array access; popping on an empty array",50:"out-of-bounds access of an array or bytesN",65:"out of memory",81:"uninitialized function"},qy={"0x08c379a0":{signature:"Error(string)",name:"Error",inputs:["string"],reason:r=>`reverted with reason string ${JSON.stringify(r)}`},"0x4e487b71":{signature:"Panic(uint256)",name:"Panic",inputs:["uint256"],reason:r=>{let e="unknown panic code";return r>=0&&r<=255&&Hy[r.toString()]&&(e=Hy[r.toString()]),`reverted with panic code 0x${r.toString(16)} (${e})`}}};var sn,on,an,vt,bn,cu,lu;const gi=class gi{constructor(e){M(this,bn);F(this,"fragments");F(this,"deploy");F(this,"fallback");F(this,"receive");M(this,sn);M(this,on);M(this,an);M(this,vt);let t=[];typeof e=="string"?t=JSON.parse(e):t=e,P(this,an,new Map),P(this,sn,new Map),P(this,on,new Map);const n=[];for(const o of t)try{n.push(Wi.from(o))}catch(a){console.log(`[Warning] Invalid Fragment ${JSON.stringify(o)}:`,a.message)}ie(this,{fragments:Object.freeze(n)});let s=null,i=!1;P(this,vt,this.getAbiCoder()),this.fragments.forEach((o,a)=>{let c;switch(o.type){case"constructor":if(this.deploy){console.log("duplicate definition - constructor");return}ie(this,{deploy:o});return;case"fallback":o.inputs.length===0?i=!0:(R(!s||o.payable!==s.payable,"conflicting fallback fragments",`fragments[${a}]`,o),s=o,i=s.payable);return;case"function":c=y(this,an);break;case"event":c=y(this,on);break;case"error":c=y(this,sn);break;default:return}const l=o.format();c.has(l)||c.set(l,o)}),this.deploy||ie(this,{deploy:Gn.from("constructor()")}),ie(this,{fallback:s,receive:i})}format(e){const t=e?"minimal":"full";return this.fragments.map(s=>s.format(t))}formatJson(){const e=this.fragments.map(t=>t.format("json"));return JSON.stringify(e.map(t=>JSON.parse(t)))}getAbiCoder(){return zc.defaultAbiCoder()}getFunctionName(e){const t=K(this,bn,cu).call(this,e,null,!1);return R(t,"no matching function","key",e),t.name}hasFunction(e){return!!K(this,bn,cu).call(this,e,null,!1)}getFunction(e,t){return K(this,bn,cu).call(this,e,t||null,!0)}forEachFunction(e){const t=Array.from(y(this,an).keys());t.sort((n,s)=>n.localeCompare(s));for(let n=0;n<t.length;n++){const s=t[n];e(y(this,an).get(s),n)}}getEventName(e){const t=K(this,bn,lu).call(this,e,null,!1);return R(t,"no matching event","key",e),t.name}hasEvent(e){return!!K(this,bn,lu).call(this,e,null,!1)}getEvent(e,t){return K(this,bn,lu).call(this,e,t||null,!0)}forEachEvent(e){const t=Array.from(y(this,on).keys());t.sort((n,s)=>n.localeCompare(s));for(let n=0;n<t.length;n++){const s=t[n];e(y(this,on).get(s),n)}}getError(e,t){if(Ce(e)){const s=e.toLowerCase();if(qy[s])return qt.from(qy[s].signature);for(const i of y(this,sn).values())if(s===i.selector)return i;return null}if(e.indexOf("(")===-1){const s=[];for(const[i,o]of y(this,sn))i.split("(")[0]===e&&s.push(o);if(s.length===0)return e==="Error"?qt.from("error Error(string)"):e==="Panic"?qt.from("error Panic(uint256)"):null;if(s.length>1){const i=s.map(o=>JSON.stringify(o.format())).join(", ");R(!1,`ambiguous error description (i.e. ${i})`,"name",e)}return s[0]}if(e=qt.from(e).format(),e==="Error(string)")return qt.from("error Error(string)");if(e==="Panic(uint256)")return qt.from("error Panic(uint256)");const n=y(this,sn).get(e);return n||null}forEachError(e){const t=Array.from(y(this,sn).keys());t.sort((n,s)=>n.localeCompare(s));for(let n=0;n<t.length;n++){const s=t[n];e(y(this,sn).get(s),n)}}_decodeParams(e,t){return y(this,vt).decode(e,t)}_encodeParams(e,t){return y(this,vt).encode(e,t)}encodeDeploy(e){return this._encodeParams(this.deploy.inputs,e||[])}decodeErrorResult(e,t){if(typeof e=="string"){const n=this.getError(e);R(n,"unknown error","fragment",e),e=n}return R(ke(t,0,4)===e.selector,`data signature does not match error ${e.name}.`,"data",t),this._decodeParams(e.inputs,ke(t,4))}encodeErrorResult(e,t){if(typeof e=="string"){const n=this.getError(e);R(n,"unknown error","fragment",e),e=n}return $e([e.selector,this._encodeParams(e.inputs,t||[])])}decodeFunctionData(e,t){if(typeof e=="string"){const n=this.getFunction(e);R(n,"unknown function","fragment",e),e=n}return R(ke(t,0,4)===e.selector,`data signature does not match function ${e.name}.`,"data",t),this._decodeParams(e.inputs,ke(t,4))}encodeFunctionData(e,t){if(typeof e=="string"){const n=this.getFunction(e);R(n,"unknown function","fragment",e),e=n}return $e([e.selector,this._encodeParams(e.inputs,t||[])])}decodeFunctionResult(e,t){if(typeof e=="string"){const i=this.getFunction(e);R(i,"unknown function","fragment",e),e=i}let n="invalid length for result data";const s=Dt(t);if(s.length%32===0)try{return y(this,vt).decode(e.outputs,s)}catch{n="could not decode result data"}q(!1,n,"BAD_DATA",{value:X(s),info:{method:e.name,signature:e.format()}})}makeError(e,t){const n=ue(e,"data"),s=zc.getBuiltinCallException("call",t,n);if(s.message.startsWith("execution reverted (unknown custom error)")){const a=X(n.slice(0,4)),c=this.getError(a);if(c)try{const l=y(this,vt).decode(c.inputs,n.slice(4));s.revert={name:c.name,signature:c.format(),args:l},s.reason=s.revert.signature,s.message=`execution reverted: ${s.reason}`}catch{s.message="execution reverted (coult not decode custom error)"}}const o=this.parseTransaction(t);return o&&(s.invocation={method:o.name,signature:o.signature,args:o.args}),s}encodeFunctionResult(e,t){if(typeof e=="string"){const n=this.getFunction(e);R(n,"unknown function","fragment",e),e=n}return X(y(this,vt).encode(e.outputs,t||[]))}encodeFilterTopics(e,t){if(typeof e=="string"){const i=this.getEvent(e);R(i,"unknown event","eventFragment",e),e=i}q(t.length<=e.inputs.length,`too many arguments for ${e.format()}`,"UNEXPECTED_ARGUMENT",{count:t.length,expectedCount:e.inputs.length});const n=[];e.anonymous||n.push(e.topicHash);const s=(i,o)=>i.type==="string"?Gi(o):i.type==="bytes"?Ke(X(o)):(i.type==="bool"&&typeof o=="boolean"?o=o?"0x01":"0x00":i.type.match(/^u?int/)?o=Vs(o):i.type.match(/^bytes/)?o=DA(o,32):i.type==="address"&&y(this,vt).encode(["address"],[o]),Xn(X(o),32));for(t.forEach((i,o)=>{const a=e.inputs[o];if(!a.indexed){R(i==null,"cannot filter non-indexed parameters; must be null","contract."+a.name,i);return}i==null?n.push(null):a.baseType==="array"||a.baseType==="tuple"?R(!1,"filtering with tuples or arrays not supported","contract."+a.name,i):Array.isArray(i)?n.push(i.map(c=>s(a,c))):n.push(s(a,i))});n.length&&n[n.length-1]===null;)n.pop();return n}encodeEventLog(e,t){if(typeof e=="string"){const o=this.getEvent(e);R(o,"unknown event","eventFragment",e),e=o}const n=[],s=[],i=[];return e.anonymous||n.push(e.topicHash),R(t.length===e.inputs.length,"event arguments/values mismatch","values",t),e.inputs.forEach((o,a)=>{const c=t[a];if(o.indexed)if(o.type==="string")n.push(Gi(c));else if(o.type==="bytes")n.push(Ke(c));else{if(o.baseType==="tuple"||o.baseType==="array")throw new Error("not implemented");n.push(y(this,vt).encode([o.type],[c]))}else s.push(o),i.push(c)}),{data:y(this,vt).encode(s,i),topics:n}}decodeEventLog(e,t,n){if(typeof e=="string"){const d=this.getEvent(e);R(d,"unknown event","eventFragment",e),e=d}if(n!=null&&!e.anonymous){const d=e.topicHash;R(Ce(n[0],32)&&n[0].toLowerCase()===d,"fragment/topic mismatch","topics[0]",n[0]),n=n.slice(1)}const s=[],i=[],o=[];e.inputs.forEach((d,p)=>{d.indexed?d.type==="string"||d.type==="bytes"||d.baseType==="tuple"||d.baseType==="array"?(s.push(ut.from({type:"bytes32",name:d.name})),o.push(!0)):(s.push(d),o.push(!1)):(i.push(d),o.push(!1))});const a=n!=null?y(this,vt).decode(s,$e(n)):null,c=y(this,vt).decode(i,t,!0),l=[],u=[];let h=0,f=0;return e.inputs.forEach((d,p)=>{let g=null;if(d.indexed)if(a==null)g=new zy(null);else if(o[p])g=new zy(a[f++]);else try{g=a[f++]}catch(m){g=m}else try{g=c[h++]}catch(m){g=m}l.push(g),u.push(d.name||null)}),_a.fromItems(l,u)}parseTransaction(e){const t=ue(e.data,"tx.data"),n=re(e.value!=null?e.value:0,"tx.value"),s=this.getFunction(X(t.slice(0,4)));if(!s)return null;const i=y(this,vt).decode(s.inputs,t.slice(4));return new fS(s,s.selector,i,n)}parseCallResult(e){throw new Error("@TODO")}parseLog(e){const t=this.getEvent(e.topics[0]);return!t||t.anonymous?null:new hS(t,t.topicHash,this.decodeEventLog(t,e.data,e.topics))}parseError(e){const t=X(e),n=this.getError(ke(t,0,4));if(!n)return null;const s=y(this,vt).decode(n.inputs,ke(t,4));return new dS(n,n.selector,s)}static from(e){return e instanceof gi?e:typeof e=="string"?new gi(JSON.parse(e)):typeof e.formatJson=="function"?new gi(e.formatJson()):typeof e.format=="function"?new gi(e.format("json")):new gi(e)}};sn=new WeakMap,on=new WeakMap,an=new WeakMap,vt=new WeakMap,bn=new WeakSet,cu=function(e,t,n){if(Ce(e)){const i=e.toLowerCase();for(const o of y(this,an).values())if(i===o.selector)return o;return null}if(e.indexOf("(")===-1){const i=[];for(const[o,a]of y(this,an))o.split("(")[0]===e&&i.push(a);if(t){const o=t.length>0?t[t.length-1]:null;let a=t.length,c=!0;It.isTyped(o)&&o.type==="overrides"&&(c=!1,a--);for(let l=i.length-1;l>=0;l--){const u=i[l].inputs.length;u!==a&&(!c||u!==a-1)&&i.splice(l,1)}for(let l=i.length-1;l>=0;l--){const u=i[l].inputs;for(let h=0;h<t.length;h++)if(It.isTyped(t[h])){if(h>=u.length){if(t[h].type==="overrides")continue;i.splice(l,1);break}if(t[h].type!==u[h].baseType){i.splice(l,1);break}}}}if(i.length===1&&t&&t.length!==i[0].inputs.length){const o=t[t.length-1];(o==null||Array.isArray(o)||typeof o!="object")&&i.splice(0,1)}if(i.length===0)return null;if(i.length>1&&n){const o=i.map(a=>JSON.stringify(a.format())).join(", ");R(!1,`ambiguous function description (i.e. matches ${o})`,"key",e)}return i[0]}const s=y(this,an).get(pn.from(e).format());return s||null},lu=function(e,t,n){if(Ce(e)){const i=e.toLowerCase();for(const o of y(this,on).values())if(i===o.topicHash)return o;return null}if(e.indexOf("(")===-1){const i=[];for(const[o,a]of y(this,on))o.split("(")[0]===e&&i.push(a);if(t){for(let o=i.length-1;o>=0;o--)i[o].inputs.length<t.length&&i.splice(o,1);for(let o=i.length-1;o>=0;o--){const a=i[o].inputs;for(let c=0;c<t.length;c++)if(It.isTyped(t[c])&&t[c].type!==a[c].baseType){i.splice(o,1);break}}}if(i.length===0)return null;if(i.length>1&&n){const o=i.map(a=>JSON.stringify(a.format())).join(", ");R(!1,`ambiguous event description (i.e. matches ${o})`,"key",e)}return i[0]}const s=y(this,on).get(dn.from(e).format());return s||null};let Id=gi;const Y1=BigInt(0);function Mo(r){return r??null}function Fe(r){return r==null?null:r.toString()}class Vy{constructor(e,t,n){F(this,"gasPrice");F(this,"maxFeePerGas");F(this,"maxPriorityFeePerGas");ie(this,{gasPrice:Mo(e),maxFeePerGas:Mo(t),maxPriorityFeePerGas:Mo(n)})}toJSON(){const{gasPrice:e,maxFeePerGas:t,maxPriorityFeePerGas:n}=this;return{_type:"FeeData",gasPrice:Fe(e),maxFeePerGas:Fe(t),maxPriorityFeePerGas:Fe(n)}}}function _u(r){const e={};r.to&&(e.to=r.to),r.from&&(e.from=r.from),r.data&&(e.data=X(r.data));const t="chainId,gasLimit,gasPrice,maxFeePerBlobGas,maxFeePerGas,maxPriorityFeePerGas,value".split(/,/);for(const s of t)!(s in r)||r[s]==null||(e[s]=re(r[s],`request.${s}`));const n="type,nonce".split(/,/);for(const s of n)!(s in r)||r[s]==null||(e[s]=ce(r[s],`request.${s}`));return r.accessList&&(e.accessList=ro(r.accessList)),r.authorizationList&&(e.authorizationList=r.authorizationList.slice()),"blockTag"in r&&(e.blockTag=r.blockTag),"enableCcipRead"in r&&(e.enableCcipRead=!!r.enableCcipRead),"customData"in r&&(e.customData=r.customData),"blobVersionedHashes"in r&&r.blobVersionedHashes&&(e.blobVersionedHashes=r.blobVersionedHashes.slice()),"kzg"in r&&(e.kzg=r.kzg),"blobs"in r&&r.blobs&&(e.blobs=r.blobs.map(s=>kp(s)?X(s):Object.assign({},s))),e}var Mn;class pS{constructor(e,t){F(this,"provider");F(this,"number");F(this,"hash");F(this,"timestamp");F(this,"parentHash");F(this,"parentBeaconBlockRoot");F(this,"nonce");F(this,"difficulty");F(this,"gasLimit");F(this,"gasUsed");F(this,"stateRoot");F(this,"receiptsRoot");F(this,"blobGasUsed");F(this,"excessBlobGas");F(this,"miner");F(this,"prevRandao");F(this,"extraData");F(this,"baseFeePerGas");M(this,Mn);P(this,Mn,e.transactions.map(n=>typeof n!="string"?new Hc(n,t):n)),ie(this,{provider:t,hash:Mo(e.hash),number:e.number,timestamp:e.timestamp,parentHash:e.parentHash,parentBeaconBlockRoot:e.parentBeaconBlockRoot,nonce:e.nonce,difficulty:e.difficulty,gasLimit:e.gasLimit,gasUsed:e.gasUsed,blobGasUsed:e.blobGasUsed,excessBlobGas:e.excessBlobGas,miner:e.miner,prevRandao:Mo(e.prevRandao),extraData:e.extraData,baseFeePerGas:Mo(e.baseFeePerGas),stateRoot:e.stateRoot,receiptsRoot:e.receiptsRoot})}get transactions(){return y(this,Mn).map(e=>typeof e=="string"?e:e.hash)}get prefetchedTransactions(){const e=y(this,Mn).slice();return e.length===0?[]:(q(typeof e[0]=="object","transactions were not prefetched with block request","UNSUPPORTED_OPERATION",{operation:"transactionResponses()"}),e)}toJSON(){const{baseFeePerGas:e,difficulty:t,extraData:n,gasLimit:s,gasUsed:i,hash:o,miner:a,prevRandao:c,nonce:l,number:u,parentHash:h,parentBeaconBlockRoot:f,stateRoot:d,receiptsRoot:p,timestamp:g,transactions:m}=this;return{_type:"Block",baseFeePerGas:Fe(e),difficulty:Fe(t),extraData:n,gasLimit:Fe(s),gasUsed:Fe(i),blobGasUsed:Fe(this.blobGasUsed),excessBlobGas:Fe(this.excessBlobGas),hash:o,miner:a,prevRandao:c,nonce:l,number:u,parentHash:h,timestamp:g,parentBeaconBlockRoot:f,stateRoot:d,receiptsRoot:p,transactions:m}}[Symbol.iterator](){let e=0;const t=this.transactions;return{next:()=>e<this.length?{value:t[e++],done:!1}:{value:void 0,done:!0}}}get length(){return y(this,Mn).length}get date(){return this.timestamp==null?null:new Date(this.timestamp*1e3)}async getTransaction(e){let t;if(typeof e=="number")t=y(this,Mn)[e];else{const n=e.toLowerCase();for(const s of y(this,Mn))if(typeof s=="string"){if(s!==n)continue;t=s;break}else{if(s.hash!==n)continue;t=s;break}}if(t==null)throw new Error("no such tx");return typeof t=="string"?await this.provider.getTransaction(t):t}getPrefetchedTransaction(e){const t=this.prefetchedTransactions;if(typeof e=="number")return t[e];e=e.toLowerCase();for(const n of t)if(n.hash===e)return n;R(!1,"no matching transaction","indexOrHash",e)}isMined(){return!!this.hash}isLondon(){return!!this.baseFeePerGas}orphanedEvent(){if(!this.isMined())throw new Error("");return gS(this)}}Mn=new WeakMap;class fl{constructor(e,t){F(this,"provider");F(this,"transactionHash");F(this,"blockHash");F(this,"blockNumber");F(this,"removed");F(this,"address");F(this,"data");F(this,"topics");F(this,"index");F(this,"transactionIndex");this.provider=t;const n=Object.freeze(e.topics.slice());ie(this,{transactionHash:e.transactionHash,blockHash:e.blockHash,blockNumber:e.blockNumber,removed:e.removed,address:e.address,data:e.data,topics:n,index:e.index,transactionIndex:e.transactionIndex})}toJSON(){const{address:e,blockHash:t,blockNumber:n,data:s,index:i,removed:o,topics:a,transactionHash:c,transactionIndex:l}=this;return{_type:"log",address:e,blockHash:t,blockNumber:n,data:s,index:i,removed:o,topics:a,transactionHash:c,transactionIndex:l}}async getBlock(){const e=await this.provider.getBlock(this.blockHash);return q(!!e,"failed to find transaction","UNKNOWN_ERROR",{}),e}async getTransaction(){const e=await this.provider.getTransaction(this.transactionHash);return q(!!e,"failed to find transaction","UNKNOWN_ERROR",{}),e}async getTransactionReceipt(){const e=await this.provider.getTransactionReceipt(this.transactionHash);return q(!!e,"failed to find transaction receipt","UNKNOWN_ERROR",{}),e}removedEvent(){return yS(this)}}var rl;class Z1{constructor(e,t){F(this,"provider");F(this,"to");F(this,"from");F(this,"contractAddress");F(this,"hash");F(this,"index");F(this,"blockHash");F(this,"blockNumber");F(this,"logsBloom");F(this,"gasUsed");F(this,"blobGasUsed");F(this,"cumulativeGasUsed");F(this,"gasPrice");F(this,"blobGasPrice");F(this,"type");F(this,"status");F(this,"root");M(this,rl);P(this,rl,Object.freeze(e.logs.map(s=>new fl(s,t))));let n=Y1;e.effectiveGasPrice!=null?n=e.effectiveGasPrice:e.gasPrice!=null&&(n=e.gasPrice),ie(this,{provider:t,to:e.to,from:e.from,contractAddress:e.contractAddress,hash:e.hash,index:e.index,blockHash:e.blockHash,blockNumber:e.blockNumber,logsBloom:e.logsBloom,gasUsed:e.gasUsed,cumulativeGasUsed:e.cumulativeGasUsed,blobGasUsed:e.blobGasUsed,gasPrice:n,blobGasPrice:e.blobGasPrice,type:e.type,status:e.status,root:e.root})}get logs(){return y(this,rl)}toJSON(){const{to:e,from:t,contractAddress:n,hash:s,index:i,blockHash:o,blockNumber:a,logsBloom:c,logs:l,status:u,root:h}=this;return{_type:"TransactionReceipt",blockHash:o,blockNumber:a,contractAddress:n,cumulativeGasUsed:Fe(this.cumulativeGasUsed),from:t,gasPrice:Fe(this.gasPrice),blobGasUsed:Fe(this.blobGasUsed),blobGasPrice:Fe(this.blobGasPrice),gasUsed:Fe(this.gasUsed),hash:s,index:i,logs:l,logsBloom:c,root:h,status:u,to:e}}get length(){return this.logs.length}[Symbol.iterator](){let e=0;return{next:()=>e<this.length?{value:this.logs[e++],done:!1}:{value:void 0,done:!0}}}get fee(){return this.gasUsed*this.gasPrice}async getBlock(){const e=await this.provider.getBlock(this.blockHash);if(e==null)throw new Error("TODO");return e}async getTransaction(){const e=await this.provider.getTransaction(this.hash);if(e==null)throw new Error("TODO");return e}async getResult(){return await this.provider.getTransactionResult(this.hash)}async confirmations(){return await this.provider.getBlockNumber()-this.blockNumber+1}removedEvent(){return ev(this)}reorderedEvent(e){return q(!e||e.isMined(),"unmined 'other' transction cannot be orphaned","UNSUPPORTED_OPERATION",{operation:"reorderedEvent(other)"}),X1(this,e)}}rl=new WeakMap;var _s;const kg=class kg{constructor(e,t){F(this,"provider");F(this,"blockNumber");F(this,"blockHash");F(this,"index");F(this,"hash");F(this,"type");F(this,"to");F(this,"from");F(this,"nonce");F(this,"gasLimit");F(this,"gasPrice");F(this,"maxPriorityFeePerGas");F(this,"maxFeePerGas");F(this,"maxFeePerBlobGas");F(this,"data");F(this,"value");F(this,"chainId");F(this,"signature");F(this,"accessList");F(this,"blobVersionedHashes");F(this,"authorizationList");M(this,_s);this.provider=t,this.blockNumber=e.blockNumber!=null?e.blockNumber:null,this.blockHash=e.blockHash!=null?e.blockHash:null,this.hash=e.hash,this.index=e.index,this.type=e.type,this.from=e.from,this.to=e.to||null,this.gasLimit=e.gasLimit,this.nonce=e.nonce,this.data=e.data,this.value=e.value,this.gasPrice=e.gasPrice,this.maxPriorityFeePerGas=e.maxPriorityFeePerGas!=null?e.maxPriorityFeePerGas:null,this.maxFeePerGas=e.maxFeePerGas!=null?e.maxFeePerGas:null,this.maxFeePerBlobGas=e.maxFeePerBlobGas!=null?e.maxFeePerBlobGas:null,this.chainId=e.chainId,this.signature=e.signature,this.accessList=e.accessList!=null?e.accessList:null,this.blobVersionedHashes=e.blobVersionedHashes!=null?e.blobVersionedHashes:null,this.authorizationList=e.authorizationList!=null?e.authorizationList:null,P(this,_s,-1)}toJSON(){const{blockNumber:e,blockHash:t,index:n,hash:s,type:i,to:o,from:a,nonce:c,data:l,signature:u,accessList:h,blobVersionedHashes:f}=this;return{_type:"TransactionResponse",accessList:h,blockNumber:e,blockHash:t,blobVersionedHashes:f,chainId:Fe(this.chainId),data:l,from:a,gasLimit:Fe(this.gasLimit),gasPrice:Fe(this.gasPrice),hash:s,maxFeePerGas:Fe(this.maxFeePerGas),maxPriorityFeePerGas:Fe(this.maxPriorityFeePerGas),maxFeePerBlobGas:Fe(this.maxFeePerBlobGas),nonce:c,signature:u,to:o,index:n,type:i,value:Fe(this.value)}}async getBlock(){let e=this.blockNumber;if(e==null){const n=await this.getTransaction();n&&(e=n.blockNumber)}if(e==null)return null;const t=this.provider.getBlock(e);if(t==null)throw new Error("TODO");return t}async getTransaction(){return this.provider.getTransaction(this.hash)}async confirmations(){if(this.blockNumber==null){const{tx:t,blockNumber:n}=await Ot({tx:this.getTransaction(),blockNumber:this.provider.getBlockNumber()});return t==null||t.blockNumber==null?0:n-t.blockNumber+1}return await this.provider.getBlockNumber()-this.blockNumber+1}async wait(e,t){const n=e??1,s=t??0;let i=y(this,_s),o=-1,a=i===-1;const c=async()=>{if(a)return null;const{blockNumber:f,nonce:d}=await Ot({blockNumber:this.provider.getBlockNumber(),nonce:this.provider.getTransactionCount(this.from)});if(d<this.nonce){i=f;return}if(a)return null;const p=await this.getTransaction();if(!(p&&p.blockNumber!=null))for(o===-1&&(o=i-3,o<y(this,_s)&&(o=y(this,_s)));o<=f;){if(a)return null;const g=await this.provider.getBlock(o,!0);if(g==null)return;for(const m of g)if(m===this.hash)return;for(let m=0;m<g.length;m++){const b=await g.getTransaction(m);if(b.from===this.from&&b.nonce===this.nonce){if(a)return null;const x=await this.provider.getTransactionReceipt(b.hash);if(x==null||f-x.blockNumber+1<n)return;let v="replaced";b.data===this.data&&b.to===this.to&&b.value===this.value?v="repriced":b.data==="0x"&&b.from===b.to&&b.value===Y1&&(v="cancelled"),q(!1,"transaction was replaced","TRANSACTION_REPLACED",{cancelled:v==="replaced"||v==="cancelled",reason:v,replacement:b.replaceableTransaction(i),hash:b.hash,receipt:x})}}o++}},l=f=>{if(f==null||f.status!==0)return f;q(!1,"transaction execution reverted","CALL_EXCEPTION",{action:"sendTransaction",data:null,reason:null,invocation:null,revert:null,transaction:{to:f.to,from:f.from,data:""},receipt:f})},u=await this.provider.getTransactionReceipt(this.hash);if(n===0)return l(u);if(u){if(n===1||await u.confirmations()>=n)return l(u)}else if(await c(),n===0)return null;return await new Promise((f,d)=>{const p=[],g=()=>{p.forEach(b=>b())};if(p.push(()=>{a=!0}),s>0){const b=setTimeout(()=>{g(),d(Te("wait for transaction timeout","TIMEOUT"))},s);p.push(()=>{clearTimeout(b)})}const m=async b=>{if(await b.confirmations()>=n){g();try{f(l(b))}catch(x){d(x)}}};if(p.push(()=>{this.provider.off(this.hash,m)}),this.provider.on(this.hash,m),i>=0){const b=async()=>{try{await c()}catch(x){if(lt(x,"TRANSACTION_REPLACED")){g(),d(x);return}}a||this.provider.once("block",b)};p.push(()=>{this.provider.off("block",b)}),this.provider.once("block",b)}})}isMined(){return this.blockHash!=null}isLegacy(){return this.type===0}isBerlin(){return this.type===1}isLondon(){return this.type===2}isCancun(){return this.type===3}removedEvent(){return q(this.isMined(),"unmined transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),ev(this)}reorderedEvent(e){return q(this.isMined(),"unmined transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),q(!e||e.isMined(),"unmined 'other' transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),X1(this,e)}replaceableTransaction(e){R(Number.isInteger(e)&&e>=0,"invalid startBlock","startBlock",e);const t=new kg(this,this.provider);return P(t,_s,e),t}};_s=new WeakMap;let Hc=kg;function gS(r){return{orphan:"drop-block",hash:r.hash,number:r.number}}function X1(r,e){return{orphan:"reorder-transaction",tx:r,other:e}}function ev(r){return{orphan:"drop-transaction",tx:r}}function yS(r){return{orphan:"drop-log",log:{transactionHash:r.transactionHash,blockHash:r.blockHash,blockNumber:r.blockNumber,address:r.address,data:r.data,topics:Object.freeze(r.topics.slice()),index:r.index}}}class Qp extends fl{constructor(t,n,s){super(t,t.provider);F(this,"interface");F(this,"fragment");F(this,"args");const i=n.decodeEventLog(s,t.data,t.topics);ie(this,{args:i,fragment:s,interface:n})}get eventName(){return this.fragment.name}get eventSignature(){return this.fragment.format()}}class tv extends fl{constructor(t,n){super(t,t.provider);F(this,"error");ie(this,{error:n})}}var ya;class mS extends Z1{constructor(t,n,s){super(s,n);M(this,ya);P(this,ya,t)}get logs(){return super.logs.map(t=>{const n=t.topics.length?y(this,ya).getEvent(t.topics[0]):null;if(n)try{return new Qp(t,y(this,ya),n)}catch(s){return new tv(t,s)}return t})}}ya=new WeakMap;var nl;class Wp extends Hc{constructor(t,n,s){super(s,n);M(this,nl);P(this,nl,t)}async wait(t,n){const s=await super.wait(t,n);return s==null?null:new mS(y(this,nl),this.provider,s)}}nl=new WeakMap;class rv extends Ob{constructor(t,n,s,i){super(t,n,s);F(this,"log");ie(this,{log:i})}async getBlock(){return await this.log.getBlock()}async getTransaction(){return await this.log.getTransaction()}async getTransactionReceipt(){return await this.log.getTransactionReceipt()}}class wS extends rv{constructor(e,t,n,s,i){super(e,t,n,new Qp(i,e.interface,s));const o=e.interface.decodeEventLog(s,this.log.data,this.log.topics);ie(this,{args:o,fragment:s})}get eventName(){return this.fragment.name}get eventSignature(){return this.fragment.format()}}const Ky=BigInt(0);function nv(r){return r&&typeof r.call=="function"}function sv(r){return r&&typeof r.estimateGas=="function"}function mh(r){return r&&typeof r.resolveName=="function"}function iv(r){return r&&typeof r.sendTransaction=="function"}function ov(r){if(r!=null){if(mh(r))return r;if(r.provider)return r.provider}}var sl;class bS{constructor(e,t,n){M(this,sl);F(this,"fragment");if(ie(this,{fragment:t}),t.inputs.length<n.length)throw new Error("too many arguments");const s=Ji(e.runner,"resolveName"),i=mh(s)?s:null;P(this,sl,(async function(){const o=await Promise.all(t.inputs.map((a,c)=>n[c]==null?null:a.walkAsync(n[c],(u,h)=>u==="address"?Array.isArray(h)?Promise.all(h.map(f=>Bt(f,i))):Bt(h,i):h)));return e.interface.encodeFilterTopics(t,o)})())}getTopicFilter(){return y(this,sl)}}sl=new WeakMap;function Ji(r,e){return r==null?null:typeof r[e]=="function"?r:r.provider&&typeof r.provider[e]=="function"?r.provider:null}function vi(r){return r==null?null:r.provider||null}async function av(r,e){const t=It.dereference(r,"overrides");R(typeof t=="object","invalid overrides parameter","overrides",r);const n=_u(t);return R(n.to==null||(e||[]).indexOf("to")>=0,"cannot override to","overrides.to",n.to),R(n.data==null||(e||[]).indexOf("data")>=0,"cannot override data","overrides.data",n.data),n.from&&(n.from=n.from),n}async function vS(r,e,t){const n=Ji(r,"resolveName"),s=mh(n)?n:null;return await Promise.all(e.map((i,o)=>i.walkAsync(t[o],(a,c)=>(c=It.dereference(c,a),a==="address"?Bt(c,s):c))))}function ES(r){const e=async function(o){const a=await av(o,["data"]);a.to=await r.getAddress(),a.from&&(a.from=await Bt(a.from,ov(r.runner)));const c=r.interface,l=re(a.value||Ky,"overrides.value")===Ky,u=(a.data||"0x")==="0x";c.fallback&&!c.fallback.payable&&c.receive&&!u&&!l&&R(!1,"cannot send data to receive or send value to non-payable fallback","overrides",o),R(c.fallback||u,"cannot send data to receive-only contract","overrides.data",a.data);const h=c.receive||c.fallback&&c.fallback.payable;return R(h||l,"cannot send value to non-payable fallback","overrides.value",a.value),R(c.fallback||u,"cannot send data to receive-only contract","overrides.data",a.data),a},t=async function(o){const a=Ji(r.runner,"call");q(nv(a),"contract runner does not support calling","UNSUPPORTED_OPERATION",{operation:"call"});const c=await e(o);try{return await a.call(c)}catch(l){throw Up(l)&&l.data?r.interface.makeError(l.data,c):l}},n=async function(o){const a=r.runner;q(iv(a),"contract runner does not support sending transactions","UNSUPPORTED_OPERATION",{operation:"sendTransaction"});const c=await a.sendTransaction(await e(o)),l=vi(r.runner);return new Wp(r.interface,l,c)},s=async function(o){const a=Ji(r.runner,"estimateGas");return q(sv(a),"contract runner does not support gas estimation","UNSUPPORTED_OPERATION",{operation:"estimateGas"}),await a.estimateGas(await e(o))},i=async o=>await n(o);return ie(i,{_contract:r,estimateGas:s,populateTransaction:e,send:n,staticCall:t}),i}function AS(r,e){const t=function(...l){const u=r.interface.getFunction(e,l);return q(u,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e,args:l}}),u},n=async function(...l){const u=t(...l);let h={};if(u.inputs.length+1===l.length&&(h=await av(l.pop()),h.from&&(h.from=await Bt(h.from,ov(r.runner)))),u.inputs.length!==l.length)throw new Error("internal error: fragment inputs doesn't match arguments; should not happen");const f=await vS(r.runner,u.inputs,l);return Object.assign({},h,await Ot({to:r.getAddress(),data:r.interface.encodeFunctionData(u,f)}))},s=async function(...l){const u=await a(...l);return u.length===1?u[0]:u},i=async function(...l){const u=r.runner;q(iv(u),"contract runner does not support sending transactions","UNSUPPORTED_OPERATION",{operation:"sendTransaction"});const h=await u.sendTransaction(await n(...l)),f=vi(r.runner);return new Wp(r.interface,f,h)},o=async function(...l){const u=Ji(r.runner,"estimateGas");return q(sv(u),"contract runner does not support gas estimation","UNSUPPORTED_OPERATION",{operation:"estimateGas"}),await u.estimateGas(await n(...l))},a=async function(...l){const u=Ji(r.runner,"call");q(nv(u),"contract runner does not support calling","UNSUPPORTED_OPERATION",{operation:"call"});const h=await n(...l);let f="0x";try{f=await u.call(h)}catch(p){throw Up(p)&&p.data?r.interface.makeError(p.data,h):p}const d=t(...l);return r.interface.decodeFunctionResult(d,f)},c=async(...l)=>t(...l).constant?await s(...l):await i(...l);return ie(c,{name:r.interface.getFunctionName(e),_contract:r,_key:e,getFragment:t,estimateGas:o,populateTransaction:n,send:i,staticCall:s,staticCallResult:a}),Object.defineProperty(c,"fragment",{configurable:!1,enumerable:!0,get:()=>{const l=r.interface.getFunction(e);return q(l,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e}}),l}}),c}function xS(r,e){const t=function(...s){const i=r.interface.getEvent(e,s);return q(i,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e,args:s}}),i},n=function(...s){return new bS(r,t(...s),s)};return ie(n,{name:r.interface.getEventName(e),_contract:r,_key:e,getFragment:t}),Object.defineProperty(n,"fragment",{configurable:!1,enumerable:!0,get:()=>{const s=r.interface.getEvent(e);return q(s,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e}}),s}}),n}const Tu=Symbol.for("_ethersInternal_contract"),cv=new WeakMap;function IS(r,e){cv.set(r[Tu],e)}function er(r){return cv.get(r[Tu])}function SS(r){return r&&typeof r=="object"&&"getTopicFilter"in r&&typeof r.getTopicFilter=="function"&&r.fragment}async function Jp(r,e){let t,n=null;if(Array.isArray(e)){const i=function(o){if(Ce(o,32))return o;const a=r.interface.getEvent(o);return R(a,"unknown fragment","name",o),a.topicHash};t=e.map(o=>o==null?null:Array.isArray(o)?o.map(i):i(o))}else e==="*"?t=[null]:typeof e=="string"?Ce(e,32)?t=[e]:(n=r.interface.getEvent(e),R(n,"unknown fragment","event",e),t=[n.topicHash]):SS(e)?t=await e.getTopicFilter():"fragment"in e?(n=e.fragment,t=[n.topicHash]):R(!1,"unknown event name","event",e);t=t.map(i=>{if(i==null)return null;if(Array.isArray(i)){const o=Array.from(new Set(i.map(a=>a.toLowerCase())).values());return o.length===1?o[0]:(o.sort(),o)}return i.toLowerCase()});const s=t.map(i=>i==null?"null":Array.isArray(i)?i.join("|"):i).join("&");return{fragment:n,tag:s,topics:t}}async function bc(r,e){const{subs:t}=er(r);return t.get((await Jp(r,e)).tag)||null}async function Gy(r,e,t){const n=vi(r.runner);q(n,"contract runner does not support subscribing","UNSUPPORTED_OPERATION",{operation:e});const{fragment:s,tag:i,topics:o}=await Jp(r,t),{addr:a,subs:c}=er(r);let l=c.get(i);if(!l){const h={address:a||r,topics:o},f=m=>{let b=s;if(b==null)try{b=r.interface.getEvent(m.topics[0])}catch{}if(b){const x=b,v=s?r.interface.decodeEventLog(s,m.data,m.topics):[];Pd(r,t,v,S=>new wS(r,S,t,x,m))}else Pd(r,t,[],x=>new rv(r,x,t,m))};let d=[];l={tag:i,listeners:[],start:()=>{d.length||d.push(n.on(h,f))},stop:async()=>{if(d.length==0)return;let m=d;d=[],await Promise.all(m),n.off(h,f)}},c.set(i,l)}return l}let Sd=Promise.resolve();async function PS(r,e,t,n){await Sd;const s=await bc(r,e);if(!s)return!1;const i=s.listeners.length;return s.listeners=s.listeners.filter(({listener:o,once:a})=>{const c=Array.from(t);n&&c.push(n(a?null:o));try{o.call(r,...c)}catch{}return!a}),s.listeners.length===0&&(s.stop(),er(r).subs.delete(s.tag)),i>0}async function Pd(r,e,t,n){try{await Sd}catch{}const s=PS(r,e,t,n);return Sd=s,await s}const kl=["then"];var Ab;Ab=Tu;const Nc=class Nc{constructor(e,t,n,s){F(this,"target");F(this,"interface");F(this,"runner");F(this,"filters");F(this,Ab);F(this,"fallback");R(typeof e=="string"||d1(e),"invalid value for Contract target","target",e),n==null&&(n=null);const i=Id.from(t);ie(this,{target:e,runner:n,interface:i}),Object.defineProperty(this,Tu,{value:{}});let o,a=null,c=null;if(s){const h=vi(n);c=new Wp(this.interface,h,s)}let l=new Map;if(typeof e=="string")if(Ce(e))a=e,o=Promise.resolve(e);else{const h=Ji(n,"resolveName");if(!mh(h))throw Te("contract runner does not support name resolution","UNSUPPORTED_OPERATION",{operation:"resolveName"});o=h.resolveName(e).then(f=>{if(f==null)throw Te("an ENS name used for a contract target must be correctly configured","UNCONFIGURED_NAME",{value:e});return er(this).addr=f,f})}else o=e.getAddress().then(h=>{if(h==null)throw new Error("TODO");return er(this).addr=h,h});IS(this,{addrPromise:o,addr:a,deployTx:c,subs:l});const u=new Proxy({},{get:(h,f,d)=>{if(typeof f=="symbol"||kl.indexOf(f)>=0)return Reflect.get(h,f,d);try{return this.getEvent(f)}catch(p){if(!lt(p,"INVALID_ARGUMENT")||p.argument!=="key")throw p}},has:(h,f)=>kl.indexOf(f)>=0?Reflect.has(h,f):Reflect.has(h,f)||this.interface.hasEvent(String(f))});return ie(this,{filters:u}),ie(this,{fallback:i.receive||i.fallback?ES(this):null}),new Proxy(this,{get:(h,f,d)=>{if(typeof f=="symbol"||f in h||kl.indexOf(f)>=0)return Reflect.get(h,f,d);try{return h.getFunction(f)}catch(p){if(!lt(p,"INVALID_ARGUMENT")||p.argument!=="key")throw p}},has:(h,f)=>typeof f=="symbol"||f in h||kl.indexOf(f)>=0?Reflect.has(h,f):h.interface.hasFunction(f)})}connect(e){return new Nc(this.target,this.interface,e)}attach(e){return new Nc(e,this.interface,this.runner)}async getAddress(){return await er(this).addrPromise}async getDeployedCode(){const e=vi(this.runner);q(e,"runner does not support .provider","UNSUPPORTED_OPERATION",{operation:"getDeployedCode"});const t=await e.getCode(await this.getAddress());return t==="0x"?null:t}async waitForDeployment(){const e=this.deploymentTransaction();if(e)return await e.wait(),this;if(await this.getDeployedCode()!=null)return this;const n=vi(this.runner);return q(n!=null,"contract runner does not support .provider","UNSUPPORTED_OPERATION",{operation:"waitForDeployment"}),new Promise((s,i)=>{const o=async()=>{try{if(await this.getDeployedCode()!=null)return s(this);n.once("block",o)}catch(a){i(a)}};o()})}deploymentTransaction(){return er(this).deployTx}getFunction(e){return typeof e!="string"&&(e=e.format()),AS(this,e)}getEvent(e){return typeof e!="string"&&(e=e.format()),xS(this,e)}async queryTransaction(e){throw new Error("@TODO")}async queryFilter(e,t,n){t==null&&(t=0),n==null&&(n="latest");const{addr:s,addrPromise:i}=er(this),o=s||await i,{fragment:a,topics:c}=await Jp(this,e),l={address:o,topics:c,fromBlock:t,toBlock:n},u=vi(this.runner);return q(u,"contract runner does not have a provider","UNSUPPORTED_OPERATION",{operation:"queryFilter"}),(await u.getLogs(l)).map(h=>{let f=a;if(f==null)try{f=this.interface.getEvent(h.topics[0])}catch{}if(f)try{return new Qp(h,this.interface,f)}catch(d){return new tv(h,d)}return new fl(h,u)})}async on(e,t){const n=await Gy(this,"on",e);return n.listeners.push({listener:t,once:!1}),n.start(),this}async once(e,t){const n=await Gy(this,"once",e);return n.listeners.push({listener:t,once:!0}),n.start(),this}async emit(e,...t){return await Pd(this,e,t,null)}async listenerCount(e){if(e){const s=await bc(this,e);return s?s.listeners.length:0}const{subs:t}=er(this);let n=0;for(const{listeners:s}of t.values())n+=s.length;return n}async listeners(e){if(e){const s=await bc(this,e);return s?s.listeners.map(({listener:i})=>i):[]}const{subs:t}=er(this);let n=[];for(const{listeners:s}of t.values())n=n.concat(s.map(({listener:i})=>i));return n}async off(e,t){const n=await bc(this,e);if(!n)return this;if(t){const s=n.listeners.map(({listener:i})=>i).indexOf(t);s>=0&&n.listeners.splice(s,1)}return(t==null||n.listeners.length===0)&&(n.stop(),er(this).subs.delete(n.tag)),this}async removeAllListeners(e){if(e){const t=await bc(this,e);if(!t)return this;t.stop(),er(this).subs.delete(t.tag)}else{const{subs:t}=er(this);for(const{tag:n,stop:s}of t.values())s(),t.delete(n)}return this}async addListener(e,t){return await this.on(e,t)}async removeListener(e,t){return await this.off(e,t)}static buildClass(e){class t extends Nc{constructor(s,i=null){super(s,e,i)}}return t}static from(e,t,n){return n==null&&(n=null),new this(e,t,n)}};let Od=Nc;function OS(){return Od}class Pc extends OS(){}function Xh(r){return r.match(/^ipfs:\/\/ipfs\//i)?r=r.substring(12):r.match(/^ipfs:\/\//i)?r=r.substring(7):R(!1,"unsupported IPFS format","link",r),`https://gateway.ipfs.io/ipfs/${r}`}class DS{constructor(e){F(this,"name");ie(this,{name:e})}connect(e){return this}supportsCoinType(e){return!1}async encodeAddress(e,t){throw new Error("unsupported coin")}async decodeAddress(e,t){throw new Error("unsupported coin")}}const lv=new RegExp("^(ipfs)://(.*)$","i"),Qy=[new RegExp("^(https)://(.*)$","i"),new RegExp("^(data):(.*)$","i"),lv,new RegExp("^eip155:[0-9]+/(erc[0-9]+):(.*)$","i")];var Ts,$i,Ns,So,rh,uv;const Uo=class Uo{constructor(e,t,n){M(this,Ns);F(this,"provider");F(this,"address");F(this,"name");M(this,Ts);M(this,$i);ie(this,{provider:e,address:t,name:n}),P(this,Ts,null),P(this,$i,new Pc(t,["function supportsInterface(bytes4) view returns (bool)","function resolve(bytes, bytes) view returns (bytes)","function addr(bytes32) view returns (address)","function addr(bytes32, uint) view returns (bytes)","function text(bytes32, string) view returns (string)","function contenthash(bytes32) view returns (bytes)"],e))}async supportsWildcard(){return y(this,Ts)==null&&P(this,Ts,(async()=>{try{return await y(this,$i).supportsInterface("0x9061b923")}catch(e){if(lt(e,"CALL_EXCEPTION"))return!1;throw P(this,Ts,null),e}})()),await y(this,Ts)}async getAddress(e){if(e==null&&(e=60),e===60)try{const i=await K(this,Ns,So).call(this,"addr(bytes32)");return i==null||i===Uc?null:i}catch(i){if(lt(i,"CALL_EXCEPTION"))return null;throw i}if(e>=0&&e<2147483648){let i=e+2147483648;const o=await K(this,Ns,So).call(this,"addr(bytes32,uint)",[i]);if(Ce(o,20))return Ae(o)}let t=null;for(const i of this.provider.plugins)if(i instanceof DS&&i.supportsCoinType(e)){t=i;break}if(t==null)return null;const n=await K(this,Ns,So).call(this,"addr(bytes32,uint)",[e]);if(n==null||n==="0x")return null;const s=await t.decodeAddress(e,n);if(s!=null)return s;q(!1,"invalid coin data","UNSUPPORTED_OPERATION",{operation:`getAddress(${e})`,info:{coinType:e,data:n}})}async getText(e){const t=await K(this,Ns,So).call(this,"text(bytes32,string)",[e]);return t==null||t==="0x"?null:t}async getContentHash(){const e=await K(this,Ns,So).call(this,"contenthash(bytes32)");if(e==null||e==="0x")return null;const t=e.match(/^0x(e3010170|e5010172)(([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f]*))$/);if(t){const s=t[1]==="e3010170"?"ipfs":"ipns",i=parseInt(t[4],16);if(t[5].length===i*2)return`${s}://${BA("0x"+t[2])}`}const n=e.match(/^0xe40101fa011b20([0-9a-f]*)$/);if(n&&n[1].length===64)return`bzz://${n[1]}`;q(!1,"invalid or unsupported content hash data","UNSUPPORTED_OPERATION",{operation:"getContentHash()",info:{data:e}})}async getAvatar(){return(await this._getAvatar()).url}async _getAvatar(){const e=[{type:"name",value:this.name}];try{const t=await this.getText("avatar");if(t==null)return e.push({type:"!avatar",value:""}),{url:null,linkage:e};e.push({type:"avatar",value:t});for(let n=0;n<Qy.length;n++){const s=t.match(Qy[n]);if(s==null)continue;const i=s[1].toLowerCase();switch(i){case"https":case"data":return e.push({type:"url",value:t}),{linkage:e,url:t};case"ipfs":{const o=Xh(t);return e.push({type:"ipfs",value:t}),e.push({type:"url",value:o}),{linkage:e,url:o}}case"erc721":case"erc1155":{const o=i==="erc721"?"tokenURI(uint256)":"uri(uint256)";e.push({type:i,value:t});const a=await this.getAddress();if(a==null)return e.push({type:"!owner",value:""}),{url:null,linkage:e};const c=(s[2]||"").split("/");if(c.length!==2)return e.push({type:`!${i}caip`,value:s[2]||""}),{url:null,linkage:e};const l=c[1],u=new Pc(c[0],["function tokenURI(uint) view returns (string)","function ownerOf(uint) view returns (address)","function uri(uint) view returns (string)","function balanceOf(address, uint256) view returns (uint)"],this.provider);if(i==="erc721"){const g=await u.ownerOf(l);if(a!==g)return e.push({type:"!owner",value:g}),{url:null,linkage:e};e.push({type:"owner",value:g})}else if(i==="erc1155"){const g=await u.balanceOf(a,l);if(!g)return e.push({type:"!balance",value:"0"}),{url:null,linkage:e};e.push({type:"balance",value:g.toString()})}let h=await u[o](l);if(h==null||h==="0x")return e.push({type:"!metadata-url",value:""}),{url:null,linkage:e};e.push({type:"metadata-url-base",value:h}),i==="erc1155"&&(h=h.replace("{id}",Vs(l,32).substring(2)),e.push({type:"metadata-url-expanded",value:h})),h.match(/^ipfs:/i)&&(h=Xh(h)),e.push({type:"metadata-url",value:h});let f={};const d=await new Ks(h).send();d.assertOk();try{f=d.bodyJson}catch{try{e.push({type:"!metadata",value:d.bodyText})}catch{const b=d.body;return b&&e.push({type:"!metadata",value:X(b)}),{url:null,linkage:e}}return{url:null,linkage:e}}if(!f)return e.push({type:"!metadata",value:""}),{url:null,linkage:e};e.push({type:"metadata",value:JSON.stringify(f)});let p=f.image;if(typeof p!="string")return e.push({type:"!imageUrl",value:""}),{url:null,linkage:e};if(!p.match(/^(https:\/\/|data:)/i)){if(p.match(lv)==null)return e.push({type:"!imageUrl-ipfs",value:p}),{url:null,linkage:e};e.push({type:"imageUrl-ipfs",value:p}),p=Xh(p)}return e.push({type:"url",value:p}),{linkage:e,url:p}}}}}catch{}return{linkage:e,url:null}}static async getEnsAddress(e){const t=await e.getNetwork(),n=t.getPlugin("org.ethers.plugins.network.Ens");return q(n,"network does not support ENS","UNSUPPORTED_OPERATION",{operation:"getEnsAddress",info:{network:t}}),n.address}static async fromName(e,t){var s;let n=t;for(;;){if(n===""||n==="."||t!=="eth"&&n==="eth")return null;const i=await K(s=Uo,rh,uv).call(s,e,n);if(i!=null){const o=new Uo(e,i,t);return n!==t&&!await o.supportsWildcard()?null:o}n=n.split(".").slice(1).join(".")}}};Ts=new WeakMap,$i=new WeakMap,Ns=new WeakSet,So=async function(e,t){t=(t||[]).slice();const n=y(this,$i).interface;t.unshift(Ad(this.name));let s=null;await this.supportsWildcard()&&(s=n.getFunction(e),q(s,"missing fragment","UNKNOWN_ERROR",{info:{funcName:e}}),t=[H3(this.name,255),n.encodeFunctionData(s,t)],e="resolve(bytes,bytes)"),t.push({enableCcipRead:!0});try{const i=await y(this,$i)[e](...t);return s?n.decodeFunctionResult(s,i)[0]:i}catch(i){if(!lt(i,"CALL_EXCEPTION"))throw i}return null},rh=new WeakSet,uv=async function(e,t){const n=await Uo.getEnsAddress(e);try{const i=await new Pc(n,["function resolver(bytes32) view returns (address)"],e).resolver(Ad(t),{enableCcipRead:!0});return i===Uc?null:i}catch(s){throw s}return null},M(Uo,rh);let Nu=Uo;const Wy=BigInt(0);function ge(r,e){return(function(t){return t==null?e:r(t)})}function qc(r,e){return(t=>{if(e&&t==null)return null;if(!Array.isArray(t))throw new Error("not an array");return t.map(n=>r(n))})}function dl(r,e){return(t=>{const n={};for(const s in r){let i=s;if(e&&s in e&&!(i in t)){for(const o of e[s])if(o in t){i=o;break}}try{const o=r[s](t[i]);o!==void 0&&(n[s]=o)}catch(o){const a=o instanceof Error?o.message:"not-an-error";q(!1,`invalid value for value.${s} (${a})`,"BAD_DATA",{value:t})}}return n})}function CS(r){switch(r){case!0:case"true":return!0;case!1:case"false":return!1}R(!1,`invalid boolean; ${JSON.stringify(r)}`,"value",r)}function La(r){return R(Ce(r,!0),"invalid data","value",r),r}function ct(r){return R(Ce(r,32),"invalid hash","value",r),r}const BS=dl({address:Ae,blockHash:ct,blockNumber:ce,data:La,index:ce,removed:ge(CS,!1),topics:qc(ct),transactionHash:ct,transactionIndex:ce},{index:["logIndex"]});function _S(r){return BS(r)}const TS=dl({hash:ge(ct),parentHash:ct,parentBeaconBlockRoot:ge(ct,null),number:ce,timestamp:ce,nonce:ge(La),difficulty:re,gasLimit:re,gasUsed:re,stateRoot:ge(ct,null),receiptsRoot:ge(ct,null),blobGasUsed:ge(re,null),excessBlobGas:ge(re,null),miner:ge(Ae),prevRandao:ge(ct,null),extraData:La,baseFeePerGas:ge(re)},{prevRandao:["mixHash"]});function NS(r){const e=TS(r);return e.transactions=r.transactions.map(t=>typeof t=="string"?t:hv(t)),e}const RS=dl({transactionIndex:ce,blockNumber:ce,transactionHash:ct,address:Ae,topics:qc(ct),data:La,index:ce,blockHash:ct},{index:["logIndex"]});function US(r){return RS(r)}const kS=dl({to:ge(Ae,null),from:ge(Ae,null),contractAddress:ge(Ae,null),index:ce,root:ge(X),gasUsed:re,blobGasUsed:ge(re,null),logsBloom:ge(La),blockHash:ct,hash:ct,logs:qc(US),blockNumber:ce,cumulativeGasUsed:re,effectiveGasPrice:ge(re),blobGasPrice:ge(re,null),status:ge(ce),type:ge(ce,0)},{effectiveGasPrice:["gasPrice"],hash:["transactionHash"],index:["transactionIndex"]});function $S(r){return kS(r)}function hv(r){r.to&&re(r.to)===Wy&&(r.to="0x0000000000000000000000000000000000000000");const e=dl({hash:ct,index:ge(ce,void 0),type:t=>t==="0x"||t==null?0:ce(t),accessList:ge(ro,null),blobVersionedHashes:ge(qc(ct,!0),null),authorizationList:ge(qc(t=>{let n;if(t.signature)n=t.signature;else{let s=t.yParity;s==="0x1b"?s=0:s==="0x1c"&&(s=1),n=Object.assign({},t,{yParity:s})}return{address:Ae(t.address),chainId:re(t.chainId),nonce:re(t.nonce),signature:Kt.from(n)}},!1),null),blockHash:ge(ct,null),blockNumber:ge(ce,null),transactionIndex:ge(ce,null),from:Ae,gasPrice:ge(re),maxPriorityFeePerGas:ge(re),maxFeePerGas:ge(re),maxFeePerBlobGas:ge(re,null),gasLimit:re,to:ge(Ae,null),value:re,nonce:ce,data:La,creates:ge(Ae,null),chainId:ge(re,null)},{data:["input"],gasLimit:["gas"],index:["transactionIndex"]})(r);if(e.to==null&&e.creates==null&&(e.creates=SI(e)),(r.type===1||r.type===2)&&r.accessList==null&&(e.accessList=[]),r.signature?e.signature=Kt.from(r.signature):e.signature=Kt.from(r),e.chainId==null){const t=e.signature.legacyChainId;t!=null&&(e.chainId=t)}return e.blockHash&&re(e.blockHash)===Wy&&(e.blockHash=null),e}const LS="0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e";class pl{constructor(e){F(this,"name");ie(this,{name:e})}clone(){return new pl(this.name)}}class wh extends pl{constructor(t,n){t==null&&(t=0);super(`org.ethers.network.plugins.GasCost#${t||0}`);F(this,"effectiveBlock");F(this,"txBase");F(this,"txCreate");F(this,"txDataZero");F(this,"txDataNonzero");F(this,"txAccessListStorageKey");F(this,"txAccessListAddress");const s={effectiveBlock:t};function i(o,a){let c=(n||{})[o];c==null&&(c=a),R(typeof c=="number",`invalud value for ${o}`,"costs",n),s[o]=c}i("txBase",21e3),i("txCreate",32e3),i("txDataZero",4),i("txDataNonzero",16),i("txAccessListStorageKey",1900),i("txAccessListAddress",2400),ie(this,s)}clone(){return new wh(this.effectiveBlock,this)}}class bh extends pl{constructor(t,n){super("org.ethers.plugins.network.Ens");F(this,"address");F(this,"targetNetwork");ie(this,{address:t||LS,targetNetwork:n??1})}clone(){return new bh(this.address,this.targetNetwork)}}var il,ol;class FS extends pl{constructor(t,n){super("org.ethers.plugins.network.FetchUrlFeeDataPlugin");M(this,il);M(this,ol);P(this,il,t),P(this,ol,n)}get url(){return y(this,il)}get processFunc(){return y(this,ol)}clone(){return this}}il=new WeakMap,ol=new WeakMap;const ef=new Map;var ma,wa,Rs;const ko=class ko{constructor(e,t){M(this,ma);M(this,wa);M(this,Rs);P(this,ma,e),P(this,wa,re(t)),P(this,Rs,new Map)}toJSON(){return{name:this.name,chainId:String(this.chainId)}}get name(){return y(this,ma)}set name(e){P(this,ma,e)}get chainId(){return y(this,wa)}set chainId(e){P(this,wa,re(e,"chainId"))}matches(e){if(e==null)return!1;if(typeof e=="string"){try{return this.chainId===re(e)}catch{}return this.name===e}if(typeof e=="number"||typeof e=="bigint"){try{return this.chainId===re(e)}catch{}return!1}if(typeof e=="object"){if(e.chainId!=null){try{return this.chainId===re(e.chainId)}catch{}return!1}return e.name!=null?this.name===e.name:!1}return!1}get plugins(){return Array.from(y(this,Rs).values())}attachPlugin(e){if(y(this,Rs).get(e.name))throw new Error(`cannot replace existing plugin: ${e.name} `);return y(this,Rs).set(e.name,e.clone()),this}getPlugin(e){return y(this,Rs).get(e)||null}getPlugins(e){return this.plugins.filter(t=>t.name.split("#")[0]===e)}clone(){const e=new ko(this.name,this.chainId);return this.plugins.forEach(t=>{e.attachPlugin(t.clone())}),e}computeIntrinsicGas(e){const t=this.getPlugin("org.ethers.plugins.network.GasCost")||new wh;let n=t.txBase;if(e.to==null&&(n+=t.txCreate),e.data)for(let s=2;s<e.data.length;s+=2)e.data.substring(s,s+2)==="00"?n+=t.txDataZero:n+=t.txDataNonzero;if(e.accessList){const s=ro(e.accessList);for(const i in s)n+=t.txAccessListAddress+t.txAccessListStorageKey*s[i].storageKeys.length}return n}static from(e){if(MS(),e==null)return ko.from("mainnet");if(typeof e=="number"&&(e=BigInt(e)),typeof e=="string"||typeof e=="bigint"){const t=ef.get(e);if(t)return t();if(typeof e=="bigint")return new ko("unknown",e);R(!1,"unknown network","network",e)}if(typeof e.clone=="function")return e.clone();if(typeof e=="object"){R(typeof e.name=="string"&&typeof e.chainId=="number","invalid network object name or chainId","network",e);const t=new ko(e.name,e.chainId);return(e.ensAddress||e.ensNetwork!=null)&&t.attachPlugin(new bh(e.ensAddress,e.ensNetwork)),t}R(!1,"invalid network","network",e)}static register(e,t){typeof e=="number"&&(e=BigInt(e));const n=ef.get(e);n&&R(!1,`conflicting network for ${JSON.stringify(n.name)}`,"nameOrChainId",e),ef.set(e,t)}};ma=new WeakMap,wa=new WeakMap,Rs=new WeakMap;let gn=ko;function Jy(r,e){const t=String(r);if(!t.match(/^[0-9.]+$/))throw new Error(`invalid gwei value: ${r}`);const n=t.split(".");if(n.length===1&&n.push(""),n.length!==2)throw new Error(`invalid gwei value: ${r}`);for(;n[1].length<e;)n[1]+="0";if(n[1].length>9){let s=BigInt(n[1].substring(0,9));n[1].substring(9).match(/^0+$/)||s++,n[1]=s.toString()}return BigInt(n[0]+n[1])}function Yy(r){return new FS(r,async(e,t,n)=>{n.setHeader("User-Agent","ethers");let s;try{const[i,o]=await Promise.all([n.send(),e()]);s=i;const a=s.bodyJson.standard;return{gasPrice:o.gasPrice,maxFeePerGas:Jy(a.maxFee,9),maxPriorityFeePerGas:Jy(a.maxPriorityFee,9)}}catch(i){q(!1,`error encountered with polygon gas station (${JSON.stringify(n.url)})`,"SERVER_ERROR",{request:n,response:s,error:i})}})}let Zy=!1;function MS(){if(Zy)return;Zy=!0;function r(e,t,n){const s=function(){const i=new gn(e,t);return n.ensNetwork!=null&&i.attachPlugin(new bh(null,n.ensNetwork)),i.attachPlugin(new wh),(n.plugins||[]).forEach(o=>{i.attachPlugin(o)}),i};gn.register(e,s),gn.register(t,s),n.altNames&&n.altNames.forEach(i=>{gn.register(i,s)})}r("mainnet",1,{ensNetwork:1,altNames:["homestead"]}),r("ropsten",3,{ensNetwork:3}),r("rinkeby",4,{ensNetwork:4}),r("goerli",5,{ensNetwork:5}),r("kovan",42,{ensNetwork:42}),r("sepolia",11155111,{ensNetwork:11155111}),r("holesky",17e3,{ensNetwork:17e3}),r("classic",61,{}),r("classicKotti",6,{}),r("arbitrum",42161,{ensNetwork:1}),r("arbitrum-goerli",421613,{}),r("arbitrum-sepolia",421614,{}),r("base",8453,{ensNetwork:1}),r("base-goerli",84531,{}),r("base-sepolia",84532,{}),r("bnb",56,{ensNetwork:1}),r("bnbt",97,{}),r("linea",59144,{ensNetwork:1}),r("linea-goerli",59140,{}),r("linea-sepolia",59141,{}),r("matic",137,{ensNetwork:1,plugins:[Yy("https://gasstation.polygon.technology/v2")]}),r("matic-amoy",80002,{}),r("matic-mumbai",80001,{altNames:["maticMumbai","maticmum"],plugins:[Yy("https://gasstation-testnet.polygon.technology/v2")]}),r("optimism",10,{ensNetwork:1,plugins:[]}),r("optimism-goerli",420,{}),r("optimism-sepolia",11155420,{}),r("xdai",100,{ensNetwork:1})}function Dd(r){return JSON.parse(JSON.stringify(r))}var jn,yr,Us,cn,ba,uu;class jS{constructor(e){M(this,ba);M(this,jn);M(this,yr);M(this,Us);M(this,cn);P(this,jn,e),P(this,yr,null),P(this,Us,4e3),P(this,cn,-2)}get pollingInterval(){return y(this,Us)}set pollingInterval(e){P(this,Us,e)}start(){y(this,yr)||(P(this,yr,y(this,jn)._setTimeout(K(this,ba,uu).bind(this),y(this,Us))),K(this,ba,uu).call(this))}stop(){y(this,yr)&&(y(this,jn)._clearTimeout(y(this,yr)),P(this,yr,null))}pause(e){this.stop(),e&&P(this,cn,-2)}resume(){this.start()}}jn=new WeakMap,yr=new WeakMap,Us=new WeakMap,cn=new WeakMap,ba=new WeakSet,uu=async function(){try{const e=await y(this,jn).getBlockNumber();if(y(this,cn)===-2){P(this,cn,e);return}if(e!==y(this,cn)){for(let t=y(this,cn)+1;t<=e;t++){if(y(this,yr)==null)return;await y(this,jn).emit("block",t)}P(this,cn,e)}}catch{}y(this,yr)!=null&&P(this,yr,y(this,jn)._setTimeout(K(this,ba,uu).bind(this),y(this,Us)))};var Li,Fi,ks;class Yp{constructor(e){M(this,Li);M(this,Fi);M(this,ks);P(this,Li,e),P(this,ks,!1),P(this,Fi,t=>{this._poll(t,y(this,Li))})}async _poll(e,t){throw new Error("sub-classes must override this")}start(){y(this,ks)||(P(this,ks,!0),y(this,Fi).call(this,-2),y(this,Li).on("block",y(this,Fi)))}stop(){y(this,ks)&&(P(this,ks,!1),y(this,Li).off("block",y(this,Fi)))}pause(e){this.stop()}resume(){this.start()}}Li=new WeakMap,Fi=new WeakMap,ks=new WeakMap;var va,zn;class zS extends Yp{constructor(t,n){super(t);M(this,va);M(this,zn);P(this,va,n),P(this,zn,-2)}pause(t){t&&P(this,zn,-2),super.pause(t)}async _poll(t,n){const s=await n.getBlock(y(this,va));s!=null&&(y(this,zn)===-2?P(this,zn,s.number):s.number>y(this,zn)&&(n.emit(y(this,va),s.number),P(this,zn,s.number)))}}va=new WeakMap,zn=new WeakMap;var nh;class HS extends Yp{constructor(t,n){super(t);M(this,nh);P(this,nh,Dd(n))}async _poll(t,n){throw new Error("@TODO")}}nh=new WeakMap;var Ea;class qS extends Yp{constructor(t,n){super(t);M(this,Ea);P(this,Ea,n)}async _poll(t,n){const s=await n.getTransactionReceipt(y(this,Ea));s&&n.emit(y(this,Ea),s)}}Ea=new WeakMap;var Hn,Aa,xa,$s,mr,sh,fv;class Zp{constructor(e,t){M(this,sh);M(this,Hn);M(this,Aa);M(this,xa);M(this,$s);M(this,mr);P(this,Hn,e),P(this,Aa,Dd(t)),P(this,xa,K(this,sh,fv).bind(this)),P(this,$s,!1),P(this,mr,-2)}start(){y(this,$s)||(P(this,$s,!0),y(this,mr)===-2&&y(this,Hn).getBlockNumber().then(e=>{P(this,mr,e)}),y(this,Hn).on("block",y(this,xa)))}stop(){y(this,$s)&&(P(this,$s,!1),y(this,Hn).off("block",y(this,xa)))}pause(e){this.stop(),e&&P(this,mr,-2)}resume(){this.start()}}Hn=new WeakMap,Aa=new WeakMap,xa=new WeakMap,$s=new WeakMap,mr=new WeakMap,sh=new WeakSet,fv=async function(e){if(y(this,mr)===-2)return;const t=Dd(y(this,Aa));t.fromBlock=y(this,mr)+1,t.toBlock=e;const n=await y(this,Hn).getLogs(t);if(n.length===0){y(this,mr)<e-60&&P(this,mr,e-60);return}for(const s of n)y(this,Hn).emit(y(this,Aa),s),P(this,mr,s.blockNumber)};const VS=BigInt(2),KS=10;function $l(r){return r&&typeof r.then=="function"}function hu(r,e){return r+":"+JSON.stringify(e,(t,n)=>{if(n==null)return"null";if(typeof n=="bigint")return`bigint:${n.toString()}`;if(typeof n=="string")return n.toLowerCase();if(typeof n=="object"&&!Array.isArray(n)){const s=Object.keys(n);return s.sort(),s.reduce((i,o)=>(i[o]=n[o],i),{})}return n})}class dv{constructor(e){F(this,"name");ie(this,{name:e})}start(){}stop(){}pause(e){}resume(){}}function GS(r){return JSON.parse(JSON.stringify(r))}function Cd(r){return r=Array.from(new Set(r).values()),r.sort(),r}async function tf(r,e){if(r==null)throw new Error("invalid event");if(Array.isArray(r)&&(r={topics:r}),typeof r=="string")switch(r){case"block":case"debug":case"error":case"finalized":case"network":case"pending":case"safe":return{type:r,tag:r}}if(Ce(r,32)){const t=r.toLowerCase();return{type:"transaction",tag:hu("tx",{hash:t}),hash:t}}if(r.orphan){const t=r;return{type:"orphan",tag:hu("orphan",t),filter:GS(t)}}if(r.address||r.topics){const t=r,n={topics:(t.topics||[]).map(s=>s==null?null:Array.isArray(s)?Cd(s.map(i=>i.toLowerCase())):s.toLowerCase())};if(t.address){const s=[],i=[],o=a=>{Ce(a)?s.push(a):i.push((async()=>{s.push(await Bt(a,e))})())};Array.isArray(t.address)?t.address.forEach(o):o(t.address),i.length&&await Promise.all(i),n.address=Cd(s.map(a=>a.toLowerCase()))}return{filter:n,tag:hu("event",n),type:"event"}}R(!1,"unknown ProviderEvent","event",r)}function rf(){return new Date().getTime()}const QS={cacheTimeout:250,pollingInterval:4e3};var Et,Ls,At,Ia,sr,Mi,Fs,qn,al,wr,Sa,Pa,he,Zt,Bd,_d,vc,Td,Ec,fu;class WS{constructor(e,t){M(this,he);M(this,Et);M(this,Ls);M(this,At);M(this,Ia);M(this,sr);M(this,Mi);M(this,Fs);M(this,qn);M(this,al);M(this,wr);M(this,Sa);M(this,Pa);if(P(this,Pa,Object.assign({},QS,t||{})),e==="any")P(this,Mi,!0),P(this,sr,null);else if(e){const n=gn.from(e);P(this,Mi,!1),P(this,sr,Promise.resolve(n)),setTimeout(()=>{this.emit("network",n,null)},0)}else P(this,Mi,!1),P(this,sr,null);P(this,qn,-1),P(this,Fs,new Map),P(this,Et,new Map),P(this,Ls,new Map),P(this,At,null),P(this,Ia,!1),P(this,al,1),P(this,wr,new Map),P(this,Sa,!1)}get pollingInterval(){return y(this,Pa).pollingInterval}get provider(){return this}get plugins(){return Array.from(y(this,Ls).values())}attachPlugin(e){if(y(this,Ls).get(e.name))throw new Error(`cannot replace existing plugin: ${e.name} `);return y(this,Ls).set(e.name,e.connect(this)),this}getPlugin(e){return y(this,Ls).get(e)||null}get disableCcipRead(){return y(this,Sa)}set disableCcipRead(e){P(this,Sa,!!e)}async ccipReadFetch(e,t,n){if(this.disableCcipRead||n.length===0||e.to==null)return null;const s=e.to.toLowerCase(),i=t.toLowerCase(),o=[];for(let a=0;a<n.length;a++){const c=n[a],l=c.replace("{sender}",s).replace("{data}",i),u=new Ks(l);c.indexOf("{data}")===-1&&(u.body={data:i,sender:s}),this.emit("debug",{action:"sendCcipReadFetchRequest",request:u,index:a,urls:n});let h="unknown error",f;try{f=await u.send()}catch(d){o.push(d.message),this.emit("debug",{action:"receiveCcipReadFetchError",request:u,result:{error:d}});continue}try{const d=f.bodyJson;if(d.data)return this.emit("debug",{action:"receiveCcipReadFetchResult",request:u,result:d}),d.data;d.message&&(h=d.message),this.emit("debug",{action:"receiveCcipReadFetchError",request:u,result:d})}catch{}q(f.statusCode<400||f.statusCode>=500,`response not found during CCIP fetch: ${h}`,"OFFCHAIN_FAULT",{reason:"404_MISSING_RESOURCE",transaction:e,info:{url:c,errorMessage:h}}),o.push(h)}q(!1,`error encountered during CCIP fetch: ${o.map(a=>JSON.stringify(a)).join(", ")}`,"OFFCHAIN_FAULT",{reason:"500_SERVER_ERROR",transaction:e,info:{urls:n,errorMessages:o}})}_wrapBlock(e,t){return new pS(NS(e),this)}_wrapLog(e,t){return new fl(_S(e),this)}_wrapTransactionReceipt(e,t){return new Z1($S(e),this)}_wrapTransactionResponse(e,t){return new Hc(hv(e),this)}_detectNetwork(){q(!1,"sub-classes must implement this","UNSUPPORTED_OPERATION",{operation:"_detectNetwork"})}async _perform(e){q(!1,`unsupported method: ${e.method}`,"UNSUPPORTED_OPERATION",{operation:e.method,info:e})}async getBlockNumber(){const e=ce(await K(this,he,Zt).call(this,{method:"getBlockNumber"}),"%response");return y(this,qn)>=0&&P(this,qn,e),e}_getAddress(e){return Bt(e,this)}_getBlockTag(e){if(e==null)return"latest";switch(e){case"earliest":return"0x0";case"finalized":case"latest":case"pending":case"safe":return e}if(Ce(e))return Ce(e,32)?e:Fr(e);if(typeof e=="bigint"&&(e=ce(e,"blockTag")),typeof e=="number")return e>=0?Fr(e):y(this,qn)>=0?Fr(y(this,qn)+e):this.getBlockNumber().then(t=>Fr(t+e));R(!1,"invalid blockTag","blockTag",e)}_getFilter(e){const t=(e.topics||[]).map(c=>c==null?null:Array.isArray(c)?Cd(c.map(l=>l.toLowerCase())):c.toLowerCase()),n="blockHash"in e?e.blockHash:void 0,s=(c,l,u)=>{let h;switch(c.length){case 0:break;case 1:h=c[0];break;default:c.sort(),h=c}if(n&&(l!=null||u!=null))throw new Error("invalid filter");const f={};return h&&(f.address=h),t.length&&(f.topics=t),l&&(f.fromBlock=l),u&&(f.toBlock=u),n&&(f.blockHash=n),f};let i=[];if(e.address)if(Array.isArray(e.address))for(const c of e.address)i.push(this._getAddress(c));else i.push(this._getAddress(e.address));let o;"fromBlock"in e&&(o=this._getBlockTag(e.fromBlock));let a;return"toBlock"in e&&(a=this._getBlockTag(e.toBlock)),i.filter(c=>typeof c!="string").length||o!=null&&typeof o!="string"||a!=null&&typeof a!="string"?Promise.all([Promise.all(i),o,a]).then(c=>s(c[0],c[1],c[2])):s(i,o,a)}_getTransactionRequest(e){const t=_u(e),n=[];if(["to","from"].forEach(s=>{if(t[s]==null)return;const i=Bt(t[s],this);$l(i)?n.push((async function(){t[s]=await i})()):t[s]=i}),t.blockTag!=null){const s=this._getBlockTag(t.blockTag);$l(s)?n.push((async function(){t.blockTag=await s})()):t.blockTag=s}return n.length?(async function(){return await Promise.all(n),t})():t}async getNetwork(){if(y(this,sr)==null){const s=(async()=>{try{const i=await this._detectNetwork();return this.emit("network",i,null),i}catch(i){throw y(this,sr)===s&&P(this,sr,null),i}})();return P(this,sr,s),(await s).clone()}const e=y(this,sr),[t,n]=await Promise.all([e,this._detectNetwork()]);return t.chainId!==n.chainId&&(y(this,Mi)?(this.emit("network",n,t),y(this,sr)===e&&P(this,sr,Promise.resolve(n))):q(!1,`network changed: ${t.chainId} => ${n.chainId} `,"NETWORK_ERROR",{event:"changed"})),t.clone()}async getFeeData(){const e=await this.getNetwork(),t=async()=>{const{_block:s,gasPrice:i,priorityFee:o}=await Ot({_block:K(this,he,Td).call(this,"latest",!1),gasPrice:(async()=>{try{const u=await K(this,he,Zt).call(this,{method:"getGasPrice"});return re(u,"%response")}catch{}return null})(),priorityFee:(async()=>{try{const u=await K(this,he,Zt).call(this,{method:"getPriorityFee"});return re(u,"%response")}catch{}return null})()});let a=null,c=null;const l=this._wrapBlock(s,e);return l&&l.baseFeePerGas&&(c=o??BigInt("1000000000"),a=l.baseFeePerGas*VS+c),new Vy(i,a,c)},n=e.getPlugin("org.ethers.plugins.network.FetchUrlFeeDataPlugin");if(n){const s=new Ks(n.url),i=await n.processFunc(t,this,s);return new Vy(i.gasPrice,i.maxFeePerGas,i.maxPriorityFeePerGas)}return await t()}async estimateGas(e){let t=this._getTransactionRequest(e);return $l(t)&&(t=await t),re(await K(this,he,Zt).call(this,{method:"estimateGas",transaction:t}),"%response")}async call(e){const{tx:t,blockTag:n}=await Ot({tx:this._getTransactionRequest(e),blockTag:this._getBlockTag(e.blockTag)});return await K(this,he,_d).call(this,K(this,he,Bd).call(this,t,n,e.enableCcipRead?0:-1))}async getBalance(e,t){return re(await K(this,he,vc).call(this,{method:"getBalance"},e,t),"%response")}async getTransactionCount(e,t){return ce(await K(this,he,vc).call(this,{method:"getTransactionCount"},e,t),"%response")}async getCode(e,t){return X(await K(this,he,vc).call(this,{method:"getCode"},e,t))}async getStorage(e,t,n){const s=re(t,"position");return X(await K(this,he,vc).call(this,{method:"getStorage",position:s},e,n))}async broadcastTransaction(e){const{blockNumber:t,hash:n,network:s}=await Ot({blockNumber:this.getBlockNumber(),hash:this._perform({method:"broadcastTransaction",signedTransaction:e}),network:this.getNetwork()}),i=Iu.from(e);if(i.hash!==n)throw new Error("@TODO: the returned hash did not match");return this._wrapTransactionResponse(i,s).replaceableTransaction(t)}async getBlock(e,t){const{network:n,params:s}=await Ot({network:this.getNetwork(),params:K(this,he,Td).call(this,e,!!t)});return s==null?null:this._wrapBlock(s,n)}async getTransaction(e){const{network:t,params:n}=await Ot({network:this.getNetwork(),params:K(this,he,Zt).call(this,{method:"getTransaction",hash:e})});return n==null?null:this._wrapTransactionResponse(n,t)}async getTransactionReceipt(e){const{network:t,params:n}=await Ot({network:this.getNetwork(),params:K(this,he,Zt).call(this,{method:"getTransactionReceipt",hash:e})});if(n==null)return null;if(n.gasPrice==null&&n.effectiveGasPrice==null){const s=await K(this,he,Zt).call(this,{method:"getTransaction",hash:e});if(s==null)throw new Error("report this; could not find tx or effectiveGasPrice");n.effectiveGasPrice=s.gasPrice}return this._wrapTransactionReceipt(n,t)}async getTransactionResult(e){const{result:t}=await Ot({network:this.getNetwork(),result:K(this,he,Zt).call(this,{method:"getTransactionResult",hash:e})});return t==null?null:X(t)}async getLogs(e){let t=this._getFilter(e);$l(t)&&(t=await t);const{network:n,params:s}=await Ot({network:this.getNetwork(),params:K(this,he,Zt).call(this,{method:"getLogs",filter:t})});return s.map(i=>this._wrapLog(i,n))}_getProvider(e){q(!1,"provider cannot connect to target network","UNSUPPORTED_OPERATION",{operation:"_getProvider()"})}async getResolver(e){return await Nu.fromName(this,e)}async getAvatar(e){const t=await this.getResolver(e);return t?await t.getAvatar():null}async resolveName(e){const t=await this.getResolver(e);return t?await t.getAddress():null}async lookupAddress(e){e=Ae(e);const t=Ad(e.substring(2).toLowerCase()+".addr.reverse");try{const n=await Nu.getEnsAddress(this),i=await new Pc(n,["function resolver(bytes32) view returns (address)"],this).resolver(t);if(i==null||i===Uc)return null;const a=await new Pc(i,["function name(bytes32) view returns (string)"],this).name(t);return await this.resolveName(a)!==e?null:a}catch(n){if(lt(n,"BAD_DATA")&&n.value==="0x"||lt(n,"CALL_EXCEPTION"))return null;throw n}return null}async waitForTransaction(e,t,n){const s=t??1;return s===0?this.getTransactionReceipt(e):new Promise(async(i,o)=>{let a=null;const c=(async l=>{try{const u=await this.getTransactionReceipt(e);if(u!=null&&l-u.blockNumber+1>=s){i(u),a&&(clearTimeout(a),a=null);return}}catch(u){console.log("EEE",u)}this.once("block",c)});n!=null&&(a=setTimeout(()=>{a!=null&&(a=null,this.off("block",c),o(Te("timeout","TIMEOUT",{reason:"timeout"})))},n)),c(await this.getBlockNumber())})}async waitForBlock(e){q(!1,"not implemented yet","NOT_IMPLEMENTED",{operation:"waitForBlock"})}_clearTimeout(e){const t=y(this,wr).get(e);t&&(t.timer&&clearTimeout(t.timer),y(this,wr).delete(e))}_setTimeout(e,t){t==null&&(t=0);const n=Wa(this,al)._++,s=()=>{y(this,wr).delete(n),e()};if(this.paused)y(this,wr).set(n,{timer:null,func:s,time:t});else{const i=setTimeout(s,t);y(this,wr).set(n,{timer:i,func:s,time:rf()})}return n}_forEachSubscriber(e){for(const t of y(this,Et).values())e(t.subscriber)}_getSubscriber(e){switch(e.type){case"debug":case"error":case"network":return new dv(e.type);case"block":{const t=new jS(this);return t.pollingInterval=this.pollingInterval,t}case"safe":case"finalized":return new zS(this,e.type);case"event":return new Zp(this,e.filter);case"transaction":return new qS(this,e.hash);case"orphan":return new HS(this,e.filter)}throw new Error(`unsupported event: ${e.type}`)}_recoverSubscriber(e,t){for(const n of y(this,Et).values())if(n.subscriber===e){n.started&&n.subscriber.stop(),n.subscriber=t,n.started&&t.start(),y(this,At)!=null&&t.pause(y(this,At));break}}async on(e,t){const n=await K(this,he,fu).call(this,e);return n.listeners.push({listener:t,once:!1}),n.started||(n.subscriber.start(),n.started=!0,y(this,At)!=null&&n.subscriber.pause(y(this,At))),this}async once(e,t){const n=await K(this,he,fu).call(this,e);return n.listeners.push({listener:t,once:!0}),n.started||(n.subscriber.start(),n.started=!0,y(this,At)!=null&&n.subscriber.pause(y(this,At))),this}async emit(e,...t){const n=await K(this,he,Ec).call(this,e,t);if(!n||n.listeners.length===0)return!1;const s=n.listeners.length;return n.listeners=n.listeners.filter(({listener:i,once:o})=>{const a=new Ob(this,o?null:i,e);try{i.call(this,...t,a)}catch{}return!o}),n.listeners.length===0&&(n.started&&n.subscriber.stop(),y(this,Et).delete(n.tag)),s>0}async listenerCount(e){if(e){const n=await K(this,he,Ec).call(this,e);return n?n.listeners.length:0}let t=0;for(const{listeners:n}of y(this,Et).values())t+=n.length;return t}async listeners(e){if(e){const n=await K(this,he,Ec).call(this,e);return n?n.listeners.map(({listener:s})=>s):[]}let t=[];for(const{listeners:n}of y(this,Et).values())t=t.concat(n.map(({listener:s})=>s));return t}async off(e,t){const n=await K(this,he,Ec).call(this,e);if(!n)return this;if(t){const s=n.listeners.map(({listener:i})=>i).indexOf(t);s>=0&&n.listeners.splice(s,1)}return(!t||n.listeners.length===0)&&(n.started&&n.subscriber.stop(),y(this,Et).delete(n.tag)),this}async removeAllListeners(e){if(e){const{tag:t,started:n,subscriber:s}=await K(this,he,fu).call(this,e);n&&s.stop(),y(this,Et).delete(t)}else for(const[t,{started:n,subscriber:s}]of y(this,Et))n&&s.stop(),y(this,Et).delete(t);return this}async addListener(e,t){return await this.on(e,t)}async removeListener(e,t){return this.off(e,t)}get destroyed(){return y(this,Ia)}destroy(){this.removeAllListeners();for(const e of y(this,wr).keys())this._clearTimeout(e);P(this,Ia,!0)}get paused(){return y(this,At)!=null}set paused(e){!!e!==this.paused&&(this.paused?this.resume():this.pause(!1))}pause(e){if(P(this,qn,-1),y(this,At)!=null){if(y(this,At)==!!e)return;q(!1,"cannot change pause type; resume first","UNSUPPORTED_OPERATION",{operation:"pause"})}this._forEachSubscriber(t=>t.pause(e)),P(this,At,!!e);for(const t of y(this,wr).values())t.timer&&clearTimeout(t.timer),t.time=rf()-t.time}resume(){if(y(this,At)!=null){this._forEachSubscriber(e=>e.resume()),P(this,At,null);for(const e of y(this,wr).values()){let t=e.time;t<0&&(t=0),e.time=rf(),setTimeout(e.func,t)}}}}Et=new WeakMap,Ls=new WeakMap,At=new WeakMap,Ia=new WeakMap,sr=new WeakMap,Mi=new WeakMap,Fs=new WeakMap,qn=new WeakMap,al=new WeakMap,wr=new WeakMap,Sa=new WeakMap,Pa=new WeakMap,he=new WeakSet,Zt=async function(e){const t=y(this,Pa).cacheTimeout;if(t<0)return await this._perform(e);const n=hu(e.method,e);let s=y(this,Fs).get(n);return s||(s=this._perform(e),y(this,Fs).set(n,s),setTimeout(()=>{y(this,Fs).get(n)===s&&y(this,Fs).delete(n)},t)),await s},Bd=async function(e,t,n){q(n<KS,"CCIP read exceeded maximum redirections","OFFCHAIN_FAULT",{reason:"TOO_MANY_REDIRECTS",transaction:Object.assign({},e,{blockTag:t,enableCcipRead:!0})});const s=_u(e);try{return X(await this._perform({method:"call",transaction:s,blockTag:t}))}catch(i){if(!this.disableCcipRead&&Up(i)&&i.data&&n>=0&&t==="latest"&&s.to!=null&&ke(i.data,0,4)==="0x556f1830"){const o=i.data,a=await Bt(s.to,this);let c;try{c=eP(ke(i.data,4))}catch(h){q(!1,h.message,"OFFCHAIN_FAULT",{reason:"BAD_DATA",transaction:s,info:{data:o}})}q(c.sender.toLowerCase()===a.toLowerCase(),"CCIP Read sender mismatch","CALL_EXCEPTION",{action:"call",data:o,reason:"OffchainLookup",transaction:s,invocation:null,revert:{signature:"OffchainLookup(address,string[],bytes,bytes4,bytes)",name:"OffchainLookup",args:c.errorArgs}});const l=await this.ccipReadFetch(s,c.calldata,c.urls);q(l!=null,"CCIP Read failed to fetch data","OFFCHAIN_FAULT",{reason:"FETCH_FAILED",transaction:s,info:{data:i.data,errorArgs:c.errorArgs}});const u={to:a,data:$e([c.selector,XS([l,c.extraData])])};this.emit("debug",{action:"sendCcipReadCall",transaction:u});try{const h=await K(this,he,Bd).call(this,u,t,n+1);return this.emit("debug",{action:"receiveCcipReadCallResult",transaction:Object.assign({},u),result:h}),h}catch(h){throw this.emit("debug",{action:"receiveCcipReadCallError",transaction:Object.assign({},u),error:h}),h}}throw i}},_d=async function(e){const{value:t}=await Ot({network:this.getNetwork(),value:e});return t},vc=async function(e,t,n){let s=this._getAddress(t),i=this._getBlockTag(n);return(typeof s!="string"||typeof i!="string")&&([s,i]=await Promise.all([s,i])),await K(this,he,_d).call(this,K(this,he,Zt).call(this,Object.assign(e,{address:s,blockTag:i})))},Td=async function(e,t){if(Ce(e,32))return await K(this,he,Zt).call(this,{method:"getBlock",blockHash:e,includeTransactions:t});let n=this._getBlockTag(e);return typeof n!="string"&&(n=await n),await K(this,he,Zt).call(this,{method:"getBlock",blockTag:n,includeTransactions:t})},Ec=async function(e,t){let n=await tf(e,this);return n.type==="event"&&t&&t.length>0&&t[0].removed===!0&&(n=await tf({orphan:"drop-log",log:t[0]},this)),y(this,Et).get(n.tag)||null},fu=async function(e){const t=await tf(e,this),n=t.tag;let s=y(this,Et).get(n);return s||(s={subscriber:this._getSubscriber(t),tag:n,addressableMap:new WeakMap,nameMap:new Map,started:!1,listeners:[]},y(this,Et).set(n,s)),s};function JS(r,e){try{const t=Nd(r,e);if(t)return Au(t)}catch{}return null}function Nd(r,e){if(r==="0x")return null;try{const t=ce(ke(r,e,e+32)),n=ce(ke(r,t,t+32));return ke(r,t+32,t+32+n)}catch{}return null}function Xy(r){const e=Je(r);if(e.length>32)throw new Error("internal; should not happen");const t=new Uint8Array(32);return t.set(e,32-e.length),t}function YS(r){if(r.length%32===0)return r;const e=new Uint8Array(Math.ceil(r.length/32)*32);return e.set(r),e}const ZS=new Uint8Array([]);function XS(r){const e=[];let t=0;for(let n=0;n<r.length;n++)e.push(ZS),t+=32;for(let n=0;n<r.length;n++){const s=ue(r[n]);e[n]=Xy(t),e.push(Xy(s.length)),e.push(YS(s)),t+=32+Math.ceil(s.length/32)*32}return $e(e)}const e0="0x0000000000000000000000000000000000000000000000000000000000000000";function eP(r){const e={sender:"",urls:[],calldata:"",selector:"",extraData:"",errorArgs:[]};q($o(r)>=160,"insufficient OffchainLookup data","OFFCHAIN_FAULT",{reason:"insufficient OffchainLookup data"});const t=ke(r,0,32);q(ke(t,0,12)===ke(e0,0,12),"corrupt OffchainLookup sender","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup sender"}),e.sender=ke(t,12);try{const n=[],s=ce(ke(r,32,64)),i=ce(ke(r,s,s+32)),o=ke(r,s+32);for(let a=0;a<i;a++){const c=JS(o,a*32);if(c==null)throw new Error("abort");n.push(c)}e.urls=n}catch{q(!1,"corrupt OffchainLookup urls","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup urls"})}try{const n=Nd(r,64);if(n==null)throw new Error("abort");e.calldata=n}catch{q(!1,"corrupt OffchainLookup calldata","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup calldata"})}q(ke(r,100,128)===ke(e0,0,28),"corrupt OffchainLookup callbaackSelector","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup callbaackSelector"}),e.selector=ke(r,96,100);try{const n=Nd(r,128);if(n==null)throw new Error("abort");e.extraData=n}catch{q(!1,"corrupt OffchainLookup extraData","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup extraData"})}return e.errorArgs="sender,urls,calldata,selector,extraData".split(/,/).map(n=>e[n]),e}function ei(r,e){if(r.provider)return r.provider;q(!1,"missing provider","UNSUPPORTED_OPERATION",{operation:e})}async function t0(r,e){let t=_u(e);if(t.to!=null&&(t.to=Bt(t.to,r)),t.from!=null){const n=t.from;t.from=Promise.all([r.getAddress(),Bt(n,r)]).then(([s,i])=>(R(s.toLowerCase()===i.toLowerCase(),"transaction from mismatch","tx.from",i),s))}else t.from=r.getAddress();return await Ot(t)}class tP{constructor(e){F(this,"provider");ie(this,{provider:e||null})}async getNonce(e){return ei(this,"getTransactionCount").getTransactionCount(await this.getAddress(),e)}async populateCall(e){return await t0(this,e)}async populateTransaction(e){const t=ei(this,"populateTransaction"),n=await t0(this,e);n.nonce==null&&(n.nonce=await this.getNonce("pending")),n.gasLimit==null&&(n.gasLimit=await this.estimateGas(n));const s=await this.provider.getNetwork();if(n.chainId!=null){const o=re(n.chainId);R(o===s.chainId,"transaction chainId mismatch","tx.chainId",e.chainId)}else n.chainId=s.chainId;const i=n.maxFeePerGas!=null||n.maxPriorityFeePerGas!=null;if(n.gasPrice!=null&&(n.type===2||i)?R(!1,"eip-1559 transaction do not support gasPrice","tx",e):(n.type===0||n.type===1)&&i&&R(!1,"pre-eip-1559 transaction do not support maxFeePerGas/maxPriorityFeePerGas","tx",e),(n.type===2||n.type==null)&&n.maxFeePerGas!=null&&n.maxPriorityFeePerGas!=null)n.type=2;else if(n.type===0||n.type===1){const o=await t.getFeeData();q(o.gasPrice!=null,"network does not support gasPrice","UNSUPPORTED_OPERATION",{operation:"getGasPrice"}),n.gasPrice==null&&(n.gasPrice=o.gasPrice)}else{const o=await t.getFeeData();if(n.type==null)if(o.maxFeePerGas!=null&&o.maxPriorityFeePerGas!=null)if(n.authorizationList&&n.authorizationList.length?n.type=4:n.type=2,n.gasPrice!=null){const a=n.gasPrice;delete n.gasPrice,n.maxFeePerGas=a,n.maxPriorityFeePerGas=a}else n.maxFeePerGas==null&&(n.maxFeePerGas=o.maxFeePerGas),n.maxPriorityFeePerGas==null&&(n.maxPriorityFeePerGas=o.maxPriorityFeePerGas);else o.gasPrice!=null?(q(!i,"network does not support EIP-1559","UNSUPPORTED_OPERATION",{operation:"populateTransaction"}),n.gasPrice==null&&(n.gasPrice=o.gasPrice),n.type=0):q(!1,"failed to get consistent fee data","UNSUPPORTED_OPERATION",{operation:"signer.getFeeData"});else(n.type===2||n.type===3||n.type===4)&&(n.maxFeePerGas==null&&(n.maxFeePerGas=o.maxFeePerGas),n.maxPriorityFeePerGas==null&&(n.maxPriorityFeePerGas=o.maxPriorityFeePerGas))}return await Ot(n)}async populateAuthorization(e){const t=Object.assign({},e);return t.chainId==null&&(t.chainId=(await ei(this,"getNetwork").getNetwork()).chainId),t.nonce==null&&(t.nonce=await this.getNonce()),t}async estimateGas(e){return ei(this,"estimateGas").estimateGas(await this.populateCall(e))}async call(e){return ei(this,"call").call(await this.populateCall(e))}async resolveName(e){return await ei(this,"resolveName").resolveName(e)}async sendTransaction(e){const t=ei(this,"sendTransaction"),n=await this.populateTransaction(e);delete n.from;const s=Iu.from(n);return await t.broadcastTransaction(await this.signTransaction(s))}authorize(e){q(!1,"authorization not implemented for this signer","UNSUPPORTED_OPERATION",{operation:"authorize"})}}function rP(r){return JSON.parse(JSON.stringify(r))}var Pt,ln,ji,Ms,zi,Oa,Ws,Rd,Ud;class pv{constructor(e){M(this,Ws);M(this,Pt);M(this,ln);M(this,ji);M(this,Ms);M(this,zi);M(this,Oa);P(this,Pt,e),P(this,ln,null),P(this,ji,K(this,Ws,Rd).bind(this)),P(this,Ms,!1),P(this,zi,null),P(this,Oa,!1)}_subscribe(e){throw new Error("subclasses must override this")}_emitResults(e,t){throw new Error("subclasses must override this")}_recover(e){throw new Error("subclasses must override this")}start(){y(this,Ms)||(P(this,Ms,!0),K(this,Ws,Rd).call(this,-2))}stop(){y(this,Ms)&&(P(this,Ms,!1),P(this,Oa,!0),K(this,Ws,Ud).call(this),y(this,Pt).off("block",y(this,ji)))}pause(e){e&&K(this,Ws,Ud).call(this),y(this,Pt).off("block",y(this,ji))}resume(){this.start()}}Pt=new WeakMap,ln=new WeakMap,ji=new WeakMap,Ms=new WeakMap,zi=new WeakMap,Oa=new WeakMap,Ws=new WeakSet,Rd=async function(e){try{y(this,ln)==null&&P(this,ln,this._subscribe(y(this,Pt)));let t=null;try{t=await y(this,ln)}catch(i){if(!lt(i,"UNSUPPORTED_OPERATION")||i.operation!=="eth_newFilter")throw i}if(t==null){P(this,ln,null),y(this,Pt)._recoverSubscriber(this,this._recover(y(this,Pt)));return}const n=await y(this,Pt).getNetwork();if(y(this,zi)||P(this,zi,n),y(this,zi).chainId!==n.chainId)throw new Error("chaid changed");if(y(this,Oa))return;const s=await y(this,Pt).send("eth_getFilterChanges",[t]);await this._emitResults(y(this,Pt),s)}catch(t){console.log("@TODO",t)}y(this,Pt).once("block",y(this,ji))},Ud=function(){const e=y(this,ln);e&&(P(this,ln,null),e.then(t=>{y(this,Pt).destroyed||y(this,Pt).send("eth_uninstallFilter",[t])}))};var Hi;class nP extends pv{constructor(t,n){super(t);M(this,Hi);P(this,Hi,rP(n))}_recover(t){return new Zp(t,y(this,Hi))}async _subscribe(t){return await t.send("eth_newFilter",[y(this,Hi)])}async _emitResults(t,n){for(const s of n)t.emit(y(this,Hi),t._wrapLog(s,t._network))}}Hi=new WeakMap;class sP extends pv{async _subscribe(e){return await e.send("eth_newPendingTransactionFilter",[])}async _emitResults(e,t){for(const n of t)e.emit("pending",n)}}const iP="bigint,boolean,function,number,string,symbol".split(/,/g);function du(r){if(r==null||iP.indexOf(typeof r)>=0||typeof r.getAddress=="function")return r;if(Array.isArray(r))return r.map(du);if(typeof r=="object")return Object.keys(r).reduce((e,t)=>(e[t]=r[t],e),{});throw new Error(`should not happen: ${r} (${typeof r})`)}function oP(r){return new Promise(e=>{setTimeout(e,r)})}function fo(r){return r&&r.toLowerCase()}function r0(r){return r&&typeof r.pollingInterval=="number"}const gv={polling:!1,staticNetwork:null,batchStallTime:10,batchMaxSize:1<<20,batchMaxCount:100,cacheTimeout:250,pollingInterval:4e3};class nf extends tP{constructor(t,n){super(t);F(this,"address");n=Ae(n),ie(this,{address:n})}connect(t){q(!1,"cannot reconnect JsonRpcSigner","UNSUPPORTED_OPERATION",{operation:"signer.connect"})}async getAddress(){return this.address}async populateTransaction(t){return await this.populateCall(t)}async sendUncheckedTransaction(t){const n=du(t),s=[];if(n.from){const o=n.from;s.push((async()=>{const a=await Bt(o,this.provider);R(a!=null&&a.toLowerCase()===this.address.toLowerCase(),"from address mismatch","transaction",t),n.from=a})())}else n.from=this.address;if(n.gasLimit==null&&s.push((async()=>{n.gasLimit=await this.provider.estimateGas({...n,from:this.address})})()),n.to!=null){const o=n.to;s.push((async()=>{n.to=await Bt(o,this.provider)})())}s.length&&await Promise.all(s);const i=this.provider.getRpcTransaction(n);return this.provider.send("eth_sendTransaction",[i])}async sendTransaction(t){const n=await this.provider.getBlockNumber(),s=await this.sendUncheckedTransaction(t);return await new Promise((i,o)=>{const a=[1e3,100];let c=0;const l=async()=>{try{const u=await this.provider.getTransaction(s);if(u!=null){i(u.replaceableTransaction(n));return}}catch(u){if(lt(u,"CANCELLED")||lt(u,"BAD_DATA")||lt(u,"NETWORK_ERROR")||lt(u,"UNSUPPORTED_OPERATION")){u.info==null&&(u.info={}),u.info.sendTransactionHash=s,o(u);return}if(lt(u,"INVALID_ARGUMENT")&&(c++,u.info==null&&(u.info={}),u.info.sendTransactionHash=s,c>10)){o(u);return}this.provider.emit("error",Te("failed to fetch transation after sending (will try again)","UNKNOWN_ERROR",{error:u}))}this.provider._setTimeout(()=>{l()},a.pop()||4e3)};l()})}async signTransaction(t){const n=du(t);if(n.from){const i=await Bt(n.from,this.provider);R(i!=null&&i.toLowerCase()===this.address.toLowerCase(),"from address mismatch","transaction",t),n.from=i}else n.from=this.address;const s=this.provider.getRpcTransaction(n);return await this.provider.send("eth_signTransaction",[s])}async signMessage(t){const n=typeof t=="string"?Wn(t):t;return await this.provider.send("personal_sign",[X(n),this.address.toLowerCase()])}async signTypedData(t,n,s){const i=du(s),o=await Bu.resolveNames(t,n,i,async a=>{const c=await Bt(a);return R(c!=null,"TypedData does not support null address","value",a),c});return await this.provider.send("eth_signTypedData_v4",[this.address.toLowerCase(),JSON.stringify(Bu.getPayload(o.domain,n,o.value))])}async unlock(t){return this.provider.send("personal_unlockAccount",[this.address.toLowerCase(),t,null])}async _legacySignMessage(t){const n=typeof t=="string"?Wn(t):t;return await this.provider.send("eth_sign",[this.address.toLowerCase(),X(n)])}}var qi,Da,Vn,un,Lr,br,Mt,cl,kd;class aP extends WS{constructor(t,n){super(t,n);M(this,cl);M(this,qi);M(this,Da);M(this,Vn);M(this,un);M(this,Lr);M(this,br);M(this,Mt);P(this,Da,1),P(this,qi,Object.assign({},gv,n||{})),P(this,Vn,[]),P(this,un,null),P(this,br,null),P(this,Mt,null);{let i=null;const o=new Promise(a=>{i=a});P(this,Lr,{promise:o,resolve:i})}const s=this._getOption("staticNetwork");typeof s=="boolean"?(R(!s||t!=="any","staticNetwork cannot be used on special network 'any'","options",n),s&&t!=null&&P(this,br,gn.from(t))):s&&(R(t==null||s.matches(t),"staticNetwork MUST match network object","options",n),P(this,br,s))}_getOption(t){return y(this,qi)[t]}get _network(){return q(y(this,br),"network is not available yet","NETWORK_ERROR"),y(this,br)}async _perform(t){if(t.method==="call"||t.method==="estimateGas"){let s=t.transaction;if(s&&s.type!=null&&re(s.type)&&s.maxFeePerGas==null&&s.maxPriorityFeePerGas==null){const i=await this.getFeeData();i.maxFeePerGas==null&&i.maxPriorityFeePerGas==null&&(t=Object.assign({},t,{transaction:Object.assign({},s,{type:void 0})}))}}const n=this.getRpcRequest(t);return n!=null?await this.send(n.method,n.args):super._perform(t)}async _detectNetwork(){const t=this._getOption("staticNetwork");if(t)if(t===!0){if(y(this,br))return y(this,br)}else return t;return y(this,Mt)?await y(this,Mt):this.ready?(P(this,Mt,(async()=>{try{const n=gn.from(re(await this.send("eth_chainId",[])));return P(this,Mt,null),n}catch(n){throw P(this,Mt,null),n}})()),await y(this,Mt)):(P(this,Mt,(async()=>{const n={id:Wa(this,Da)._++,method:"eth_chainId",params:[],jsonrpc:"2.0"};this.emit("debug",{action:"sendRpcPayload",payload:n});let s;try{s=(await this._send(n))[0],P(this,Mt,null)}catch(i){throw P(this,Mt,null),this.emit("debug",{action:"receiveRpcError",error:i}),i}if(this.emit("debug",{action:"receiveRpcResult",result:s}),"result"in s)return gn.from(re(s.result));throw this.getRpcError(n,s)})()),await y(this,Mt))}_start(){y(this,Lr)==null||y(this,Lr).resolve==null||(y(this,Lr).resolve(),P(this,Lr,null),(async()=>{for(;y(this,br)==null&&!this.destroyed;)try{P(this,br,await this._detectNetwork())}catch(t){if(this.destroyed)break;console.log("JsonRpcProvider failed to detect network and cannot start up; retry in 1s (perhaps the URL is wrong or the node is not started)"),this.emit("error",Te("failed to bootstrap network detection","NETWORK_ERROR",{event:"initial-network-discovery",info:{error:t}})),await oP(1e3)}K(this,cl,kd).call(this)})())}async _waitUntilReady(){if(y(this,Lr)!=null)return await y(this,Lr).promise}_getSubscriber(t){return t.type==="pending"?new sP(this):t.type==="event"?this._getOption("polling")?new Zp(this,t.filter):new nP(this,t.filter):t.type==="orphan"&&t.filter.orphan==="drop-log"?new dv("orphan"):super._getSubscriber(t)}get ready(){return y(this,Lr)==null}getRpcTransaction(t){const n={};return["chainId","gasLimit","gasPrice","type","maxFeePerGas","maxPriorityFeePerGas","nonce","value"].forEach(s=>{if(t[s]==null)return;let i=s;s==="gasLimit"&&(i="gas"),n[i]=Fr(re(t[s],`tx.${s}`))}),["from","to","data"].forEach(s=>{t[s]!=null&&(n[s]=X(t[s]))}),t.accessList&&(n.accessList=ro(t.accessList)),t.blobVersionedHashes&&(n.blobVersionedHashes=t.blobVersionedHashes.map(s=>s.toLowerCase())),t.authorizationList&&(n.authorizationList=t.authorizationList.map(s=>{const i=m1(s);return{address:i.address,nonce:Fr(i.nonce),chainId:Fr(i.chainId),yParity:Fr(i.signature.yParity),r:Fr(i.signature.r),s:Fr(i.signature.s)}})),n}getRpcRequest(t){switch(t.method){case"chainId":return{method:"eth_chainId",args:[]};case"getBlockNumber":return{method:"eth_blockNumber",args:[]};case"getGasPrice":return{method:"eth_gasPrice",args:[]};case"getPriorityFee":return{method:"eth_maxPriorityFeePerGas",args:[]};case"getBalance":return{method:"eth_getBalance",args:[fo(t.address),t.blockTag]};case"getTransactionCount":return{method:"eth_getTransactionCount",args:[fo(t.address),t.blockTag]};case"getCode":return{method:"eth_getCode",args:[fo(t.address),t.blockTag]};case"getStorage":return{method:"eth_getStorageAt",args:[fo(t.address),"0x"+t.position.toString(16),t.blockTag]};case"broadcastTransaction":return{method:"eth_sendRawTransaction",args:[t.signedTransaction]};case"getBlock":if("blockTag"in t)return{method:"eth_getBlockByNumber",args:[t.blockTag,!!t.includeTransactions]};if("blockHash"in t)return{method:"eth_getBlockByHash",args:[t.blockHash,!!t.includeTransactions]};break;case"getTransaction":return{method:"eth_getTransactionByHash",args:[t.hash]};case"getTransactionReceipt":return{method:"eth_getTransactionReceipt",args:[t.hash]};case"call":return{method:"eth_call",args:[this.getRpcTransaction(t.transaction),t.blockTag]};case"estimateGas":return{method:"eth_estimateGas",args:[this.getRpcTransaction(t.transaction)]};case"getLogs":return t.filter&&t.filter.address!=null&&(Array.isArray(t.filter.address)?t.filter.address=t.filter.address.map(fo):t.filter.address=fo(t.filter.address)),{method:"eth_getLogs",args:[t.filter]}}return null}getRpcError(t,n){const{method:s}=t,{error:i}=n;if(s==="eth_estimateGas"&&i.message){const c=i.message;if(!c.match(/revert/i)&&c.match(/insufficient funds/i))return Te("insufficient funds","INSUFFICIENT_FUNDS",{transaction:t.params[0],info:{payload:t,error:i}});if(c.match(/nonce/i)&&c.match(/too low/i))return Te("nonce has already been used","NONCE_EXPIRED",{transaction:t.params[0],info:{payload:t,error:i}})}if(s==="eth_call"||s==="eth_estimateGas"){const c=$d(i),l=zc.getBuiltinCallException(s==="eth_call"?"call":"estimateGas",t.params[0],c?c.data:null);return l.info={error:i,payload:t},l}const o=JSON.stringify(lP(i));if(typeof i.message=="string"&&i.message.match(/user denied|ethers-user-denied/i))return Te("user rejected action","ACTION_REJECTED",{action:{eth_sign:"signMessage",personal_sign:"signMessage",eth_signTypedData_v4:"signTypedData",eth_signTransaction:"signTransaction",eth_sendTransaction:"sendTransaction",eth_requestAccounts:"requestAccess",wallet_requestAccounts:"requestAccess"}[s]||"unknown",reason:"rejected",info:{payload:t,error:i}});if(s==="eth_sendRawTransaction"||s==="eth_sendTransaction"){const c=t.params[0];if(o.match(/insufficient funds|base fee exceeds gas limit/i))return Te("insufficient funds for intrinsic transaction cost","INSUFFICIENT_FUNDS",{transaction:c,info:{error:i}});if(o.match(/nonce/i)&&o.match(/too low/i))return Te("nonce has already been used","NONCE_EXPIRED",{transaction:c,info:{error:i}});if(o.match(/replacement transaction/i)&&o.match(/underpriced/i))return Te("replacement fee too low","REPLACEMENT_UNDERPRICED",{transaction:c,info:{error:i}});if(o.match(/only replay-protected/i))return Te("legacy pre-eip-155 transactions not supported","UNSUPPORTED_OPERATION",{operation:s,info:{transaction:c,info:{error:i}}})}let a=!!o.match(/the method .* does not exist/i);return a||i&&i.details&&i.details.startsWith("Unauthorized method:")&&(a=!0),a?Te("unsupported operation","UNSUPPORTED_OPERATION",{operation:t.method,info:{error:i,payload:t}}):Te("could not coalesce error","UNKNOWN_ERROR",{error:i,payload:t})}send(t,n){if(this.destroyed)return Promise.reject(Te("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:t}));const s=Wa(this,Da)._++,i=new Promise((o,a)=>{y(this,Vn).push({resolve:o,reject:a,payload:{method:t,params:n,id:s,jsonrpc:"2.0"}})});return K(this,cl,kd).call(this),i}async getSigner(t){t==null&&(t=0);const n=this.send("eth_accounts",[]);if(typeof t=="number"){const i=await n;if(t>=i.length)throw new Error("no such account");return new nf(this,i[t])}const{accounts:s}=await Ot({network:this.getNetwork(),accounts:n});t=Ae(t);for(const i of s)if(Ae(i)===t)return new nf(this,t);throw new Error("invalid account")}async listAccounts(){return(await this.send("eth_accounts",[])).map(n=>new nf(this,n))}destroy(){y(this,un)&&(clearTimeout(y(this,un)),P(this,un,null));for(const{payload:t,reject:n}of y(this,Vn))n(Te("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:t.method}));P(this,Vn,[]),super.destroy()}}qi=new WeakMap,Da=new WeakMap,Vn=new WeakMap,un=new WeakMap,Lr=new WeakMap,br=new WeakMap,Mt=new WeakMap,cl=new WeakSet,kd=function(){if(y(this,un))return;const t=this._getOption("batchMaxCount")===1?0:this._getOption("batchStallTime");P(this,un,setTimeout(()=>{P(this,un,null);const n=y(this,Vn);for(P(this,Vn,[]);n.length;){const s=[n.shift()];for(;n.length&&s.length!==y(this,qi).batchMaxCount;)if(s.push(n.shift()),JSON.stringify(s.map(o=>o.payload)).length>y(this,qi).batchMaxSize){n.unshift(s.pop());break}(async()=>{const i=s.length===1?s[0].payload:s.map(o=>o.payload);this.emit("debug",{action:"sendRpcPayload",payload:i});try{const o=await this._send(i);this.emit("debug",{action:"receiveRpcResult",result:o});for(const{resolve:a,reject:c,payload:l}of s){if(this.destroyed){c(Te("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:l.method}));continue}const u=o.filter(h=>h.id===l.id)[0];if(u==null){const h=Te("missing response for request","BAD_DATA",{value:o,info:{payload:l}});this.emit("error",h),c(h);continue}if("error"in u){c(this.getRpcError(l,u));continue}a(u.result)}}catch(o){this.emit("debug",{action:"receiveRpcError",error:o});for(const{reject:a}of s)a(o)}})()}},t))};var js;class cP extends aP{constructor(t,n){super(t,n);M(this,js);let s=this._getOption("pollingInterval");s==null&&(s=gv.pollingInterval),P(this,js,s)}_getSubscriber(t){const n=super._getSubscriber(t);return r0(n)&&(n.pollingInterval=y(this,js)),n}get pollingInterval(){return y(this,js)}set pollingInterval(t){if(!Number.isInteger(t)||t<0)throw new Error("invalid interval");P(this,js,t),this._forEachSubscriber(n=>{r0(n)&&(n.pollingInterval=y(this,js))})}}js=new WeakMap;function $d(r){if(r==null)return null;if(typeof r.message=="string"&&r.message.match(/revert/i)&&Ce(r.data))return{message:r.message,data:r.data};if(typeof r=="object"){for(const e in r){const t=$d(r[e]);if(t)return t}return null}if(typeof r=="string")try{return $d(JSON.parse(r))}catch{}return null}function Ld(r,e){if(r!=null){if(typeof r.message=="string"&&e.push(r.message),typeof r=="object")for(const t in r)Ld(r[t],e);if(typeof r=="string")try{return Ld(JSON.parse(r),e)}catch{}}}function lP(r){const e=[];return Ld(r,e),e}var Ca,Ba;const yi=class yi extends cP{constructor(t,n,s){const i=Object.assign({},s??{},{batchMaxCount:1});R(t&&t.request,"invalid EIP-1193 provider","ethereum",t);super(n,i);M(this,Ca);M(this,Ba);P(this,Ba,null),s&&s.providerInfo&&P(this,Ba,s.providerInfo),P(this,Ca,async(o,a)=>{const c={method:o,params:a};this.emit("debug",{action:"sendEip1193Request",payload:c});try{const l=await t.request(c);return this.emit("debug",{action:"receiveEip1193Result",result:l}),l}catch(l){const u=new Error(l.message);throw u.code=l.code,u.data=l.data,u.payload=c,this.emit("debug",{action:"receiveEip1193Error",error:u}),u}})}get providerInfo(){return y(this,Ba)}async send(t,n){return await this._start(),await super.send(t,n)}async _send(t){R(!Array.isArray(t),"EIP-1193 does not support batch request","payload",t);try{const n=await y(this,Ca).call(this,t.method,t.params||[]);return[{id:t.id,result:n}]}catch(n){return[{id:t.id,error:{code:n.code,data:n.data,message:n.message}}]}}getRpcError(t,n){switch(n=JSON.parse(JSON.stringify(n)),n.error.code||-1){case 4001:n.error.message=`ethers-user-denied: ${n.error.message}`;break;case 4200:n.error.message=`ethers-unsupported: ${n.error.message}`;break}return super.getRpcError(t,n)}async hasSigner(t){t==null&&(t=0);const n=await this.send("eth_accounts",[]);return typeof t=="number"?n.length>t:(t=t.toLowerCase(),n.filter(s=>s.toLowerCase()===t).length!==0)}async getSigner(t){if(t==null&&(t=0),!await this.hasSigner(t))try{await y(this,Ca).call(this,"eth_requestAccounts",[])}catch(n){const s=n.payload;throw this.getRpcError(s,{id:s.id,error:n})}return await super.getSigner(t)}static async discover(t){if(t==null&&(t={}),t.provider)return new yi(t.provider);const n=t.window?t.window:typeof window<"u"?window:null;if(n==null)return null;const s=t.anyProvider;if(s&&n.ethereum)return new yi(n.ethereum);if(!("addEventListener"in n&&"dispatchEvent"in n&&"removeEventListener"in n))return null;const i=t.timeout?t.timeout:300;return i===0?null:await new Promise((o,a)=>{let c=[];const l=f=>{c.push(f.detail),s&&u()},u=()=>{if(clearTimeout(h),c.length)if(t&&t.filter){const f=t.filter(c.map(d=>Object.assign({},d.info)));if(f==null)o(null);else if(f instanceof yi)o(f);else{let d=null;if(f.uuid&&(d=c.filter(g=>f.uuid===g.info.uuid)[0]),d){const{provider:p,info:g}=d;o(new yi(p,void 0,{providerInfo:g}))}else a(Te("filter returned unknown info","UNSUPPORTED_OPERATION",{value:f}))}}else{const{provider:f,info:d}=c[0];o(new yi(f,void 0,{providerInfo:d}))}else o(null);n.removeEventListener("eip6963:announceProvider",l)},h=setTimeout(()=>{u()},i);n.addEventListener("eip6963:announceProvider",l),n.dispatchEvent(new Event("eip6963:requestProvider"))})}};Ca=new WeakMap,Ba=new WeakMap;let Fd=yi;const uP="modulepreload",hP=function(r){return"/build/"+r},n0={},yv=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){let o=function(l){return Promise.all(l.map(u=>Promise.resolve(u).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),c=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=o(t.map(l=>{if(l=hP(l),l in n0)return;n0[l]=!0;const u=l.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${h}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":uP,u||(f.as="script"),f.crossOrigin="",f.href=l,c&&f.setAttribute("nonce",c),document.head.appendChild(f),u)return new Promise((d,p)=>{f.addEventListener("load",d),f.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return s.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})};var hn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Xp(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function fP(r){if(Object.prototype.hasOwnProperty.call(r,"__esModule"))return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var s=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:function(){return r[n]}})}),t}var Ll={exports:{}},s0;function dP(){if(s0)return Ll.exports;s0=1;var r=typeof Reflect=="object"?Reflect:null,e=r&&typeof r.apply=="function"?r.apply:function(I,A,O){return Function.prototype.apply.call(I,A,O)},t;r&&typeof r.ownKeys=="function"?t=r.ownKeys:Object.getOwnPropertySymbols?t=function(I){return Object.getOwnPropertyNames(I).concat(Object.getOwnPropertySymbols(I))}:t=function(I){return Object.getOwnPropertyNames(I)};function n(S){console&&console.warn&&console.warn(S)}var s=Number.isNaN||function(I){return I!==I};function i(){i.init.call(this)}Ll.exports=i,Ll.exports.once=b,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var o=10;function a(S){if(typeof S!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof S)}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(S){if(typeof S!="number"||S<0||s(S))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+S+".");o=S}}),i.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(I){if(typeof I!="number"||I<0||s(I))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+I+".");return this._maxListeners=I,this};function c(S){return S._maxListeners===void 0?i.defaultMaxListeners:S._maxListeners}i.prototype.getMaxListeners=function(){return c(this)},i.prototype.emit=function(I){for(var A=[],O=1;O<arguments.length;O++)A.push(arguments[O]);var D=I==="error",B=this._events;if(B!==void 0)D=D&&B.error===void 0;else if(!D)return!1;if(D){var L;if(A.length>0&&(L=A[0]),L instanceof Error)throw L;var j=new Error("Unhandled error."+(L?" ("+L.message+")":""));throw j.context=L,j}var $=B[I];if($===void 0)return!1;if(typeof $=="function")e($,this,A);else for(var U=$.length,T=p($,U),O=0;O<U;++O)e(T[O],this,A);return!0};function l(S,I,A,O){var D,B,L;if(a(A),B=S._events,B===void 0?(B=S._events=Object.create(null),S._eventsCount=0):(B.newListener!==void 0&&(S.emit("newListener",I,A.listener?A.listener:A),B=S._events),L=B[I]),L===void 0)L=B[I]=A,++S._eventsCount;else if(typeof L=="function"?L=B[I]=O?[A,L]:[L,A]:O?L.unshift(A):L.push(A),D=c(S),D>0&&L.length>D&&!L.warned){L.warned=!0;var j=new Error("Possible EventEmitter memory leak detected. "+L.length+" "+String(I)+" listeners added. Use emitter.setMaxListeners() to increase limit");j.name="MaxListenersExceededWarning",j.emitter=S,j.type=I,j.count=L.length,n(j)}return S}i.prototype.addListener=function(I,A){return l(this,I,A,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(I,A){return l(this,I,A,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(S,I,A){var O={fired:!1,wrapFn:void 0,target:S,type:I,listener:A},D=u.bind(O);return D.listener=A,O.wrapFn=D,D}i.prototype.once=function(I,A){return a(A),this.on(I,h(this,I,A)),this},i.prototype.prependOnceListener=function(I,A){return a(A),this.prependListener(I,h(this,I,A)),this},i.prototype.removeListener=function(I,A){var O,D,B,L,j;if(a(A),D=this._events,D===void 0)return this;if(O=D[I],O===void 0)return this;if(O===A||O.listener===A)--this._eventsCount===0?this._events=Object.create(null):(delete D[I],D.removeListener&&this.emit("removeListener",I,O.listener||A));else if(typeof O!="function"){for(B=-1,L=O.length-1;L>=0;L--)if(O[L]===A||O[L].listener===A){j=O[L].listener,B=L;break}if(B<0)return this;B===0?O.shift():g(O,B),O.length===1&&(D[I]=O[0]),D.removeListener!==void 0&&this.emit("removeListener",I,j||A)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(I){var A,O,D;if(O=this._events,O===void 0)return this;if(O.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):O[I]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete O[I]),this;if(arguments.length===0){var B=Object.keys(O),L;for(D=0;D<B.length;++D)L=B[D],L!=="removeListener"&&this.removeAllListeners(L);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(A=O[I],typeof A=="function")this.removeListener(I,A);else if(A!==void 0)for(D=A.length-1;D>=0;D--)this.removeListener(I,A[D]);return this};function f(S,I,A){var O=S._events;if(O===void 0)return[];var D=O[I];return D===void 0?[]:typeof D=="function"?A?[D.listener||D]:[D]:A?m(D):p(D,D.length)}i.prototype.listeners=function(I){return f(this,I,!0)},i.prototype.rawListeners=function(I){return f(this,I,!1)},i.listenerCount=function(S,I){return typeof S.listenerCount=="function"?S.listenerCount(I):d.call(S,I)},i.prototype.listenerCount=d;function d(S){var I=this._events;if(I!==void 0){var A=I[S];if(typeof A=="function")return 1;if(A!==void 0)return A.length}return 0}i.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function p(S,I){for(var A=new Array(I),O=0;O<I;++O)A[O]=S[O];return A}function g(S,I){for(;I+1<S.length;I++)S[I]=S[I+1];S.pop()}function m(S){for(var I=new Array(S.length),A=0;A<I.length;++A)I[A]=S[A].listener||S[A];return I}function b(S,I){return new Promise(function(A,O){function D(L){S.removeListener(I,B),O(L)}function B(){typeof S.removeListener=="function"&&S.removeListener("error",D),A([].slice.call(arguments))}v(S,I,B,{once:!0}),I!=="error"&&x(S,D,{once:!0})})}function x(S,I,A){typeof S.on=="function"&&v(S,"error",I,A)}function v(S,I,A,O){if(typeof S.on=="function")O.once?S.once(I,A):S.on(I,A);else if(typeof S.addEventListener=="function")S.addEventListener(I,function D(B){O.once&&S.removeEventListener(I,D),A(B)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof S)}return Ll.exports}var cr=dP();const eg=Xp(cr);var i0=function(r,e,t){if(t||arguments.length===2)for(var n=0,s=e.length,i;n<s;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))},pP=(function(){function r(e,t,n){this.name=e,this.version=t,this.os=n,this.type="browser"}return r})(),gP=(function(){function r(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return r})(),yP=(function(){function r(e,t,n,s){this.name=e,this.version=t,this.os=n,this.bot=s,this.type="bot-device"}return r})(),mP=(function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r})(),wP=(function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r})(),bP=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,vP=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,o0=3,EP=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",bP]],a0=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function AP(r){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new wP:typeof navigator<"u"?IP(navigator.userAgent):PP()}function xP(r){return r!==""&&EP.reduce(function(e,t){var n=t[0],s=t[1];if(e)return e;var i=s.exec(r);return!!i&&[n,i]},!1)}function IP(r){var e=xP(r);if(!e)return null;var t=e[0],n=e[1];if(t==="searchbot")return new mP;var s=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);s?s.length<o0&&(s=i0(i0([],s,!0),OP(o0-s.length),!0)):s=[];var i=s.join("."),o=SP(r),a=vP.exec(r);return a&&a[1]?new yP(t,i,o,a[1]):new pP(t,i,o)}function SP(r){for(var e=0,t=a0.length;e<t;e++){var n=a0[e],s=n[0],i=n[1],o=i.exec(r);if(o)return s}return null}function PP(){var r=typeof process<"u"&&process.version;return r?new gP(process.version.slice(1)):null}function OP(r){for(var e=[],t=0;t<r;t++)e.push("0");return e}var sf={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Md=function(r,e){return Md=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var s in n)n.hasOwnProperty(s)&&(t[s]=n[s])},Md(r,e)};function DP(r,e){Md(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var jd=function(){return jd=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},jd.apply(this,arguments)};function CP(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(r);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(r,n[s])&&(t[n[s]]=r[n[s]]);return t}function BP(r,e,t,n){var s=arguments.length,i=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(i=(s<3?o(i):s>3?o(e,t,i):o(e,t))||i);return s>3&&i&&Object.defineProperty(e,t,i),i}function _P(r,e){return function(t,n){e(t,n,r)}}function TP(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)}function NP(r,e,t,n){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{l(n.next(u))}catch(h){o(h)}}function c(u){try{l(n.throw(u))}catch(h){o(h)}}function l(u){u.done?i(u.value):s(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})}function RP(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,s,i,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,s&&(i=l[0]&2?s.return:l[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,l[1])).done)return i;switch(s=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,s=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){t.label=l[1];break}if(l[0]===6&&t.label<i[1]){t.label=i[1],i=l;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(l);break}i[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(u){l=[6,u],s=0}finally{n=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function UP(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}function kP(r,e){for(var t in r)t!=="default"&&!e.hasOwnProperty(t)&&(e[t]=r[t])}function zd(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function mv(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),s,i=[],o;try{for(;(e===void 0||e-- >0)&&!(s=n.next()).done;)i.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function $P(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(mv(arguments[e]));return r}function LP(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;for(var n=Array(r),s=0,e=0;e<t;e++)for(var i=arguments[e],o=0,a=i.length;o<a;o++,s++)n[s]=i[o];return n}function Vc(r){return this instanceof Vc?(this.v=r,this):new Vc(r)}function FP(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),s,i=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(f){n[f]&&(s[f]=function(d){return new Promise(function(p,g){i.push([f,d,p,g])>1||a(f,d)})})}function a(f,d){try{c(n[f](d))}catch(p){h(i[0][3],p)}}function c(f){f.value instanceof Vc?Promise.resolve(f.value.v).then(l,u):h(i[0][2],f)}function l(f){a("next",f)}function u(f){a("throw",f)}function h(f,d){f(d),i.shift(),i.length&&a(i[0][0],i[0][1])}}function MP(r){var e,t;return e={},n("next"),n("throw",function(s){throw s}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(s,i){e[s]=r[s]?function(o){return(t=!t)?{value:Vc(r[s](o)),done:s==="return"}:i?i(o):o}:i}}function jP(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof zd=="function"?zd(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(i){t[i]=r[i]&&function(o){return new Promise(function(a,c){o=r[i](o),s(a,c,o.done,o.value)})}}function s(i,o,a,c){Promise.resolve(c).then(function(l){i({value:l,done:a})},o)}}function zP(r,e){return Object.defineProperty?Object.defineProperty(r,"raw",{value:e}):r.raw=e,r}function HP(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)Object.hasOwnProperty.call(r,t)&&(e[t]=r[t]);return e.default=r,e}function qP(r){return r&&r.__esModule?r:{default:r}}function VP(r,e){if(!e.has(r))throw new TypeError("attempted to get private field on non-instance");return e.get(r)}function KP(r,e,t){if(!e.has(r))throw new TypeError("attempted to set private field on non-instance");return e.set(r,t),t}const GP=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return jd},__asyncDelegator:MP,__asyncGenerator:FP,__asyncValues:jP,__await:Vc,__awaiter:NP,__classPrivateFieldGet:VP,__classPrivateFieldSet:KP,__createBinding:UP,__decorate:BP,__exportStar:kP,__extends:DP,__generator:RP,__importDefault:qP,__importStar:HP,__makeTemplateObject:zP,__metadata:TP,__param:_P,__read:mv,__rest:CP,__spread:$P,__spreadArrays:LP,__values:zd},Symbol.toStringTag,{value:"Module"})),gl=fP(GP);var of={},Xa={},c0;function QP(){if(c0)return Xa;c0=1,Object.defineProperty(Xa,"__esModule",{value:!0}),Xa.delay=void 0;function r(e){return new Promise(t=>{setTimeout(()=>{t(!0)},e)})}return Xa.delay=r,Xa}var ti={},af={},ri={},l0;function WP(){return l0||(l0=1,Object.defineProperty(ri,"__esModule",{value:!0}),ri.ONE_THOUSAND=ri.ONE_HUNDRED=void 0,ri.ONE_HUNDRED=100,ri.ONE_THOUSAND=1e3),ri}var cf={},u0;function JP(){return u0||(u0=1,(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ONE_YEAR=r.FOUR_WEEKS=r.THREE_WEEKS=r.TWO_WEEKS=r.ONE_WEEK=r.THIRTY_DAYS=r.SEVEN_DAYS=r.FIVE_DAYS=r.THREE_DAYS=r.ONE_DAY=r.TWENTY_FOUR_HOURS=r.TWELVE_HOURS=r.SIX_HOURS=r.THREE_HOURS=r.ONE_HOUR=r.SIXTY_MINUTES=r.THIRTY_MINUTES=r.TEN_MINUTES=r.FIVE_MINUTES=r.ONE_MINUTE=r.SIXTY_SECONDS=r.THIRTY_SECONDS=r.TEN_SECONDS=r.FIVE_SECONDS=r.ONE_SECOND=void 0,r.ONE_SECOND=1,r.FIVE_SECONDS=5,r.TEN_SECONDS=10,r.THIRTY_SECONDS=30,r.SIXTY_SECONDS=60,r.ONE_MINUTE=r.SIXTY_SECONDS,r.FIVE_MINUTES=r.ONE_MINUTE*5,r.TEN_MINUTES=r.ONE_MINUTE*10,r.THIRTY_MINUTES=r.ONE_MINUTE*30,r.SIXTY_MINUTES=r.ONE_MINUTE*60,r.ONE_HOUR=r.SIXTY_MINUTES,r.THREE_HOURS=r.ONE_HOUR*3,r.SIX_HOURS=r.ONE_HOUR*6,r.TWELVE_HOURS=r.ONE_HOUR*12,r.TWENTY_FOUR_HOURS=r.ONE_HOUR*24,r.ONE_DAY=r.TWENTY_FOUR_HOURS,r.THREE_DAYS=r.ONE_DAY*3,r.FIVE_DAYS=r.ONE_DAY*5,r.SEVEN_DAYS=r.ONE_DAY*7,r.THIRTY_DAYS=r.ONE_DAY*30,r.ONE_WEEK=r.SEVEN_DAYS,r.TWO_WEEKS=r.ONE_WEEK*2,r.THREE_WEEKS=r.ONE_WEEK*3,r.FOUR_WEEKS=r.ONE_WEEK*4,r.ONE_YEAR=r.ONE_DAY*365})(cf)),cf}var h0;function wv(){return h0||(h0=1,(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=gl;e.__exportStar(WP(),r),e.__exportStar(JP(),r)})(af)),af}var f0;function YP(){if(f0)return ti;f0=1,Object.defineProperty(ti,"__esModule",{value:!0}),ti.fromMiliseconds=ti.toMiliseconds=void 0;const r=wv();function e(n){return n*r.ONE_THOUSAND}ti.toMiliseconds=e;function t(n){return Math.floor(n/r.ONE_THOUSAND)}return ti.fromMiliseconds=t,ti}var d0;function ZP(){return d0||(d0=1,(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=gl;e.__exportStar(QP(),r),e.__exportStar(YP(),r)})(of)),of}var po={},p0;function XP(){if(p0)return po;p0=1,Object.defineProperty(po,"__esModule",{value:!0}),po.Watch=void 0;class r{constructor(){this.timestamps=new Map}start(t){if(this.timestamps.has(t))throw new Error(`Watch already started for label: ${t}`);this.timestamps.set(t,{started:Date.now()})}stop(t){const n=this.get(t);if(typeof n.elapsed<"u")throw new Error(`Watch already stopped for label: ${t}`);const s=Date.now()-n.started;this.timestamps.set(t,{started:n.started,elapsed:s})}get(t){const n=this.timestamps.get(t);if(typeof n>"u")throw new Error(`No timestamp found for label: ${t}`);return n}elapsed(t){const n=this.get(t);return n.elapsed||Date.now()-n.started}}return po.Watch=r,po.default=r,po}var lf={},ec={},g0;function eO(){if(g0)return ec;g0=1,Object.defineProperty(ec,"__esModule",{value:!0}),ec.IWatch=void 0;class r{}return ec.IWatch=r,ec}var y0;function tO(){return y0||(y0=1,(function(r){Object.defineProperty(r,"__esModule",{value:!0}),gl.__exportStar(eO(),r)})(lf)),lf}var m0;function rO(){return m0||(m0=1,(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=gl;e.__exportStar(ZP(),r),e.__exportStar(XP(),r),e.__exportStar(tO(),r),e.__exportStar(wv(),r)})(sf)),sf}var J=rO(),Pe={},w0;function bv(){if(w0)return Pe;w0=1,Object.defineProperty(Pe,"__esModule",{value:!0}),Pe.getLocalStorage=Pe.getLocalStorageOrThrow=Pe.getCrypto=Pe.getCryptoOrThrow=Pe.getLocation=Pe.getLocationOrThrow=Pe.getNavigator=Pe.getNavigatorOrThrow=Pe.getDocument=Pe.getDocumentOrThrow=Pe.getFromWindowOrThrow=Pe.getFromWindow=void 0;function r(f){let d;return typeof window<"u"&&typeof window[f]<"u"&&(d=window[f]),d}Pe.getFromWindow=r;function e(f){const d=r(f);if(!d)throw new Error(`${f} is not defined in Window`);return d}Pe.getFromWindowOrThrow=e;function t(){return e("document")}Pe.getDocumentOrThrow=t;function n(){return r("document")}Pe.getDocument=n;function s(){return e("navigator")}Pe.getNavigatorOrThrow=s;function i(){return r("navigator")}Pe.getNavigator=i;function o(){return e("location")}Pe.getLocationOrThrow=o;function a(){return r("location")}Pe.getLocation=a;function c(){return e("crypto")}Pe.getCryptoOrThrow=c;function l(){return r("crypto")}Pe.getCrypto=l;function u(){return e("localStorage")}Pe.getLocalStorageOrThrow=u;function h(){return r("localStorage")}return Pe.getLocalStorage=h,Pe}var ts=bv(),tc={},b0;function nO(){if(b0)return tc;b0=1,Object.defineProperty(tc,"__esModule",{value:!0}),tc.getWindowMetadata=void 0;const r=bv();function e(){let t,n;try{t=r.getDocumentOrThrow(),n=r.getLocationOrThrow()}catch{return null}function s(){const d=t.getElementsByTagName("link"),p=[];for(let g=0;g<d.length;g++){const m=d[g],b=m.getAttribute("rel");if(b&&b.toLowerCase().indexOf("icon")>-1){const x=m.getAttribute("href");if(x)if(x.toLowerCase().indexOf("https:")===-1&&x.toLowerCase().indexOf("http:")===-1&&x.indexOf("//")!==0){let v=n.protocol+"//"+n.host;if(x.indexOf("/")===0)v+=x;else{const S=n.pathname.split("/");S.pop();const I=S.join("/");v+=I+"/"+x}p.push(v)}else if(x.indexOf("//")===0){const v=n.protocol+x;p.push(v)}else p.push(x)}}return p}function i(...d){const p=t.getElementsByTagName("meta");for(let g=0;g<p.length;g++){const m=p[g],b=["itemprop","property","name"].map(x=>m.getAttribute(x)).filter(x=>x?d.includes(x):!1);if(b.length&&b){const x=m.getAttribute("content");if(x)return x}}return""}function o(){let d=i("name","og:site_name","og:title","twitter:title");return d||(d=t.title),d}function a(){return i("description","og:description","twitter:description","keywords")}const c=o(),l=a(),u=n.origin,h=s();return{description:l,url:u,icons:h,name:c}}return tc.getWindowMetadata=e,tc}var sO=nO();function Kc(r,{strict:e=!0}={}){return!r||typeof r!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(r):r.startsWith("0x")}function Hd(r){return Kc(r,{strict:!1})?Math.ceil((r.length-2)/2):r.length}const vv="2.36.0";let rc={getDocsUrl:({docsBaseUrl:r,docsPath:e="",docsSlug:t})=>e?`${r??"https://viem.sh"}${e}${t?`#${t}`:""}`:void 0,version:`viem@${vv}`};class Yi extends Error{constructor(e,t={}){var a;const n=(()=>{var c;return t.cause instanceof Yi?t.cause.details:(c=t.cause)!=null&&c.message?t.cause.message:t.details})(),s=t.cause instanceof Yi&&t.cause.docsPath||t.docsPath,i=(a=rc.getDocsUrl)==null?void 0:a.call(rc,{...t,docsPath:s}),o=[e||"An error occurred.","",...t.metaMessages?[...t.metaMessages,""]:[],...i?[`Docs: ${i}`]:[],...n?[`Details: ${n}`]:[],...rc.version?[`Version: ${rc.version}`]:[]].join(`
`);super(o,t.cause?{cause:t.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=n,this.docsPath=s,this.metaMessages=t.metaMessages,this.name=t.name??this.name,this.shortMessage=e,this.version=vv}walk(e){return Ev(this,e)}}function Ev(r,e){return e!=null&&e(r)?r:r&&typeof r=="object"&&"cause"in r&&r.cause!==void 0?Ev(r.cause,e):e?null:r}class Av extends Yi{constructor({size:e,targetSize:t,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (${e}) exceeds padding size (${t}).`,{name:"SizeExceedsPaddingSizeError"})}}function qa(r,{dir:e,size:t=32}={}){return typeof r=="string"?iO(r,{dir:e,size:t}):oO(r,{dir:e,size:t})}function iO(r,{dir:e,size:t=32}={}){if(t===null)return r;const n=r.replace("0x","");if(n.length>t*2)throw new Av({size:Math.ceil(n.length/2),targetSize:t,type:"hex"});return`0x${n[e==="right"?"padEnd":"padStart"](t*2,"0")}`}function oO(r,{dir:e,size:t=32}={}){if(t===null)return r;if(r.length>t)throw new Av({size:r.length,targetSize:t,type:"bytes"});const n=new Uint8Array(t);for(let s=0;s<t;s++){const i=e==="right";n[i?s:t-s-1]=r[i?s:r.length-s-1]}return n}class aO extends Yi{constructor({max:e,min:t,signed:n,size:s,value:i}){super(`Number "${i}" is not in safe ${s?`${s*8}-bit ${n?"signed":"unsigned"} `:""}integer range ${e?`(${t} to ${e})`:`(above ${t})`}`,{name:"IntegerOutOfRangeError"})}}class cO extends Yi{constructor({givenSize:e,maxSize:t}){super(`Size cannot exceed ${t} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function Va(r,{size:e}){if(Hd(r)>e)throw new cO({givenSize:Hd(r),maxSize:e})}function qd(r,e={}){const{signed:t}=e;e.size&&Va(r,{size:e.size});const n=BigInt(r);if(!t)return n;const s=(r.length-2)/2,i=(1n<<BigInt(s)*8n-1n)-1n;return n<=i?n:n-BigInt(`0x${"f".padStart(s*2,"f")}`)-1n}function lO(r,e={}){return Number(qd(r,e))}const uO=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function Vd(r,e={}){return typeof r=="number"||typeof r=="bigint"?Iv(r,e):typeof r=="string"?dO(r,e):typeof r=="boolean"?hO(r,e):xv(r,e)}function hO(r,e={}){const t=`0x${Number(r)}`;return typeof e.size=="number"?(Va(t,{size:e.size}),qa(t,{size:e.size})):t}function xv(r,e={}){let t="";for(let s=0;s<r.length;s++)t+=uO[r[s]];const n=`0x${t}`;return typeof e.size=="number"?(Va(n,{size:e.size}),qa(n,{dir:"right",size:e.size})):n}function Iv(r,e={}){const{signed:t,size:n}=e,s=BigInt(r);let i;n?t?i=(1n<<BigInt(n)*8n-1n)-1n:i=2n**(BigInt(n)*8n)-1n:typeof r=="number"&&(i=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof i=="bigint"&&t?-i-1n:0;if(i&&s>i||s<o){const c=typeof r=="bigint"?"n":"";throw new aO({max:i?`${i}${c}`:void 0,min:`${o}${c}`,signed:t,size:n,value:`${r}${c}`})}const a=`0x${(t&&s<0?(1n<<BigInt(n*8))+BigInt(s):s).toString(16)}`;return n?qa(a,{size:n}):a}const fO=new TextEncoder;function dO(r,e={}){const t=fO.encode(r);return xv(t,e)}const pO=new TextEncoder;function gO(r,e={}){return typeof r=="number"||typeof r=="bigint"?mO(r,e):typeof r=="boolean"?yO(r,e):Kc(r)?Sv(r,e):Pv(r,e)}function yO(r,e={}){const t=new Uint8Array(1);return t[0]=Number(r),typeof e.size=="number"?(Va(t,{size:e.size}),qa(t,{size:e.size})):t}const En={zero:48,nine:57,A:65,F:70,a:97,f:102};function v0(r){if(r>=En.zero&&r<=En.nine)return r-En.zero;if(r>=En.A&&r<=En.F)return r-(En.A-10);if(r>=En.a&&r<=En.f)return r-(En.a-10)}function Sv(r,e={}){let t=r;e.size&&(Va(t,{size:e.size}),t=qa(t,{dir:"right",size:e.size}));let n=t.slice(2);n.length%2&&(n=`0${n}`);const s=n.length/2,i=new Uint8Array(s);for(let o=0,a=0;o<s;o++){const c=v0(n.charCodeAt(a++)),l=v0(n.charCodeAt(a++));if(c===void 0||l===void 0)throw new Yi(`Invalid byte sequence ("${n[a-2]}${n[a-1]}" in "${n}").`);i[o]=c*16+l}return i}function mO(r,e){const t=Iv(r,e);return Sv(t)}function Pv(r,e={}){const t=pO.encode(r);return typeof e.size=="number"?(Va(t,{size:e.size}),qa(t,{dir:"right",size:e.size})):t}const Fl=BigInt(2**32-1),E0=BigInt(32);function wO(r,e=!1){return e?{h:Number(r&Fl),l:Number(r>>E0&Fl)}:{h:Number(r>>E0&Fl)|0,l:Number(r&Fl)|0}}function bO(r,e=!1){const t=r.length;let n=new Uint32Array(t),s=new Uint32Array(t);for(let i=0;i<t;i++){const{h:o,l:a}=wO(r[i],e);[n[i],s[i]]=[o,a]}return[n,s]}const vO=(r,e,t)=>r<<t|e>>>32-t,EO=(r,e,t)=>e<<t|r>>>32-t,AO=(r,e,t)=>e<<t-32|r>>>64-t,xO=(r,e,t)=>r<<t-32|e>>>64-t,go=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function IO(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Ru(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function Fa(r,...e){if(!IO(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function lM(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Ru(r.outputLen),Ru(r.blockLen)}function A0(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function SO(r,e){Fa(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function PO(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}function Ov(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function uM(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function hM(r,e){return r<<32-e|r>>>e}const OO=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function DO(r){return r<<24&4278190080|r<<8&16711680|r>>>8&65280|r>>>24&255}function CO(r){for(let e=0;e<r.length;e++)r[e]=DO(r[e]);return r}const x0=OO?r=>r:CO,Dv=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",BO=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function fM(r){if(Fa(r),Dv)return r.toHex();let e="";for(let t=0;t<r.length;t++)e+=BO[r[t]];return e}const An={_0:48,_9:57,A:65,F:70,a:97,f:102};function I0(r){if(r>=An._0&&r<=An._9)return r-An._0;if(r>=An.A&&r<=An.F)return r-(An.A-10);if(r>=An.a&&r<=An.f)return r-(An.a-10)}function dM(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);if(Dv)return Uint8Array.fromHex(r);const e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(t);for(let s=0,i=0;s<t;s++,i+=2){const o=I0(r.charCodeAt(i)),a=I0(r.charCodeAt(i+1));if(o===void 0||a===void 0){const c=r[i]+r[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[s]=o*16+a}return n}function _O(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function Cv(r){return typeof r=="string"&&(r=_O(r)),Fa(r),r}function pM(...r){let e=0;for(let n=0;n<r.length;n++){const s=r[n];Fa(s),e+=s.length}const t=new Uint8Array(e);for(let n=0,s=0;n<r.length;n++){const i=r[n];t.set(i,s),s+=i.length}return t}class TO{}function NO(r){const e=n=>r().update(Cv(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function gM(r=32){if(go&&typeof go.getRandomValues=="function")return go.getRandomValues(new Uint8Array(r));if(go&&typeof go.randomBytes=="function")return Uint8Array.from(go.randomBytes(r));throw new Error("crypto.getRandomValues must be defined")}const RO=BigInt(0),nc=BigInt(1),UO=BigInt(2),kO=BigInt(7),$O=BigInt(256),LO=BigInt(113),Bv=[],_v=[],Tv=[];for(let r=0,e=nc,t=1,n=0;r<24;r++){[t,n]=[n,(2*t+3*n)%5],Bv.push(2*(5*n+t)),_v.push((r+1)*(r+2)/2%64);let s=RO;for(let i=0;i<7;i++)e=(e<<nc^(e>>kO)*LO)%$O,e&UO&&(s^=nc<<(nc<<BigInt(i))-nc);Tv.push(s)}const Nv=bO(Tv,!0),FO=Nv[0],MO=Nv[1],S0=(r,e,t)=>t>32?AO(r,e,t):vO(r,e,t),P0=(r,e,t)=>t>32?xO(r,e,t):EO(r,e,t);function jO(r,e=24){const t=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)t[o]=r[o]^r[o+10]^r[o+20]^r[o+30]^r[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=t[c],u=t[c+1],h=S0(l,u,1)^t[a],f=P0(l,u,1)^t[a+1];for(let d=0;d<50;d+=10)r[o+d]^=h,r[o+d+1]^=f}let s=r[2],i=r[3];for(let o=0;o<24;o++){const a=_v[o],c=S0(s,i,a),l=P0(s,i,a),u=Bv[o];s=r[u],i=r[u+1],r[u]=c,r[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)t[a]=r[o+a];for(let a=0;a<10;a++)r[o+a]^=~t[(a+2)%10]&t[(a+4)%10]}r[0]^=FO[n],r[1]^=MO[n]}Ov(t)}class tg extends TO{constructor(e,t,n,s=!1,i=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=t,this.outputLen=n,this.enableXOF=s,this.rounds=i,Ru(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=PO(this.state)}clone(){return this._cloneInto()}keccak(){x0(this.state32),jO(this.state32,this.rounds),x0(this.state32),this.posOut=0,this.pos=0}update(e){A0(this),e=Cv(e),Fa(e);const{blockLen:t,state:n}=this,s=e.length;for(let i=0;i<s;){const o=Math.min(t-this.pos,s-i);for(let a=0;a<o;a++)n[this.pos++]^=e[i++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:n,blockLen:s}=this;e[n]^=t,(t&128)!==0&&n===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){A0(this,!1),Fa(e),this.finish();const t=this.state,{blockLen:n}=this;for(let s=0,i=e.length;s<i;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,i-s);e.set(t.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Ru(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(SO(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Ov(this.state)}_cloneInto(e){const{blockLen:t,suffix:n,outputLen:s,rounds:i,enableXOF:o}=this;return e||(e=new tg(t,n,s,o,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=n,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}}const zO=(r,e,t)=>NO(()=>new tg(e,r,t)),HO=zO(1,136,256/8);function Rv(r,e){const t=e||"hex",n=HO(Kc(r,{strict:!1})?gO(r):r);return t==="bytes"?n:Vd(n)}class qO extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const t=super.get(e);return super.has(e)&&t!==void 0&&(this.delete(e),super.set(e,t)),t}set(e,t){if(super.set(e,t),this.maxSize&&this.size>this.maxSize){const n=this.keys().next().value;n&&this.delete(n)}return this}}const uf=new qO(8192);function VO(r,e){if(uf.has(`${r}.${e}`))return uf.get(`${r}.${e}`);const t=r.substring(2).toLowerCase(),n=Rv(Pv(t),"bytes"),s=t.split("");for(let o=0;o<40;o+=2)n[o>>1]>>4>=8&&s[o]&&(s[o]=s[o].toUpperCase()),(n[o>>1]&15)>=8&&s[o+1]&&(s[o+1]=s[o+1].toUpperCase());const i=`0x${s.join("")}`;return uf.set(`${r}.${e}`,i),i}function KO(r){const e=Rv(`0x${r.substring(4)}`).substring(26);return VO(`0x${e}`)}async function GO({hash:r,signature:e}){const t=Kc(r)?r:Vd(r),{secp256k1:n}=await yv(async()=>{const{secp256k1:o}=await import("./secp256k1-BQLewIEv.js");return{secp256k1:o}},[]);return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){const{r:l,s:u,v:h,yParity:f}=e,d=Number(f??h),p=O0(d);return new n.Signature(qd(l),qd(u)).addRecoveryBit(p)}const o=Kc(e)?e:Vd(e);if(Hd(o)!==65)throw new Error("invalid signature length");const a=lO(`0x${o.slice(130)}`),c=O0(a);return n.Signature.fromCompact(o.substring(2,130)).addRecoveryBit(c)})().recoverPublicKey(t.substring(2)).toHex(!1)}`}function O0(r){if(r===0||r===1)return r;if(r===27)return 0;if(r===28)return 1;throw new Error("Invalid yParityOrV value")}async function QO({hash:r,signature:e}){return KO(await GO({hash:r,signature:e}))}function WO(r){if(r.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let l=0;l<e.length;l++)e[l]=255;for(let l=0;l<r.length;l++){const u=r.charAt(l),h=u.charCodeAt(0);if(e[h]!==255)throw new TypeError(u+" is ambiguous");e[h]=l}const t=r.length,n=r.charAt(0),s=Math.log(t)/Math.log(256),i=Math.log(256)/Math.log(t);function o(l){if(l instanceof Uint8Array||(ArrayBuffer.isView(l)?l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength):Array.isArray(l)&&(l=Uint8Array.from(l))),!(l instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(l.length===0)return"";let u=0,h=0,f=0;const d=l.length;for(;f!==d&&l[f]===0;)f++,u++;const p=(d-f)*i+1>>>0,g=new Uint8Array(p);for(;f!==d;){let x=l[f],v=0;for(let S=p-1;(x!==0||v<h)&&S!==-1;S--,v++)x+=256*g[S]>>>0,g[S]=x%t>>>0,x=x/t>>>0;if(x!==0)throw new Error("Non-zero carry");h=v,f++}let m=p-h;for(;m!==p&&g[m]===0;)m++;let b=n.repeat(u);for(;m<p;++m)b+=r.charAt(g[m]);return b}function a(l){if(typeof l!="string")throw new TypeError("Expected String");if(l.length===0)return new Uint8Array;let u=0,h=0,f=0;for(;l[u]===n;)h++,u++;const d=(l.length-u)*s+1>>>0,p=new Uint8Array(d);for(;u<l.length;){const x=l.charCodeAt(u);if(x>255)return;let v=e[x];if(v===255)return;let S=0;for(let I=d-1;(v!==0||S<f)&&I!==-1;I--,S++)v+=t*p[I]>>>0,p[I]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");f=S,u++}let g=d-f;for(;g!==d&&p[g]===0;)g++;const m=new Uint8Array(h+(d-g));let b=h;for(;g!==d;)m[b++]=p[g++];return m}function c(l){const u=a(l);if(u)return u;throw new Error("Non-base"+t+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var JO="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const yl=WO(JO);function YO(r){const e=r.length;let t=0,n=0;for(;n<e;){let s=r.charCodeAt(n++);if((s&4294967168)===0){t++;continue}else if((s&4294965248)===0)t+=2;else{if(s>=55296&&s<=56319&&n<e){const i=r.charCodeAt(n);(i&64512)===56320&&(++n,s=((s&1023)<<10)+(i&1023)+65536)}(s&4294901760)===0?t+=3:t+=4}}return t}function ZO(r,e,t){const n=r.length;let s=t,i=0;for(;i<n;){let o=r.charCodeAt(i++);if((o&4294967168)===0){e[s++]=o;continue}else if((o&4294965248)===0)e[s++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&i<n){const a=r.charCodeAt(i);(a&64512)===56320&&(++i,o=((o&1023)<<10)+(a&1023)+65536)}(o&4294901760)===0?(e[s++]=o>>12&15|224,e[s++]=o>>6&63|128):(e[s++]=o>>18&7|240,e[s++]=o>>12&63|128,e[s++]=o>>6&63|128)}e[s++]=o&63|128}}const XO=new TextEncoder,e8=50;function t8(r,e,t){XO.encodeInto(r,e.subarray(t))}function r8(r,e,t){r.length>e8?t8(r,e,t):ZO(r,e,t)}const n8=4096;function Uv(r,e,t){let n=e;const s=n+t,i=[];let o="";for(;n<s;){const a=r[n++];if((a&128)===0)i.push(a);else if((a&224)===192){const c=r[n++]&63;i.push((a&31)<<6|c)}else if((a&240)===224){const c=r[n++]&63,l=r[n++]&63;i.push((a&31)<<12|c<<6|l)}else if((a&248)===240){const c=r[n++]&63,l=r[n++]&63,u=r[n++]&63;let h=(a&7)<<18|c<<12|l<<6|u;h>65535&&(h-=65536,i.push(h>>>10&1023|55296),h=56320|h&1023),i.push(h)}else i.push(a);i.length>=n8&&(o+=String.fromCharCode(...i),i.length=0)}return i.length>0&&(o+=String.fromCharCode(...i)),o}const s8=new TextDecoder,i8=200;function o8(r,e,t){const n=r.subarray(e,e+t);return s8.decode(n)}function a8(r,e,t){return t>i8?o8(r,e,t):Uv(r,e,t)}class Ml{constructor(e,t){this.type=e,this.data=t}}class ir extends Error{constructor(e){super(e);const t=Object.create(ir.prototype);Object.setPrototypeOf(this,t),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:ir.name})}}const sc=4294967295;function c8(r,e,t){const n=t/4294967296,s=t;r.setUint32(e,n),r.setUint32(e+4,s)}function kv(r,e,t){const n=Math.floor(t/4294967296),s=t;r.setUint32(e,n),r.setUint32(e+4,s)}function $v(r,e){const t=r.getInt32(e),n=r.getUint32(e+4);return t*4294967296+n}function l8(r,e){const t=r.getUint32(e),n=r.getUint32(e+4);return t*4294967296+n}const u8=-1,h8=4294967296-1,f8=17179869184-1;function d8({sec:r,nsec:e}){if(r>=0&&e>=0&&r<=f8)if(e===0&&r<=h8){const t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,r),t}else{const t=r/4294967296,n=r&4294967295,s=new Uint8Array(8),i=new DataView(s.buffer);return i.setUint32(0,e<<2|t&3),i.setUint32(4,n),s}else{const t=new Uint8Array(12),n=new DataView(t.buffer);return n.setUint32(0,e),kv(n,4,r),t}}function p8(r){const e=r.getTime(),t=Math.floor(e/1e3),n=(e-t*1e3)*1e6,s=Math.floor(n/1e9);return{sec:t+s,nsec:n-s*1e9}}function g8(r){if(r instanceof Date){const e=p8(r);return d8(e)}else return null}function y8(r){const e=new DataView(r.buffer,r.byteOffset,r.byteLength);switch(r.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const t=e.getUint32(0),n=e.getUint32(4),s=(t&3)*4294967296+n,i=t>>>2;return{sec:s,nsec:i}}case 12:{const t=$v(e,4),n=e.getUint32(0);return{sec:t,nsec:n}}default:throw new ir(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${r.length}`)}}function m8(r){const e=y8(r);return new Date(e.sec*1e3+e.nsec/1e6)}const w8={type:u8,encode:g8,decode:m8};class Uu{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(w8)}register({type:e,encode:t,decode:n}){if(e>=0)this.encoders[e]=t,this.decoders[e]=n;else{const s=-1-e;this.builtInEncoders[s]=t,this.builtInDecoders[s]=n}}tryToEncode(e,t){for(let n=0;n<this.builtInEncoders.length;n++){const s=this.builtInEncoders[n];if(s!=null){const i=s(e,t);if(i!=null){const o=-1-n;return new Ml(o,i)}}}for(let n=0;n<this.encoders.length;n++){const s=this.encoders[n];if(s!=null){const i=s(e,t);if(i!=null){const o=n;return new Ml(o,i)}}}return e instanceof Ml?e:null}decode(e,t,n){const s=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return s?s(e,t,n):new Ml(t,e)}}Uu.defaultCodec=new Uu;function b8(r){return r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer}function Kd(r){return r instanceof Uint8Array?r:ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):b8(r)?new Uint8Array(r):Uint8Array.from(r)}const v8=100,E8=2048;let A8=class Lv{constructor(e){this.entered=!1,this.extensionCodec=(e==null?void 0:e.extensionCodec)??Uu.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.maxDepth=(e==null?void 0:e.maxDepth)??v8,this.initialBufferSize=(e==null?void 0:e.initialBufferSize)??E8,this.sortKeys=(e==null?void 0:e.sortKeys)??!1,this.forceFloat32=(e==null?void 0:e.forceFloat32)??!1,this.ignoreUndefined=(e==null?void 0:e.ignoreUndefined)??!1,this.forceIntegerToFloat=(e==null?void 0:e.forceIntegerToFloat)??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new Lv({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,t){if(t>this.maxDepth)throw new Error(`Too deep objects in depth ${t}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,t)}ensureBufferSizeToWrite(e){const t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(t*2)}resizeBuffer(e){const t=new ArrayBuffer(e),n=new Uint8Array(t),s=new DataView(t);n.set(this.bytes),this.view=s,this.bytes=n}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const n=YO(e);this.ensureBufferSizeToWrite(5+n),this.writeStringHeader(n),r8(e,this.bytes,this.pos),this.pos+=n}encodeObject(e,t){const n=this.extensionCodec.tryToEncode(e,this.context);if(n!=null)this.encodeExtension(n);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,t);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else if(t<4294967296)this.writeU8(198),this.writeU32(t);else throw new Error(`Too large binary: ${t}`);const n=Kd(e);this.writeU8a(n)}encodeArray(e,t){const n=e.length;if(n<16)this.writeU8(144+n);else if(n<65536)this.writeU8(220),this.writeU16(n);else if(n<4294967296)this.writeU8(221),this.writeU32(n);else throw new Error(`Too large array: ${n}`);for(const s of e)this.doEncode(s,t+1)}countWithoutUndefined(e,t){let n=0;for(const s of t)e[s]!==void 0&&n++;return n}encodeMap(e,t){const n=Object.keys(e);this.sortKeys&&n.sort();const s=this.ignoreUndefined?this.countWithoutUndefined(e,n):n.length;if(s<16)this.writeU8(128+s);else if(s<65536)this.writeU8(222),this.writeU16(s);else if(s<4294967296)this.writeU8(223),this.writeU32(s);else throw new Error(`Too large map object: ${s}`);for(const i of n){const o=e[i];this.ignoreUndefined&&o===void 0||(this.encodeString(i),this.doEncode(o,t+1))}}encodeExtension(e){if(typeof e.data=="function"){const n=e.data(this.pos+6),s=n.length;if(s>=4294967296)throw new Error(`Too large extension object: ${s}`);this.writeU8(201),this.writeU32(s),this.writeI8(e.type),this.writeU8a(n);return}const t=e.data.length;if(t===1)this.writeU8(212);else if(t===2)this.writeU8(213);else if(t===4)this.writeU8(214);else if(t===8)this.writeU8(215);else if(t===16)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else if(t<4294967296)this.writeU8(201),this.writeU32(t);else throw new Error(`Too large extension object: ${t}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),c8(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),kv(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function x8(r,e){return new A8(e).encodeSharedRef(r)}function hf(r){return`${r<0?"-":""}0x${Math.abs(r).toString(16).padStart(2,"0")}`}const I8=16,S8=16;class P8{constructor(e=I8,t=S8){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=t,this.caches=[];for(let n=0;n<this.maxKeyLength;n++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,t,n){const s=this.caches[n-1];e:for(const i of s){const o=i.bytes;for(let a=0;a<n;a++)if(o[a]!==e[t+a])continue e;return i.str}return null}store(e,t){const n=this.caches[e.length-1],s={bytes:e,str:t};n.length>=this.maxLengthPerKey?n[Math.random()*n.length|0]=s:n.push(s)}decode(e,t,n){const s=this.find(e,t,n);if(s!=null)return this.hit++,s;this.miss++;const i=Uv(e,t,n),o=Uint8Array.prototype.slice.call(e,t,t+n);return this.store(o,i),i}}const Gd="array",Oc="map_key",Fv="map_value",O8=r=>{if(typeof r=="string"||typeof r=="number")return r;throw new ir("The type of key must be string or number but "+typeof r)};class D8{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const t=this.getUninitializedStateFromPool();t.type=Gd,t.position=0,t.size=e,t.array=new Array(e)}pushMapState(e){const t=this.getUninitializedStateFromPool();t.type=Oc,t.readCount=0,t.size=e,t.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===Gd){const n=e;n.size=0,n.array=void 0,n.position=0,n.type=void 0}if(e.type===Oc||e.type===Fv){const n=e;n.size=0,n.map=void 0,n.readCount=0,n.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const ic=-1,rg=new DataView(new ArrayBuffer(0)),C8=new Uint8Array(rg.buffer);try{rg.getInt8(0)}catch(r){if(!(r instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const D0=new RangeError("Insufficient data"),B8=new P8;let _8=class Mv{constructor(e){this.totalPos=0,this.pos=0,this.view=rg,this.bytes=C8,this.headByte=ic,this.stack=new D8,this.entered=!1,this.extensionCodec=(e==null?void 0:e.extensionCodec)??Uu.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.rawStrings=(e==null?void 0:e.rawStrings)??!1,this.maxStrLength=(e==null?void 0:e.maxStrLength)??sc,this.maxBinLength=(e==null?void 0:e.maxBinLength)??sc,this.maxArrayLength=(e==null?void 0:e.maxArrayLength)??sc,this.maxMapLength=(e==null?void 0:e.maxMapLength)??sc,this.maxExtLength=(e==null?void 0:e.maxExtLength)??sc,this.keyDecoder=(e==null?void 0:e.keyDecoder)!==void 0?e.keyDecoder:B8,this.mapKeyConverter=(e==null?void 0:e.mapKeyConverter)??O8}clone(){return new Mv({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=ic,this.stack.reset()}setBuffer(e){const t=Kd(e);this.bytes=t,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===ic&&!this.hasRemaining(1))this.setBuffer(e);else{const t=this.bytes.subarray(this.pos),n=Kd(e),s=new Uint8Array(t.length+n.length);s.set(t),s.set(n,t.length),this.setBuffer(s)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:t,pos:n}=this;return new RangeError(`Extra ${t.byteLength-n} of ${t.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let t=!1,n;for await(const a of e){if(t)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{n=this.doDecodeSync(),t=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(t){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return n}const{headByte:s,pos:i,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${hf(s)} at ${o} (${i} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,t){if(this.entered){yield*this.clone().decodeMultiAsync(e,t);return}try{this.entered=!0;let n=t,s=-1;for await(const i of e){if(t&&s===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(i),n&&(s=this.readArraySize(),n=!1,this.complete());try{for(;yield this.doDecodeSync(),--s!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let t;if(e>=224)t=e-256;else if(e<192)if(e<128)t=e;else if(e<144){const s=e-128;if(s!==0){this.pushMapState(s),this.complete();continue e}else t={}}else if(e<160){const s=e-144;if(s!==0){this.pushArrayState(s),this.complete();continue e}else t=[]}else{const s=e-160;t=this.decodeString(s,0)}else if(e===192)t=null;else if(e===194)t=!1;else if(e===195)t=!0;else if(e===202)t=this.readF32();else if(e===203)t=this.readF64();else if(e===204)t=this.readU8();else if(e===205)t=this.readU16();else if(e===206)t=this.readU32();else if(e===207)this.useBigInt64?t=this.readU64AsBigInt():t=this.readU64();else if(e===208)t=this.readI8();else if(e===209)t=this.readI16();else if(e===210)t=this.readI32();else if(e===211)this.useBigInt64?t=this.readI64AsBigInt():t=this.readI64();else if(e===217){const s=this.lookU8();t=this.decodeString(s,1)}else if(e===218){const s=this.lookU16();t=this.decodeString(s,2)}else if(e===219){const s=this.lookU32();t=this.decodeString(s,4)}else if(e===220){const s=this.readU16();if(s!==0){this.pushArrayState(s),this.complete();continue e}else t=[]}else if(e===221){const s=this.readU32();if(s!==0){this.pushArrayState(s),this.complete();continue e}else t=[]}else if(e===222){const s=this.readU16();if(s!==0){this.pushMapState(s),this.complete();continue e}else t={}}else if(e===223){const s=this.readU32();if(s!==0){this.pushMapState(s),this.complete();continue e}else t={}}else if(e===196){const s=this.lookU8();t=this.decodeBinary(s,1)}else if(e===197){const s=this.lookU16();t=this.decodeBinary(s,2)}else if(e===198){const s=this.lookU32();t=this.decodeBinary(s,4)}else if(e===212)t=this.decodeExtension(1,0);else if(e===213)t=this.decodeExtension(2,0);else if(e===214)t=this.decodeExtension(4,0);else if(e===215)t=this.decodeExtension(8,0);else if(e===216)t=this.decodeExtension(16,0);else if(e===199){const s=this.lookU8();t=this.decodeExtension(s,1)}else if(e===200){const s=this.lookU16();t=this.decodeExtension(s,2)}else if(e===201){const s=this.lookU32();t=this.decodeExtension(s,4)}else throw new ir(`Unrecognized type byte: ${hf(e)}`);this.complete();const n=this.stack;for(;n.length>0;){const s=n.top();if(s.type===Gd)if(s.array[s.position]=t,s.position++,s.position===s.size)t=s.array,n.release(s);else continue e;else if(s.type===Oc){if(t==="__proto__")throw new ir("The key __proto__ is not allowed");s.key=this.mapKeyConverter(t),s.type=Fv;continue e}else if(s.map[s.key]=t,s.readCount++,s.readCount===s.size)t=s.map,n.release(s);else{s.key=null,s.type=Oc;continue e}}return t}}readHeadByte(){return this.headByte===ic&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=ic}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new ir(`Unrecognized array type byte: ${hf(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new ir(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new ir(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,t){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,t):this.decodeBinary(e,t)}decodeUtf8String(e,t){var i;if(e>this.maxStrLength)throw new ir(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+t+e)throw D0;const n=this.pos+t;let s;return this.stateIsMapKey()&&((i=this.keyDecoder)!=null&&i.canBeCached(e))?s=this.keyDecoder.decode(this.bytes,n,e):s=a8(this.bytes,n,e),this.pos+=t+e,s}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===Oc:!1}decodeBinary(e,t){if(e>this.maxBinLength)throw new ir(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+t))throw D0;const n=this.pos+t,s=this.bytes.subarray(n,n+e);return this.pos+=t+e,s}decodeExtension(e,t){if(e>this.maxExtLength)throw new ir(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const n=this.view.getInt8(this.pos+t),s=this.decodeBinary(e,t+1);return this.extensionCodec.decode(s,n,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=l8(this.view,this.pos);return this.pos+=8,e}readI64(){const e=$v(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}};function T8(r,e){return new _8(e).decode(r)}/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function N8(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function jv(r,e){return Array.isArray(e)?e.length===0?!0:r?e.every(t=>typeof t=="string"):e.every(t=>Number.isSafeInteger(t)):!1}function ku(r,e){if(typeof e!="string")throw new Error(`${r}: string expected`);return!0}function ng(r){if(!Number.isSafeInteger(r))throw new Error(`invalid integer: ${r}`)}function Qd(r){if(!Array.isArray(r))throw new Error("array expected")}function $u(r,e){if(!jv(!0,e))throw new Error(`${r}: array of strings expected`)}function R8(r,e){if(!jv(!1,e))throw new Error(`${r}: array of numbers expected`)}function U8(...r){const e=i=>i,t=(i,o)=>a=>i(o(a)),n=r.map(i=>i.encode).reduceRight(t,e),s=r.map(i=>i.decode).reduce(t,e);return{encode:n,decode:s}}function k8(r){const e=typeof r=="string"?r.split(""):r,t=e.length;$u("alphabet",e);const n=new Map(e.map((s,i)=>[s,i]));return{encode:s=>(Qd(s),s.map(i=>{if(!Number.isSafeInteger(i)||i<0||i>=t)throw new Error(`alphabet.encode: digit index outside alphabet "${i}". Allowed: ${r}`);return e[i]})),decode:s=>(Qd(s),s.map(i=>{ku("alphabet.decode",i);const o=n.get(i);if(o===void 0)throw new Error(`Unknown letter: "${i}". Allowed: ${r}`);return o}))}}function $8(r=""){return ku("join",r),{encode:e=>($u("join.decode",e),e.join(r)),decode:e=>(ku("join.decode",e),e.split(r))}}function L8(r,e="="){return ng(r),ku("padding",e),{encode(t){for($u("padding.encode",t);t.length*r%8;)t.push(e);return t},decode(t){$u("padding.decode",t);let n=t.length;if(n*r%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;n>0&&t[n-1]===e;n--)if((n-1)*r%8===0)throw new Error("padding: invalid, string has too much padding");return t.slice(0,n)}}}const zv=(r,e)=>e===0?r:zv(e,r%e),Lu=(r,e)=>r+(e-zv(r,e)),ff=(()=>{let r=[];for(let e=0;e<40;e++)r.push(2**e);return r})();function C0(r,e,t,n){if(Qd(r),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(t<=0||t>32)throw new Error(`convertRadix2: wrong to=${t}`);if(Lu(e,t)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${t} carryBits=${Lu(e,t)}`);let s=0,i=0;const o=ff[e],a=ff[t]-1,c=[];for(const l of r){if(ng(l),l>=o)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(s=s<<e|l,i+e>32)throw new Error(`convertRadix2: carry overflow pos=${i} from=${e}`);for(i+=e;i>=t;i-=t)c.push((s>>i-t&a)>>>0);const u=ff[i];if(u===void 0)throw new Error("invalid carry");s&=u-1}if(s=s<<t-i&a,!n&&i>=e)throw new Error("Excess padding");if(!n&&s>0)throw new Error(`Non-zero padding: ${s}`);return n&&i>0&&c.push(s>>>0),c}function F8(r,e=!1){if(ng(r),r<=0||r>32)throw new Error("radix2: bits should be in (0..32]");if(Lu(8,r)>32||Lu(r,8)>32)throw new Error("radix2: carry overflow");return{encode:t=>{if(!N8(t))throw new Error("radix2.encode input should be Uint8Array");return C0(Array.from(t),8,r,!e)},decode:t=>(R8("radix2.decode",t),Uint8Array.from(C0(t,r,8,e)))}}const M8=U8(F8(5),k8("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),L8(5),$8("")),j8=r=>JSON.stringify(r,(e,t)=>typeof t=="bigint"?t.toString()+"n":t),z8=r=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,t=r.replace(e,'$1"$2n"$3');return JSON.parse(t,(n,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function Zi(r){if(typeof r!="string")throw new Error(`Cannot safe json parse value of type ${typeof r}`);try{return z8(r)}catch{return r}}function rs(r){return typeof r=="string"?r:j8(r)||""}function H8(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Hv(r,...e){if(!H8(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function B0(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function q8(r,e){Hv(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const yo=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const df=r=>new DataView(r.buffer,r.byteOffset,r.byteLength);function V8(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function qv(r){return typeof r=="string"&&(r=V8(r)),Hv(r),r}let K8=class{clone(){return this._cloneInto()}};function G8(r){const e=n=>r().update(qv(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function Vv(r=32){if(yo&&typeof yo.getRandomValues=="function")return yo.getRandomValues(new Uint8Array(r));if(yo&&typeof yo.randomBytes=="function")return yo.randomBytes(r);throw new Error("crypto.getRandomValues must be defined")}function Q8(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(t>>s&i),a=Number(t&i),c=n?4:0,l=n?0:4;r.setUint32(e+c,o,n),r.setUint32(e+l,a,n)}let W8=class extends K8{constructor(e,t,n,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=df(this.buffer)}update(e){B0(this);const{view:t,buffer:n,blockLen:s}=this;e=qv(e);const i=e.length;for(let o=0;o<i;){const a=Math.min(s-this.pos,i-o);if(a===s){const c=df(e);for(;s<=i-o;o+=s)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){B0(this),q8(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:s,isLE:i}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(n,0),o=0);for(let h=o;h<s;h++)t[h]=0;Q8(n,s-8,BigInt(this.length*8),i),this.process(n,0);const a=df(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return e.length=s,e.pos=a,e.finished=i,e.destroyed=o,s%t&&e.buffer.set(n),e}};const jl=BigInt(2**32-1),Wd=BigInt(32);function Kv(r,e=!1){return e?{h:Number(r&jl),l:Number(r>>Wd&jl)}:{h:Number(r>>Wd&jl)|0,l:Number(r&jl)|0}}function J8(r,e=!1){let t=new Uint32Array(r.length),n=new Uint32Array(r.length);for(let s=0;s<r.length;s++){const{h:i,l:o}=Kv(r[s],e);[t[s],n[s]]=[i,o]}return[t,n]}const Y8=(r,e)=>BigInt(r>>>0)<<Wd|BigInt(e>>>0),Z8=(r,e,t)=>r>>>t,X8=(r,e,t)=>r<<32-t|e>>>t,eD=(r,e,t)=>r>>>t|e<<32-t,tD=(r,e,t)=>r<<32-t|e>>>t,rD=(r,e,t)=>r<<64-t|e>>>t-32,nD=(r,e,t)=>r>>>t-32|e<<64-t,sD=(r,e)=>e,iD=(r,e)=>r,oD=(r,e,t)=>r<<t|e>>>32-t,aD=(r,e,t)=>e<<t|r>>>32-t,cD=(r,e,t)=>e<<t-32|r>>>64-t,lD=(r,e,t)=>r<<t-32|e>>>64-t;function uD(r,e,t,n){const s=(e>>>0)+(n>>>0);return{h:r+t+(s/2**32|0)|0,l:s|0}}const hD=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),fD=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,dD=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),pD=(r,e,t,n,s)=>e+t+n+s+(r/2**32|0)|0,gD=(r,e,t,n,s)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(s>>>0),yD=(r,e,t,n,s,i)=>e+t+n+s+i+(r/2**32|0)|0,ae={fromBig:Kv,split:J8,toBig:Y8,shrSH:Z8,shrSL:X8,rotrSH:eD,rotrSL:tD,rotrBH:rD,rotrBL:nD,rotr32H:sD,rotr32L:iD,rotlSH:oD,rotlSL:aD,rotlBH:cD,rotlBL:lD,add:uD,add3L:hD,add3H:fD,add4L:dD,add4H:pD,add5H:yD,add5L:gD},[mD,wD]=ae.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),ls=new Uint32Array(80),us=new Uint32Array(80);let bD=class extends W8{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:n,Bl:s,Ch:i,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:f,Gh:d,Gl:p,Hh:g,Hl:m}=this;return[e,t,n,s,i,o,a,c,l,u,h,f,d,p,g,m]}set(e,t,n,s,i,o,a,c,l,u,h,f,d,p,g,m){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=f|0,this.Gh=d|0,this.Gl=p|0,this.Hh=g|0,this.Hl=m|0}process(e,t){for(let v=0;v<16;v++,t+=4)ls[v]=e.getUint32(t),us[v]=e.getUint32(t+=4);for(let v=16;v<80;v++){const S=ls[v-15]|0,I=us[v-15]|0,A=ae.rotrSH(S,I,1)^ae.rotrSH(S,I,8)^ae.shrSH(S,I,7),O=ae.rotrSL(S,I,1)^ae.rotrSL(S,I,8)^ae.shrSL(S,I,7),D=ls[v-2]|0,B=us[v-2]|0,L=ae.rotrSH(D,B,19)^ae.rotrBH(D,B,61)^ae.shrSH(D,B,6),j=ae.rotrSL(D,B,19)^ae.rotrBL(D,B,61)^ae.shrSL(D,B,6),$=ae.add4L(O,j,us[v-7],us[v-16]),U=ae.add4H($,A,L,ls[v-7],ls[v-16]);ls[v]=U|0,us[v]=$|0}let{Ah:n,Al:s,Bh:i,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:f,Fh:d,Fl:p,Gh:g,Gl:m,Hh:b,Hl:x}=this;for(let v=0;v<80;v++){const S=ae.rotrSH(h,f,14)^ae.rotrSH(h,f,18)^ae.rotrBH(h,f,41),I=ae.rotrSL(h,f,14)^ae.rotrSL(h,f,18)^ae.rotrBL(h,f,41),A=h&d^~h&g,O=f&p^~f&m,D=ae.add5L(x,I,O,wD[v],us[v]),B=ae.add5H(D,b,S,A,mD[v],ls[v]),L=D|0,j=ae.rotrSH(n,s,28)^ae.rotrBH(n,s,34)^ae.rotrBH(n,s,39),$=ae.rotrSL(n,s,28)^ae.rotrBL(n,s,34)^ae.rotrBL(n,s,39),U=n&i^n&a^i&a,T=s&o^s&c^o&c;b=g|0,x=m|0,g=d|0,m=p|0,d=h|0,p=f|0,{h,l:f}=ae.add(l|0,u|0,B|0,L|0),l=a|0,u=c|0,a=i|0,c=o|0,i=n|0,o=s|0;const w=ae.add3L(L,$,T);n=ae.add3H(w,B,j,U),s=w|0}({h:n,l:s}=ae.add(this.Ah|0,this.Al|0,n|0,s|0)),{h:i,l:o}=ae.add(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=ae.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=ae.add(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:f}=ae.add(this.Eh|0,this.El|0,h|0,f|0),{h:d,l:p}=ae.add(this.Fh|0,this.Fl|0,d|0,p|0),{h:g,l:m}=ae.add(this.Gh|0,this.Gl|0,g|0,m|0),{h:b,l:x}=ae.add(this.Hh|0,this.Hl|0,b|0,x|0),this.set(n,s,i,o,a,c,l,u,h,f,d,p,g,m,b,x)}roundClean(){ls.fill(0),us.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const vD=G8(()=>new bD);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const sg=BigInt(0),Gv=BigInt(1),ED=BigInt(2);function ig(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function og(r){if(!ig(r))throw new Error("Uint8Array expected")}function pf(r,e){if(typeof e!="boolean")throw new Error(r+" boolean expected, got "+e)}const AD=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function ag(r){og(r);let e="";for(let t=0;t<r.length;t++)e+=AD[r[t]];return e}function Qv(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?sg:BigInt("0x"+r)}const xn={_0:48,_9:57,A:65,F:70,a:97,f:102};function _0(r){if(r>=xn._0&&r<=xn._9)return r-xn._0;if(r>=xn.A&&r<=xn.F)return r-(xn.A-10);if(r>=xn.a&&r<=xn.f)return r-(xn.a-10)}function Wv(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);const e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(t);for(let s=0,i=0;s<t;s++,i+=2){const o=_0(r.charCodeAt(i)),a=_0(r.charCodeAt(i+1));if(o===void 0||a===void 0){const c=r[i]+r[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[s]=o*16+a}return n}function xD(r){return Qv(ag(r))}function pu(r){return og(r),Qv(ag(Uint8Array.from(r).reverse()))}function Jv(r,e){return Wv(r.toString(16).padStart(e*2,"0"))}function Jd(r,e){return Jv(r,e).reverse()}function In(r,e,t){let n;if(typeof e=="string")try{n=Wv(e)}catch(i){throw new Error(r+" must be hex string or Uint8Array, cause: "+i)}else if(ig(e))n=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");const s=n.length;if(typeof t=="number"&&s!==t)throw new Error(r+" of length "+t+" expected, got "+s);return n}function T0(...r){let e=0;for(let n=0;n<r.length;n++){const s=r[n];og(s),e+=s.length}const t=new Uint8Array(e);for(let n=0,s=0;n<r.length;n++){const i=r[n];t.set(i,s),s+=i.length}return t}const gf=r=>typeof r=="bigint"&&sg<=r;function ID(r,e,t){return gf(r)&&gf(e)&&gf(t)&&e<=r&&r<t}function oc(r,e,t,n){if(!ID(e,t,n))throw new Error("expected valid "+r+": "+t+" <= n < "+n+", got "+e)}function SD(r){let e;for(e=0;r>sg;r>>=Gv,e+=1);return e}const PD=r=>(ED<<BigInt(r-1))-Gv,OD={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||ig(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function cg(r,e,t={}){const n=(s,i,o)=>{const a=OD[i];if(typeof a!="function")throw new Error("invalid validator function");const c=r[s];if(!(o&&c===void 0)&&!a(c,r))throw new Error("param "+String(s)+" is invalid. Expected "+i+", got "+c)};for(const[s,i]of Object.entries(e))n(s,i,!1);for(const[s,i]of Object.entries(t))n(s,i,!0);return r}function N0(r){const e=new WeakMap;return(t,...n)=>{const s=e.get(t);if(s!==void 0)return s;const i=r(t,...n);return e.set(t,i),i}}const rt=BigInt(0),je=BigInt(1),hi=BigInt(2),DD=BigInt(3),Yd=BigInt(4),R0=BigInt(5),U0=BigInt(8);function Qe(r,e){const t=r%e;return t>=rt?t:e+t}function CD(r,e,t){if(e<rt)throw new Error("invalid exponent, negatives unsupported");if(t<=rt)throw new Error("invalid modulus");if(t===je)return rt;let n=je;for(;e>rt;)e&je&&(n=n*r%t),r=r*r%t,e>>=je;return n}function Gr(r,e,t){let n=r;for(;e-- >rt;)n*=n,n%=t;return n}function k0(r,e){if(r===rt)throw new Error("invert: expected non-zero number");if(e<=rt)throw new Error("invert: expected positive modulus, got "+e);let t=Qe(r,e),n=e,s=rt,i=je;for(;t!==rt;){const o=n/t,a=n%t,c=s-i*o;n=t,t=a,s=i,i=c}if(n!==je)throw new Error("invert: does not exist");return Qe(s,e)}function BD(r){const e=(r-je)/hi;let t,n,s;for(t=r-je,n=0;t%hi===rt;t/=hi,n++);for(s=hi;s<r&&CD(s,e,r)!==r-je;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(r+je)/Yd;return function(a,c){const l=a.pow(c,o);if(!a.eql(a.sqr(l),c))throw new Error("Cannot find square root");return l}}const i=(t+je)/hi;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=n,l=o.pow(o.mul(o.ONE,s),t),u=o.pow(a,i),h=o.pow(a,t);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let f=1;for(let p=o.sqr(h);f<c&&!o.eql(p,o.ONE);f++)p=o.sqr(p);const d=o.pow(l,je<<BigInt(c-f-1));l=o.sqr(d),u=o.mul(u,d),h=o.mul(h,l),c=f}return u}}function _D(r){if(r%Yd===DD){const e=(r+je)/Yd;return function(t,n){const s=t.pow(n,e);if(!t.eql(t.sqr(s),n))throw new Error("Cannot find square root");return s}}if(r%U0===R0){const e=(r-R0)/U0;return function(t,n){const s=t.mul(n,hi),i=t.pow(s,e),o=t.mul(n,i),a=t.mul(t.mul(o,hi),i),c=t.mul(o,t.sub(a,t.ONE));if(!t.eql(t.sqr(c),n))throw new Error("Cannot find square root");return c}}return BD(r)}const TD=(r,e)=>(Qe(r,e)&je)===je,ND=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function RD(r){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=ND.reduce((n,s)=>(n[s]="function",n),e);return cg(r,t)}function UD(r,e,t){if(t<rt)throw new Error("invalid exponent, negatives unsupported");if(t===rt)return r.ONE;if(t===je)return e;let n=r.ONE,s=e;for(;t>rt;)t&je&&(n=r.mul(n,s)),s=r.sqr(s),t>>=je;return n}function kD(r,e){const t=new Array(e.length),n=e.reduce((i,o,a)=>r.is0(o)?i:(t[a]=i,r.mul(i,o)),r.ONE),s=r.inv(n);return e.reduceRight((i,o,a)=>r.is0(o)?i:(t[a]=r.mul(i,t[a]),r.mul(i,o)),s),t}function Yv(r,e){const t=e!==void 0?e:r.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}function Zv(r,e,t=!1,n={}){if(r<=rt)throw new Error("invalid field: expected ORDER > 0, got "+r);const{nBitLength:s,nByteLength:i}=Yv(r,e);if(i>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:r,isLE:t,BITS:s,BYTES:i,MASK:PD(s),ZERO:rt,ONE:je,create:c=>Qe(c,r),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return rt<=c&&c<r},is0:c=>c===rt,isOdd:c=>(c&je)===je,neg:c=>Qe(-c,r),eql:(c,l)=>c===l,sqr:c=>Qe(c*c,r),add:(c,l)=>Qe(c+l,r),sub:(c,l)=>Qe(c-l,r),mul:(c,l)=>Qe(c*l,r),pow:(c,l)=>UD(a,c,l),div:(c,l)=>Qe(c*k0(l,r),r),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>k0(c,r),sqrt:n.sqrt||(c=>(o||(o=_D(r)),o(a,c))),invertBatch:c=>kD(a,c),cmov:(c,l,u)=>u?l:c,toBytes:c=>t?Jd(c,i):Jv(c,i),fromBytes:c=>{if(c.length!==i)throw new Error("Field.fromBytes: expected "+i+" bytes, got "+c.length);return t?pu(c):xD(c)}});return Object.freeze(a)}const $0=BigInt(0),zl=BigInt(1);function yf(r,e){const t=e.negate();return r?t:e}function Xv(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function mf(r,e){Xv(r,e);const t=Math.ceil(e/r)+1,n=2**(r-1);return{windows:t,windowSize:n}}function $D(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,n)=>{if(!(t instanceof e))throw new Error("invalid point at index "+n)})}function LD(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,n)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+n)})}const wf=new WeakMap,eE=new WeakMap;function bf(r){return eE.get(r)||1}function FD(r,e){return{constTimeNegate:yf,hasPrecomputes(t){return bf(t)!==1},unsafeLadder(t,n,s=r.ZERO){let i=t;for(;n>$0;)n&zl&&(s=s.add(i)),i=i.double(),n>>=zl;return s},precomputeWindow(t,n){const{windows:s,windowSize:i}=mf(n,e),o=[];let a=t,c=a;for(let l=0;l<s;l++){c=a,o.push(c);for(let u=1;u<i;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(t,n,s){const{windows:i,windowSize:o}=mf(t,e);let a=r.ZERO,c=r.BASE;const l=BigInt(2**t-1),u=2**t,h=BigInt(t);for(let f=0;f<i;f++){const d=f*o;let p=Number(s&l);s>>=h,p>o&&(p-=u,s+=zl);const g=d,m=d+Math.abs(p)-1,b=f%2!==0,x=p<0;p===0?c=c.add(yf(b,n[g])):a=a.add(yf(x,n[m]))}return{p:a,f:c}},wNAFUnsafe(t,n,s,i=r.ZERO){const{windows:o,windowSize:a}=mf(t,e),c=BigInt(2**t-1),l=2**t,u=BigInt(t);for(let h=0;h<o;h++){const f=h*a;if(s===$0)break;let d=Number(s&c);if(s>>=u,d>a&&(d-=l,s+=zl),d===0)continue;let p=n[f+Math.abs(d)-1];d<0&&(p=p.negate()),i=i.add(p)}return i},getPrecomputes(t,n,s){let i=wf.get(n);return i||(i=this.precomputeWindow(n,t),t!==1&&wf.set(n,s(i))),i},wNAFCached(t,n,s){const i=bf(t);return this.wNAF(i,this.getPrecomputes(i,t,s),n)},wNAFCachedUnsafe(t,n,s,i){const o=bf(t);return o===1?this.unsafeLadder(t,n,i):this.wNAFUnsafe(o,this.getPrecomputes(o,t,s),n,i)},setWindowSize(t,n){Xv(n,e),eE.set(t,n),wf.delete(t)}}}function MD(r,e,t,n){if($D(t,r),LD(n,e),t.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const s=r.ZERO,i=SD(BigInt(t.length)),o=i>12?i-3:i>4?i-2:i?2:1,a=(1<<o)-1,c=new Array(a+1).fill(s),l=Math.floor((e.BITS-1)/o)*o;let u=s;for(let h=l;h>=0;h-=o){c.fill(s);for(let d=0;d<n.length;d++){const p=n[d],g=Number(p>>BigInt(h)&BigInt(a));c[g]=c[g].add(t[d])}let f=s;for(let d=c.length-1,p=s;d>0;d--)p=p.add(c[d]),f=f.add(p);if(u=u.add(f),h!==0)for(let d=0;d<o;d++)u=u.double()}return u}function jD(r){return RD(r.Fp),cg(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...Yv(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}const Pr=BigInt(0),Ut=BigInt(1),Hl=BigInt(2),zD=BigInt(8),HD={zip215:!0};function qD(r){const e=jD(r);return cg(r,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function VD(r){const e=qD(r),{Fp:t,n,prehash:s,hash:i,randomBytes:o,nByteLength:a,h:c}=e,l=Hl<<BigInt(a*8)-Ut,u=t.create,h=Zv(e.n,e.nBitLength),f=e.uvRatio||((w,E)=>{try{return{isValid:!0,value:t.sqrt(w*t.inv(E))}}catch{return{isValid:!1,value:Pr}}}),d=e.adjustScalarBytes||(w=>w),p=e.domain||((w,E,C)=>{if(pf("phflag",C),E.length||C)throw new Error("Contexts/pre-hash are not supported");return w});function g(w,E){oc("coordinate "+w,E,Pr,l)}function m(w){if(!(w instanceof v))throw new Error("ExtendedPoint expected")}const b=N0((w,E)=>{const{ex:C,ey:k,ez:_}=w,N=w.is0();E==null&&(E=N?zD:t.inv(_));const z=u(C*E),H=u(k*E),Y=u(_*E);if(N)return{x:Pr,y:Ut};if(Y!==Ut)throw new Error("invZ was invalid");return{x:z,y:H}}),x=N0(w=>{const{a:E,d:C}=e;if(w.is0())throw new Error("bad point: ZERO");const{ex:k,ey:_,ez:N,et:z}=w,H=u(k*k),Y=u(_*_),G=u(N*N),Q=u(G*G),ee=u(H*E),se=u(G*u(ee+Y)),le=u(Q+u(C*u(H*Y)));if(se!==le)throw new Error("bad point: equation left != right (1)");const ne=u(k*_),fe=u(N*z);if(ne!==fe)throw new Error("bad point: equation left != right (2)");return!0});class v{constructor(E,C,k,_){this.ex=E,this.ey=C,this.ez=k,this.et=_,g("x",E),g("y",C),g("z",k),g("t",_),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(E){if(E instanceof v)throw new Error("extended point not allowed");const{x:C,y:k}=E||{};return g("x",C),g("y",k),new v(C,k,Ut,u(C*k))}static normalizeZ(E){const C=t.invertBatch(E.map(k=>k.ez));return E.map((k,_)=>k.toAffine(C[_])).map(v.fromAffine)}static msm(E,C){return MD(v,h,E,C)}_setWindowSize(E){A.setWindowSize(this,E)}assertValidity(){x(this)}equals(E){m(E);const{ex:C,ey:k,ez:_}=this,{ex:N,ey:z,ez:H}=E,Y=u(C*H),G=u(N*_),Q=u(k*H),ee=u(z*_);return Y===G&&Q===ee}is0(){return this.equals(v.ZERO)}negate(){return new v(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:E}=e,{ex:C,ey:k,ez:_}=this,N=u(C*C),z=u(k*k),H=u(Hl*u(_*_)),Y=u(E*N),G=C+k,Q=u(u(G*G)-N-z),ee=Y+z,se=ee-H,le=Y-z,ne=u(Q*se),fe=u(ee*le),Re=u(Q*le),ze=u(se*ee);return new v(ne,fe,ze,Re)}add(E){m(E);const{a:C,d:k}=e,{ex:_,ey:N,ez:z,et:H}=this,{ex:Y,ey:G,ez:Q,et:ee}=E;if(C===BigInt(-1)){const $g=u((N-_)*(G+Y)),Lg=u((N+_)*(G-Y)),Lh=u(Lg-$g);if(Lh===Pr)return this.double();const Fg=u(z*Hl*ee),Mg=u(H*Hl*Q),jg=Mg+Fg,zg=Lg+$g,Hg=Mg-Fg,vA=u(jg*Lh),EA=u(zg*Hg),AA=u(jg*Hg),xA=u(Lh*zg);return new v(vA,EA,xA,AA)}const se=u(_*Y),le=u(N*G),ne=u(H*k*ee),fe=u(z*Q),Re=u((_+N)*(Y+G)-se-le),ze=fe-ne,Ue=fe+ne,pt=u(le-C*se),lo=u(Re*ze),Dl=u(Ue*pt),wA=u(Re*pt),bA=u(ze*Ue);return new v(lo,Dl,bA,wA)}subtract(E){return this.add(E.negate())}wNAF(E){return A.wNAFCached(this,E,v.normalizeZ)}multiply(E){const C=E;oc("scalar",C,Ut,n);const{p:k,f:_}=this.wNAF(C);return v.normalizeZ([k,_])[0]}multiplyUnsafe(E,C=v.ZERO){const k=E;return oc("scalar",k,Pr,n),k===Pr?I:this.is0()||k===Ut?this:A.wNAFCachedUnsafe(this,k,v.normalizeZ,C)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return A.unsafeLadder(this,n).is0()}toAffine(E){return b(this,E)}clearCofactor(){const{h:E}=e;return E===Ut?this:this.multiplyUnsafe(E)}static fromHex(E,C=!1){const{d:k,a:_}=e,N=t.BYTES;E=In("pointHex",E,N),pf("zip215",C);const z=E.slice(),H=E[N-1];z[N-1]=H&-129;const Y=pu(z),G=C?l:t.ORDER;oc("pointHex.y",Y,Pr,G);const Q=u(Y*Y),ee=u(Q-Ut),se=u(k*Q-_);let{isValid:le,value:ne}=f(ee,se);if(!le)throw new Error("Point.fromHex: invalid y coordinate");const fe=(ne&Ut)===Ut,Re=(H&128)!==0;if(!C&&ne===Pr&&Re)throw new Error("Point.fromHex: x=0 and x_0=1");return Re!==fe&&(ne=u(-ne)),v.fromAffine({x:ne,y:Y})}static fromPrivateKey(E){return B(E).point}toRawBytes(){const{x:E,y:C}=this.toAffine(),k=Jd(C,t.BYTES);return k[k.length-1]|=E&Ut?128:0,k}toHex(){return ag(this.toRawBytes())}}v.BASE=new v(e.Gx,e.Gy,Ut,u(e.Gx*e.Gy)),v.ZERO=new v(Pr,Ut,Ut,Pr);const{BASE:S,ZERO:I}=v,A=FD(v,a*8);function O(w){return Qe(w,n)}function D(w){return O(pu(w))}function B(w){const E=t.BYTES;w=In("private key",w,E);const C=In("hashed private key",i(w),2*E),k=d(C.slice(0,E)),_=C.slice(E,2*E),N=D(k),z=S.multiply(N),H=z.toRawBytes();return{head:k,prefix:_,scalar:N,point:z,pointBytes:H}}function L(w){return B(w).pointBytes}function j(w=new Uint8Array,...E){const C=T0(...E);return D(i(p(C,In("context",w),!!s)))}function $(w,E,C={}){w=In("message",w),s&&(w=s(w));const{prefix:k,scalar:_,pointBytes:N}=B(E),z=j(C.context,k,w),H=S.multiply(z).toRawBytes(),Y=j(C.context,H,N,w),G=O(z+Y*_);oc("signature.s",G,Pr,n);const Q=T0(H,Jd(G,t.BYTES));return In("result",Q,t.BYTES*2)}const U=HD;function T(w,E,C,k=U){const{context:_,zip215:N}=k,z=t.BYTES;w=In("signature",w,2*z),E=In("message",E),C=In("publicKey",C,z),N!==void 0&&pf("zip215",N),s&&(E=s(E));const H=pu(w.slice(z,2*z));let Y,G,Q;try{Y=v.fromHex(C,N),G=v.fromHex(w.slice(0,z),N),Q=S.multiplyUnsafe(H)}catch{return!1}if(!N&&Y.isSmallOrder())return!1;const ee=j(_,G.toRawBytes(),Y.toRawBytes(),E);return G.add(Y.multiplyUnsafe(ee)).subtract(Q).clearCofactor().equals(v.ZERO)}return S._setWindowSize(8),{CURVE:e,getPublicKey:L,sign:$,verify:T,ExtendedPoint:v,utils:{getExtendedPublicKey:B,randomPrivateKey:()=>o(t.BYTES),precompute(w=8,E=v.BASE){return E._setWindowSize(w),E.multiply(BigInt(3)),E}}}}BigInt(0),BigInt(1);const lg=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),L0=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const KD=BigInt(1),F0=BigInt(2);BigInt(3);const GD=BigInt(5),QD=BigInt(8);function WD(r){const e=BigInt(10),t=BigInt(20),n=BigInt(40),s=BigInt(80),i=lg,o=r*r%i*r%i,a=Gr(o,F0,i)*o%i,c=Gr(a,KD,i)*r%i,l=Gr(c,GD,i)*c%i,u=Gr(l,e,i)*l%i,h=Gr(u,t,i)*u%i,f=Gr(h,n,i)*h%i,d=Gr(f,s,i)*f%i,p=Gr(d,s,i)*f%i,g=Gr(p,e,i)*l%i;return{pow_p_5_8:Gr(g,F0,i)*r%i,b2:o}}function JD(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function YD(r,e){const t=lg,n=Qe(e*e*e,t),s=Qe(n*n*e,t),i=WD(r*s).pow_p_5_8;let o=Qe(r*n*i,t);const a=Qe(e*o*o,t),c=o,l=Qe(o*L0,t),u=a===r,h=a===Qe(-r,t),f=a===Qe(-r*L0,t);return u&&(o=c),(h||f)&&(o=l),TD(o,t)&&(o=Qe(-o,t)),{isValid:u||h,value:o}}const ZD=Zv(lg,void 0,!0),XD={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:ZD,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:QD,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:vD,randomBytes:Vv,adjustScalarBytes:JD,uvRatio:YD},tE=VD(XD),eC="EdDSA",tC="JWT",Fu=".",vh="base64url",rE="utf8",nE="utf8",rC=":",nC="did",sC="key",M0="base58btc",iC="z",oC="K36",aC=32;function ug(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function sE(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?ug(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function iE(r,e){e||(e=r.reduce((s,i)=>s+i.length,0));const t=sE(e);let n=0;for(const s of r)t.set(s,n),n+=s.length;return ug(t)}function cC(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,m=0,b=0,x=p.length;b!==x&&p[b]===0;)b++,g++;for(var v=(x-b)*u+1>>>0,S=new Uint8Array(v);b!==x;){for(var I=p[b],A=0,O=v-1;(I!==0||A<m)&&O!==-1;O--,A++)I+=256*S[O]>>>0,S[O]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");m=A,b++}for(var D=v-m;D!==v&&S[D]===0;)D++;for(var B=c.repeat(g);D<v;++D)B+=r.charAt(S[D]);return B}function f(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var m=0,b=0;p[g]===c;)m++,g++;for(var x=(p.length-g)*l+1>>>0,v=new Uint8Array(x);p[g];){var S=t[p.charCodeAt(g)];if(S===255)return;for(var I=0,A=x-1;(S!==0||I<b)&&A!==-1;A--,I++)S+=a*v[A]>>>0,v[A]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");b=I,g++}if(p[g]!==" "){for(var O=x-b;O!==x&&v[O]===0;)O++;for(var D=new Uint8Array(m+(x-O)),B=m;O!==x;)D[B++]=v[O++];return D}}}function d(p){var g=f(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:d}}var lC=cC,uC=lC;const oE=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},hC=r=>new TextEncoder().encode(r),fC=r=>new TextDecoder().decode(r);let dC=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},pC=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return aE(this,e)}},gC=class{constructor(e){this.decoders=e}or(e){return aE(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const aE=(r,e)=>new gC({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let yC=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new dC(e,t,n),this.decoder=new pC(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Eh=({name:r,prefix:e,encode:t,decode:n})=>new yC(r,e,t,n),ml=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=uC(t,e);return Eh({prefix:r,name:e,encode:n,decode:i=>oE(s(i))})},mC=(r,e,t,n)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const h=s[r[u]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},wC=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},ht=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>Eh({prefix:e,name:r,encode(s){return wC(s,n,t)},decode(s){return mC(s,n,t,r)}}),bC=Eh({prefix:"\0",name:"identity",encode:r=>fC(r),decode:r=>hC(r)});var vC=Object.freeze({__proto__:null,identity:bC});const EC=ht({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var AC=Object.freeze({__proto__:null,base2:EC});const xC=ht({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var IC=Object.freeze({__proto__:null,base8:xC});const SC=ml({prefix:"9",name:"base10",alphabet:"0123456789"});var PC=Object.freeze({__proto__:null,base10:SC});const OC=ht({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),DC=ht({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var CC=Object.freeze({__proto__:null,base16:OC,base16upper:DC});const BC=ht({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),_C=ht({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),TC=ht({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),NC=ht({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),RC=ht({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),UC=ht({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),kC=ht({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),$C=ht({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),LC=ht({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var FC=Object.freeze({__proto__:null,base32:BC,base32upper:_C,base32pad:TC,base32padupper:NC,base32hex:RC,base32hexupper:UC,base32hexpad:kC,base32hexpadupper:$C,base32z:LC});const MC=ml({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),jC=ml({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var zC=Object.freeze({__proto__:null,base36:MC,base36upper:jC});const HC=ml({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),qC=ml({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var VC=Object.freeze({__proto__:null,base58btc:HC,base58flickr:qC});const KC=ht({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),GC=ht({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),QC=ht({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),WC=ht({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var JC=Object.freeze({__proto__:null,base64:KC,base64pad:GC,base64url:QC,base64urlpad:WC});const cE=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),YC=cE.reduce((r,e,t)=>(r[t]=e,r),[]),ZC=cE.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function XC(r){return r.reduce((e,t)=>(e+=YC[t],e),"")}function eB(r){const e=[];for(const t of r){const n=ZC[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const tB=Eh({prefix:"🚀",name:"base256emoji",encode:XC,decode:eB});var rB=Object.freeze({__proto__:null,base256emoji:tB}),nB=lE,j0=128,sB=-128,iB=Math.pow(2,31);function lE(r,e,t){e=e||[],t=t||0;for(var n=t;r>=iB;)e[t++]=r&255|j0,r/=128;for(;r&sB;)e[t++]=r&255|j0,r>>>=7;return e[t]=r|0,lE.bytes=t-n+1,e}var oB=Zd,aB=128,z0=127;function Zd(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw Zd.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&z0)<<s:(o&z0)*Math.pow(2,s),s+=7}while(o>=aB);return Zd.bytes=i-n,t}var cB=Math.pow(2,7),lB=Math.pow(2,14),uB=Math.pow(2,21),hB=Math.pow(2,28),fB=Math.pow(2,35),dB=Math.pow(2,42),pB=Math.pow(2,49),gB=Math.pow(2,56),yB=Math.pow(2,63),mB=function(r){return r<cB?1:r<lB?2:r<uB?3:r<hB?4:r<fB?5:r<dB?6:r<pB?7:r<gB?8:r<yB?9:10},wB={encode:nB,decode:oB,encodingLength:mB},uE=wB;const H0=(r,e,t=0)=>(uE.encode(r,e,t),e),q0=r=>uE.encodingLength(r),Xd=(r,e)=>{const t=e.byteLength,n=q0(r),s=n+q0(t),i=new Uint8Array(s+t);return H0(r,i,0),H0(t,i,n),i.set(e,s),new bB(r,t,e,i)};let bB=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};const hE=({name:r,code:e,encode:t})=>new vB(r,e,t);let vB=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Xd(this.code,t):t.then(n=>Xd(this.code,n))}else throw Error("Unknown type, must be binary type")}};const fE=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),EB=hE({name:"sha2-256",code:18,encode:fE("SHA-256")}),AB=hE({name:"sha2-512",code:19,encode:fE("SHA-512")});var xB=Object.freeze({__proto__:null,sha256:EB,sha512:AB});const dE=0,IB="identity",pE=oE,SB=r=>Xd(dE,pE(r)),PB={code:dE,name:IB,encode:pE,digest:SB};var OB=Object.freeze({__proto__:null,identity:PB});new TextEncoder,new TextDecoder;const V0={...vC,...AC,...IC,...PC,...CC,...FC,...zC,...VC,...JC,...rB};({...xB,...OB});function gE(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}const K0=gE("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),vf=gE("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=sE(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),yE={utf8:K0,"utf-8":K0,hex:V0.base16,latin1:vf,ascii:vf,binary:vf,...V0};function Ah(r,e="utf8"){const t=yE[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}function Ka(r,e="utf8"){const t=yE[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?ug(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}function G0(r){return Zi(Ah(Ka(r,vh),rE))}function Mu(r){return Ah(Ka(rs(r),rE),vh)}function mE(r){const e=Ka(oC,M0),t=iC+Ah(iE([e,r]),M0);return[nC,sC,t].join(rC)}function DB(r){return Ah(r,vh)}function CB(r){return Ka(r,vh)}function BB(r){return Ka([Mu(r.header),Mu(r.payload)].join(Fu),nE)}function _B(r){return[Mu(r.header),Mu(r.payload),DB(r.signature)].join(Fu)}function ep(r){const e=r.split(Fu),t=G0(e[0]),n=G0(e[1]),s=CB(e[2]),i=Ka(e.slice(0,2).join(Fu),nE);return{header:t,payload:n,signature:s,data:i}}function Q0(r=Vv(aC)){const e=tE.getPublicKey(r);return{secretKey:iE([r,e]),publicKey:e}}async function TB(r,e,t,n,s=J.fromMiliseconds(Date.now())){const i={alg:eC,typ:tC},o=mE(n.publicKey),a=s+t,c={iss:o,sub:r,aud:e,iat:s,exp:a},l=BB({header:i,payload:c}),u=tE.sign(l,n.secretKey.slice(0,32));return _B({header:i,payload:c,signature:u})}function hg(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function wE(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?hg(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function Dc(r,e){e||(e=r.reduce((s,i)=>s+i.length,0));const t=wE(e);let n=0;for(const s of r)t.set(s,n),n+=s.length;return hg(t)}function NB(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,m=0,b=0,x=p.length;b!==x&&p[b]===0;)b++,g++;for(var v=(x-b)*u+1>>>0,S=new Uint8Array(v);b!==x;){for(var I=p[b],A=0,O=v-1;(I!==0||A<m)&&O!==-1;O--,A++)I+=256*S[O]>>>0,S[O]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");m=A,b++}for(var D=v-m;D!==v&&S[D]===0;)D++;for(var B=c.repeat(g);D<v;++D)B+=r.charAt(S[D]);return B}function f(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var m=0,b=0;p[g]===c;)m++,g++;for(var x=(p.length-g)*l+1>>>0,v=new Uint8Array(x);p[g];){var S=t[p.charCodeAt(g)];if(S===255)return;for(var I=0,A=x-1;(S!==0||I<b)&&A!==-1;A--,I++)S+=a*v[A]>>>0,v[A]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");b=I,g++}if(p[g]!==" "){for(var O=x-b;O!==x&&v[O]===0;)O++;for(var D=new Uint8Array(m+(x-O)),B=m;O!==x;)D[B++]=v[O++];return D}}}function d(p){var g=f(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:d}}var RB=NB,UB=RB;const kB=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},$B=r=>new TextEncoder().encode(r),LB=r=>new TextDecoder().decode(r);class FB{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class MB{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return bE(this,e)}}class jB{constructor(e){this.decoders=e}or(e){return bE(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const bE=(r,e)=>new jB({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class zB{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new FB(e,t,n),this.decoder=new MB(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const xh=({name:r,prefix:e,encode:t,decode:n})=>new zB(r,e,t,n),wl=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=UB(t,e);return xh({prefix:r,name:e,encode:n,decode:i=>kB(s(i))})},HB=(r,e,t,n)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const h=s[r[u]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},qB=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},ft=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>xh({prefix:e,name:r,encode(s){return qB(s,n,t)},decode(s){return HB(s,n,t,r)}}),VB=xh({prefix:"\0",name:"identity",encode:r=>LB(r),decode:r=>$B(r)}),KB=Object.freeze(Object.defineProperty({__proto__:null,identity:VB},Symbol.toStringTag,{value:"Module"})),GB=ft({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),QB=Object.freeze(Object.defineProperty({__proto__:null,base2:GB},Symbol.toStringTag,{value:"Module"})),WB=ft({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),JB=Object.freeze(Object.defineProperty({__proto__:null,base8:WB},Symbol.toStringTag,{value:"Module"})),YB=wl({prefix:"9",name:"base10",alphabet:"0123456789"}),ZB=Object.freeze(Object.defineProperty({__proto__:null,base10:YB},Symbol.toStringTag,{value:"Module"})),XB=ft({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),e_=ft({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),t_=Object.freeze(Object.defineProperty({__proto__:null,base16:XB,base16upper:e_},Symbol.toStringTag,{value:"Module"})),r_=ft({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),n_=ft({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),s_=ft({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),i_=ft({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),o_=ft({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),a_=ft({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),c_=ft({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),l_=ft({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),u_=ft({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),h_=Object.freeze(Object.defineProperty({__proto__:null,base32:r_,base32hex:o_,base32hexpad:c_,base32hexpadupper:l_,base32hexupper:a_,base32pad:s_,base32padupper:i_,base32upper:n_,base32z:u_},Symbol.toStringTag,{value:"Module"})),f_=wl({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),d_=wl({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),p_=Object.freeze(Object.defineProperty({__proto__:null,base36:f_,base36upper:d_},Symbol.toStringTag,{value:"Module"})),g_=wl({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),y_=wl({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),m_=Object.freeze(Object.defineProperty({__proto__:null,base58btc:g_,base58flickr:y_},Symbol.toStringTag,{value:"Module"})),w_=ft({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),b_=ft({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),v_=ft({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),E_=ft({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),A_=Object.freeze(Object.defineProperty({__proto__:null,base64:w_,base64pad:b_,base64url:v_,base64urlpad:E_},Symbol.toStringTag,{value:"Module"})),vE=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),x_=vE.reduce((r,e,t)=>(r[t]=e,r),[]),I_=vE.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function S_(r){return r.reduce((e,t)=>(e+=x_[t],e),"")}function P_(r){const e=[];for(const t of r){const n=I_[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const O_=xh({prefix:"🚀",name:"base256emoji",encode:S_,decode:P_}),D_=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:O_},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const W0={...KB,...QB,...JB,...ZB,...t_,...h_,...p_,...m_,...A_,...D_};function EE(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}const J0=EE("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),Ef=EE("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=wE(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),AE={utf8:J0,"utf-8":J0,hex:W0.base16,latin1:Ef,ascii:Ef,binary:Ef,...W0};function xr(r,e="utf8"){const t=AE[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?hg(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}function Gt(r,e="utf8"){const t=AE[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}const C_={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var Af,Y0;function xE(){if(Y0)return Af;Y0=1;const r="Input must be an string, Buffer or Uint8Array";function e(o){let a;if(o instanceof Uint8Array)a=o;else if(typeof o=="string")a=new TextEncoder().encode(o);else throw new Error(r);return a}function t(o){return Array.prototype.map.call(o,function(a){return(a<16?"0":"")+a.toString(16)}).join("")}function n(o){return(4294967296+o).toString(16).substring(1)}function s(o,a,c){let l=`
`+o+" = ";for(let u=0;u<a.length;u+=2){if(c===32)l+=n(a[u]).toUpperCase(),l+=" ",l+=n(a[u+1]).toUpperCase();else if(c===64)l+=n(a[u+1]).toUpperCase(),l+=n(a[u]).toUpperCase();else throw new Error("Invalid size "+c);u%6===4?l+=`
`+new Array(o.length+4).join(" "):u<a.length-2&&(l+=" ")}console.log(l)}function i(o,a,c){let l=new Date().getTime();const u=new Uint8Array(a);for(let f=0;f<a;f++)u[f]=f%256;const h=new Date().getTime();console.log("Generated random input in "+(h-l)+"ms"),l=h;for(let f=0;f<c;f++){const d=o(u),p=new Date().getTime(),g=p-l;l=p,console.log("Hashed in "+g+"ms: "+d.substring(0,20)+"..."),console.log(Math.round(a/(1<<20)/(g/1e3)*100)/100+" MB PER SECOND")}}return Af={normalizeInput:e,toHex:t,debugPrint:s,testSpeed:i},Af}var xf,Z0;function B_(){if(Z0)return xf;Z0=1;const r=xE();function e(b,x,v){const S=b[x]+b[v];let I=b[x+1]+b[v+1];S>=4294967296&&I++,b[x]=S,b[x+1]=I}function t(b,x,v,S){let I=b[x]+v;v<0&&(I+=4294967296);let A=b[x+1]+S;I>=4294967296&&A++,b[x]=I,b[x+1]=A}function n(b,x){return b[x]^b[x+1]<<8^b[x+2]<<16^b[x+3]<<24}function s(b,x,v,S,I,A){const O=l[I],D=l[I+1],B=l[A],L=l[A+1];e(c,b,x),t(c,b,O,D);let j=c[S]^c[b],$=c[S+1]^c[b+1];c[S]=$,c[S+1]=j,e(c,v,S),j=c[x]^c[v],$=c[x+1]^c[v+1],c[x]=j>>>24^$<<8,c[x+1]=$>>>24^j<<8,e(c,b,x),t(c,b,B,L),j=c[S]^c[b],$=c[S+1]^c[b+1],c[S]=j>>>16^$<<16,c[S+1]=$>>>16^j<<16,e(c,v,S),j=c[x]^c[v],$=c[x+1]^c[v+1],c[x]=$>>>31^j<<1,c[x+1]=j>>>31^$<<1}const i=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),o=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],a=new Uint8Array(o.map(function(b){return b*2})),c=new Uint32Array(32),l=new Uint32Array(32);function u(b,x){let v=0;for(v=0;v<16;v++)c[v]=b.h[v],c[v+16]=i[v];for(c[24]=c[24]^b.t,c[25]=c[25]^b.t/4294967296,x&&(c[28]=~c[28],c[29]=~c[29]),v=0;v<32;v++)l[v]=n(b.b,4*v);for(v=0;v<12;v++)s(0,8,16,24,a[v*16+0],a[v*16+1]),s(2,10,18,26,a[v*16+2],a[v*16+3]),s(4,12,20,28,a[v*16+4],a[v*16+5]),s(6,14,22,30,a[v*16+6],a[v*16+7]),s(0,10,20,30,a[v*16+8],a[v*16+9]),s(2,12,22,24,a[v*16+10],a[v*16+11]),s(4,14,16,26,a[v*16+12],a[v*16+13]),s(6,8,18,28,a[v*16+14],a[v*16+15]);for(v=0;v<16;v++)b.h[v]=b.h[v]^c[v]^c[v+16]}const h=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function f(b,x,v,S){if(b===0||b>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(x&&x.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(v&&v.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(S&&S.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");const I={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:b};h.fill(0),h[0]=b,x&&(h[1]=x.length),h[2]=1,h[3]=1,v&&h.set(v,32),S&&h.set(S,48);for(let A=0;A<16;A++)I.h[A]=i[A]^n(h,A*4);return x&&(d(I,x),I.c=128),I}function d(b,x){for(let v=0;v<x.length;v++)b.c===128&&(b.t+=b.c,u(b,!1),b.c=0),b.b[b.c++]=x[v]}function p(b){for(b.t+=b.c;b.c<128;)b.b[b.c++]=0;u(b,!0);const x=new Uint8Array(b.outlen);for(let v=0;v<b.outlen;v++)x[v]=b.h[v>>2]>>8*(v&3);return x}function g(b,x,v,S,I){v=v||64,b=r.normalizeInput(b),S&&(S=r.normalizeInput(S)),I&&(I=r.normalizeInput(I));const A=f(v,x,S,I);return d(A,b),p(A)}function m(b,x,v,S,I){const A=g(b,x,v,S,I);return r.toHex(A)}return xf={blake2b:g,blake2bHex:m,blake2bInit:f,blake2bUpdate:d,blake2bFinal:p},xf}var If,X0;function __(){if(X0)return If;X0=1;const r=xE();function e(p,g){return p[g]^p[g+1]<<8^p[g+2]<<16^p[g+3]<<24}function t(p,g,m,b,x,v){o[p]=o[p]+o[g]+x,o[b]=n(o[b]^o[p],16),o[m]=o[m]+o[b],o[g]=n(o[g]^o[m],12),o[p]=o[p]+o[g]+v,o[b]=n(o[b]^o[p],8),o[m]=o[m]+o[b],o[g]=n(o[g]^o[m],7)}function n(p,g){return p>>>g^p<<32-g}const s=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),i=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),o=new Uint32Array(16),a=new Uint32Array(16);function c(p,g){let m=0;for(m=0;m<8;m++)o[m]=p.h[m],o[m+8]=s[m];for(o[12]^=p.t,o[13]^=p.t/4294967296,g&&(o[14]=~o[14]),m=0;m<16;m++)a[m]=e(p.b,4*m);for(m=0;m<10;m++)t(0,4,8,12,a[i[m*16+0]],a[i[m*16+1]]),t(1,5,9,13,a[i[m*16+2]],a[i[m*16+3]]),t(2,6,10,14,a[i[m*16+4]],a[i[m*16+5]]),t(3,7,11,15,a[i[m*16+6]],a[i[m*16+7]]),t(0,5,10,15,a[i[m*16+8]],a[i[m*16+9]]),t(1,6,11,12,a[i[m*16+10]],a[i[m*16+11]]),t(2,7,8,13,a[i[m*16+12]],a[i[m*16+13]]),t(3,4,9,14,a[i[m*16+14]],a[i[m*16+15]]);for(m=0;m<8;m++)p.h[m]^=o[m]^o[m+8]}function l(p,g){if(!(p>0&&p<=32))throw new Error("Incorrect output length, should be in [1, 32]");const m=g?g.length:0;if(g&&!(m>0&&m<=32))throw new Error("Incorrect key length, should be in [1, 32]");const b={h:new Uint32Array(s),b:new Uint8Array(64),c:0,t:0,outlen:p};return b.h[0]^=16842752^m<<8^p,m>0&&(u(b,g),b.c=64),b}function u(p,g){for(let m=0;m<g.length;m++)p.c===64&&(p.t+=p.c,c(p,!1),p.c=0),p.b[p.c++]=g[m]}function h(p){for(p.t+=p.c;p.c<64;)p.b[p.c++]=0;c(p,!0);const g=new Uint8Array(p.outlen);for(let m=0;m<p.outlen;m++)g[m]=p.h[m>>2]>>8*(m&3)&255;return g}function f(p,g,m){m=m||32,p=r.normalizeInput(p);const b=l(m,g);return u(b,p),h(b)}function d(p,g,m){const b=f(p,g,m);return r.toHex(b)}return If={blake2s:f,blake2sHex:d,blake2sInit:l,blake2sUpdate:u,blake2sFinal:h},If}var Sf,em;function T_(){if(em)return Sf;em=1;const r=B_(),e=__();return Sf={blake2b:r.blake2b,blake2bHex:r.blake2bHex,blake2bInit:r.blake2bInit,blake2bUpdate:r.blake2bUpdate,blake2bFinal:r.blake2bFinal,blake2s:e.blake2s,blake2sHex:e.blake2sHex,blake2sInit:e.blake2sInit,blake2sUpdate:e.blake2sUpdate,blake2sFinal:e.blake2sFinal},Sf}var N_=T_(),R_={};const U_=":";function Yn(r){const[e,t]=r.split(U_);return{namespace:e,reference:t}}function tm(r,e=[]){const t=[];return Object.keys(r).forEach(n=>{if(e.length&&!e.includes(n))return;const s=r[n];t.push(...s.accounts)}),t}function IE(r,e){return r.includes(":")?[r]:e.chains||[]}var k_=Object.defineProperty,$_=Object.defineProperties,L_=Object.getOwnPropertyDescriptors,rm=Object.getOwnPropertySymbols,F_=Object.prototype.hasOwnProperty,M_=Object.prototype.propertyIsEnumerable,tp=(r,e,t)=>e in r?k_(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,nm=(r,e)=>{for(var t in e||(e={}))F_.call(e,t)&&tp(r,t,e[t]);if(rm)for(var t of rm(e))M_.call(e,t)&&tp(r,t,e[t]);return r},j_=(r,e)=>$_(r,L_(e)),sm=(r,e,t)=>tp(r,typeof e!="symbol"?e+"":e,t);const z_="ReactNative",ar={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},H_="js";function ju(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Ys(){return!ts.getDocument()&&!!ts.getNavigator()&&navigator.product===z_}function q_(){return Ys()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function V_(){return Ys()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function Ga(){return!ju()&&!!ts.getNavigator()&&!!ts.getDocument()}function bl(){return Ys()?ar.reactNative:ju()?ar.node:Ga()?ar.browser:ar.unknown}function im(){var r;try{return Ys()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(r=global.Application)==null?void 0:r.applicationId:void 0}catch{return}}function K_(r,e){const t=new URLSearchParams(r);return Object.entries(e).sort(([n],[s])=>n.localeCompare(s)).forEach(([n,s])=>{s!=null&&t.set(n,String(s))}),t.toString()}function G_(r){var e,t;const n=SE();try{return r!=null&&r.url&&n.url&&new URL(r.url).host!==new URL(n.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${r.url} differs from the actual page url:${n.url}. This is probably unintended and can lead to issues.`),r.url=n.url),(e=r==null?void 0:r.icons)!=null&&e.length&&r.icons.length>0&&(r.icons=r.icons.filter(s=>s!=="")),j_(nm(nm({},n),r),{url:(r==null?void 0:r.url)||n.url,name:(r==null?void 0:r.name)||n.name,description:(r==null?void 0:r.description)||n.description,icons:(t=r==null?void 0:r.icons)!=null&&t.length&&r.icons.length>0?r.icons:n.icons})}catch(s){return console.warn("Error populating app metadata",s),r||n}}function SE(){return sO.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function Q_(){if(bl()===ar.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:t,Version:n}=global.Platform;return[t,n].join("-")}const r=AP();if(r===null)return"unknown";const e=r.os?r.os.replace(" ","").toLowerCase():"unknown";return r.type==="browser"?[e,r.name,r.version].join("-"):[e,r.version].join("-")}function W_(){var r;const e=bl();return e===ar.browser?[e,((r=ts.getLocation())==null?void 0:r.host)||"unknown"].join(":"):e}function PE(r,e,t){const n=Q_(),s=W_();return[[r,e].join("-"),[H_,t].join("-"),n,s].join("/")}function J_({protocol:r,version:e,relayUrl:t,sdkVersion:n,auth:s,projectId:i,useOnCloseEvent:o,bundleId:a,packageName:c}){const l=t.split("?"),u=PE(r,e,n),h={auth:s,ua:u,projectId:i,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},f=K_(l[1]||"",h);return l[0]+"?"+f}function Ei(r,e){return r.filter(t=>e.includes(t)).length===r.length}function rp(r){return Object.fromEntries(r.entries())}function np(r){return new Map(Object.entries(r))}function ai(r=J.FIVE_MINUTES,e){const t=J.toMiliseconds(r||J.FIVE_MINUTES);let n,s,i,o;return{resolve:a=>{i&&n&&(clearTimeout(i),n(a),o=Promise.resolve(a))},reject:a=>{i&&s&&(clearTimeout(i),s(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);i=setTimeout(()=>{const l=new Error(e);o=Promise.reject(l),c(l)},t),n=a,s=c})}}function yn(r,e,t){return new Promise(async(n,s)=>{const i=setTimeout(()=>s(new Error(t)),e);try{const o=await r;n(o)}catch(o){s(o)}clearTimeout(i)})}function OE(r,e){if(typeof e=="string"&&e.startsWith(`${r}:`))return e;if(r.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(r.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${r}`)}function Y_(r){return OE("topic",r)}function Z_(r){return OE("id",r)}function DE(r){const[e,t]=r.split(":"),n={id:void 0,topic:void 0};if(e==="topic"&&typeof t=="string")n.topic=t;else if(e==="id"&&Number.isInteger(Number(t)))n.id=Number(t);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${t}`);return n}function qe(r,e){return J.fromMiliseconds(Date.now()+J.toMiliseconds(r))}function fn(r){return Date.now()>=J.toMiliseconds(r)}function ve(r,e){return`${r}${e?`:${e}`:""}`}function mn(r=[],e=[]){return[...new Set([...r,...e])]}async function X_({id:r,topic:e,wcDeepLink:t}){var n;try{if(!t)return;const s=typeof t=="string"?JSON.parse(t):t,i=s==null?void 0:s.href;if(typeof i!="string")return;const o=eT(i,r,e),a=bl();if(a===ar.browser){if(!((n=ts.getDocument())!=null&&n.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}tT(o)}else a===ar.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(s){console.error(s)}}function eT(r,e,t){const n=`requestId=${e}&sessionTopic=${t}`;r.endsWith("/")&&(r=r.slice(0,-1));let s=`${r}`;if(r.startsWith("https://t.me")){const i=r.includes("?")?"&startapp=":"?startapp=";s=`${s}${i}${iT(n,!0)}`}else s=`${s}/wc?${n}`;return s}function tT(r){let e="_self";sT()?e="_top":(nT()||r.startsWith("https://")||r.startsWith("http://"))&&(e="_blank"),window.open(r,e,"noreferrer noopener")}async function rT(r,e){let t="";try{if(Ga()&&(t=localStorage.getItem(e),t))return t;t=await r.getItem(e)}catch(n){console.error(n)}return t}function om(r,e){if(!r.includes(e))return null;const t=r.split(/([&,?,=])/),n=t.indexOf(e);return t[n+2]}function am(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,r=>{const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)})}function fg(){return typeof process<"u"&&R_.IS_VITEST==="true"}function nT(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function sT(){try{return window.self!==window.top}catch{return!1}}function iT(r,e=!1){const t=Buffer.from(r).toString("base64");return e?t.replace(/[=]/g,""):t}function CE(r){return Buffer.from(r,"base64").toString("utf-8")}function oT(r){return new Promise(e=>setTimeout(e,r))}let aT=class{constructor({limit:e}){sm(this,"limit"),sm(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){const t=this.set.values().next().value;t&&this.set.delete(t)}this.set.add(e)}}has(e){return this.set.has(e)}};const ql=BigInt(2**32-1),cm=BigInt(32);function BE(r,e=!1){return e?{h:Number(r&ql),l:Number(r>>cm&ql)}:{h:Number(r>>cm&ql)|0,l:Number(r&ql)|0}}function _E(r,e=!1){const t=r.length;let n=new Uint32Array(t),s=new Uint32Array(t);for(let i=0;i<t;i++){const{h:o,l:a}=BE(r[i],e);[n[i],s[i]]=[o,a]}return[n,s]}const lm=(r,e,t)=>r>>>t,um=(r,e,t)=>r<<32-t|e>>>t,bs=(r,e,t)=>r>>>t|e<<32-t,vs=(r,e,t)=>r<<32-t|e>>>t,Ac=(r,e,t)=>r<<64-t|e>>>t-32,xc=(r,e,t)=>r>>>t-32|e<<64-t,cT=(r,e)=>e,lT=(r,e)=>r,uT=(r,e,t)=>r<<t|e>>>32-t,hT=(r,e,t)=>e<<t|r>>>32-t,fT=(r,e,t)=>e<<t-32|r>>>64-t,dT=(r,e,t)=>r<<t-32|e>>>64-t;function Br(r,e,t,n){const s=(e>>>0)+(n>>>0);return{h:r+t+(s/2**32|0)|0,l:s|0}}const dg=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),pg=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,pT=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),gT=(r,e,t,n,s)=>e+t+n+s+(r/2**32|0)|0,yT=(r,e,t,n,s)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(s>>>0),mT=(r,e,t,n,s,i)=>e+t+n+s+i+(r/2**32|0)|0,mo=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Ih(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function ns(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function qr(r,...e){if(!Ih(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function Sh(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");ns(r.outputLen),ns(r.blockLen)}function Qs(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function gg(r,e){qr(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function Gc(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}function Sr(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function Pf(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function Qr(r,e){return r<<32-e|r>>>e}const TE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function NE(r){return r<<24&4278190080|r<<8&16711680|r>>>8&65280|r>>>24&255}const Cn=TE?r=>r:r=>NE(r);function wT(r){for(let e=0;e<r.length;e++)r[e]=NE(r[e]);return r}const Es=TE?r=>r:wT,RE=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",bT=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function jo(r){if(qr(r),RE)return r.toHex();let e="";for(let t=0;t<r.length;t++)e+=bT[r[t]];return e}const Sn={_0:48,_9:57,A:65,F:70,a:97,f:102};function hm(r){if(r>=Sn._0&&r<=Sn._9)return r-Sn._0;if(r>=Sn.A&&r<=Sn.F)return r-(Sn.A-10);if(r>=Sn.a&&r<=Sn.f)return r-(Sn.a-10)}function zu(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);if(RE)return Uint8Array.fromHex(r);const e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(t);for(let s=0,i=0;s<t;s++,i+=2){const o=hm(r.charCodeAt(i)),a=hm(r.charCodeAt(i+1));if(o===void 0||a===void 0){const c=r[i]+r[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[s]=o*16+a}return n}function UE(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function zr(r){return typeof r=="string"&&(r=UE(r)),qr(r),r}function xs(...r){let e=0;for(let n=0;n<r.length;n++){const s=r[n];qr(s),e+=s.length}const t=new Uint8Array(e);for(let n=0,s=0;n<r.length;n++){const i=r[n];t.set(i,s),s+=i.length}return t}class Ph{}function vl(r){const e=n=>r().update(zr(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function vT(r){const e=(n,s)=>r(s).update(zr(n)).digest(),t=r({});return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=n=>r(n),e}function so(r=32){if(mo&&typeof mo.getRandomValues=="function")return mo.getRandomValues(new Uint8Array(r));if(mo&&typeof mo.randomBytes=="function")return Uint8Array.from(mo.randomBytes(r));throw new Error("crypto.getRandomValues must be defined")}const ET=BigInt(0),ac=BigInt(1),AT=BigInt(2),xT=BigInt(7),IT=BigInt(256),ST=BigInt(113),kE=[],$E=[],LE=[];for(let r=0,e=ac,t=1,n=0;r<24;r++){[t,n]=[n,(2*t+3*n)%5],kE.push(2*(5*n+t)),$E.push((r+1)*(r+2)/2%64);let s=ET;for(let i=0;i<7;i++)e=(e<<ac^(e>>xT)*ST)%IT,e&AT&&(s^=ac<<(ac<<BigInt(i))-ac);LE.push(s)}const FE=_E(LE,!0),PT=FE[0],OT=FE[1],fm=(r,e,t)=>t>32?fT(r,e,t):uT(r,e,t),dm=(r,e,t)=>t>32?dT(r,e,t):hT(r,e,t);function DT(r,e=24){const t=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)t[o]=r[o]^r[o+10]^r[o+20]^r[o+30]^r[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=t[c],u=t[c+1],h=fm(l,u,1)^t[a],f=dm(l,u,1)^t[a+1];for(let d=0;d<50;d+=10)r[o+d]^=h,r[o+d+1]^=f}let s=r[2],i=r[3];for(let o=0;o<24;o++){const a=$E[o],c=fm(s,i,a),l=dm(s,i,a),u=kE[o];s=r[u],i=r[u+1],r[u]=c,r[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)t[a]=r[o+a];for(let a=0;a<10;a++)r[o+a]^=~t[(a+2)%10]&t[(a+4)%10]}r[0]^=PT[n],r[1]^=OT[n]}Sr(t)}let CT=class ME extends Ph{constructor(e,t,n,s=!1,i=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=t,this.outputLen=n,this.enableXOF=s,this.rounds=i,ns(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=Gc(this.state)}clone(){return this._cloneInto()}keccak(){Es(this.state32),DT(this.state32,this.rounds),Es(this.state32),this.posOut=0,this.pos=0}update(e){Qs(this),e=zr(e),qr(e);const{blockLen:t,state:n}=this,s=e.length;for(let i=0;i<s;){const o=Math.min(t-this.pos,s-i);for(let a=0;a<o;a++)n[this.pos++]^=e[i++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:n,blockLen:s}=this;e[n]^=t,(t&128)!==0&&n===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){Qs(this,!1),qr(e),this.finish();const t=this.state,{blockLen:n}=this;for(let s=0,i=e.length;s<i;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,i-s);e.set(t.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return ns(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(gg(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Sr(this.state)}_cloneInto(e){const{blockLen:t,suffix:n,outputLen:s,rounds:i,enableXOF:o}=this;return e||(e=new ME(t,n,s,o,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=n,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}};const BT=(r,e,t)=>vl(()=>new CT(e,r,t)),_T=BT(1,136,256/8);function TT(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(t>>s&i),a=Number(t&i),c=n?4:0,l=n?0:4;r.setUint32(e+c,o,n),r.setUint32(e+l,a,n)}function NT(r,e,t){return r&e^~r&t}function RT(r,e,t){return r&e^r&t^e&t}let jE=class extends Ph{constructor(e,t,n,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=s,this.buffer=new Uint8Array(e),this.view=Pf(this.buffer)}update(e){Qs(this),e=zr(e),qr(e);const{view:t,buffer:n,blockLen:s}=this,i=e.length;for(let o=0;o<i;){const a=Math.min(s-this.pos,i-o);if(a===s){const c=Pf(e);for(;s<=i-o;o+=s)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Qs(this),gg(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:s,isLE:i}=this;let{pos:o}=this;t[o++]=128,Sr(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(n,0),o=0);for(let h=o;h<s;h++)t[h]=0;TT(n,s-8,BigInt(this.length*8),i),this.process(n,0);const a=Pf(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=i,e.length=s,e.pos=a,s%t&&e.buffer.set(n),e}clone(){return this._cloneInto()}};const hs=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),gt=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),yt=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),UT=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),fs=new Uint32Array(64);class kT extends jE{constructor(e=32){super(64,e,8,!1),this.A=hs[0]|0,this.B=hs[1]|0,this.C=hs[2]|0,this.D=hs[3]|0,this.E=hs[4]|0,this.F=hs[5]|0,this.G=hs[6]|0,this.H=hs[7]|0}get(){const{A:e,B:t,C:n,D:s,E:i,F:o,G:a,H:c}=this;return[e,t,n,s,i,o,a,c]}set(e,t,n,s,i,o,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let h=0;h<16;h++,t+=4)fs[h]=e.getUint32(t,!1);for(let h=16;h<64;h++){const f=fs[h-15],d=fs[h-2],p=Qr(f,7)^Qr(f,18)^f>>>3,g=Qr(d,17)^Qr(d,19)^d>>>10;fs[h]=g+fs[h-7]+p+fs[h-16]|0}let{A:n,B:s,C:i,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){const f=Qr(a,6)^Qr(a,11)^Qr(a,25),d=u+f+NT(a,c,l)+UT[h]+fs[h]|0,p=(Qr(n,2)^Qr(n,13)^Qr(n,22))+RT(n,s,i)|0;u=l,l=c,c=a,a=o+d|0,o=i,i=s,s=n,n=d+p|0}n=n+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(n,s,i,o,a,c,l,u)}roundClean(){Sr(fs)}destroy(){this.set(0,0,0,0,0,0,0,0),Sr(this.buffer)}}const zE=_E(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),$T=zE[0],LT=zE[1],ds=new Uint32Array(80),ps=new Uint32Array(80);let yg=class extends jE{constructor(e=64){super(128,e,16,!1),this.Ah=yt[0]|0,this.Al=yt[1]|0,this.Bh=yt[2]|0,this.Bl=yt[3]|0,this.Ch=yt[4]|0,this.Cl=yt[5]|0,this.Dh=yt[6]|0,this.Dl=yt[7]|0,this.Eh=yt[8]|0,this.El=yt[9]|0,this.Fh=yt[10]|0,this.Fl=yt[11]|0,this.Gh=yt[12]|0,this.Gl=yt[13]|0,this.Hh=yt[14]|0,this.Hl=yt[15]|0}get(){const{Ah:e,Al:t,Bh:n,Bl:s,Ch:i,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:f,Gh:d,Gl:p,Hh:g,Hl:m}=this;return[e,t,n,s,i,o,a,c,l,u,h,f,d,p,g,m]}set(e,t,n,s,i,o,a,c,l,u,h,f,d,p,g,m){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=f|0,this.Gh=d|0,this.Gl=p|0,this.Hh=g|0,this.Hl=m|0}process(e,t){for(let v=0;v<16;v++,t+=4)ds[v]=e.getUint32(t),ps[v]=e.getUint32(t+=4);for(let v=16;v<80;v++){const S=ds[v-15]|0,I=ps[v-15]|0,A=bs(S,I,1)^bs(S,I,8)^lm(S,I,7),O=vs(S,I,1)^vs(S,I,8)^um(S,I,7),D=ds[v-2]|0,B=ps[v-2]|0,L=bs(D,B,19)^Ac(D,B,61)^lm(D,B,6),j=vs(D,B,19)^xc(D,B,61)^um(D,B,6),$=pT(O,j,ps[v-7],ps[v-16]),U=gT($,A,L,ds[v-7],ds[v-16]);ds[v]=U|0,ps[v]=$|0}let{Ah:n,Al:s,Bh:i,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:f,Fh:d,Fl:p,Gh:g,Gl:m,Hh:b,Hl:x}=this;for(let v=0;v<80;v++){const S=bs(h,f,14)^bs(h,f,18)^Ac(h,f,41),I=vs(h,f,14)^vs(h,f,18)^xc(h,f,41),A=h&d^~h&g,O=f&p^~f&m,D=yT(x,I,O,LT[v],ps[v]),B=mT(D,b,S,A,$T[v],ds[v]),L=D|0,j=bs(n,s,28)^Ac(n,s,34)^Ac(n,s,39),$=vs(n,s,28)^xc(n,s,34)^xc(n,s,39),U=n&i^n&a^i&a,T=s&o^s&c^o&c;b=g|0,x=m|0,g=d|0,m=p|0,d=h|0,p=f|0,{h,l:f}=Br(l|0,u|0,B|0,L|0),l=a|0,u=c|0,a=i|0,c=o|0,i=n|0,o=s|0;const w=dg(L,$,T);n=pg(w,B,j,U),s=w|0}({h:n,l:s}=Br(this.Ah|0,this.Al|0,n|0,s|0)),{h:i,l:o}=Br(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=Br(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=Br(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:f}=Br(this.Eh|0,this.El|0,h|0,f|0),{h:d,l:p}=Br(this.Fh|0,this.Fl|0,d|0,p|0),{h:g,l:m}=Br(this.Gh|0,this.Gl|0,g|0,m|0),{h:b,l:x}=Br(this.Hh|0,this.Hl|0,b|0,x|0),this.set(n,s,i,o,a,c,l,u,h,f,d,p,g,m,b,x)}roundClean(){Sr(ds,ps)}destroy(){Sr(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};class FT extends yg{constructor(){super(48),this.Ah=gt[0]|0,this.Al=gt[1]|0,this.Bh=gt[2]|0,this.Bl=gt[3]|0,this.Ch=gt[4]|0,this.Cl=gt[5]|0,this.Dh=gt[6]|0,this.Dl=gt[7]|0,this.Eh=gt[8]|0,this.El=gt[9]|0,this.Fh=gt[10]|0,this.Fl=gt[11]|0,this.Gh=gt[12]|0,this.Gl=gt[13]|0,this.Hh=gt[14]|0,this.Hl=gt[15]|0}}const mt=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class MT extends yg{constructor(){super(32),this.Ah=mt[0]|0,this.Al=mt[1]|0,this.Bh=mt[2]|0,this.Bl=mt[3]|0,this.Ch=mt[4]|0,this.Cl=mt[5]|0,this.Dh=mt[6]|0,this.Dl=mt[7]|0,this.Eh=mt[8]|0,this.El=mt[9]|0,this.Fh=mt[10]|0,this.Fl=mt[11]|0,this.Gh=mt[12]|0,this.Gl=mt[13]|0,this.Hh=mt[14]|0,this.Hl=mt[15]|0}}const Oh=vl(()=>new kT),jT=vl(()=>new yg),zT=vl(()=>new FT),HT=vl(()=>new MT),qT=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),Ge=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),Z=new Uint32Array(32);function gs(r,e,t,n,s,i){const o=s[i],a=s[i+1];let c=Z[2*r],l=Z[2*r+1],u=Z[2*e],h=Z[2*e+1],f=Z[2*t],d=Z[2*t+1],p=Z[2*n],g=Z[2*n+1],m=dg(c,u,o);l=pg(m,l,h,a),c=m|0,{Dh:g,Dl:p}={Dh:g^l,Dl:p^c},{Dh:g,Dl:p}={Dh:cT(g,p),Dl:lT(g)},{h:d,l:f}=Br(d,f,g,p),{Bh:h,Bl:u}={Bh:h^d,Bl:u^f},{Bh:h,Bl:u}={Bh:bs(h,u,24),Bl:vs(h,u,24)},Z[2*r]=c,Z[2*r+1]=l,Z[2*e]=u,Z[2*e+1]=h,Z[2*t]=f,Z[2*t+1]=d,Z[2*n]=p,Z[2*n+1]=g}function ys(r,e,t,n,s,i){const o=s[i],a=s[i+1];let c=Z[2*r],l=Z[2*r+1],u=Z[2*e],h=Z[2*e+1],f=Z[2*t],d=Z[2*t+1],p=Z[2*n],g=Z[2*n+1],m=dg(c,u,o);l=pg(m,l,h,a),c=m|0,{Dh:g,Dl:p}={Dh:g^l,Dl:p^c},{Dh:g,Dl:p}={Dh:bs(g,p,16),Dl:vs(g,p,16)},{h:d,l:f}=Br(d,f,g,p),{Bh:h,Bl:u}={Bh:h^d,Bl:u^f},{Bh:h,Bl:u}={Bh:Ac(h,u,63),Bl:xc(h,u,63)},Z[2*r]=c,Z[2*r+1]=l,Z[2*e]=u,Z[2*e+1]=h,Z[2*t]=f,Z[2*t+1]=d,Z[2*n]=p,Z[2*n+1]=g}function VT(r,e={},t,n,s){if(ns(t),r<0||r>t)throw new Error("outputLen bigger than keyLen");const{key:i,salt:o,personalization:a}=e;if(i!==void 0&&(i.length<1||i.length>t))throw new Error("key length must be undefined or 1.."+t);if(o!==void 0&&o.length!==n)throw new Error("salt must be undefined or "+n);if(a!==void 0&&a.length!==s)throw new Error("personalization must be undefined or "+s)}class KT extends Ph{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,ns(e),ns(t),this.blockLen=e,this.outputLen=t,this.buffer=new Uint8Array(e),this.buffer32=Gc(this.buffer)}update(e){Qs(this),e=zr(e),qr(e);const{blockLen:t,buffer:n,buffer32:s}=this,i=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<i;){this.pos===t&&(Es(s),this.compress(s,0,!1),Es(s),this.pos=0);const l=Math.min(t-this.pos,i-c),u=o+c;if(l===t&&!(u%4)&&c+l<i){const h=new Uint32Array(a,u,Math.floor((i-c)/4));Es(h);for(let f=0;c+t<i;f+=s.length,c+=t)this.length+=t,this.compress(h,f,!1);Es(h);continue}n.set(e.subarray(c,c+l),this.pos),this.pos+=l,this.length+=l,c+=l}return this}digestInto(e){Qs(this),gg(e,this);const{pos:t,buffer32:n}=this;this.finished=!0,Sr(this.buffer.subarray(t)),Es(n),this.compress(n,0,!0),Es(n);const s=Gc(e);this.get().forEach((i,o)=>s[o]=Cn(i))}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){const{buffer:t,length:n,finished:s,destroyed:i,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(t),e.destroyed=i,e.finished=s,e.length=n,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class GT extends KT{constructor(e={}){const t=e.dkLen===void 0?64:e.dkLen;super(128,t),this.v0l=Ge[0]|0,this.v0h=Ge[1]|0,this.v1l=Ge[2]|0,this.v1h=Ge[3]|0,this.v2l=Ge[4]|0,this.v2h=Ge[5]|0,this.v3l=Ge[6]|0,this.v3h=Ge[7]|0,this.v4l=Ge[8]|0,this.v4h=Ge[9]|0,this.v5l=Ge[10]|0,this.v5h=Ge[11]|0,this.v6l=Ge[12]|0,this.v6h=Ge[13]|0,this.v7l=Ge[14]|0,this.v7h=Ge[15]|0,VT(t,e,64,16,16);let{key:n,personalization:s,salt:i}=e,o=0;if(n!==void 0&&(n=zr(n),o=n.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,i!==void 0){i=zr(i);const a=Gc(i);this.v4l^=Cn(a[0]),this.v4h^=Cn(a[1]),this.v5l^=Cn(a[2]),this.v5h^=Cn(a[3])}if(s!==void 0){s=zr(s);const a=Gc(s);this.v6l^=Cn(a[0]),this.v6h^=Cn(a[1]),this.v7l^=Cn(a[2]),this.v7h^=Cn(a[3])}if(n!==void 0){const a=new Uint8Array(this.blockLen);a.set(n),this.update(a)}}get(){let{v0l:e,v0h:t,v1l:n,v1h:s,v2l:i,v2h:o,v3l:a,v3h:c,v4l:l,v4h:u,v5l:h,v5h:f,v6l:d,v6h:p,v7l:g,v7h:m}=this;return[e,t,n,s,i,o,a,c,l,u,h,f,d,p,g,m]}set(e,t,n,s,i,o,a,c,l,u,h,f,d,p,g,m){this.v0l=e|0,this.v0h=t|0,this.v1l=n|0,this.v1h=s|0,this.v2l=i|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=l|0,this.v4h=u|0,this.v5l=h|0,this.v5h=f|0,this.v6l=d|0,this.v6h=p|0,this.v7l=g|0,this.v7h=m|0}compress(e,t,n){this.get().forEach((c,l)=>Z[l]=c),Z.set(Ge,16);let{h:s,l:i}=BE(BigInt(this.length));Z[24]=Ge[8]^i,Z[25]=Ge[9]^s,n&&(Z[28]=~Z[28],Z[29]=~Z[29]);let o=0;const a=qT;for(let c=0;c<12;c++)gs(0,4,8,12,e,t+2*a[o++]),ys(0,4,8,12,e,t+2*a[o++]),gs(1,5,9,13,e,t+2*a[o++]),ys(1,5,9,13,e,t+2*a[o++]),gs(2,6,10,14,e,t+2*a[o++]),ys(2,6,10,14,e,t+2*a[o++]),gs(3,7,11,15,e,t+2*a[o++]),ys(3,7,11,15,e,t+2*a[o++]),gs(0,5,10,15,e,t+2*a[o++]),ys(0,5,10,15,e,t+2*a[o++]),gs(1,6,11,12,e,t+2*a[o++]),ys(1,6,11,12,e,t+2*a[o++]),gs(2,7,8,13,e,t+2*a[o++]),ys(2,7,8,13,e,t+2*a[o++]),gs(3,4,9,14,e,t+2*a[o++]),ys(3,4,9,14,e,t+2*a[o++]);this.v0l^=Z[0]^Z[16],this.v0h^=Z[1]^Z[17],this.v1l^=Z[2]^Z[18],this.v1h^=Z[3]^Z[19],this.v2l^=Z[4]^Z[20],this.v2h^=Z[5]^Z[21],this.v3l^=Z[6]^Z[22],this.v3h^=Z[7]^Z[23],this.v4l^=Z[8]^Z[24],this.v4h^=Z[9]^Z[25],this.v5l^=Z[10]^Z[26],this.v5h^=Z[11]^Z[27],this.v6l^=Z[12]^Z[28],this.v6h^=Z[13]^Z[29],this.v7l^=Z[14]^Z[30],this.v7h^=Z[15]^Z[31],Sr(Z)}destroy(){this.destroyed=!0,Sr(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const QT=vT(r=>new GT(r)),WT="https://rpc.walletconnect.org/v1";function HE(r){const e=`Ethereum Signed Message:
${r.length}`,t=new TextEncoder().encode(e+r);return"0x"+Buffer.from(_T(t)).toString("hex")}async function JT(r,e,t,n,s,i){switch(t.t){case"eip191":return await YT(r,e,t.s);case"eip1271":return await ZT(r,e,t.s,n,s,i);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${t.t}`)}}async function YT(r,e,t){return(await QO({hash:HE(e),signature:t})).toLowerCase()===r.toLowerCase()}async function ZT(r,e,t,n,s,i){const o=Yn(n);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${n}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",l=t.substring(2),u=(l.length/2).toString(16).padStart(64,"0"),h=(e.startsWith("0x")?e:HE(e)).substring(2),f=a+h+c+u+l,d=await fetch(`${i||WT}/?chainId=${n}&projectId=${s}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:XT(),jsonrpc:"2.0",method:"eth_call",params:[{to:r,data:f},"latest"]})}),{result:p}=await d.json();return p?p.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function XT(){return Date.now()+Math.floor(Math.random()*1e3)}function eN(r){const e=atob(r),t=new Uint8Array(e.length);for(let o=0;o<e.length;o++)t[o]=e.charCodeAt(o);const n=t[0];if(n===0)throw new Error("No signatures found");const s=1+n*64;if(t.length<s)throw new Error("Transaction data too short for claimed signature count");if(t.length<100)throw new Error("Transaction too short");const i=Buffer.from(r,"base64").slice(1,65);return yl.encode(i)}function tN(r){const e=new Uint8Array(Buffer.from(r,"base64")),t=Array.from("TransactionData::").map(i=>i.charCodeAt(0)),n=new Uint8Array(t.length+e.length);n.set(t),n.set(e,t.length);const s=QT(n,{dkLen:32});return yl.encode(s)}function pm(r){const e=new Uint8Array(Oh(rN(r)));return yl.encode(e)}function rN(r){if(r instanceof Uint8Array)return r;if(Array.isArray(r))return new Uint8Array(r);if(typeof r=="object"&&r!=null&&r.data)return new Uint8Array(Object.values(r.data));if(typeof r=="object"&&r)return new Uint8Array(Object.values(r));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function gm(r){const e=Buffer.from(r,"base64"),t=T8(e).txn;if(!t)throw new Error("Invalid signed transaction: missing 'txn' field");const n=x8(t),s=Buffer.from("TX"),i=Buffer.concat([s,Buffer.from(n)]),o=HT(i);return M8.encode(o).replace(/=+$/,"")}function Of(r){const e=[];let t=BigInt(r);for(;t>=BigInt(128);)e.push(Number(t&BigInt(127)|BigInt(128))),t>>=BigInt(7);return e.push(Number(t)),Buffer.from(e)}function nN(r){const e=Buffer.from(r.signed.bodyBytes,"base64"),t=Buffer.from(r.signed.authInfoBytes,"base64"),n=Buffer.from(r.signature.signature,"base64"),s=[];s.push(Buffer.from([10])),s.push(Of(e.length)),s.push(e),s.push(Buffer.from([18])),s.push(Of(t.length)),s.push(t),s.push(Buffer.from([26])),s.push(Of(n.length)),s.push(n);const i=Buffer.concat(s),o=Oh(i);return Buffer.from(o).toString("hex").toUpperCase()}function sN(r){var e,t;const n=[];try{if(typeof r=="string")return n.push(r),n;if(typeof r!="object")return n;r!=null&&r.id&&n.push(r.id);const s=(t=(e=r==null?void 0:r.capabilities)==null?void 0:e.caip345)==null?void 0:t.transactionHashes;s&&n.push(...s)}catch(s){console.warn("getWalletSendCallsHashes failed: ",s)}return n}var iN=Object.defineProperty,oN=Object.defineProperties,aN=Object.getOwnPropertyDescriptors,ym=Object.getOwnPropertySymbols,cN=Object.prototype.hasOwnProperty,lN=Object.prototype.propertyIsEnumerable,mm=(r,e,t)=>e in r?iN(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,uN=(r,e)=>{for(var t in e||(e={}))cN.call(e,t)&&mm(r,t,e[t]);if(ym)for(var t of ym(e))lN.call(e,t)&&mm(r,t,e[t]);return r},hN=(r,e)=>oN(r,aN(e));const fN="did:pkh:",mg=r=>r==null?void 0:r.split(":"),dN=r=>{const e=r&&mg(r);if(e)return r.includes(fN)?e[3]:e[1]},sp=r=>{const e=r&&mg(r);if(e)return e[2]+":"+e[3]},Hu=r=>{const e=r&&mg(r);if(e)return e.pop()};async function wm(r){const{cacao:e,projectId:t}=r,{s:n,p:s}=e,i=qE(s,s.iss),o=Hu(s.iss);return await JT(o,i,n,sp(s.iss),t)}const qE=(r,e)=>{const t=`${r.domain} wants you to sign in with your Ethereum account:`,n=Hu(e);if(!r.aud&&!r.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let s=r.statement||void 0;const i=`URI: ${r.aud||r.uri}`,o=`Version: ${r.version}`,a=`Chain ID: ${dN(e)}`,c=`Nonce: ${r.nonce}`,l=`Issued At: ${r.iat}`,u=r.exp?`Expiration Time: ${r.exp}`:void 0,h=r.nbf?`Not Before: ${r.nbf}`:void 0,f=r.requestId?`Request ID: ${r.requestId}`:void 0,d=r.resources?`Resources:${r.resources.map(g=>`
- ${g}`).join("")}`:void 0,p=gu(r.resources);if(p){const g=Qc(p);s=AN(s,g)}return[t,n,"",s,"",i,o,a,c,l,u,h,f,d].filter(g=>g!=null).join(`
`)};function pN(r){return Buffer.from(JSON.stringify(r)).toString("base64")}function gN(r){return JSON.parse(Buffer.from(r,"base64").toString("utf-8"))}function Xi(r){if(!r)throw new Error("No recap provided, value is undefined");if(!r.att)throw new Error("No `att` property found");const e=Object.keys(r.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(t=>{const n=r.att[t];if(Array.isArray(n))throw new Error(`Resource must be an object: ${t}`);if(typeof n!="object")throw new Error(`Resource must be an object: ${t}`);if(!Object.keys(n).length)throw new Error(`Resource object is empty: ${t}`);Object.keys(n).forEach(s=>{const i=n[s];if(!Array.isArray(i))throw new Error(`Ability limits ${s} must be an array of objects, found: ${i}`);if(!i.length)throw new Error(`Value of ${s} is empty array, must be an array with objects`);i.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${s}) must be an array of objects, found: ${o}`)})})})}function yN(r,e,t,n={}){return t==null||t.sort((s,i)=>s.localeCompare(i)),{att:{[r]:mN(e,t,n)}}}function mN(r,e,t={}){e=e==null?void 0:e.sort((s,i)=>s.localeCompare(i));const n=e.map(s=>({[`${r}/${s}`]:[t]}));return Object.assign({},...n)}function VE(r){return Xi(r),`urn:recap:${pN(r).replace(/=/g,"")}`}function Qc(r){const e=gN(r.replace("urn:recap:",""));return Xi(e),e}function wN(r,e,t){const n=yN(r,e,t);return VE(n)}function bN(r){return r&&r.includes("urn:recap:")}function vN(r,e){const t=Qc(r),n=Qc(e),s=EN(t,n);return VE(s)}function EN(r,e){Xi(r),Xi(e);const t=Object.keys(r.att).concat(Object.keys(e.att)).sort((s,i)=>s.localeCompare(i)),n={att:{}};return t.forEach(s=>{var i,o;Object.keys(((i=r.att)==null?void 0:i[s])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[s])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,l;n.att[s]=hN(uN({},n.att[s]),{[a]:((c=r.att[s])==null?void 0:c[a])||((l=e.att[s])==null?void 0:l[a])})})}),n}function AN(r="",e){Xi(e);const t="I further authorize the stated URI to perform the following actions on my behalf: ";if(r.includes(t))return r;const n=[];let s=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(h=>({ability:h.split("/")[0],action:h.split("/")[1]}));c.sort((h,f)=>h.action.localeCompare(f.action));const l={};c.forEach(h=>{l[h.ability]||(l[h.ability]=[]),l[h.ability].push(h.action)});const u=Object.keys(l).map(h=>(s++,`(${s}) '${h}': '${l[h].join("', '")}' for '${a}'.`));n.push(u.join(", ").replace(".,","."))});const i=n.join(" "),o=`${t}${i}`;return`${r?r+" ":""}${o}`}function bm(r){var e;const t=Qc(r);Xi(t);const n=(e=t.att)==null?void 0:e.eip155;return n?Object.keys(n).map(s=>s.split("/")[1]):[]}function vm(r){const e=Qc(r);Xi(e);const t=[];return Object.values(e.att).forEach(n=>{Object.values(n).forEach(s=>{var i;(i=s==null?void 0:s[0])!=null&&i.chains&&t.push(s[0].chains)})}),[...new Set(t.flat())]}function gu(r){if(!r)return;const e=r==null?void 0:r[r.length-1];return bN(e)?e:void 0}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function KE(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function ip(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}function Df(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function zt(r,...e){if(!KE(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function Em(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function xN(r,e){zt(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function qs(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}function Ma(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function IN(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}const SN=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function PN(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function op(r){if(typeof r=="string")r=PN(r);else if(KE(r))r=ap(r);else throw new Error("Uint8Array expected, got "+typeof r);return r}function ON(r,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(r,e)}function DN(r,e){if(r.length!==e.length)return!1;let t=0;for(let n=0;n<r.length;n++)t|=r[n]^e[n];return t===0}const CN=(r,e)=>{function t(n,...s){if(zt(n),!SN)throw new Error("Non little-endian hardware is not yet supported");if(r.nonceLength!==void 0){const l=s[0];if(!l)throw new Error("nonce / iv required");r.varSizeNonce?zt(l):zt(l,r.nonceLength)}const i=r.tagLength;i&&s[1]!==void 0&&zt(s[1]);const o=e(n,...s),a=(l,u)=>{if(u!==void 0){if(l!==2)throw new Error("cipher output not supported");zt(u)}};let c=!1;return{encrypt(l,u){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,zt(l),a(o.encrypt.length,u),o.encrypt(l,u)},decrypt(l,u){if(zt(l),i&&l.length<i)throw new Error("invalid ciphertext length: smaller than tagLength="+i);return a(o.decrypt.length,u),o.decrypt(l,u)}}}return Object.assign(t,r),t};function Am(r,e,t=!0){if(e===void 0)return new Uint8Array(r);if(e.length!==r)throw new Error("invalid output length, expected "+r+", got: "+e.length);if(t&&!_N(e))throw new Error("invalid output, must be aligned");return e}function xm(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(t>>s&i),a=Number(t&i);r.setUint32(e+4,o,n),r.setUint32(e+0,a,n)}function BN(r,e,t){ip(t);const n=new Uint8Array(16),s=IN(n);return xm(s,0,BigInt(e),t),xm(s,8,BigInt(r),t),n}function _N(r){return r.byteOffset%4===0}function ap(r){return Uint8Array.from(r)}const GE=r=>Uint8Array.from(r.split("").map(e=>e.charCodeAt(0))),TN=GE("expand 16-byte k"),NN=GE("expand 32-byte k"),RN=qs(TN),UN=qs(NN);function we(r,e){return r<<e|r>>>32-e}function cp(r){return r.byteOffset%4===0}const Vl=64,kN=16,QE=2**32-1,Im=new Uint32Array;function $N(r,e,t,n,s,i,o,a){const c=s.length,l=new Uint8Array(Vl),u=qs(l),h=cp(s)&&cp(i),f=h?qs(s):Im,d=h?qs(i):Im;for(let p=0;p<c;o++){if(r(e,t,n,u,o,a),o>=QE)throw new Error("arx: counter overflow");const g=Math.min(Vl,c-p);if(h&&g===Vl){const m=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let b=0,x;b<kN;b++)x=m+b,d[x]=f[x]^u[b];p+=Vl;continue}for(let m=0,b;m<g;m++)b=p+m,i[b]=s[b]^l[m];p+=g}}function LN(r,e){const{allowShortKeys:t,extendNonceFn:n,counterLength:s,counterRight:i,rounds:o}=ON({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof r!="function")throw new Error("core must be a function");return Df(s),Df(o),ip(i),ip(t),(a,c,l,u,h=0)=>{zt(a),zt(c),zt(l);const f=l.length;if(u===void 0&&(u=new Uint8Array(f)),zt(u),Df(h),h<0||h>=QE)throw new Error("arx: counter overflow");if(u.length<f)throw new Error(`arx: output (${u.length}) is shorter than data (${f})`);const d=[];let p=a.length,g,m;if(p===32)d.push(g=ap(a)),m=UN;else if(p===16&&t)g=new Uint8Array(32),g.set(a),g.set(a,16),m=RN,d.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${p}`);cp(c)||d.push(c=ap(c));const b=qs(g);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(m,b,qs(c.subarray(0,16)),b),c=c.subarray(16)}const x=16-s;if(x!==c.length)throw new Error(`arx: nonce must be ${x} or 16 bytes`);if(x!==12){const S=new Uint8Array(12);S.set(c,i?0:12-c.length),c=S,d.push(c)}const v=qs(c);return $N(r,m,b,v,l,u,h,o),Ma(...d),u}}const nt=(r,e)=>r[e++]&255|(r[e++]&255)<<8;class FN{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=op(e),zt(e,32);const t=nt(e,0),n=nt(e,2),s=nt(e,4),i=nt(e,6),o=nt(e,8),a=nt(e,10),c=nt(e,12),l=nt(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|n<<3)&8191,this.r[2]=(n>>>10|s<<6)&7939,this.r[3]=(s>>>7|i<<9)&8191,this.r[4]=(i>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=nt(e,16+2*u)}process(e,t,n=!1){const s=n?0:2048,{h:i,r:o}=this,a=o[0],c=o[1],l=o[2],u=o[3],h=o[4],f=o[5],d=o[6],p=o[7],g=o[8],m=o[9],b=nt(e,t+0),x=nt(e,t+2),v=nt(e,t+4),S=nt(e,t+6),I=nt(e,t+8),A=nt(e,t+10),O=nt(e,t+12),D=nt(e,t+14);let B=i[0]+(b&8191),L=i[1]+((b>>>13|x<<3)&8191),j=i[2]+((x>>>10|v<<6)&8191),$=i[3]+((v>>>7|S<<9)&8191),U=i[4]+((S>>>4|I<<12)&8191),T=i[5]+(I>>>1&8191),w=i[6]+((I>>>14|A<<2)&8191),E=i[7]+((A>>>11|O<<5)&8191),C=i[8]+((O>>>8|D<<8)&8191),k=i[9]+(D>>>5|s),_=0,N=_+B*a+L*(5*m)+j*(5*g)+$*(5*p)+U*(5*d);_=N>>>13,N&=8191,N+=T*(5*f)+w*(5*h)+E*(5*u)+C*(5*l)+k*(5*c),_+=N>>>13,N&=8191;let z=_+B*c+L*a+j*(5*m)+$*(5*g)+U*(5*p);_=z>>>13,z&=8191,z+=T*(5*d)+w*(5*f)+E*(5*h)+C*(5*u)+k*(5*l),_+=z>>>13,z&=8191;let H=_+B*l+L*c+j*a+$*(5*m)+U*(5*g);_=H>>>13,H&=8191,H+=T*(5*p)+w*(5*d)+E*(5*f)+C*(5*h)+k*(5*u),_+=H>>>13,H&=8191;let Y=_+B*u+L*l+j*c+$*a+U*(5*m);_=Y>>>13,Y&=8191,Y+=T*(5*g)+w*(5*p)+E*(5*d)+C*(5*f)+k*(5*h),_+=Y>>>13,Y&=8191;let G=_+B*h+L*u+j*l+$*c+U*a;_=G>>>13,G&=8191,G+=T*(5*m)+w*(5*g)+E*(5*p)+C*(5*d)+k*(5*f),_+=G>>>13,G&=8191;let Q=_+B*f+L*h+j*u+$*l+U*c;_=Q>>>13,Q&=8191,Q+=T*a+w*(5*m)+E*(5*g)+C*(5*p)+k*(5*d),_+=Q>>>13,Q&=8191;let ee=_+B*d+L*f+j*h+$*u+U*l;_=ee>>>13,ee&=8191,ee+=T*c+w*a+E*(5*m)+C*(5*g)+k*(5*p),_+=ee>>>13,ee&=8191;let se=_+B*p+L*d+j*f+$*h+U*u;_=se>>>13,se&=8191,se+=T*l+w*c+E*a+C*(5*m)+k*(5*g),_+=se>>>13,se&=8191;let le=_+B*g+L*p+j*d+$*f+U*h;_=le>>>13,le&=8191,le+=T*u+w*l+E*c+C*a+k*(5*m),_+=le>>>13,le&=8191;let ne=_+B*m+L*g+j*p+$*d+U*f;_=ne>>>13,ne&=8191,ne+=T*h+w*u+E*l+C*c+k*a,_+=ne>>>13,ne&=8191,_=(_<<2)+_|0,_=_+N|0,N=_&8191,_=_>>>13,z+=_,i[0]=N,i[1]=z,i[2]=H,i[3]=Y,i[4]=G,i[5]=Q,i[6]=ee,i[7]=se,i[8]=le,i[9]=ne}finalize(){const{h:e,pad:t}=this,n=new Uint16Array(10);let s=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=s,s=e[a]>>>13,e[a]&=8191;e[0]+=s*5,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,n[0]=e[0]+5,s=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+s,s=n[a]>>>13,n[a]&=8191;n[9]-=8192;let i=(s^1)-1;for(let a=0;a<10;a++)n[a]&=i;i=~i;for(let a=0;a<10;a++)e[a]=e[a]&i|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+t[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+t[a]|0)+(o>>>16)|0,e[a]=o&65535;Ma(n)}update(e){Em(this),e=op(e),zt(e);const{buffer:t,blockLen:n}=this,s=e.length;for(let i=0;i<s;){const o=Math.min(n-this.pos,s-i);if(o===n){for(;n<=s-i;i+=n)this.process(e,i);continue}t.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===n&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){Ma(this.h,this.r,this.buffer,this.pad)}digestInto(e){Em(this),xN(e,this),this.finished=!0;const{buffer:t,h:n}=this;let{pos:s}=this;if(s){for(t[s++]=1;s<16;s++)t[s]=0;this.process(t,0,!0)}this.finalize();let i=0;for(let o=0;o<8;o++)e[i++]=n[o]>>>0,e[i++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}}function MN(r){const e=(n,s)=>r(s).update(op(n)).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=n=>r(n),e}const jN=MN(r=>new FN(r));function zN(r,e,t,n,s,i=20){let o=r[0],a=r[1],c=r[2],l=r[3],u=e[0],h=e[1],f=e[2],d=e[3],p=e[4],g=e[5],m=e[6],b=e[7],x=s,v=t[0],S=t[1],I=t[2],A=o,O=a,D=c,B=l,L=u,j=h,$=f,U=d,T=p,w=g,E=m,C=b,k=x,_=v,N=S,z=I;for(let Y=0;Y<i;Y+=2)A=A+L|0,k=we(k^A,16),T=T+k|0,L=we(L^T,12),A=A+L|0,k=we(k^A,8),T=T+k|0,L=we(L^T,7),O=O+j|0,_=we(_^O,16),w=w+_|0,j=we(j^w,12),O=O+j|0,_=we(_^O,8),w=w+_|0,j=we(j^w,7),D=D+$|0,N=we(N^D,16),E=E+N|0,$=we($^E,12),D=D+$|0,N=we(N^D,8),E=E+N|0,$=we($^E,7),B=B+U|0,z=we(z^B,16),C=C+z|0,U=we(U^C,12),B=B+U|0,z=we(z^B,8),C=C+z|0,U=we(U^C,7),A=A+j|0,z=we(z^A,16),E=E+z|0,j=we(j^E,12),A=A+j|0,z=we(z^A,8),E=E+z|0,j=we(j^E,7),O=O+$|0,k=we(k^O,16),C=C+k|0,$=we($^C,12),O=O+$|0,k=we(k^O,8),C=C+k|0,$=we($^C,7),D=D+U|0,_=we(_^D,16),T=T+_|0,U=we(U^T,12),D=D+U|0,_=we(_^D,8),T=T+_|0,U=we(U^T,7),B=B+L|0,N=we(N^B,16),w=w+N|0,L=we(L^w,12),B=B+L|0,N=we(N^B,8),w=w+N|0,L=we(L^w,7);let H=0;n[H++]=o+A|0,n[H++]=a+O|0,n[H++]=c+D|0,n[H++]=l+B|0,n[H++]=u+L|0,n[H++]=h+j|0,n[H++]=f+$|0,n[H++]=d+U|0,n[H++]=p+T|0,n[H++]=g+w|0,n[H++]=m+E|0,n[H++]=b+C|0,n[H++]=x+k|0,n[H++]=v+_|0,n[H++]=S+N|0,n[H++]=I+z|0}const HN=LN(zN,{counterRight:!1,counterLength:4,allowShortKeys:!1}),qN=new Uint8Array(16),Sm=(r,e)=>{r.update(e);const t=e.length%16;t&&r.update(qN.subarray(t))},VN=new Uint8Array(32);function Pm(r,e,t,n,s){const i=r(e,t,VN),o=jN.create(i);s&&Sm(o,s),Sm(o,n);const a=BN(n.length,s?s.length:0,!0);o.update(a);const c=o.digest();return Ma(i,a),c}const KN=r=>(e,t,n)=>({encrypt(s,i){const o=s.length;i=Am(o+16,i,!1),i.set(s);const a=i.subarray(0,-16);r(e,t,a,a,1);const c=Pm(r,e,t,a,n);return i.set(c,o),Ma(c),i},decrypt(s,i){i=Am(s.length-16,i,!1);const o=s.subarray(0,-16),a=s.subarray(-16),c=Pm(r,e,t,o,n);if(!DN(a,c))throw new Error("invalid tag");return i.set(s.subarray(0,-16)),r(e,t,i,i,1),Ma(c),i}}),WE=CN({blockSize:64,nonceLength:12,tagLength:16},KN(HN));let JE=class extends Ph{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,Sh(e);const n=zr(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,i=new Uint8Array(s);i.set(n.length>s?e.create().update(n).digest():n);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),Sr(i)}update(e){return Qs(this),this.iHash.update(e),this}digestInto(e){Qs(this),qr(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:s,destroyed:i,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=i,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const Dh=(r,e,t)=>new JE(r,e).update(t).digest();Dh.create=(r,e)=>new JE(r,e);function GN(r,e,t){return Sh(r),t===void 0&&(t=new Uint8Array(r.outputLen)),Dh(r,zr(t),zr(e))}const Cf=Uint8Array.from([0]),Om=Uint8Array.of();function QN(r,e,t,n=32){Sh(r),ns(n);const s=r.outputLen;if(n>255*s)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(n/s);t===void 0&&(t=Om);const o=new Uint8Array(i*s),a=Dh.create(r,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let u=0;u<i;u++)Cf[0]=u+1,c.update(u===0?Om:l).update(t).update(Cf).digestInto(l),o.set(l,s*u),a._cloneInto(c);return a.destroy(),c.destroy(),Sr(l,Cf),o.slice(0,n)}const WN=(r,e,t,n,s)=>QN(r,GN(r,e,t),n,s),Ch=Oh,wg=BigInt(0),lp=BigInt(1);function qu(r,e=""){if(typeof r!="boolean"){const t=e&&`"${e}"`;throw new Error(t+"expected boolean, got type="+typeof r)}return r}function Ai(r,e,t=""){const n=Ih(r),s=r==null?void 0:r.length,i=e!==void 0;if(!n||i&&s!==e){const o=t&&`"${t}" `,a=i?` of length ${e}`:"",c=n?`length=${s}`:`type=${typeof r}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return r}function Kl(r){const e=r.toString(16);return e.length&1?"0"+e:e}function YE(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?wg:BigInt("0x"+r)}function Bh(r){return YE(jo(r))}function Vu(r){return qr(r),YE(jo(Uint8Array.from(r).reverse()))}function bg(r,e){return zu(r.toString(16).padStart(e*2,"0"))}function vg(r,e){return bg(r,e).reverse()}function xt(r,e,t){let n;if(typeof e=="string")try{n=zu(e)}catch(i){throw new Error(r+" must be hex string or Uint8Array, cause: "+i)}else if(Ih(e))n=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");const s=n.length;if(typeof t=="number"&&s!==t)throw new Error(r+" of length "+t+" expected, got "+s);return n}const Bf=r=>typeof r=="bigint"&&wg<=r;function JN(r,e,t){return Bf(r)&&Bf(e)&&Bf(t)&&e<=r&&r<t}function up(r,e,t,n){if(!JN(e,t,n))throw new Error("expected valid "+r+": "+t+" <= n < "+n+", got "+e)}function ZE(r){let e;for(e=0;r>wg;r>>=lp,e+=1);return e}const El=r=>(lp<<BigInt(r))-lp;function YN(r,e,t){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");const n=f=>new Uint8Array(f),s=f=>Uint8Array.of(f);let i=n(r),o=n(r),a=0;const c=()=>{i.fill(1),o.fill(0),a=0},l=(...f)=>t(o,i,...f),u=(f=n(0))=>{o=l(s(0),f),i=l(),f.length!==0&&(o=l(s(1),f),i=l())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const d=[];for(;f<e;){i=l();const p=i.slice();d.push(p),f+=i.length}return xs(...d)};return(f,d)=>{c(),u(f);let p;for(;!(p=d(h()));)u();return c(),p}}function _h(r,e,t={}){if(!r||typeof r!="object")throw new Error("expected valid options object");function n(s,i,o){const a=r[s];if(o&&a===void 0)return;const c=typeof a;if(c!==i||a===null)throw new Error(`param "${s}" is invalid: expected ${i}, got ${c}`)}Object.entries(e).forEach(([s,i])=>n(s,i,!1)),Object.entries(t).forEach(([s,i])=>n(s,i,!0))}function Dm(r){const e=new WeakMap;return(t,...n)=>{const s=e.get(t);if(s!==void 0)return s;const i=r(t,...n);return e.set(t,i),i}}const Vt=BigInt(0),Tt=BigInt(1),xi=BigInt(2),XE=BigInt(3),e2=BigInt(4),t2=BigInt(5),ZN=BigInt(7),r2=BigInt(8),XN=BigInt(9),n2=BigInt(16);function or(r,e){const t=r%e;return t>=Vt?t:e+t}function Dr(r,e,t){let n=r;for(;e-- >Vt;)n*=n,n%=t;return n}function Cm(r,e){if(r===Vt)throw new Error("invert: expected non-zero number");if(e<=Vt)throw new Error("invert: expected positive modulus, got "+e);let t=or(r,e),n=e,s=Vt,i=Tt;for(;t!==Vt;){const o=n/t,a=n%t,c=s-i*o;n=t,t=a,s=i,i=c}if(n!==Tt)throw new Error("invert: does not exist");return or(s,e)}function Eg(r,e,t){if(!r.eql(r.sqr(e),t))throw new Error("Cannot find square root")}function s2(r,e){const t=(r.ORDER+Tt)/e2,n=r.pow(e,t);return Eg(r,n,e),n}function eR(r,e){const t=(r.ORDER-t2)/r2,n=r.mul(e,xi),s=r.pow(n,t),i=r.mul(e,s),o=r.mul(r.mul(i,xi),s),a=r.mul(i,r.sub(o,r.ONE));return Eg(r,a,e),a}function tR(r){const e=Zs(r),t=i2(r),n=t(e,e.neg(e.ONE)),s=t(e,n),i=t(e,e.neg(n)),o=(r+ZN)/n2;return(a,c)=>{let l=a.pow(c,o),u=a.mul(l,n);const h=a.mul(l,s),f=a.mul(l,i),d=a.eql(a.sqr(u),c),p=a.eql(a.sqr(h),c);l=a.cmov(l,u,d),u=a.cmov(f,h,p);const g=a.eql(a.sqr(u),c),m=a.cmov(l,u,g);return Eg(a,m,c),m}}function i2(r){if(r<XE)throw new Error("sqrt is not defined for small field");let e=r-Tt,t=0;for(;e%xi===Vt;)e/=xi,t++;let n=xi;const s=Zs(r);for(;Bm(s,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(t===1)return s2;let i=s.pow(n,e);const o=(e+Tt)/xi;return function(a,c){if(a.is0(c))return c;if(Bm(a,c)!==1)throw new Error("Cannot find square root");let l=t,u=a.mul(a.ONE,i),h=a.pow(c,e),f=a.pow(c,o);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let d=1,p=a.sqr(h);for(;!a.eql(p,a.ONE);)if(d++,p=a.sqr(p),d===l)throw new Error("Cannot find square root");const g=Tt<<BigInt(l-d-1),m=a.pow(u,g);l=d,u=a.sqr(m),h=a.mul(h,u),f=a.mul(f,m)}return f}}function rR(r){return r%e2===XE?s2:r%r2===t2?eR:r%n2===XN?tR(r):i2(r)}const nR=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function sR(r){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},t=nR.reduce((n,s)=>(n[s]="function",n),e);return _h(r,t),r}function iR(r,e,t){if(t<Vt)throw new Error("invalid exponent, negatives unsupported");if(t===Vt)return r.ONE;if(t===Tt)return e;let n=r.ONE,s=e;for(;t>Vt;)t&Tt&&(n=r.mul(n,s)),s=r.sqr(s),t>>=Tt;return n}function o2(r,e,t=!1){const n=new Array(e.length).fill(t?r.ZERO:void 0),s=e.reduce((o,a,c)=>r.is0(a)?o:(n[c]=o,r.mul(o,a)),r.ONE),i=r.inv(s);return e.reduceRight((o,a,c)=>r.is0(a)?o:(n[c]=r.mul(o,n[c]),r.mul(o,a)),i),n}function Bm(r,e){const t=(r.ORDER-Tt)/xi,n=r.pow(e,t),s=r.eql(n,r.ONE),i=r.eql(n,r.ZERO),o=r.eql(n,r.neg(r.ONE));if(!s&&!i&&!o)throw new Error("invalid Legendre symbol result");return s?1:i?0:-1}function a2(r,e){e!==void 0&&ns(e);const t=e!==void 0?e:r.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}function Zs(r,e,t=!1,n={}){if(r<=Vt)throw new Error("invalid field: expected ORDER > 0, got "+r);let s,i,o=!1,a;if(typeof e=="object"&&e!=null){if(n.sqrt||t)throw new Error("cannot specify opts in two arguments");const f=e;f.BITS&&(s=f.BITS),f.sqrt&&(i=f.sqrt),typeof f.isLE=="boolean"&&(t=f.isLE),typeof f.modFromBytes=="boolean"&&(o=f.modFromBytes),a=f.allowedLengths}else typeof e=="number"&&(s=e),n.sqrt&&(i=n.sqrt);const{nBitLength:c,nByteLength:l}=a2(r,s);if(l>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let u;const h=Object.freeze({ORDER:r,isLE:t,BITS:c,BYTES:l,MASK:El(c),ZERO:Vt,ONE:Tt,allowedLengths:a,create:f=>or(f,r),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return Vt<=f&&f<r},is0:f=>f===Vt,isValidNot0:f=>!h.is0(f)&&h.isValid(f),isOdd:f=>(f&Tt)===Tt,neg:f=>or(-f,r),eql:(f,d)=>f===d,sqr:f=>or(f*f,r),add:(f,d)=>or(f+d,r),sub:(f,d)=>or(f-d,r),mul:(f,d)=>or(f*d,r),pow:(f,d)=>iR(h,f,d),div:(f,d)=>or(f*Cm(d,r),r),sqrN:f=>f*f,addN:(f,d)=>f+d,subN:(f,d)=>f-d,mulN:(f,d)=>f*d,inv:f=>Cm(f,r),sqrt:i||(f=>(u||(u=rR(r)),u(h,f))),toBytes:f=>t?vg(f,l):bg(f,l),fromBytes:(f,d=!0)=>{if(a){if(!a.includes(f.length)||f.length>l)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+f.length);const g=new Uint8Array(l);g.set(f,t?0:g.length-f.length),f=g}if(f.length!==l)throw new Error("Field.fromBytes: expected "+l+" bytes, got "+f.length);let p=t?Vu(f):Bh(f);if(o&&(p=or(p,r)),!d&&!h.isValid(p))throw new Error("invalid field element: outside of range 0..ORDER");return p},invertBatch:f=>o2(h,f),cmov:(f,d,p)=>p?d:f});return Object.freeze(h)}function c2(r){if(typeof r!="bigint")throw new Error("field order must be bigint");const e=r.toString(2).length;return Math.ceil(e/8)}function l2(r){const e=c2(r);return e+Math.ceil(e/2)}function oR(r,e,t=!1){const n=r.length,s=c2(e),i=l2(e);if(n<16||n<i||n>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+n);const o=t?Vu(r):Bh(r),a=or(o,e-Tt)+Tt;return t?vg(a,s):bg(a,s)}const ja=BigInt(0),Ii=BigInt(1);function Ku(r,e){const t=e.negate();return r?t:e}function _f(r,e){const t=o2(r.Fp,e.map(n=>n.Z));return e.map((n,s)=>r.fromAffine(n.toAffine(t[s])))}function u2(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function Tf(r,e){u2(r,e);const t=Math.ceil(e/r)+1,n=2**(r-1),s=2**r,i=El(r),o=BigInt(r);return{windows:t,windowSize:n,mask:i,maxNumber:s,shiftBy:o}}function _m(r,e,t){const{windowSize:n,mask:s,maxNumber:i,shiftBy:o}=t;let a=Number(r&s),c=r>>o;a>n&&(a-=i,c+=Ii);const l=e*n,u=l+Math.abs(a)-1,h=a===0,f=a<0,d=e%2!==0;return{nextN:c,offset:u,isZero:h,isNeg:f,isNegF:d,offsetF:l}}function aR(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,n)=>{if(!(t instanceof e))throw new Error("invalid point at index "+n)})}function cR(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,n)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+n)})}const Nf=new WeakMap,h2=new WeakMap;function Rf(r){return h2.get(r)||1}function Tm(r){if(r!==ja)throw new Error("invalid wNAF")}class lR{constructor(e,t){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=t}_unsafeLadder(e,t,n=this.ZERO){let s=e;for(;t>ja;)t&Ii&&(n=n.add(s)),s=s.double(),t>>=Ii;return n}precomputeWindow(e,t){const{windows:n,windowSize:s}=Tf(t,this.bits),i=[];let o=e,a=o;for(let c=0;c<n;c++){a=o,i.push(a);for(let l=1;l<s;l++)a=a.add(o),i.push(a);o=a.double()}return i}wNAF(e,t,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let s=this.ZERO,i=this.BASE;const o=Tf(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:l,isZero:u,isNeg:h,isNegF:f,offsetF:d}=_m(n,a,o);n=c,u?i=i.add(Ku(f,t[d])):s=s.add(Ku(h,t[l]))}return Tm(n),{p:s,f:i}}wNAFUnsafe(e,t,n,s=this.ZERO){const i=Tf(e,this.bits);for(let o=0;o<i.windows&&n!==ja;o++){const{nextN:a,offset:c,isZero:l,isNeg:u}=_m(n,o,i);if(n=a,!l){const h=t[c];s=s.add(u?h.negate():h)}}return Tm(n),s}getPrecomputes(e,t,n){let s=Nf.get(t);return s||(s=this.precomputeWindow(t,e),e!==1&&(typeof n=="function"&&(s=n(s)),Nf.set(t,s))),s}cached(e,t,n){const s=Rf(e);return this.wNAF(s,this.getPrecomputes(s,e,n),t)}unsafe(e,t,n,s){const i=Rf(e);return i===1?this._unsafeLadder(e,t,s):this.wNAFUnsafe(i,this.getPrecomputes(i,e,n),t,s)}createCache(e,t){u2(t,this.bits),h2.set(e,t),Nf.delete(e)}hasCache(e){return Rf(e)!==1}}function uR(r,e,t,n){let s=e,i=r.ZERO,o=r.ZERO;for(;t>ja||n>ja;)t&Ii&&(i=i.add(s)),n&Ii&&(o=o.add(s)),s=s.double(),t>>=Ii,n>>=Ii;return{p1:i,p2:o}}function hR(r,e,t,n){aR(t,r),cR(n,e);const s=t.length,i=n.length;if(s!==i)throw new Error("arrays of points and scalars must have equal length");const o=r.ZERO,a=ZE(BigInt(s));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=El(c),u=new Array(Number(l)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let f=o;for(let d=h;d>=0;d-=c){u.fill(o);for(let g=0;g<i;g++){const m=n[g],b=Number(m>>BigInt(d)&l);u[b]=u[b].add(t[g])}let p=o;for(let g=u.length-1,m=o;g>0;g--)m=m.add(u[g]),p=p.add(m);if(f=f.add(p),d!==0)for(let g=0;g<c;g++)f=f.double()}return f}function Nm(r,e,t){if(e){if(e.ORDER!==r)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return sR(e),e}else return Zs(r,{isLE:t})}function fR(r,e,t={},n){if(n===void 0&&(n=r==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${r} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!(typeof c=="bigint"&&c>ja))throw new Error(`CURVE.${a} must be positive bigint`)}const s=Nm(e.p,t.Fp,n),i=Nm(e.n,t.Fn,n),o=["Gx","Gy","a","b"];for(const a of o)if(!s.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:s,Fn:i}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),UE("HashToScalar-");const cc=BigInt(0),wo=BigInt(1),Gl=BigInt(2);function dR(r){return _h(r,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...r})}function pR(r){const e=dR(r),{P:t,type:n,adjustScalarBytes:s,powPminus2:i,randomBytes:o}=e,a=n==="x25519";if(!a&&n!=="x448")throw new Error("invalid type");const c=o||so,l=a?255:448,u=a?32:56,h=BigInt(a?9:5),f=BigInt(a?121665:39081),d=a?Gl**BigInt(254):Gl**BigInt(447),p=a?BigInt(8)*Gl**BigInt(251)-wo:BigInt(4)*Gl**BigInt(445)-wo,g=d+p+wo,m=$=>or($,t),b=x(h);function x($){return vg(m($),u)}function v($){const U=xt("u coordinate",$,u);return a&&(U[31]&=127),m(Vu(U))}function S($){return Vu(s(xt("scalar",$,u)))}function I($,U){const T=D(v(U),S($));if(T===cc)throw new Error("invalid private or public key received");return x(T)}function A($){return I($,b)}function O($,U,T){const w=m($*(U-T));return U=m(U-w),T=m(T+w),{x_2:U,x_3:T}}function D($,U){up("u",$,cc,t),up("scalar",U,d,g);const T=U,w=$;let E=wo,C=cc,k=$,_=wo,N=cc;for(let H=BigInt(l-1);H>=cc;H--){const Y=T>>H&wo;N^=Y,{x_2:E,x_3:k}=O(N,E,k),{x_2:C,x_3:_}=O(N,C,_),N=Y;const G=E+C,Q=m(G*G),ee=E-C,se=m(ee*ee),le=Q-se,ne=k+_,fe=k-_,Re=m(fe*G),ze=m(ne*ee),Ue=Re+ze,pt=Re-ze;k=m(Ue*Ue),_=m(w*m(pt*pt)),E=m(Q*se),C=m(le*(Q+m(f*le)))}({x_2:E,x_3:k}=O(N,E,k)),{x_2:C,x_3:_}=O(N,C,_);const z=i(C);return m(E*z)}const B={secretKey:u,publicKey:u,seed:u},L=($=c(u))=>(qr($,B.seed),$);function j($){const U=L($);return{secretKey:U,publicKey:A(U)}}return{keygen:j,getSharedSecret:($,U)=>I($,U),getPublicKey:$=>A($),scalarMult:I,scalarMultBase:A,utils:{randomSecretKey:L,randomPrivateKey:L},GuBytes:b.slice(),lengths:B}}const gR=BigInt(1),Rm=BigInt(2),yR=BigInt(3),mR=BigInt(5);BigInt(8);const f2=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),wR={p:f2,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function bR(r){const e=BigInt(10),t=BigInt(20),n=BigInt(40),s=BigInt(80),i=f2,o=r*r%i*r%i,a=Dr(o,Rm,i)*o%i,c=Dr(a,gR,i)*r%i,l=Dr(c,mR,i)*c%i,u=Dr(l,e,i)*l%i,h=Dr(u,t,i)*u%i,f=Dr(h,n,i)*h%i,d=Dr(f,s,i)*f%i,p=Dr(d,s,i)*f%i,g=Dr(p,e,i)*l%i;return{pow_p_5_8:Dr(g,Rm,i)*r%i,b2:o}}function vR(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}const ER=Zs(wR.p,{isLE:!0}),hp=(()=>{const r=ER.ORDER;return pR({P:r,type:"x25519",powPminus2:e=>{const{pow_p_5_8:t,b2:n}=bR(e);return or(Dr(t,yR,r)*n,r)},adjustScalarBytes:vR})})(),Um=(r,e)=>(r+(r>=0?e:-e)/d2)/e;function AR(r,e,t){const[[n,s],[i,o]]=e,a=Um(o*r,t),c=Um(-s*r,t);let l=r-a*n-c*i,u=-a*s-c*o;const h=l<Qn,f=u<Qn;h&&(l=-l),f&&(u=-u);const d=El(Math.ceil(ZE(t)/2))+zo;if(l<Qn||l>=d||u<Qn||u>=d)throw new Error("splitScalar (endomorphism): failed, k="+r);return{k1neg:h,k1:l,k2neg:f,k2:u}}function fp(r){if(!["compact","recovered","der"].includes(r))throw new Error('Signature format must be "compact", "recovered", or "der"');return r}function Uf(r,e){const t={};for(let n of Object.keys(e))t[n]=r[n]===void 0?e[n]:r[n];return qu(t.lowS,"lowS"),qu(t.prehash,"prehash"),t.format!==void 0&&fp(t.format),t}class xR extends Error{constructor(e=""){super(e)}}const Rn={Err:xR,_tlv:{encode:(r,e)=>{const{Err:t}=Rn;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const n=e.length/2,s=Kl(n);if(s.length/2&128)throw new t("tlv.encode: long form length too big");const i=n>127?Kl(s.length/2|128):"";return Kl(r)+i+s+e},decode(r,e){const{Err:t}=Rn;let n=0;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[n++]!==r)throw new t("tlv.decode: wrong tlv");const s=e[n++],i=!!(s&128);let o=0;if(!i)o=s;else{const c=s&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");const l=e.subarray(n,n+c);if(l.length!==c)throw new t("tlv.decode: length bytes not complete");if(l[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(n+=c,o<128)throw new t("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(r){const{Err:e}=Rn;if(r<Qn)throw new e("integer: negative integers are not allowed");let t=Kl(r);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(r){const{Err:e}=Rn;if(r[0]&128)throw new e("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return Bh(r)}},toSig(r){const{Err:e,_int:t,_tlv:n}=Rn,s=xt("signature",r),{v:i,l:o}=n.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,i),{v:l,l:u}=n.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(l)}},hexFromSig(r){const{_tlv:e,_int:t}=Rn,n=e.encode(2,t.encode(r.r)),s=e.encode(2,t.encode(r.s)),i=n+s;return e.encode(48,i)}},Qn=BigInt(0),zo=BigInt(1),d2=BigInt(2),Ql=BigInt(3),IR=BigInt(4);function Bo(r,e){const{BYTES:t}=r;let n;if(typeof e=="bigint")n=e;else{let s=xt("private key",e);try{n=r.fromBytes(s)}catch{throw new Error(`invalid private key: expected ui8a of size ${t}, got ${typeof e}`)}}if(!r.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function SR(r,e={}){const t=fR("weierstrass",r,e),{Fp:n,Fn:s}=t;let i=t.CURVE;const{h:o,n:a}=i;_h(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!n.is0(i.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const l=g2(n,s);function u(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h($,U,T){const{x:w,y:E}=U.toAffine(),C=n.toBytes(w);if(qu(T,"isCompressed"),T){u();const k=!n.isOdd(E);return xs(p2(k),C)}else return xs(Uint8Array.of(4),C,n.toBytes(E))}function f($){Ai($,void 0,"Point");const{publicKey:U,publicKeyUncompressed:T}=l,w=$.length,E=$[0],C=$.subarray(1);if(w===U&&(E===2||E===3)){const k=n.fromBytes(C);if(!n.isValid(k))throw new Error("bad point: is not on curve, wrong x");const _=g(k);let N;try{N=n.sqrt(_)}catch(H){const Y=H instanceof Error?": "+H.message:"";throw new Error("bad point: is not on curve, sqrt error"+Y)}u();const z=n.isOdd(N);return(E&1)===1!==z&&(N=n.neg(N)),{x:k,y:N}}else if(w===T&&E===4){const k=n.BYTES,_=n.fromBytes(C.subarray(0,k)),N=n.fromBytes(C.subarray(k,k*2));if(!m(_,N))throw new Error("bad point: is not on curve");return{x:_,y:N}}else throw new Error(`bad point: got length ${w}, expected compressed=${U} or uncompressed=${T}`)}const d=e.toBytes||h,p=e.fromBytes||f;function g($){const U=n.sqr($),T=n.mul(U,$);return n.add(n.add(T,n.mul($,i.a)),i.b)}function m($,U){const T=n.sqr(U),w=g($);return n.eql(T,w)}if(!m(i.Gx,i.Gy))throw new Error("bad curve params: generator point");const b=n.mul(n.pow(i.a,Ql),IR),x=n.mul(n.sqr(i.b),BigInt(27));if(n.is0(n.add(b,x)))throw new Error("bad curve params: a or b");function v($,U,T=!1){if(!n.isValid(U)||T&&n.is0(U))throw new Error(`bad point coordinate ${$}`);return U}function S($){if(!($ instanceof B))throw new Error("ProjectivePoint expected")}function I($){if(!c||!c.basises)throw new Error("no endo");return AR($,c.basises,s.ORDER)}const A=Dm(($,U)=>{const{X:T,Y:w,Z:E}=$;if(n.eql(E,n.ONE))return{x:T,y:w};const C=$.is0();U==null&&(U=C?n.ONE:n.inv(E));const k=n.mul(T,U),_=n.mul(w,U),N=n.mul(E,U);if(C)return{x:n.ZERO,y:n.ZERO};if(!n.eql(N,n.ONE))throw new Error("invZ was invalid");return{x:k,y:_}}),O=Dm($=>{if($.is0()){if(e.allowInfinityPoint&&!n.is0($.Y))return;throw new Error("bad point: ZERO")}const{x:U,y:T}=$.toAffine();if(!n.isValid(U)||!n.isValid(T))throw new Error("bad point: x or y not field elements");if(!m(U,T))throw new Error("bad point: equation left != right");if(!$.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function D($,U,T,w,E){return T=new B(n.mul(T.X,$),T.Y,T.Z),U=Ku(w,U),T=Ku(E,T),U.add(T)}class B{constructor(U,T,w){this.X=v("x",U),this.Y=v("y",T,!0),this.Z=v("z",w),Object.freeze(this)}static CURVE(){return i}static fromAffine(U){const{x:T,y:w}=U||{};if(!U||!n.isValid(T)||!n.isValid(w))throw new Error("invalid affine point");if(U instanceof B)throw new Error("projective point not allowed");return n.is0(T)&&n.is0(w)?B.ZERO:new B(T,w,n.ONE)}static fromBytes(U){const T=B.fromAffine(p(Ai(U,void 0,"point")));return T.assertValidity(),T}static fromHex(U){return B.fromBytes(xt("pointHex",U))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(U=8,T=!0){return j.createCache(this,U),T||this.multiply(Ql),this}assertValidity(){O(this)}hasEvenY(){const{y:U}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(U)}equals(U){S(U);const{X:T,Y:w,Z:E}=this,{X:C,Y:k,Z:_}=U,N=n.eql(n.mul(T,_),n.mul(C,E)),z=n.eql(n.mul(w,_),n.mul(k,E));return N&&z}negate(){return new B(this.X,n.neg(this.Y),this.Z)}double(){const{a:U,b:T}=i,w=n.mul(T,Ql),{X:E,Y:C,Z:k}=this;let _=n.ZERO,N=n.ZERO,z=n.ZERO,H=n.mul(E,E),Y=n.mul(C,C),G=n.mul(k,k),Q=n.mul(E,C);return Q=n.add(Q,Q),z=n.mul(E,k),z=n.add(z,z),_=n.mul(U,z),N=n.mul(w,G),N=n.add(_,N),_=n.sub(Y,N),N=n.add(Y,N),N=n.mul(_,N),_=n.mul(Q,_),z=n.mul(w,z),G=n.mul(U,G),Q=n.sub(H,G),Q=n.mul(U,Q),Q=n.add(Q,z),z=n.add(H,H),H=n.add(z,H),H=n.add(H,G),H=n.mul(H,Q),N=n.add(N,H),G=n.mul(C,k),G=n.add(G,G),H=n.mul(G,Q),_=n.sub(_,H),z=n.mul(G,Y),z=n.add(z,z),z=n.add(z,z),new B(_,N,z)}add(U){S(U);const{X:T,Y:w,Z:E}=this,{X:C,Y:k,Z:_}=U;let N=n.ZERO,z=n.ZERO,H=n.ZERO;const Y=i.a,G=n.mul(i.b,Ql);let Q=n.mul(T,C),ee=n.mul(w,k),se=n.mul(E,_),le=n.add(T,w),ne=n.add(C,k);le=n.mul(le,ne),ne=n.add(Q,ee),le=n.sub(le,ne),ne=n.add(T,E);let fe=n.add(C,_);return ne=n.mul(ne,fe),fe=n.add(Q,se),ne=n.sub(ne,fe),fe=n.add(w,E),N=n.add(k,_),fe=n.mul(fe,N),N=n.add(ee,se),fe=n.sub(fe,N),H=n.mul(Y,ne),N=n.mul(G,se),H=n.add(N,H),N=n.sub(ee,H),H=n.add(ee,H),z=n.mul(N,H),ee=n.add(Q,Q),ee=n.add(ee,Q),se=n.mul(Y,se),ne=n.mul(G,ne),ee=n.add(ee,se),se=n.sub(Q,se),se=n.mul(Y,se),ne=n.add(ne,se),Q=n.mul(ee,ne),z=n.add(z,Q),Q=n.mul(fe,ne),N=n.mul(le,N),N=n.sub(N,Q),Q=n.mul(le,ee),H=n.mul(fe,H),H=n.add(H,Q),new B(N,z,H)}subtract(U){return this.add(U.negate())}is0(){return this.equals(B.ZERO)}multiply(U){const{endo:T}=e;if(!s.isValidNot0(U))throw new Error("invalid scalar: out of range");let w,E;const C=k=>j.cached(this,k,_=>_f(B,_));if(T){const{k1neg:k,k1:_,k2neg:N,k2:z}=I(U),{p:H,f:Y}=C(_),{p:G,f:Q}=C(z);E=Y.add(Q),w=D(T.beta,H,G,k,N)}else{const{p:k,f:_}=C(U);w=k,E=_}return _f(B,[w,E])[0]}multiplyUnsafe(U){const{endo:T}=e,w=this;if(!s.isValid(U))throw new Error("invalid scalar: out of range");if(U===Qn||w.is0())return B.ZERO;if(U===zo)return w;if(j.hasCache(this))return this.multiply(U);if(T){const{k1neg:E,k1:C,k2neg:k,k2:_}=I(U),{p1:N,p2:z}=uR(B,w,C,_);return D(T.beta,N,z,E,k)}else return j.unsafe(w,U)}multiplyAndAddUnsafe(U,T,w){const E=this.multiplyUnsafe(T).add(U.multiplyUnsafe(w));return E.is0()?void 0:E}toAffine(U){return A(this,U)}isTorsionFree(){const{isTorsionFree:U}=e;return o===zo?!0:U?U(B,this):j.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:U}=e;return o===zo?this:U?U(B,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(U=!0){return qu(U,"isCompressed"),this.assertValidity(),d(B,this,U)}toHex(U=!0){return jo(this.toBytes(U))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(U=!0){return this.toBytes(U)}_setWindowSize(U){this.precompute(U)}static normalizeZ(U){return _f(B,U)}static msm(U,T){return hR(B,s,U,T)}static fromPrivateKey(U){return B.BASE.multiply(Bo(s,U))}}B.BASE=new B(i.Gx,i.Gy,n.ONE),B.ZERO=new B(n.ZERO,n.ONE,n.ZERO),B.Fp=n,B.Fn=s;const L=s.BITS,j=new lR(B,e.endo?Math.ceil(L/2):L);return B.BASE.precompute(8),B}function p2(r){return Uint8Array.of(r?2:3)}function g2(r,e){return{secretKey:e.BYTES,publicKey:1+r.BYTES,publicKeyUncompressed:1+2*r.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function PR(r,e={}){const{Fn:t}=r,n=e.randomBytes||so,s=Object.assign(g2(r.Fp,t),{seed:l2(t.ORDER)});function i(f){try{return!!Bo(t,f)}catch{return!1}}function o(f,d){const{publicKey:p,publicKeyUncompressed:g}=s;try{const m=f.length;return d===!0&&m!==p||d===!1&&m!==g?!1:!!r.fromBytes(f)}catch{return!1}}function a(f=n(s.seed)){return oR(Ai(f,s.seed,"seed"),t.ORDER)}function c(f,d=!0){return r.BASE.multiply(Bo(t,f)).toBytes(d)}function l(f){const d=a(f);return{secretKey:d,publicKey:c(d)}}function u(f){if(typeof f=="bigint")return!1;if(f instanceof r)return!0;const{secretKey:d,publicKey:p,publicKeyUncompressed:g}=s;if(t.allowedLengths||d===p)return;const m=xt("key",f).length;return m===p||m===g}function h(f,d,p=!0){if(u(f)===!0)throw new Error("first arg must be private key");if(u(d)===!1)throw new Error("second arg must be public key");const g=Bo(t,f);return r.fromHex(d).multiply(g).toBytes(p)}return Object.freeze({getPublicKey:c,getSharedSecret:h,keygen:l,Point:r,utils:{isValidSecretKey:i,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:i,randomPrivateKey:a,normPrivateKeyToScalar:f=>Bo(t,f),precompute(f=8,d=r.BASE){return d.precompute(f,!1)}},lengths:s})}function OR(r,e,t={}){Sh(e),_h(t,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const n=t.randomBytes||so,s=t.hmac||((T,...w)=>Dh(e,T,xs(...w))),{Fp:i,Fn:o}=r,{ORDER:a,BITS:c}=o,{keygen:l,getPublicKey:u,getSharedSecret:h,utils:f,lengths:d}=PR(r,t),p={prehash:!1,lowS:typeof t.lowS=="boolean"?t.lowS:!1,format:void 0,extraEntropy:!1},g="compact";function m(T){const w=a>>zo;return T>w}function b(T,w){if(!o.isValidNot0(w))throw new Error(`invalid signature ${T}: out of range 1..Point.Fn.ORDER`);return w}function x(T,w){fp(w);const E=d.signature,C=w==="compact"?E:w==="recovered"?E+1:void 0;return Ai(T,C,`${w} signature`)}class v{constructor(w,E,C){this.r=b("r",w),this.s=b("s",E),C!=null&&(this.recovery=C),Object.freeze(this)}static fromBytes(w,E=g){x(w,E);let C;if(E==="der"){const{r:z,s:H}=Rn.toSig(Ai(w));return new v(z,H)}E==="recovered"&&(C=w[0],E="compact",w=w.subarray(1));const k=o.BYTES,_=w.subarray(0,k),N=w.subarray(k,k*2);return new v(o.fromBytes(_),o.fromBytes(N),C)}static fromHex(w,E){return this.fromBytes(zu(w),E)}addRecoveryBit(w){return new v(this.r,this.s,w)}recoverPublicKey(w){const E=i.ORDER,{r:C,s:k,recovery:_}=this;if(_==null||![0,1,2,3].includes(_))throw new Error("recovery id invalid");if(a*d2<E&&_>1)throw new Error("recovery id is ambiguous for h>1 curve");const N=_===2||_===3?C+a:C;if(!i.isValid(N))throw new Error("recovery id 2 or 3 invalid");const z=i.toBytes(N),H=r.fromBytes(xs(p2((_&1)===0),z)),Y=o.inv(N),G=I(xt("msgHash",w)),Q=o.create(-G*Y),ee=o.create(k*Y),se=r.BASE.multiplyUnsafe(Q).add(H.multiplyUnsafe(ee));if(se.is0())throw new Error("point at infinify");return se.assertValidity(),se}hasHighS(){return m(this.s)}toBytes(w=g){if(fp(w),w==="der")return zu(Rn.hexFromSig(this));const E=o.toBytes(this.r),C=o.toBytes(this.s);if(w==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return xs(Uint8Array.of(this.recovery),E,C)}return xs(E,C)}toHex(w){return jo(this.toBytes(w))}assertValidity(){}static fromCompact(w){return v.fromBytes(xt("sig",w),"compact")}static fromDER(w){return v.fromBytes(xt("sig",w),"der")}normalizeS(){return this.hasHighS()?new v(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return jo(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return jo(this.toBytes("compact"))}}const S=t.bits2int||function(T){if(T.length>8192)throw new Error("input is too large");const w=Bh(T),E=T.length*8-c;return E>0?w>>BigInt(E):w},I=t.bits2int_modN||function(T){return o.create(S(T))},A=El(c);function O(T){return up("num < 2^"+c,T,Qn,A),o.toBytes(T)}function D(T,w){return Ai(T,void 0,"message"),w?Ai(e(T),void 0,"prehashed message"):T}function B(T,w,E){if(["recovered","canonical"].some(ee=>ee in E))throw new Error("sign() legacy options not supported");const{lowS:C,prehash:k,extraEntropy:_}=Uf(E,p);T=D(T,k);const N=I(T),z=Bo(o,w),H=[O(z),O(N)];if(_!=null&&_!==!1){const ee=_===!0?n(d.secretKey):_;H.push(xt("extraEntropy",ee))}const Y=xs(...H),G=N;function Q(ee){const se=S(ee);if(!o.isValidNot0(se))return;const le=o.inv(se),ne=r.BASE.multiply(se).toAffine(),fe=o.create(ne.x);if(fe===Qn)return;const Re=o.create(le*o.create(G+fe*z));if(Re===Qn)return;let ze=(ne.x===fe?0:2)|Number(ne.y&zo),Ue=Re;return C&&m(Re)&&(Ue=o.neg(Re),ze^=1),new v(fe,Ue,ze)}return{seed:Y,k2sig:Q}}function L(T,w,E={}){T=xt("message",T);const{seed:C,k2sig:k}=B(T,w,E);return YN(e.outputLen,o.BYTES,s)(C,k)}function j(T){let w;const E=typeof T=="string"||Ih(T),C=!E&&T!==null&&typeof T=="object"&&typeof T.r=="bigint"&&typeof T.s=="bigint";if(!E&&!C)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(C)w=new v(T.r,T.s);else if(E){try{w=v.fromBytes(xt("sig",T),"der")}catch(k){if(!(k instanceof Rn.Err))throw k}if(!w)try{w=v.fromBytes(xt("sig",T),"compact")}catch{return!1}}return w||!1}function $(T,w,E,C={}){const{lowS:k,prehash:_,format:N}=Uf(C,p);if(E=xt("publicKey",E),w=D(xt("message",w),_),"strict"in C)throw new Error("options.strict was renamed to lowS");const z=N===void 0?j(T):v.fromBytes(xt("sig",T),N);if(z===!1)return!1;try{const H=r.fromBytes(E);if(k&&z.hasHighS())return!1;const{r:Y,s:G}=z,Q=I(w),ee=o.inv(G),se=o.create(Q*ee),le=o.create(Y*ee),ne=r.BASE.multiplyUnsafe(se).add(H.multiplyUnsafe(le));return ne.is0()?!1:o.create(ne.x)===Y}catch{return!1}}function U(T,w,E={}){const{prehash:C}=Uf(E,p);return w=D(w,C),v.fromBytes(T,"recovered").recoverPublicKey(w).toBytes()}return Object.freeze({keygen:l,getPublicKey:u,getSharedSecret:h,utils:f,lengths:d,Point:r,sign:L,verify:$,recoverPublicKey:U,Signature:v,hash:e})}function DR(r){const e={a:r.a,b:r.b,p:r.Fp.ORDER,n:r.n,h:r.h,Gx:r.Gx,Gy:r.Gy},t=r.Fp;let n=r.allowedPrivateKeyLengths?Array.from(new Set(r.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const s=Zs(e.n,{BITS:r.nBitLength,allowedLengths:n,modFromBytes:r.wrapPrivateKey}),i={Fp:t,Fn:s,allowInfinityPoint:r.allowInfinityPoint,endo:r.endo,isTorsionFree:r.isTorsionFree,clearCofactor:r.clearCofactor,fromBytes:r.fromBytes,toBytes:r.toBytes};return{CURVE:e,curveOpts:i}}function CR(r){const{CURVE:e,curveOpts:t}=DR(r),n={hmac:r.hmac,randomBytes:r.randomBytes,lowS:r.lowS,bits2int:r.bits2int,bits2int_modN:r.bits2int_modN};return{CURVE:e,curveOpts:t,hash:r.hash,ecdsaOpts:n}}function BR(r,e){const t=e.Point;return Object.assign({},e,{ProjectivePoint:t,CURVE:Object.assign({},r,a2(t.Fn.ORDER,t.Fn.BITS))})}function _R(r){const{CURVE:e,curveOpts:t,hash:n,ecdsaOpts:s}=CR(r),i=SR(e,t),o=OR(i,n,s);return BR(r,o)}function dp(r,e){const t=n=>_R({...r,hash:n});return{...t(e),create:t}}const y2={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},m2={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},w2={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},TR=Zs(y2.p),NR=Zs(m2.p),RR=Zs(w2.p),UR=dp({...y2,Fp:TR,lowS:!1},Oh);dp({...m2,Fp:NR,lowS:!1},zT),dp({...w2,Fp:RR,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},jT);const kR=UR,b2="base10",Nt="base16",Ht="base64pad",Is="base64url",Al="utf8",v2=0,Zn=1,xl=2,$R=0,km=1,Cc=12,Ag=32;function LR(){const r=hp.utils.randomPrivateKey(),e=hp.getPublicKey(r);return{privateKey:Gt(r,Nt),publicKey:Gt(e,Nt)}}function pp(){const r=so(Ag);return Gt(r,Nt)}function FR(r,e){const t=hp.getSharedSecret(xr(r,Nt),xr(e,Nt)),n=WN(Ch,t,void 0,void 0,Ag);return Gt(n,Nt)}function yu(r){const e=Ch(xr(r,Nt));return Gt(e,Nt)}function Er(r){const e=Ch(xr(r,Al));return Gt(e,Nt)}function E2(r){return xr(`${r}`,b2)}function eo(r){return Number(Gt(r,b2))}function A2(r){return r.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function x2(r){const e=r.replace(/-/g,"+").replace(/_/g,"/"),t=(4-e.length%4)%4;return e+"=".repeat(t)}function MR(r){const e=E2(typeof r.type<"u"?r.type:v2);if(eo(e)===Zn&&typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const t=typeof r.senderPublicKey<"u"?xr(r.senderPublicKey,Nt):void 0,n=typeof r.iv<"u"?xr(r.iv,Nt):so(Cc),s=xr(r.symKey,Nt),i=WE(s,n).encrypt(xr(r.message,Al)),o=I2({type:e,sealed:i,iv:n,senderPublicKey:t});return r.encoding===Is?A2(o):o}function jR(r){const e=xr(r.symKey,Nt),{sealed:t,iv:n}=Wc({encoded:r.encoded,encoding:r.encoding}),s=WE(e,n).decrypt(t);if(s===null)throw new Error("Failed to decrypt");return Gt(s,Al)}function zR(r,e){const t=E2(xl),n=so(Cc),s=xr(r,Al),i=I2({type:t,sealed:s,iv:n});return e===Is?A2(i):i}function HR(r,e){const{sealed:t}=Wc({encoded:r,encoding:e});return Gt(t,Al)}function I2(r){if(eo(r.type)===xl)return Gt(Dc([r.type,r.sealed]),Ht);if(eo(r.type)===Zn){if(typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Gt(Dc([r.type,r.senderPublicKey,r.iv,r.sealed]),Ht)}return Gt(Dc([r.type,r.iv,r.sealed]),Ht)}function Wc(r){const e=(r.encoding||Ht)===Is?x2(r.encoded):r.encoded,t=xr(e,Ht),n=t.slice($R,km),s=km;if(eo(n)===Zn){const c=s+Ag,l=c+Cc,u=t.slice(s,c),h=t.slice(c,l),f=t.slice(l);return{type:n,sealed:f,iv:h,senderPublicKey:u}}if(eo(n)===xl){const c=t.slice(s),l=so(Cc);return{type:n,sealed:c,iv:l}}const i=s+Cc,o=t.slice(s,i),a=t.slice(i);return{type:n,sealed:a,iv:o}}function qR(r,e){const t=Wc({encoded:r,encoding:e==null?void 0:e.encoding});return S2({type:eo(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?Gt(t.senderPublicKey,Nt):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function S2(r){const e=(r==null?void 0:r.type)||v2;if(e===Zn){if(typeof(r==null?void 0:r.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(r==null?void 0:r.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:r==null?void 0:r.senderPublicKey,receiverPublicKey:r==null?void 0:r.receiverPublicKey}}function $m(r){return r.type===Zn&&typeof r.senderPublicKey=="string"&&typeof r.receiverPublicKey=="string"}function Lm(r){return r.type===xl}function VR(r){const e=Buffer.from(r.x,"base64"),t=Buffer.from(r.y,"base64");return Dc([new Uint8Array([4]),e,t])}function KR(r,e){const[t,n,s]=r.split("."),i=Buffer.from(x2(s),"base64");if(i.length!==64)throw new Error("Invalid signature length");const o=i.slice(0,32),a=i.slice(32,64),c=`${t}.${n}`,l=Ch(c),u=VR(e);if(!kR.verify(Dc([o,a]),l,u))throw new Error("Invalid signature");return ep(r).payload}const GR="irn";function Gu(r){return(r==null?void 0:r.relay)||{protocol:GR}}function _o(r){const e=C_[r];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${r}`);return e}var QR=Object.defineProperty,WR=Object.defineProperties,JR=Object.getOwnPropertyDescriptors,Fm=Object.getOwnPropertySymbols,YR=Object.prototype.hasOwnProperty,ZR=Object.prototype.propertyIsEnumerable,Mm=(r,e,t)=>e in r?QR(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,kf=(r,e)=>{for(var t in e||(e={}))YR.call(e,t)&&Mm(r,t,e[t]);if(Fm)for(var t of Fm(e))ZR.call(e,t)&&Mm(r,t,e[t]);return r},XR=(r,e)=>WR(r,JR(e));function e4(r,e="-"){const t={},n="relay"+e;return Object.keys(r).forEach(s=>{if(s.startsWith(n)){const i=s.replace(n,""),o=r[s];t[i]=o}}),t}function jm(r){if(!r.includes("wc:")){const l=CE(r);l!=null&&l.includes("wc:")&&(r=l)}r=r.includes("wc://")?r.replace("wc://",""):r,r=r.includes("wc:")?r.replace("wc:",""):r;const e=r.indexOf(":"),t=r.indexOf("?")!==-1?r.indexOf("?"):void 0,n=r.substring(0,e),s=r.substring(e+1,t).split("@"),i=typeof t<"u"?r.substring(t):"",o=new URLSearchParams(i),a=Object.fromEntries(o.entries()),c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:n,topic:t4(s[0]),version:parseInt(s[1],10),symKey:a.symKey,relay:e4(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function t4(r){return r.startsWith("//")?r.substring(2):r}function r4(r,e="-"){const t="relay",n={};return Object.keys(r).forEach(s=>{const i=s,o=t+e+i;r[i]&&(n[o]=r[i])}),n}function zm(r){const e=new URLSearchParams,t=kf(kf(XR(kf({},r4(r.relay)),{symKey:r.symKey}),r.expiryTimestamp&&{expiryTimestamp:r.expiryTimestamp.toString()}),r.methods&&{methods:r.methods.join(",")});return Object.entries(t).sort(([n],[s])=>n.localeCompare(s)).forEach(([n,s])=>{s!==void 0&&e.append(n,String(s))}),`${r.protocol}:${r.topic}@${r.version}?${e}`}function Wl(r,e,t){return`${r}?wc_ev=${t}&topic=${e}`}var n4=Object.defineProperty,s4=Object.defineProperties,i4=Object.getOwnPropertyDescriptors,Hm=Object.getOwnPropertySymbols,o4=Object.prototype.hasOwnProperty,a4=Object.prototype.propertyIsEnumerable,qm=(r,e,t)=>e in r?n4(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,c4=(r,e)=>{for(var t in e||(e={}))o4.call(e,t)&&qm(r,t,e[t]);if(Hm)for(var t of Hm(e))a4.call(e,t)&&qm(r,t,e[t]);return r},l4=(r,e)=>s4(r,i4(e));function Qa(r){const e=[];return r.forEach(t=>{const[n,s]=t.split(":");e.push(`${n}:${s}`)}),e}function u4(r){const e=[];return Object.values(r).forEach(t=>{e.push(...Qa(t.accounts))}),e}function h4(r,e){const t=[];return Object.values(r).forEach(n=>{Qa(n.accounts).includes(e)&&t.push(...n.methods)}),t}function f4(r,e){const t=[];return Object.values(r).forEach(n=>{Qa(n.accounts).includes(e)&&t.push(...n.events)}),t}function Th(r){return r.includes(":")}function To(r){return Th(r)?r.split(":")[0]:r}function Vm(r){var e,t,n;const s={};if(!wn(r))return s;for(const[i,o]of Object.entries(r)){const a=Th(i)?[i]:o.chains,c=o.methods||[],l=o.events||[],u=To(i);s[u]=l4(c4({},s[u]),{chains:mn(a,(e=s[u])==null?void 0:e.chains),methods:mn(c,(t=s[u])==null?void 0:t.methods),events:mn(l,(n=s[u])==null?void 0:n.events)})}return s}function d4(r){const e={};return r==null||r.forEach(t=>{var n;const[s,i]=t.split(":");e[s]||(e[s]={accounts:[],chains:[],events:[],methods:[]}),e[s].accounts.push(t),(n=e[s].chains)==null||n.push(`${s}:${i}`)}),e}function Km(r,e){e=e.map(n=>n.replace("did:pkh:",""));const t=d4(e);for(const[n,s]of Object.entries(t))s.methods?s.methods=mn(s.methods,r):s.methods=r,s.events=["chainChanged","accountsChanged"];return t}function p4(r,e){var t,n,s,i,o,a;const c=Vm(r),l=Vm(e),u={},h=Object.keys(c).concat(Object.keys(l));for(const f of h)u[f]={chains:mn((t=c[f])==null?void 0:t.chains,(n=l[f])==null?void 0:n.chains),methods:mn((s=c[f])==null?void 0:s.methods,(i=l[f])==null?void 0:i.methods),events:mn((o=c[f])==null?void 0:o.events,(a=l[f])==null?void 0:a.events)};return u}const g4={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},y4={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function W(r,e){const{message:t,code:n}=y4[r];return{message:e?`${t} ${e}`:t,code:n}}function _e(r,e){const{message:t,code:n}=g4[r];return{message:e?`${t} ${e}`:t,code:n}}function Ir(r,e){return!!Array.isArray(r)}function wn(r){return Object.getPrototypeOf(r)===Object.prototype&&Object.keys(r).length}function We(r){return typeof r>"u"}function Ve(r,e){return e&&We(r)?!0:typeof r=="string"&&!!r.trim().length}function xg(r,e){return e&&We(r)?!0:typeof r=="number"&&!isNaN(r)}function m4(r,e){const{requiredNamespaces:t}=e,n=Object.keys(r.namespaces),s=Object.keys(t);let i=!0;return Ei(s,n)?(n.forEach(o=>{const{accounts:a,methods:c,events:l}=r.namespaces[o],u=Qa(a),h=t[o];(!Ei(IE(o,h),u)||!Ei(h.methods,c)||!Ei(h.events,l))&&(i=!1)}),i):!1}function Qu(r){return Ve(r,!1)&&r.includes(":")?r.split(":").length===2:!1}function w4(r){if(Ve(r,!1)&&r.includes(":")){const e=r.split(":");if(e.length===3){const t=e[0]+":"+e[1];return!!e[2]&&Qu(t)}}return!1}function b4(r){function e(t){try{return typeof new URL(t)<"u"}catch{return!1}}try{if(Ve(r,!1)){if(e(r))return!0;const t=CE(r);return e(t)}}catch{}return!1}function v4(r){var e;return(e=r==null?void 0:r.proposer)==null?void 0:e.publicKey}function E4(r){return r==null?void 0:r.topic}function A4(r,e){let t=null;return Ve(r==null?void 0:r.publicKey,!1)||(t=W("MISSING_OR_INVALID",`${e} controller public key should be a string`)),t}function Gm(r){let e=!0;return Ir(r)?r.length&&(e=r.every(t=>Ve(t,!1))):e=!1,e}function x4(r,e,t){let n=null;return Ir(e)&&e.length?e.forEach(s=>{n||Qu(s)||(n=_e("UNSUPPORTED_CHAINS",`${t}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):Qu(r)||(n=_e("UNSUPPORTED_CHAINS",`${t}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),n}function I4(r,e,t){let n=null;return Object.entries(r).forEach(([s,i])=>{if(n)return;const o=x4(s,IE(s,i),`${e} ${t}`);o&&(n=o)}),n}function S4(r,e){let t=null;return Ir(r)?r.forEach(n=>{t||w4(n)||(t=_e("UNSUPPORTED_ACCOUNTS",`${e}, account ${n} should be a string and conform to "namespace:chainId:address" format`))}):t=_e("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function P4(r,e){let t=null;return Object.values(r).forEach(n=>{if(t)return;const s=S4(n==null?void 0:n.accounts,`${e} namespace`);s&&(t=s)}),t}function O4(r,e){let t=null;return Gm(r==null?void 0:r.methods)?Gm(r==null?void 0:r.events)||(t=_e("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):t=_e("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),t}function P2(r,e){let t=null;return Object.values(r).forEach(n=>{if(t)return;const s=O4(n,`${e}, namespace`);s&&(t=s)}),t}function D4(r,e,t){let n=null;if(r&&wn(r)){const s=P2(r,e);s&&(n=s);const i=I4(r,e,t);i&&(n=i)}else n=W("MISSING_OR_INVALID",`${e}, ${t} should be an object with data`);return n}function $f(r,e){let t=null;if(r&&wn(r)){const n=P2(r,e);n&&(t=n);const s=P4(r,e);s&&(t=s)}else t=W("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return t}function O2(r){return Ve(r.protocol,!0)}function C4(r,e){let t=!1;return r?r&&Ir(r)&&r.length&&r.forEach(n=>{t=O2(n)}):t=!0,t}function B4(r){return typeof r=="number"}function Lt(r){return typeof r<"u"&&typeof r!==null}function _4(r){return!(!r||typeof r!="object"||!r.code||!xg(r.code,!1)||!r.message||!Ve(r.message,!1))}function T4(r){return!(We(r)||!Ve(r.method,!1))}function N4(r){return!(We(r)||We(r.result)&&We(r.error)||!xg(r.id,!1)||!Ve(r.jsonrpc,!1))}function R4(r){return!(We(r)||!Ve(r.name,!1))}function Qm(r,e){return!(!Qu(e)||!u4(r).includes(e))}function U4(r,e,t){return Ve(t,!1)?h4(r,e).includes(t):!1}function k4(r,e,t){return Ve(t,!1)?f4(r,e).includes(t):!1}function Wm(r,e,t){let n=null;const s=$4(r),i=L4(e),o=Object.keys(s),a=Object.keys(i),c=Jm(Object.keys(r)),l=Jm(Object.keys(e)),u=c.filter(h=>!l.includes(h));return u.length&&(n=W("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces.
      Required: ${u.toString()}
      Received: ${Object.keys(e).toString()}`)),Ei(o,a)||(n=W("NON_CONFORMING_NAMESPACES",`${t} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(h=>{if(!h.includes(":")||n)return;const f=Qa(e[h].accounts);f.includes(h)||(n=W("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy namespace accounts for ${h}
        Required: ${h}
        Approved: ${f.toString()}`))}),o.forEach(h=>{n||(Ei(s[h].methods,i[h].methods)?Ei(s[h].events,i[h].events)||(n=W("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy namespace events for ${h}`)):n=W("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy namespace methods for ${h}`))}),n}function $4(r){const e={};return Object.keys(r).forEach(t=>{var n;t.includes(":")?e[t]=r[t]:(n=r[t].chains)==null||n.forEach(s=>{e[s]={methods:r[t].methods,events:r[t].events}})}),e}function Jm(r){return[...new Set(r.map(e=>e.includes(":")?e.split(":")[0]:e))]}function L4(r){const e={};return Object.keys(r).forEach(t=>{if(t.includes(":"))e[t]=r[t];else{const n=Qa(r[t].accounts);n==null||n.forEach(s=>{e[s]={accounts:r[t].accounts.filter(i=>i.includes(`${s}:`)),methods:r[t].methods,events:r[t].events}})}}),e}function F4(r,e){return xg(r,!1)&&r<=e.max&&r>=e.min}function Ym(){const r=bl();return new Promise(e=>{switch(r){case ar.browser:e(M4());break;case ar.reactNative:e(j4());break;case ar.node:e(z4());break;default:e(!0)}})}function M4(){return Ga()&&(navigator==null?void 0:navigator.onLine)}async function j4(){if(Ys()&&typeof global<"u"&&global!=null&&global.NetInfo){const r=await(global==null?void 0:global.NetInfo.fetch());return r==null?void 0:r.isConnected}return!0}function z4(){return!0}function H4(r){switch(bl()){case ar.browser:q4(r);break;case ar.reactNative:V4(r);break}}function q4(r){!Ys()&&Ga()&&(window.addEventListener("online",()=>r(!0)),window.addEventListener("offline",()=>r(!1)))}function V4(r){Ys()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(e=>r(e==null?void 0:e.isConnected)))}function K4(){var r;return Ga()&&ts.getDocument()?((r=ts.getDocument())==null?void 0:r.visibilityState)==="visible":!0}const Lf={};class lc{static get(e){return Lf[e]}static set(e,t){Lf[e]=t}static delete(e){delete Lf[e]}}function G4(r){const e=yl.decode(r);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function Q4({publicKey:r,signature:e,payload:t}){var n;const s=gp(t.method),i=128|parseInt(((n=t.version)==null?void 0:n.toString())||"4"),o=Y4(t.address),a=t.era==="00"?new Uint8Array([0]):gp(t.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");const c=parseInt(t.nonce,16),l=new Uint8Array([c&255,c>>8&255]),u=BigInt(`0x${J4(t.tip)}`),h=X4(u),f=new Uint8Array([0,...r,o,...e,...a,...l,...h,...s]),d=Z4(f.length+1);return new Uint8Array([...d,i,...f])}function W4(r){const e=gp(r),t=N_.blake2b(e,void 0,32);return"0x"+Buffer.from(t).toString("hex")}function gp(r){return new Uint8Array(r.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function J4(r){return r.startsWith("0x")?r.slice(2):r}function Y4(r){const e=yl.decode(r)[0];return e===42?0:e===60?2:1}function Z4(r){if(r<64)return new Uint8Array([r<<2]);if(r<16384){const e=r<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(r<1<<30){const e=r<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function X4(r){if(r<BigInt(1)<<BigInt(6))return new Uint8Array([Number(r<<BigInt(2))]);if(r<BigInt(1)<<BigInt(14)){const e=r<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(r<BigInt(1)<<BigInt(30)){const e=r<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function e6(r){const e=Uint8Array.from(Buffer.from(r.signature,"hex")),t=G4(r.transaction.address),n=Q4({publicKey:t,signature:e,payload:r.transaction}),s=Buffer.from(n).toString("hex");return W4(s)}class io{}let t6=class extends io{constructor(e){super()}};const Zm=J.FIVE_SECONDS,oo={pulse:"heartbeat_pulse"};let r6=class D2 extends t6{constructor(e){super(e),this.events=new cr.EventEmitter,this.interval=Zm,this.interval=(e==null?void 0:e.interval)||Zm}static async init(e){const t=new D2(e);return await t.init(),t}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),J.toMiliseconds(this.interval))}pulse(){this.events.emit(oo.pulse)}};const n6=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,s6=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,i6=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function o6(r,e){if(r==="__proto__"||r==="constructor"&&e&&typeof e=="object"&&"prototype"in e){a6(r);return}return e}function a6(r){console.warn(`[destr] Dropping "${r}" key to prevent prototype pollution.`)}function Jl(r,e={}){if(typeof r!="string")return r;if(r[0]==='"'&&r[r.length-1]==='"'&&r.indexOf("\\")===-1)return r.slice(1,-1);const t=r.trim();if(t.length<=9)switch(t.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!i6.test(r)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return r}try{if(n6.test(r)||s6.test(r)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(r,o6)}return JSON.parse(r)}catch(n){if(e.strict)throw n;return r}}function c6(r){return!r||typeof r.then!="function"?Promise.resolve(r):r}function Ze(r,...e){try{return c6(r(...e))}catch(t){return Promise.reject(t)}}function l6(r){const e=typeof r;return r===null||e!=="object"&&e!=="function"}function u6(r){const e=Object.getPrototypeOf(r);return!e||e.isPrototypeOf(Object)}function mu(r){if(l6(r))return String(r);if(u6(r)||Array.isArray(r))return JSON.stringify(r);if(typeof r.toJSON=="function")return mu(r.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const yp="base64:";function h6(r){return typeof r=="string"?r:yp+p6(r)}function f6(r){return typeof r!="string"||!r.startsWith(yp)?r:d6(r.slice(yp.length))}function d6(r){return globalThis.Buffer?Buffer.from(r,"base64"):Uint8Array.from(globalThis.atob(r),e=>e.codePointAt(0))}function p6(r){return globalThis.Buffer?Buffer.from(r).toString("base64"):globalThis.btoa(String.fromCodePoint(...r))}function $t(r){var e;return r&&((e=r.split("?")[0])==null?void 0:e.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function g6(...r){return $t(r.join(":"))}function Yl(r){return r=$t(r),r?r+":":""}function y6(r,e){if(e===void 0)return!0;let t=0,n=r.indexOf(":");for(;n>-1;)t++,n=r.indexOf(":",n+1);return t<=e}function m6(r,e){return e?r.startsWith(e)&&r[r.length-1]!=="$":r[r.length-1]!=="$"}const w6="memory",b6=()=>{const r=new Map;return{name:w6,getInstance:()=>r,hasItem(e){return r.has(e)},getItem(e){return r.get(e)??null},getItemRaw(e){return r.get(e)??null},setItem(e,t){r.set(e,t)},setItemRaw(e,t){r.set(e,t)},removeItem(e){r.delete(e)},getKeys(){return[...r.keys()]},clear(){r.clear()},dispose(){r.clear()}}};function v6(r={}){const e={mounts:{"":r.driver||b6()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},t=l=>{for(const u of e.mountpoints)if(l.startsWith(u))return{base:u,relativeKey:l.slice(u.length),driver:e.mounts[u]};return{base:"",relativeKey:l,driver:e.mounts[""]}},n=(l,u)=>e.mountpoints.filter(h=>h.startsWith(l)||u&&l.startsWith(h)).map(h=>({relativeBase:l.length>h.length?l.slice(h.length):void 0,mountpoint:h,driver:e.mounts[h]})),s=(l,u)=>{if(e.watching){u=$t(u);for(const h of e.watchListeners)h(l,u)}},i=async()=>{if(!e.watching){e.watching=!0;for(const l in e.mounts)e.unwatch[l]=await Xm(e.mounts[l],s,l)}},o=async()=>{if(e.watching){for(const l in e.unwatch)await e.unwatch[l]();e.unwatch={},e.watching=!1}},a=(l,u,h)=>{const f=new Map,d=p=>{let g=f.get(p.base);return g||(g={driver:p.driver,base:p.base,items:[]},f.set(p.base,g)),g};for(const p of l){const g=typeof p=="string",m=$t(g?p:p.key),b=g?void 0:p.value,x=g||!p.options?u:{...u,...p.options},v=t(m);d(v).items.push({key:m,value:b,relativeKey:v.relativeKey,options:x})}return Promise.all([...f.values()].map(p=>h(p))).then(p=>p.flat())},c={hasItem(l,u={}){l=$t(l);const{relativeKey:h,driver:f}=t(l);return Ze(f.hasItem,h,u)},getItem(l,u={}){l=$t(l);const{relativeKey:h,driver:f}=t(l);return Ze(f.getItem,h,u).then(d=>Jl(d))},getItems(l,u={}){return a(l,u,h=>h.driver.getItems?Ze(h.driver.getItems,h.items.map(f=>({key:f.relativeKey,options:f.options})),u).then(f=>f.map(d=>({key:g6(h.base,d.key),value:Jl(d.value)}))):Promise.all(h.items.map(f=>Ze(h.driver.getItem,f.relativeKey,f.options).then(d=>({key:f.key,value:Jl(d)})))))},getItemRaw(l,u={}){l=$t(l);const{relativeKey:h,driver:f}=t(l);return f.getItemRaw?Ze(f.getItemRaw,h,u):Ze(f.getItem,h,u).then(d=>f6(d))},async setItem(l,u,h={}){if(u===void 0)return c.removeItem(l);l=$t(l);const{relativeKey:f,driver:d}=t(l);d.setItem&&(await Ze(d.setItem,f,mu(u),h),d.watch||s("update",l))},async setItems(l,u){await a(l,u,async h=>{if(h.driver.setItems)return Ze(h.driver.setItems,h.items.map(f=>({key:f.relativeKey,value:mu(f.value),options:f.options})),u);h.driver.setItem&&await Promise.all(h.items.map(f=>Ze(h.driver.setItem,f.relativeKey,mu(f.value),f.options)))})},async setItemRaw(l,u,h={}){if(u===void 0)return c.removeItem(l,h);l=$t(l);const{relativeKey:f,driver:d}=t(l);if(d.setItemRaw)await Ze(d.setItemRaw,f,u,h);else if(d.setItem)await Ze(d.setItem,f,h6(u),h);else return;d.watch||s("update",l)},async removeItem(l,u={}){typeof u=="boolean"&&(u={removeMeta:u}),l=$t(l);const{relativeKey:h,driver:f}=t(l);f.removeItem&&(await Ze(f.removeItem,h,u),(u.removeMeta||u.removeMata)&&await Ze(f.removeItem,h+"$",u),f.watch||s("remove",l))},async getMeta(l,u={}){typeof u=="boolean"&&(u={nativeOnly:u}),l=$t(l);const{relativeKey:h,driver:f}=t(l),d=Object.create(null);if(f.getMeta&&Object.assign(d,await Ze(f.getMeta,h,u)),!u.nativeOnly){const p=await Ze(f.getItem,h+"$",u).then(g=>Jl(g));p&&typeof p=="object"&&(typeof p.atime=="string"&&(p.atime=new Date(p.atime)),typeof p.mtime=="string"&&(p.mtime=new Date(p.mtime)),Object.assign(d,p))}return d},setMeta(l,u,h={}){return this.setItem(l+"$",u,h)},removeMeta(l,u={}){return this.removeItem(l+"$",u)},async getKeys(l,u={}){var m;l=Yl(l);const h=n(l,!0);let f=[];const d=[];let p=!0;for(const b of h){(m=b.driver.flags)!=null&&m.maxDepth||(p=!1);const x=await Ze(b.driver.getKeys,b.relativeBase,u);for(const v of x){const S=b.mountpoint+$t(v);f.some(I=>S.startsWith(I))||d.push(S)}f=[b.mountpoint,...f.filter(v=>!v.startsWith(b.mountpoint))]}const g=u.maxDepth!==void 0&&!p;return d.filter(b=>(!g||y6(b,u.maxDepth))&&m6(b,l))},async clear(l,u={}){l=Yl(l),await Promise.all(n(l,!1).map(async h=>{if(h.driver.clear)return Ze(h.driver.clear,h.relativeBase,u);if(h.driver.removeItem){const f=await h.driver.getKeys(h.relativeBase||"",u);return Promise.all(f.map(d=>h.driver.removeItem(d,u)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(l=>ew(l)))},async watch(l){return await i(),e.watchListeners.push(l),async()=>{e.watchListeners=e.watchListeners.filter(u=>u!==l),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(l,u){if(l=Yl(l),l&&e.mounts[l])throw new Error(`already mounted at ${l}`);return l&&(e.mountpoints.push(l),e.mountpoints.sort((h,f)=>f.length-h.length)),e.mounts[l]=u,e.watching&&Promise.resolve(Xm(u,s,l)).then(h=>{e.unwatch[l]=h}).catch(console.error),c},async unmount(l,u=!0){var h,f;l=Yl(l),!(!l||!e.mounts[l])&&(e.watching&&l in e.unwatch&&((f=(h=e.unwatch)[l])==null||f.call(h),delete e.unwatch[l]),u&&await ew(e.mounts[l]),e.mountpoints=e.mountpoints.filter(d=>d!==l),delete e.mounts[l])},getMount(l=""){l=$t(l)+":";const u=t(l);return{driver:u.driver,base:u.base}},getMounts(l="",u={}){return l=$t(l),n(l,u.parents).map(f=>({driver:f.driver,base:f.mountpoint}))},keys:(l,u={})=>c.getKeys(l,u),get:(l,u={})=>c.getItem(l,u),set:(l,u,h={})=>c.setItem(l,u,h),has:(l,u={})=>c.hasItem(l,u),del:(l,u={})=>c.removeItem(l,u),remove:(l,u={})=>c.removeItem(l,u)};return c}function Xm(r,e,t){return r.watch?r.watch((n,s)=>e(n,t+s)):()=>{}}async function ew(r){typeof r.dispose=="function"&&await Ze(r.dispose)}function ao(r){return new Promise((e,t)=>{r.oncomplete=r.onsuccess=()=>e(r.result),r.onabort=r.onerror=()=>t(r.error)})}function C2(r,e){let t;const n=()=>{if(t)return t;const s=indexedDB.open(r);return s.onupgradeneeded=()=>s.result.createObjectStore(e),t=ao(s),t.then(i=>{i.onclose=()=>t=void 0},()=>{}),t};return(s,i)=>n().then(o=>i(o.transaction(e,s).objectStore(e)))}let Ff;function Il(){return Ff||(Ff=C2("keyval-store","keyval")),Ff}function tw(r,e=Il()){return e("readonly",t=>ao(t.get(r)))}function E6(r,e,t=Il()){return t("readwrite",n=>(n.put(e,r),ao(n.transaction)))}function A6(r,e=Il()){return e("readwrite",t=>(t.delete(r),ao(t.transaction)))}function x6(r=Il()){return r("readwrite",e=>(e.clear(),ao(e.transaction)))}function I6(r,e){return r.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},ao(r.transaction)}function S6(r=Il()){return r("readonly",e=>{if(e.getAllKeys)return ao(e.getAllKeys());const t=[];return I6(e,n=>t.push(n.key)).then(()=>t)})}const P6="idb-keyval";var O6=(r={})=>{const e=r.base&&r.base.length>0?`${r.base}:`:"",t=s=>e+s;let n;return r.dbName&&r.storeName&&(n=C2(r.dbName,r.storeName)),{name:P6,options:r,async hasItem(s){return!(typeof await tw(t(s),n)>"u")},async getItem(s){return await tw(t(s),n)??null},setItem(s,i){return E6(t(s),i,n)},removeItem(s){return A6(t(s),n)},getKeys(){return S6(n)},clear(){return x6(n)}}};const D6="WALLET_CONNECT_V2_INDEXED_DB",C6="keyvaluestorage";let B6=class{constructor(){this.indexedDb=v6({driver:O6({dbName:D6,storeName:C6})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const t=await this.indexedDb.getItem(e);if(t!==null)return t}async setItem(e,t){await this.indexedDb.setItem(e,rs(t))}async removeItem(e){await this.indexedDb.removeItem(e)}};var Mf=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},wu={exports:{}};(function(){let r;function e(){}r=e,r.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},r.prototype.setItem=function(t,n){this[t]=String(n)},r.prototype.removeItem=function(t){delete this[t]},r.prototype.clear=function(){const t=this;Object.keys(t).forEach(function(n){t[n]=void 0,delete t[n]})},r.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},r.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Mf<"u"&&Mf.localStorage?wu.exports=Mf.localStorage:typeof window<"u"&&window.localStorage?wu.exports=window.localStorage:wu.exports=new e})();function _6(r){var e;return[r[0],Zi((e=r[1])!=null?e:"")]}let T6=class{constructor(){this.localStorage=wu.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(_6)}async getItem(e){const t=this.localStorage.getItem(e);if(t!==null)return Zi(t)}async setItem(e,t){this.localStorage.setItem(e,rs(t))}async removeItem(e){this.localStorage.removeItem(e)}};const N6="wc_storage_version",rw=1,R6=async(r,e,t)=>{const n=N6,s=await e.getItem(n);if(s&&s>=rw){t(e);return}const i=await r.getKeys();if(!i.length){t(e);return}const o=[];for(;i.length;){const a=i.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const l=await r.getItem(a);await e.setItem(a,l),o.push(a)}}await e.setItem(n,rw),t(e),U6(r,o)},U6=async(r,e)=>{e.length&&e.forEach(async t=>{await r.removeItem(t)})};let k6=class{constructor(){this.initialized=!1,this.setInitialized=t=>{this.storage=t,this.initialized=!0};const e=new T6;this.storage=e;try{const t=new B6;R6(e,t,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,t){return await this.initialize(),this.storage.setItem(e,t)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const t=setInterval(()=>{this.initialized&&(clearInterval(t),e())},20)})}};var jf,nw;function $6(){if(nw)return jf;nw=1;function r(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}jf=e;function e(t,n,s){var i=s&&s.stringify||r,o=1;if(typeof t=="object"&&t!==null){var a=n.length+o;if(a===1)return t;var c=new Array(a);c[0]=i(t);for(var l=1;l<a;l++)c[l]=i(n[l]);return c.join(" ")}if(typeof t!="string")return t;var u=n.length;if(u===0)return t;for(var h="",f=1-o,d=-1,p=t&&t.length||0,g=0;g<p;){if(t.charCodeAt(g)===37&&g+1<p){switch(d=d>-1?d:0,t.charCodeAt(g+1)){case 100:case 102:if(f>=u||n[f]==null)break;d<g&&(h+=t.slice(d,g)),h+=Number(n[f]),d=g+2,g++;break;case 105:if(f>=u||n[f]==null)break;d<g&&(h+=t.slice(d,g)),h+=Math.floor(Number(n[f])),d=g+2,g++;break;case 79:case 111:case 106:if(f>=u||n[f]===void 0)break;d<g&&(h+=t.slice(d,g));var m=typeof n[f];if(m==="string"){h+="'"+n[f]+"'",d=g+2,g++;break}if(m==="function"){h+=n[f].name||"<anonymous>",d=g+2,g++;break}h+=i(n[f]),d=g+2,g++;break;case 115:if(f>=u)break;d<g&&(h+=t.slice(d,g)),h+=String(n[f]),d=g+2,g++;break;case 37:d<g&&(h+=t.slice(d,g)),h+="%",d=g+2,g++,f--;break}++f}++g}return d===-1?t:(d<p&&(h+=t.slice(d)),h)}return jf}var zf,sw;function L6(){if(sw)return zf;sw=1;const r=$6();zf=s;const e=I().console||{},t={mapHttpRequest:p,mapHttpResponse:p,wrapRequestSerializer:g,wrapResponseSerializer:g,wrapErrorSerializer:g,req:p,res:p,err:f};function n(A,O){return Array.isArray(A)?A.filter(function(B){return B!=="!stdSerializers.err"}):A===!0?Object.keys(O):!1}function s(A){A=A||{},A.browser=A.browser||{};const O=A.browser.transmit;if(O&&typeof O.send!="function")throw Error("pino: transmit option must have a send function");const D=A.browser.write||e;A.browser.write&&(A.browser.asObject=!0);const B=A.serializers||{},L=n(A.browser.serialize,B);let j=A.browser.serialize;Array.isArray(A.browser.serialize)&&A.browser.serialize.indexOf("!stdSerializers.err")>-1&&(j=!1);const $=["error","fatal","warn","info","debug","trace"];typeof D=="function"&&(D.error=D.fatal=D.warn=D.info=D.debug=D.trace=D),A.enabled===!1&&(A.level="silent");const U=A.level||"info",T=Object.create(D);T.log||(T.log=m),Object.defineProperty(T,"levelVal",{get:E}),Object.defineProperty(T,"level",{get:C,set:k});const w={transmit:O,serialize:L,asObject:A.browser.asObject,levels:$,timestamp:d(A)};T.levels=s.levels,T.level=U,T.setMaxListeners=T.getMaxListeners=T.emit=T.addListener=T.on=T.prependListener=T.once=T.prependOnceListener=T.removeListener=T.removeAllListeners=T.listeners=T.listenerCount=T.eventNames=T.write=T.flush=m,T.serializers=B,T._serialize=L,T._stdErrSerialize=j,T.child=_,O&&(T._logEvent=h());function E(){return this.level==="silent"?1/0:this.levels.values[this.level]}function C(){return this._level}function k(N){if(N!=="silent"&&!this.levels.values[N])throw Error("unknown level "+N);this._level=N,i(w,T,"error","log"),i(w,T,"fatal","error"),i(w,T,"warn","error"),i(w,T,"info","log"),i(w,T,"debug","log"),i(w,T,"trace","log")}function _(N,z){if(!N)throw new Error("missing bindings for child Pino");z=z||{},L&&N.serializers&&(z.serializers=N.serializers);const H=z.serializers;if(L&&H){var Y=Object.assign({},B,H),G=A.browser.serialize===!0?Object.keys(Y):L;delete N.serializers,c([N],G,Y,this._stdErrSerialize)}function Q(ee){this._childLevel=(ee._childLevel|0)+1,this.error=l(ee,N,"error"),this.fatal=l(ee,N,"fatal"),this.warn=l(ee,N,"warn"),this.info=l(ee,N,"info"),this.debug=l(ee,N,"debug"),this.trace=l(ee,N,"trace"),Y&&(this.serializers=Y,this._serialize=G),O&&(this._logEvent=h([].concat(ee._logEvent.bindings,N)))}return Q.prototype=this,new Q(this)}return T}s.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},s.stdSerializers=t,s.stdTimeFunctions=Object.assign({},{nullTime:b,epochTime:x,unixTime:v,isoTime:S});function i(A,O,D,B){const L=Object.getPrototypeOf(O);O[D]=O.levelVal>O.levels.values[D]?m:L[D]?L[D]:e[D]||e[B]||m,o(A,O,D)}function o(A,O,D){!A.transmit&&O[D]===m||(O[D]=(function(B){return function(){const j=A.timestamp(),$=new Array(arguments.length),U=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var T=0;T<$.length;T++)$[T]=arguments[T];if(A.serialize&&!A.asObject&&c($,this._serialize,this.serializers,this._stdErrSerialize),A.asObject?B.call(U,a(this,D,$,j)):B.apply(U,$),A.transmit){const w=A.transmit.level||O.level,E=s.levels.values[w],C=s.levels.values[D];if(C<E)return;u(this,{ts:j,methodLevel:D,methodValue:C,transmitValue:s.levels.values[A.transmit.level||O.level],send:A.transmit.send,val:O.levelVal},$)}}})(O[D]))}function a(A,O,D,B){A._serialize&&c(D,A._serialize,A.serializers,A._stdErrSerialize);const L=D.slice();let j=L[0];const $={};B&&($.time=B),$.level=s.levels.values[O];let U=(A._childLevel|0)+1;if(U<1&&(U=1),j!==null&&typeof j=="object"){for(;U--&&typeof L[0]=="object";)Object.assign($,L.shift());j=L.length?r(L.shift(),L):void 0}else typeof j=="string"&&(j=r(L.shift(),L));return j!==void 0&&($.msg=j),$}function c(A,O,D,B){for(const L in A)if(B&&A[L]instanceof Error)A[L]=s.stdSerializers.err(A[L]);else if(typeof A[L]=="object"&&!Array.isArray(A[L]))for(const j in A[L])O&&O.indexOf(j)>-1&&j in D&&(A[L][j]=D[j](A[L][j]))}function l(A,O,D){return function(){const B=new Array(1+arguments.length);B[0]=O;for(var L=1;L<B.length;L++)B[L]=arguments[L-1];return A[D].apply(this,B)}}function u(A,O,D){const B=O.send,L=O.ts,j=O.methodLevel,$=O.methodValue,U=O.val,T=A._logEvent.bindings;c(D,A._serialize||Object.keys(A.serializers),A.serializers,A._stdErrSerialize===void 0?!0:A._stdErrSerialize),A._logEvent.ts=L,A._logEvent.messages=D.filter(function(w){return T.indexOf(w)===-1}),A._logEvent.level.label=j,A._logEvent.level.value=$,B(j,A._logEvent,U),A._logEvent=h(T)}function h(A){return{ts:0,messages:[],bindings:A||[],level:{label:"",value:0}}}function f(A){const O={type:A.constructor.name,msg:A.message,stack:A.stack};for(const D in A)O[D]===void 0&&(O[D]=A[D]);return O}function d(A){return typeof A.timestamp=="function"?A.timestamp:A.timestamp===!1?b:x}function p(){return{}}function g(A){return A}function m(){}function b(){return!1}function x(){return Date.now()}function v(){return Math.round(Date.now()/1e3)}function S(){return new Date(Date.now()).toISOString()}function I(){function A(O){return typeof O<"u"&&O}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return A(self)||A(window)||A(this)||{}}}return zf}var Po=L6();const Sl=Xp(Po),F6={level:"info"},Pl="custom_context",Ig=1e3*1024;let M6=class{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},iw=class{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const t=new M6(e);if(t.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${t.size}`);for(;this.size+t.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=t),this.tail=t):(this.head=t,this.tail=t),this.lengthInNodes++,this.sizeInBytes+=t.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let t=this.head;for(;t!==null;)e.push(t.value),t=t.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const t=e.value;return e=e.next,{done:!1,value:t}}}}},B2=class{constructor(e,t=Ig){this.level=e??"error",this.levelValue=Po.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=t,this.logs=new iw(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,t){t===Po.levels.values.error?console.error(e):t===Po.levels.values.warn?console.warn(e):t===Po.levels.values.debug?console.debug(e):t===Po.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(rs({timestamp:new Date().toISOString(),log:e}));const t=typeof e=="string"?JSON.parse(e).level:e.level;t>=this.levelValue&&this.forwardToConsole(e,t)}getLogs(){return this.logs}clearLogs(){this.logs=new iw(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const t=this.getLogArray();return t.push(rs({extraMetadata:e})),new Blob(t,{type:"application/json"})}},j6=class{constructor(e,t=Ig){this.baseChunkLogger=new B2(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const t=URL.createObjectURL(this.logsToBlob(e)),n=document.createElement("a");n.href=t,n.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)}},z6=class{constructor(e,t=Ig){this.baseChunkLogger=new B2(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var H6=Object.defineProperty,q6=Object.defineProperties,V6=Object.getOwnPropertyDescriptors,ow=Object.getOwnPropertySymbols,K6=Object.prototype.hasOwnProperty,G6=Object.prototype.propertyIsEnumerable,aw=(r,e,t)=>e in r?H6(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Wu=(r,e)=>{for(var t in e||(e={}))K6.call(e,t)&&aw(r,t,e[t]);if(ow)for(var t of ow(e))G6.call(e,t)&&aw(r,t,e[t]);return r},Ju=(r,e)=>q6(r,V6(e));function Nh(r){return Ju(Wu({},r),{level:(r==null?void 0:r.level)||F6.level})}function Q6(r,e=Pl){return r[e]||""}function W6(r,e,t=Pl){return r[t]=e,r}function Wt(r,e=Pl){let t="";return typeof r.bindings>"u"?t=Q6(r,e):t=r.bindings().context||"",t}function J6(r,e,t=Pl){const n=Wt(r,t);return n.trim()?`${n}/${e}`:e}function Rt(r,e,t=Pl){const n=J6(r,e,t),s=r.child({context:n});return W6(s,n,t)}function Y6(r){var e,t;const n=new j6((e=r.opts)==null?void 0:e.level,r.maxSizeInBytes);return{logger:Sl(Ju(Wu({},r.opts),{level:"trace",browser:Ju(Wu({},(t=r.opts)==null?void 0:t.browser),{write:s=>n.write(s)})})),chunkLoggerController:n}}function Z6(r){var e;const t=new z6((e=r.opts)==null?void 0:e.level,r.maxSizeInBytes);return{logger:Sl(Ju(Wu({},r.opts),{level:"trace"}),t),chunkLoggerController:t}}function X6(r){return typeof r.loggerOverride<"u"&&typeof r.loggerOverride!="string"?{logger:r.loggerOverride,chunkLoggerController:null}:typeof window<"u"?Y6(r):Z6(r)}var eU=Object.defineProperty,tU=(r,e,t)=>e in r?eU(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,cw=(r,e,t)=>tU(r,typeof e!="symbol"?e+"":e,t);let rU=class extends io{constructor(e){super(),this.opts=e,cw(this,"protocol","wc"),cw(this,"version",2)}};var nU=Object.defineProperty,sU=(r,e,t)=>e in r?nU(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,iU=(r,e,t)=>sU(r,e+"",t);let oU=class extends io{constructor(e,t){super(),this.core=e,this.logger=t,iU(this,"records",new Map)}},aU=class{constructor(e,t){this.logger=e,this.core=t}},cU=class extends io{constructor(e,t){super(),this.relayer=e,this.logger=t}},lU=class extends io{constructor(e){super()}},uU=class{constructor(e,t,n,s){this.core=e,this.logger=t,this.name=n}},hU=class extends io{constructor(e,t){super(),this.relayer=e,this.logger=t}},fU=class extends io{constructor(e,t){super(),this.core=e,this.logger=t}},dU=class{constructor(e,t,n){this.core=e,this.logger=t,this.store=n}},pU=class{constructor(e,t){this.projectId=e,this.logger=t}},gU=class{constructor(e,t,n){this.core=e,this.logger=t,this.telemetryEnabled=n}};var yU=Object.defineProperty,mU=(r,e,t)=>e in r?yU(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,lw=(r,e,t)=>mU(r,typeof e!="symbol"?e+"":e,t);let wU=class{constructor(e){this.opts=e,lw(this,"protocol","wc"),lw(this,"version",2)}},bU=class{constructor(e){this.client=e}};const vU="PARSE_ERROR",EU="INVALID_REQUEST",AU="METHOD_NOT_FOUND",xU="INVALID_PARAMS",_2="INTERNAL_ERROR",Sg="SERVER_ERROR",IU=[-32700,-32600,-32601,-32602,-32603],Bc={[vU]:{code:-32700,message:"Parse error"},[EU]:{code:-32600,message:"Invalid Request"},[AU]:{code:-32601,message:"Method not found"},[xU]:{code:-32602,message:"Invalid params"},[_2]:{code:-32603,message:"Internal error"},[Sg]:{code:-32e3,message:"Server error"}},T2=Sg;function SU(r){return IU.includes(r)}function uw(r){return Object.keys(Bc).includes(r)?Bc[r]:Bc[T2]}function PU(r){const e=Object.values(Bc).find(t=>t.code===r);return e||Bc[T2]}function N2(r,e,t){return r.message.includes("getaddrinfo ENOTFOUND")||r.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${t} RPC url at ${e}`):r}var Hf={},Pn={},hw;function OU(){if(hw)return Pn;hw=1,Object.defineProperty(Pn,"__esModule",{value:!0}),Pn.isBrowserCryptoAvailable=Pn.getSubtleCrypto=Pn.getBrowerCrypto=void 0;function r(){return(hn==null?void 0:hn.crypto)||(hn==null?void 0:hn.msCrypto)||{}}Pn.getBrowerCrypto=r;function e(){const n=r();return n.subtle||n.webkitSubtle}Pn.getSubtleCrypto=e;function t(){return!!r()&&!!e()}return Pn.isBrowserCryptoAvailable=t,Pn}var On={},fw;function DU(){if(fw)return On;fw=1,Object.defineProperty(On,"__esModule",{value:!0}),On.isBrowser=On.isNode=On.isReactNative=void 0;function r(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}On.isReactNative=r;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}On.isNode=e;function t(){return!r()&&!e()}return On.isBrowser=t,On}var dw;function CU(){return dw||(dw=1,(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=gl;e.__exportStar(OU(),r),e.__exportStar(DU(),r)})(Hf)),Hf}var BU=CU();function Zr(r=3){const e=Date.now()*Math.pow(10,r),t=Math.floor(Math.random()*Math.pow(10,r));return e+t}function zs(r=6){return BigInt(Zr(r))}function Mr(r,e,t){return{id:t||Zr(),jsonrpc:"2.0",method:r,params:e}}function Jc(r,e){return{id:r,jsonrpc:"2.0",result:e}}function Rh(r,e,t){return{id:r,jsonrpc:"2.0",error:_U(e)}}function _U(r,e){return typeof r>"u"?uw(_2):(typeof r=="string"&&(r=Object.assign(Object.assign({},uw(Sg)),{message:r})),SU(r.code)&&(r=PU(r.code)),r)}class TU{}class NU extends TU{constructor(){super()}}class RU extends NU{constructor(e){super()}}const UU="^https?:",kU="^wss?:";function $U(r){const e=r.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function R2(r,e){const t=$U(r);return typeof t>"u"?!1:new RegExp(e).test(t)}function pw(r){return R2(r,UU)}function gw(r){return R2(r,kU)}function LU(r){return new RegExp("wss?://localhost(:d{2,5})?").test(r)}function U2(r){return typeof r=="object"&&"id"in r&&"jsonrpc"in r&&r.jsonrpc==="2.0"}function Pg(r){return U2(r)&&"method"in r}function Uh(r){return U2(r)&&(Xr(r)||Ar(r))}function Xr(r){return"result"in r}function Ar(r){return"error"in r}let Og=class extends RU{constructor(e){super(e),this.events=new cr.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async request(e,t){return this.requestStrict(Mr(e.method,e.params||[],e.id||zs().toString()),t)}async requestStrict(e,t){return new Promise(async(n,s)=>{if(!this.connection.connected)try{await this.open()}catch(i){s(i)}this.events.on(`${e.id}`,i=>{Ar(i)?s(i.error):n(i.result)});try{await this.connection.send(e,t)}catch(i){s(i)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Uh(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const FU=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),MU=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",yw=r=>r.split("?")[0],mw=10,jU=FU();let zU=class{constructor(e){if(this.url=e,this.events=new cr.EventEmitter,this.registering=!1,!gw(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,t)=>{if(typeof this.socket>"u"){t(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(rs(e))}catch(t){this.onError(e.id,t)}}register(e=this.url){if(!gw(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((n,s)=>{this.events.once("register_error",i=>{this.resetMaxListeners(),s(i)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=e,this.registering=!0,new Promise((t,n)=>{const s=BU.isReactNative()?void 0:{rejectUnauthorized:!LU(e)},i=new jU(e,[],s);MU()?i.onerror=o=>{const a=o;n(this.emitError(a.error))}:i.on("error",o=>{n(this.emitError(o))}),i.onopen=()=>{this.onOpen(i),t(i)}})}onOpen(e){e.onmessage=t=>this.onPayload(t),e.onclose=t=>this.onClose(t),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const t=typeof e.data=="string"?Zi(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const n=this.parseError(t),s=n.message||n.toString(),i=Rh(e,s);this.events.emit("payload",i)}parseError(e,t=this.url){return N2(e,yw(t),"WS")}resetMaxListeners(){this.events.getMaxListeners()>mw&&this.events.setMaxListeners(mw)}emitError(e){const t=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${yw(this.url)}`));return this.events.emit("register_error",t),t}};var HU={};const k2="wc",$2=2,mp="core",vn=`${k2}@2:${mp}:`,qU={logger:"error"},VU={database:":memory:"},KU="crypto",ww="client_ed25519_seed",GU=J.ONE_DAY,QU="keychain",WU="0.3",JU="messages",YU="0.3",ZU=J.SIX_HOURS,XU="publisher",L2="irn",e5="error",F2="wss://relay.walletconnect.org",t5="relayer",Le={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},r5="_subscription",ur={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},n5=.1,wp="2.21.9",Be={link_mode:"link_mode",relay:"relay"},bu={inbound:"inbound",outbound:"outbound"},s5="0.3",i5="WALLETCONNECT_CLIENT_ID",bw="WALLETCONNECT_LINK_MODE_APPS",Xt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},o5="subscription",a5="0.3",c5="pairing",l5="0.3",uc={wc_pairingDelete:{req:{ttl:J.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:J.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:J.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:J.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:J.ONE_DAY,prompt:!1,tag:0},res:{ttl:J.ONE_DAY,prompt:!1,tag:0}}},fi={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Or={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},u5="history",h5="0.3",f5="expirer",dr={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},d5="0.3",p5="verify-api",g5="https://verify.walletconnect.com",M2="https://verify.walletconnect.org",_c=M2,y5=`${_c}/v3`,m5=[g5,M2],w5="echo",b5="https://echo.walletconnect.com",Yr={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},Bn={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},ms={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},hc={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},ni={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},fc={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},v5=.1,E5="event-client",A5=86400,x5="https://pulse.walletconnect.org/batch";function I5(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,m=0,b=0,x=p.length;b!==x&&p[b]===0;)b++,g++;for(var v=(x-b)*u+1>>>0,S=new Uint8Array(v);b!==x;){for(var I=p[b],A=0,O=v-1;(I!==0||A<m)&&O!==-1;O--,A++)I+=256*S[O]>>>0,S[O]=I%a>>>0,I=I/a>>>0;if(I!==0)throw new Error("Non-zero carry");m=A,b++}for(var D=v-m;D!==v&&S[D]===0;)D++;for(var B=c.repeat(g);D<v;++D)B+=r.charAt(S[D]);return B}function f(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var m=0,b=0;p[g]===c;)m++,g++;for(var x=(p.length-g)*l+1>>>0,v=new Uint8Array(x);p[g];){var S=t[p.charCodeAt(g)];if(S===255)return;for(var I=0,A=x-1;(S!==0||I<b)&&A!==-1;A--,I++)S+=a*v[A]>>>0,v[A]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");b=I,g++}if(p[g]!==" "){for(var O=x-b;O!==x&&v[O]===0;)O++;for(var D=new Uint8Array(m+(x-O)),B=m;O!==x;)D[B++]=v[O++];return D}}}function d(p){var g=f(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:d}}var S5=I5,P5=S5;const j2=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},O5=r=>new TextEncoder().encode(r),D5=r=>new TextDecoder().decode(r);class C5{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class B5{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return z2(this,e)}}class _5{constructor(e){this.decoders=e}or(e){return z2(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const z2=(r,e)=>new _5({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class T5{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new C5(e,t,n),this.decoder=new B5(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const kh=({name:r,prefix:e,encode:t,decode:n})=>new T5(r,e,t,n),Ol=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=P5(t,e);return kh({prefix:r,name:e,encode:n,decode:i=>j2(s(i))})},N5=(r,e,t,n)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const h=s[r[u]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},R5=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},dt=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>kh({prefix:e,name:r,encode(s){return R5(s,n,t)},decode(s){return N5(s,n,t,r)}}),U5=kh({prefix:"\0",name:"identity",encode:r=>D5(r),decode:r=>O5(r)});var k5=Object.freeze({__proto__:null,identity:U5});const $5=dt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var L5=Object.freeze({__proto__:null,base2:$5});const F5=dt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var M5=Object.freeze({__proto__:null,base8:F5});const j5=Ol({prefix:"9",name:"base10",alphabet:"0123456789"});var z5=Object.freeze({__proto__:null,base10:j5});const H5=dt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),q5=dt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var V5=Object.freeze({__proto__:null,base16:H5,base16upper:q5});const K5=dt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),G5=dt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Q5=dt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),W5=dt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),J5=dt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Y5=dt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Z5=dt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),X5=dt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ek=dt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var tk=Object.freeze({__proto__:null,base32:K5,base32upper:G5,base32pad:Q5,base32padupper:W5,base32hex:J5,base32hexupper:Y5,base32hexpad:Z5,base32hexpadupper:X5,base32z:ek});const rk=Ol({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),nk=Ol({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var sk=Object.freeze({__proto__:null,base36:rk,base36upper:nk});const ik=Ol({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),ok=Ol({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var ak=Object.freeze({__proto__:null,base58btc:ik,base58flickr:ok});const ck=dt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),lk=dt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),uk=dt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),hk=dt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var fk=Object.freeze({__proto__:null,base64:ck,base64pad:lk,base64url:uk,base64urlpad:hk});const H2=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),dk=H2.reduce((r,e,t)=>(r[t]=e,r),[]),pk=H2.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function gk(r){return r.reduce((e,t)=>(e+=dk[t],e),"")}function yk(r){const e=[];for(const t of r){const n=pk[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const mk=kh({prefix:"🚀",name:"base256emoji",encode:gk,decode:yk});var wk=Object.freeze({__proto__:null,base256emoji:mk}),bk=q2,vw=128,vk=-128,Ek=Math.pow(2,31);function q2(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Ek;)e[t++]=r&255|vw,r/=128;for(;r&vk;)e[t++]=r&255|vw,r>>>=7;return e[t]=r|0,q2.bytes=t-n+1,e}var Ak=bp,xk=128,Ew=127;function bp(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw bp.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&Ew)<<s:(o&Ew)*Math.pow(2,s),s+=7}while(o>=xk);return bp.bytes=i-n,t}var Ik=Math.pow(2,7),Sk=Math.pow(2,14),Pk=Math.pow(2,21),Ok=Math.pow(2,28),Dk=Math.pow(2,35),Ck=Math.pow(2,42),Bk=Math.pow(2,49),_k=Math.pow(2,56),Tk=Math.pow(2,63),Nk=function(r){return r<Ik?1:r<Sk?2:r<Pk?3:r<Ok?4:r<Dk?5:r<Ck?6:r<Bk?7:r<_k?8:r<Tk?9:10},Rk={encode:bk,decode:Ak,encodingLength:Nk},V2=Rk;const Aw=(r,e,t=0)=>(V2.encode(r,e,t),e),xw=r=>V2.encodingLength(r),vp=(r,e)=>{const t=e.byteLength,n=xw(r),s=n+xw(t),i=new Uint8Array(s+t);return Aw(r,i,0),Aw(t,i,n),i.set(e,s),new Uk(r,t,e,i)};class Uk{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}}const K2=({name:r,code:e,encode:t})=>new kk(r,e,t);class kk{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?vp(this.code,t):t.then(n=>vp(this.code,n))}else throw Error("Unknown type, must be binary type")}}const G2=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),$k=K2({name:"sha2-256",code:18,encode:G2("SHA-256")}),Lk=K2({name:"sha2-512",code:19,encode:G2("SHA-512")});var Fk=Object.freeze({__proto__:null,sha256:$k,sha512:Lk});const Q2=0,Mk="identity",W2=j2,jk=r=>vp(Q2,W2(r)),zk={code:Q2,name:Mk,encode:W2,digest:jk};var Hk=Object.freeze({__proto__:null,identity:zk});new TextEncoder,new TextDecoder;const Iw={...k5,...L5,...M5,...z5,...V5,...tk,...sk,...ak,...fk,...wk};({...Fk,...Hk});function J2(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function qk(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?J2(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function Y2(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}const Sw=Y2("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),qf=Y2("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=qk(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),Vk={utf8:Sw,"utf-8":Sw,hex:Iw.base16,latin1:qf,ascii:qf,binary:qf,...Iw};function Kk(r,e="utf8"){const t=Vk[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?J2(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}var Gk=Object.defineProperty,Qk=(r,e,t)=>e in r?Gk(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Wr=(r,e,t)=>Qk(r,typeof e!="symbol"?e+"":e,t);class Wk{constructor(e,t){this.core=e,this.logger=t,Wr(this,"keychain",new Map),Wr(this,"name",QU),Wr(this,"version",WU),Wr(this,"initialized",!1),Wr(this,"storagePrefix",vn),Wr(this,"init",async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}}),Wr(this,"has",n=>(this.isInitialized(),this.keychain.has(n))),Wr(this,"set",async(n,s)=>{this.isInitialized(),this.keychain.set(n,s),await this.persist()}),Wr(this,"get",n=>{this.isInitialized();const s=this.keychain.get(n);if(typeof s>"u"){const{message:i}=W("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(i)}return s}),Wr(this,"del",async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()}),this.core=e,this.logger=Rt(t,this.name)}get context(){return Wt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,rp(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?np(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Jk=Object.defineProperty,Yk=(r,e,t)=>e in r?Jk(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,st=(r,e,t)=>Yk(r,typeof e!="symbol"?e+"":e,t);class Zk{constructor(e,t,n){this.core=e,this.logger=t,st(this,"name",KU),st(this,"keychain"),st(this,"randomSessionIdentifier",pp()),st(this,"initialized",!1),st(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),st(this,"hasKeys",s=>(this.isInitialized(),this.keychain.has(s))),st(this,"getClientId",async()=>{this.isInitialized();const s=await this.getClientSeed(),i=Q0(s);return mE(i.publicKey)}),st(this,"generateKeyPair",()=>{this.isInitialized();const s=LR();return this.setPrivateKey(s.publicKey,s.privateKey)}),st(this,"signJWT",async s=>{this.isInitialized();const i=await this.getClientSeed(),o=Q0(i),a=this.randomSessionIdentifier;return await TB(a,s,GU,o)}),st(this,"generateSharedKey",(s,i,o)=>{this.isInitialized();const a=this.getPrivateKey(s),c=FR(a,i);return this.setSymKey(c,o)}),st(this,"setSymKey",async(s,i)=>{this.isInitialized();const o=i||yu(s);return await this.keychain.set(o,s),o}),st(this,"deleteKeyPair",async s=>{this.isInitialized(),await this.keychain.del(s)}),st(this,"deleteSymKey",async s=>{this.isInitialized(),await this.keychain.del(s)}),st(this,"encode",async(s,i,o)=>{this.isInitialized();const a=S2(o),c=rs(i);if(Lm(a))return zR(c,o==null?void 0:o.encoding);if($m(a)){const f=a.senderPublicKey,d=a.receiverPublicKey;s=await this.generateSharedKey(f,d)}const l=this.getSymKey(s),{type:u,senderPublicKey:h}=a;return MR({type:u,symKey:l,message:c,senderPublicKey:h,encoding:o==null?void 0:o.encoding})}),st(this,"decode",async(s,i,o)=>{this.isInitialized();const a=qR(i,o);if(Lm(a)){const c=HR(i,o==null?void 0:o.encoding);return Zi(c)}if($m(a)){const c=a.receiverPublicKey,l=a.senderPublicKey;s=await this.generateSharedKey(c,l)}try{const c=this.getSymKey(s),l=jR({symKey:c,encoded:i,encoding:o==null?void 0:o.encoding});return Zi(l)}catch(c){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),st(this,"getPayloadType",(s,i=Ht)=>{const o=Wc({encoded:s,encoding:i});return eo(o.type)}),st(this,"getPayloadSenderPublicKey",(s,i=Ht)=>{const o=Wc({encoded:s,encoding:i});return o.senderPublicKey?Gt(o.senderPublicKey,Nt):void 0}),this.core=e,this.logger=Rt(t,this.name),this.keychain=n||new Wk(this.core,this.logger)}get context(){return Wt(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(ww)}catch{e=pp(),await this.keychain.set(ww,e)}return Kk(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}}var Xk=Object.defineProperty,e$=Object.defineProperties,t$=Object.getOwnPropertyDescriptors,Pw=Object.getOwnPropertySymbols,r$=Object.prototype.hasOwnProperty,n$=Object.prototype.propertyIsEnumerable,Ep=(r,e,t)=>e in r?Xk(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,s$=(r,e)=>{for(var t in e||(e={}))r$.call(e,t)&&Ep(r,t,e[t]);if(Pw)for(var t of Pw(e))n$.call(e,t)&&Ep(r,t,e[t]);return r},i$=(r,e)=>e$(r,t$(e)),Jt=(r,e,t)=>Ep(r,typeof e!="symbol"?e+"":e,t);class o$ extends aU{constructor(e,t){super(e,t),this.logger=e,this.core=t,Jt(this,"messages",new Map),Jt(this,"messagesWithoutClientAck",new Map),Jt(this,"name",JU),Jt(this,"version",YU),Jt(this,"initialized",!1),Jt(this,"storagePrefix",vn),Jt(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n);const s=await this.getRelayerMessagesWithoutClientAck();typeof s<"u"&&(this.messagesWithoutClientAck=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}}),Jt(this,"set",async(n,s,i)=>{this.isInitialized();const o=Er(s);let a=this.messages.get(n);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=s,this.messages.set(n,a),i===bu.inbound){const c=this.messagesWithoutClientAck.get(n)||{};this.messagesWithoutClientAck.set(n,i$(s$({},c),{[o]:s}))}return await this.persist(),o}),Jt(this,"get",n=>{this.isInitialized();let s=this.messages.get(n);return typeof s>"u"&&(s={}),s}),Jt(this,"getWithoutAck",n=>{this.isInitialized();const s={};for(const i of n){const o=this.messagesWithoutClientAck.get(i)||{};s[i]=Object.values(o)}return s}),Jt(this,"has",(n,s)=>{this.isInitialized();const i=this.get(n),o=Er(s);return typeof i[o]<"u"}),Jt(this,"ack",async(n,s)=>{this.isInitialized();const i=this.messagesWithoutClientAck.get(n);if(typeof i>"u")return;const o=Er(s);delete i[o],Object.keys(i).length===0?this.messagesWithoutClientAck.delete(n):this.messagesWithoutClientAck.set(n,i),await this.persist()}),Jt(this,"del",async n=>{this.isInitialized(),this.messages.delete(n),this.messagesWithoutClientAck.delete(n),await this.persist()}),this.logger=Rt(e,this.name),this.core=t}get context(){return Wt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,rp(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,rp(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?np(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?np(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}}var a$=Object.defineProperty,c$=Object.defineProperties,l$=Object.getOwnPropertyDescriptors,Ow=Object.getOwnPropertySymbols,u$=Object.prototype.hasOwnProperty,h$=Object.prototype.propertyIsEnumerable,Ap=(r,e,t)=>e in r?a$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,bo=(r,e)=>{for(var t in e||(e={}))u$.call(e,t)&&Ap(r,t,e[t]);if(Ow)for(var t of Ow(e))h$.call(e,t)&&Ap(r,t,e[t]);return r},Dw=(r,e)=>c$(r,l$(e)),hr=(r,e,t)=>Ap(r,typeof e!="symbol"?e+"":e,t);class f$ extends cU{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,hr(this,"events",new cr.EventEmitter),hr(this,"name",XU),hr(this,"queue",new Map),hr(this,"publishTimeout",J.toMiliseconds(J.ONE_MINUTE)),hr(this,"initialPublishTimeout",J.toMiliseconds(J.ONE_SECOND*15)),hr(this,"needsTransportRestart",!1),hr(this,"publish",async(n,s,i)=>{var o,a,c,l,u;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:s,opts:i}});const h=(i==null?void 0:i.ttl)||ZU,f=(i==null?void 0:i.prompt)||!1,d=(i==null?void 0:i.tag)||0,p=(i==null?void 0:i.id)||zs().toString(),g=_o(Gu().protocol),m={id:p,method:(i==null?void 0:i.publishMethod)||g.publish,params:bo({topic:n,message:s,ttl:h,prompt:f,tag:d,attestation:i==null?void 0:i.attestation},i==null?void 0:i.tvf)},b=`Failed to publish payload, please try again. id:${p} tag:${d}`;try{We((o=m.params)==null?void 0:o.prompt)&&((a=m.params)==null||delete a.prompt),We((c=m.params)==null?void 0:c.tag)&&((l=m.params)==null||delete l.tag);const x=new Promise(async v=>{const S=({id:A})=>{var O;((O=m.id)==null?void 0:O.toString())===A.toString()&&(this.removeRequestFromQueue(A),this.relayer.events.removeListener(Le.publish,S),v())};this.relayer.events.on(Le.publish,S);const I=yn(new Promise((A,O)=>{this.rpcPublish(m,i).then(A).catch(D=>{this.logger.warn(D,D==null?void 0:D.message),O(D)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${p} tag:${d}`);try{await I,this.events.removeListener(Le.publish,S)}catch(A){this.queue.set(p,{request:m,opts:i,attempt:1}),this.logger.warn(A,A==null?void 0:A.message)}});this.logger.trace({type:"method",method:"publish",params:{id:p,topic:n,message:s,opts:i}}),await yn(x,this.publishTimeout,b)}catch(x){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(x),(u=i==null?void 0:i.internal)!=null&&u.throwOnFailedPublish)throw x}finally{this.queue.delete(p)}}),hr(this,"publishCustom",async n=>{var s,i,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:n});const{payload:l,opts:u={}}=n,{attestation:h,tvf:f,publishMethod:d,prompt:p,tag:g,ttl:m=J.FIVE_MINUTES}=u,b=u.id||zs().toString(),x=_o(Gu().protocol),v=d||x.publish,S={id:b,method:v,params:bo(Dw(bo({},l),{ttl:m,prompt:p,tag:g,attestation:h}),f)},I=`Failed to publish custom payload, please try again. id:${b} tag:${g}`;try{We((s=S.params)==null?void 0:s.prompt)&&((i=S.params)==null||delete i.prompt),We((o=S.params)==null?void 0:o.tag)&&((a=S.params)==null||delete a.tag);const A=new Promise(async O=>{const D=({id:L})=>{var j;((j=S.id)==null?void 0:j.toString())===L.toString()&&(this.removeRequestFromQueue(L),this.relayer.events.removeListener(Le.publish,D),O())};this.relayer.events.on(Le.publish,D);const B=yn(new Promise((L,j)=>{this.rpcPublish(S,u).then(L).catch($=>{this.logger.warn($,$==null?void 0:$.message),j($)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${v} id:${b} tag:${g}`);try{await B,this.events.removeListener(Le.publish,D)}catch(L){this.queue.set(b,{request:S,opts:u,attempt:1}),this.logger.warn(L,L==null?void 0:L.message)}});this.logger.trace({type:"method",method:"publish",params:{id:b,payload:l,opts:u}}),await yn(A,this.publishTimeout,I)}catch(A){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(A),(c=u==null?void 0:u.internal)!=null&&c.throwOnFailedPublish)throw A}finally{this.queue.delete(b)}}),hr(this,"on",(n,s)=>{this.events.on(n,s)}),hr(this,"once",(n,s)=>{this.events.once(n,s)}),hr(this,"off",(n,s)=>{this.events.off(n,s)}),hr(this,"removeListener",(n,s)=>{this.events.removeListener(n,s)}),this.relayer=e,this.logger=Rt(t,this.name),this.registerEventListeners()}get context(){return Wt(this.logger)}async rpcPublish(e,t){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});const n=await this.relayer.request(e);return this.relayer.events.emit(Le.publish,bo(bo({},e),t)),this.logger.debug("Successfully Published Payload"),n}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,t)=>{var n;const s=e.attempt+1;this.queue.set(t,Dw(bo({},e),{attempt:s})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(n=e.request.params)==null?void 0:n.tag}, attempt: ${s}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(oo.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Le.connection_stalled);return}this.checkQueue()}),this.relayer.on(Le.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var d$=Object.defineProperty,p$=(r,e,t)=>e in r?d$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,vo=(r,e,t)=>p$(r,typeof e!="symbol"?e+"":e,t);class g${constructor(){vo(this,"map",new Map),vo(this,"set",(e,t)=>{const n=this.get(e);this.exists(e,t)||this.map.set(e,[...n,t])}),vo(this,"get",e=>this.map.get(e)||[]),vo(this,"exists",(e,t)=>this.get(e).includes(t)),vo(this,"delete",(e,t)=>{if(typeof t>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const n=this.get(e);if(!this.exists(e,t))return;const s=n.filter(i=>i!==t);if(!s.length){this.map.delete(e);return}this.map.set(e,s)}),vo(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var y$=Object.defineProperty,m$=Object.defineProperties,w$=Object.getOwnPropertyDescriptors,Cw=Object.getOwnPropertySymbols,b$=Object.prototype.hasOwnProperty,v$=Object.prototype.propertyIsEnumerable,xp=(r,e,t)=>e in r?y$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,dc=(r,e)=>{for(var t in e||(e={}))b$.call(e,t)&&xp(r,t,e[t]);if(Cw)for(var t of Cw(e))v$.call(e,t)&&xp(r,t,e[t]);return r},Vf=(r,e)=>m$(r,w$(e)),Oe=(r,e,t)=>xp(r,typeof e!="symbol"?e+"":e,t);class E$ extends hU{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,Oe(this,"subscriptions",new Map),Oe(this,"topicMap",new g$),Oe(this,"events",new cr.EventEmitter),Oe(this,"name",o5),Oe(this,"version",a5),Oe(this,"pending",new Map),Oe(this,"cached",[]),Oe(this,"initialized",!1),Oe(this,"storagePrefix",vn),Oe(this,"subscribeTimeout",J.toMiliseconds(J.ONE_MINUTE)),Oe(this,"initialSubscribeTimeout",J.toMiliseconds(J.ONE_SECOND*15)),Oe(this,"clientId"),Oe(this,"batchSubscribeTopicsLimit",500),Oe(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),Oe(this,"subscribe",async(n,s)=>{var i;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:s}});try{const o=Gu(s),a={topic:n,relay:o,transportType:s==null?void 0:s.transportType};(i=s==null?void 0:s.internal)!=null&&i.skipSubscribe||this.pending.set(n,a);const c=await this.rpcSubscribe(n,o,s);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:s}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),Oe(this,"unsubscribe",async(n,s)=>{this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(n,s.id,s):await this.unsubscribeByTopic(n,s)}),Oe(this,"isSubscribed",n=>new Promise(s=>{s(this.topicMap.topics.includes(n))})),Oe(this,"isKnownTopic",n=>new Promise(s=>{s(this.topicMap.topics.includes(n)||this.pending.has(n)||this.cached.some(i=>i.topic===n))})),Oe(this,"on",(n,s)=>{this.events.on(n,s)}),Oe(this,"once",(n,s)=>{this.events.once(n,s)}),Oe(this,"off",(n,s)=>{this.events.off(n,s)}),Oe(this,"removeListener",(n,s)=>{this.events.removeListener(n,s)}),Oe(this,"start",async()=>{await this.onConnect()}),Oe(this,"stop",async()=>{await this.onDisconnect()}),Oe(this,"restart",async()=>{await this.restore(),await this.onRestart()}),Oe(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const n=[];this.pending.forEach(s=>{n.push(s)}),await this.batchSubscribe(n)}),Oe(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(oo.pulse,async()=>{await this.checkPending()}),this.events.on(Xt.created,async n=>{const s=Xt.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:n}),await this.persist()}),this.events.on(Xt.deleted,async n=>{const s=Xt.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:n}),await this.persist()})}),this.relayer=e,this.logger=Rt(t,this.name),this.clientId=""}get context(){return Wt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,t){let n=!1;try{n=this.getSubscription(e).topic===t}catch{}return n}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){const n=this.topicMap.get(e);await Promise.all(n.map(async s=>await this.unsubscribeById(e,s,t)))}async unsubscribeById(e,t,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:n}});try{const s=Gu(n);await this.restartToComplete({topic:e,id:t,relay:s}),await this.rpcUnsubscribe(e,t,s);const i=_e("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,i),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:n}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,t,n){var s,i;const o=await this.getSubscriptionId(e);if((s=n==null?void 0:n.internal)!=null&&s.skipSubscribe)return o;(!n||(n==null?void 0:n.transportType)===Be.relay)&&await this.restartToComplete({topic:e,id:e,relay:t});const a={method:_o(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});const c=(i=n==null?void 0:n.internal)==null?void 0:i.throwOnFailedPublish;try{if((n==null?void 0:n.transportType)===Be.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(h=>this.logger.warn(h))},J.toMiliseconds(J.ONE_SECOND)),o;const l=new Promise(async h=>{const f=d=>{d.topic===e&&(this.events.removeListener(Xt.created,f),h(d.id))};this.events.on(Xt.created,f);try{const d=await yn(new Promise((p,g)=>{this.relayer.request(a).catch(m=>{this.logger.warn(m,m==null?void 0:m.message),g(m)}).then(p)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(Xt.created,f),h(d)}catch{}}),u=await yn(l,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!u&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return u?o:null}catch(l){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Le.connection_stalled),c)throw l}return null}async rpcBatchSubscribe(e){if(!e.length)return;const t=e[0].relay,n={method:_o(t.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await yn(new Promise(s=>{this.relayer.request(n).catch(i=>this.logger.warn(i)).then(s)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(Le.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const t=e[0].relay,n={method:_o(t.protocol).batchFetchMessages,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});let s;try{s=await await yn(new Promise((i,o)=>{this.relayer.request(n).catch(a=>{this.logger.warn(a),o(a)}).then(i)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(Le.connection_stalled)}return s}rpcUnsubscribe(e,t,n){const s={method:_o(n.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,t){this.setSubscription(e,Vf(dc({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(t=>{this.setSubscription(t.id,dc({},t)),this.pending.delete(t.topic)})}async onUnsubscribe(e,t,n){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,n),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t)}addSubscription(e,t){this.subscriptions.set(e,dc({},t)),this.topicMap.set(t.topic,e),this.events.emit(Xt.created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:n}=W("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const n=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(n.topic,e),this.events.emit(Xt.deleted,Vf(dc({},n),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Xt.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let n=0;n<t;n++){const s=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(Xt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(t=>{var n;return t.topic===((n=this.subscriptions.get(t.id))==null?void 0:n.topic)})){const{message:t}=W("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async t=>Vf(dc({},t),{id:await this.getSubscriptionId(t.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const t=await this.rpcBatchFetchMessages(e);t&&t.messages&&(await oT(J.toMiliseconds(J.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(t.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return Er(e+await this.getClientId())}}var A$=Object.defineProperty,Bw=Object.getOwnPropertySymbols,x$=Object.prototype.hasOwnProperty,I$=Object.prototype.propertyIsEnumerable,Ip=(r,e,t)=>e in r?A$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,_w=(r,e)=>{for(var t in e||(e={}))x$.call(e,t)&&Ip(r,t,e[t]);if(Bw)for(var t of Bw(e))I$.call(e,t)&&Ip(r,t,e[t]);return r},be=(r,e,t)=>Ip(r,typeof e!="symbol"?e+"":e,t);class S$ extends lU{constructor(e){super(e),be(this,"protocol","wc"),be(this,"version",2),be(this,"core"),be(this,"logger"),be(this,"events",new cr.EventEmitter),be(this,"provider"),be(this,"messages"),be(this,"subscriber"),be(this,"publisher"),be(this,"name",t5),be(this,"transportExplicitlyClosed",!1),be(this,"initialized",!1),be(this,"connectionAttemptInProgress",!1),be(this,"relayUrl"),be(this,"projectId"),be(this,"packageName"),be(this,"bundleId"),be(this,"hasExperiencedNetworkDisruption",!1),be(this,"pingTimeout"),be(this,"heartBeatTimeout",J.toMiliseconds(J.THIRTY_SECONDS+J.FIVE_SECONDS)),be(this,"reconnectTimeout"),be(this,"connectPromise"),be(this,"reconnectInProgress",!1),be(this,"requestsInFlight",[]),be(this,"connectTimeout",J.toMiliseconds(J.ONE_SECOND*15)),be(this,"request",async t=>{var n,s;this.logger.debug("Publishing Request Payload");const i=t.id||zs().toString();await this.toEstablishConnection();try{this.logger.trace({id:i,method:t.method,topic:(n=t.params)==null?void 0:n.topic},"relayer.request - publishing...");const o=`${i}:${((s=t.params)==null?void 0:s.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(t);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${i}`),o}}),be(this,"resetPingTimeout",()=>{ju()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var t,n,s,i;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(i=(s=(n=(t=this.provider)==null?void 0:t.connection)==null?void 0:n.socket)==null?void 0:s.terminate)==null||i.call(s)}catch(o){this.logger.warn(o,o==null?void 0:o.message)}},this.heartBeatTimeout))}),be(this,"onPayloadHandler",t=>{this.onProviderPayload(t),this.resetPingTimeout()}),be(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected 🛜"),this.startPingTimeout(),this.events.emit(Le.connect)}),be(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected 🛑"),this.requestsInFlight=[],this.onProviderDisconnect()}),be(this,"onProviderErrorHandler",t=>{this.logger.fatal(`Fatal socket error: ${t.message}`),this.events.emit(Le.error,t),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),be(this,"registerProviderListeners",()=>{this.provider.on(ur.payload,this.onPayloadHandler),this.provider.on(ur.connect,this.onConnectHandler),this.provider.on(ur.disconnect,this.onDisconnectHandler),this.provider.on(ur.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Rt(e.logger,this.name):Sl(Nh({level:e.logger||e5})),this.messages=new o$(this.logger,e.core),this.subscriber=new E$(this,this.logger),this.publisher=new f$(this,this.logger),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||F2,q_()?this.packageName=im():V_()&&(this.bundleId=im()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e==null?void 0:e.message))}get context(){return Wt(this.logger)}get connected(){var e,t,n;return((n=(t=(e=this.provider)==null?void 0:e.connection)==null?void 0:t.socket)==null?void 0:n.readyState)===1||!1}get connecting(){var e,t,n;return((n=(t=(e=this.provider)==null?void 0:e.connection)==null?void 0:t.socket)==null?void 0:n.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,t,n){this.isInitialized(),await this.publisher.publish(e,t,n),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now(),transportType:Be.relay},bu.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,t){var n,s,i;this.isInitialized(),(!(t!=null&&t.transportType)||(t==null?void 0:t.transportType)==="relay")&&await this.toEstablishConnection();const o=typeof((n=t==null?void 0:t.internal)==null?void 0:n.throwOnFailedPublish)>"u"?!0:(s=t==null?void 0:t.internal)==null?void 0:s.throwOnFailedPublish;let a=((i=this.subscriber.topicMap.get(e))==null?void 0:i[0])||"",c;const l=u=>{u.topic===e&&(this.subscriber.off(Xt.created,l),c())};return await Promise.all([new Promise(u=>{c=u,this.subscriber.on(Xt.created,l)}),new Promise(async(u,h)=>{a=await this.subscriber.subscribe(e,_w({internal:{throwOnFailedPublish:o}},t)).catch(f=>{o&&h(f)})||a,u()})]),a}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await yn(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(t,n)=>{await this.connect(e).then(t).catch(n).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Ym())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if((e==null?void 0:e.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const t=e.sort((n,s)=>n.publishedAt-s.publishedAt);this.logger.debug(`Batch of ${t.length} message events sorted`);for(const n of t)try{await this.onMessageEvent(n)}catch(s){this.logger.warn(s,"Error while processing batch message event: "+(s==null?void 0:s.message))}this.logger.trace(`Batch of ${t.length} message events processed`)}async onLinkMessageEvent(e,t){const{topic:n}=e;if(!t.sessionExists){const s=qe(J.FIVE_MINUTES),i={topic:n,expiry:s,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(n,i)}this.events.emit(Le.message,e),await this.recordMessageEvent(e,bu.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let t=1;for(;t<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${t}...`),await this.createProvider(),await new Promise(async(n,s)=>{const i=()=>{s(new Error("Connection interrupted while trying to connect"))};this.provider.once(ur.disconnect,i),await yn(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{s(o)}).finally(()=>{this.provider.off(ur.disconnect,i),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{s(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(ur.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(ur.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,n()})}catch(n){await this.subscriber.stop();const s=n;this.logger.warn({},s.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${t}`);break}await new Promise(n=>setTimeout(n,J.toMiliseconds(t*1))),t++}}startPingTimeout(){var e,t,n,s,i;if(ju())try{(t=(e=this.provider)==null?void 0:e.connection)!=null&&t.socket&&((i=(s=(n=this.provider)==null?void 0:n.connection)==null?void 0:s.socket)==null||i.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o==null?void 0:o.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Og(new zU(J_({sdkVersion:wp,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,t){const{topic:n,message:s}=e;await this.messages.set(n,s,t)}async shouldIgnoreMessageEvent(e){const{topic:t,message:n}=e;if(!n||n.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isKnownTopic(t))return this.logger.warn(`Ignoring message for unknown topic ${t}`),!0;const s=this.messages.has(t,n);return s&&this.logger.warn(`Ignoring duplicate message: ${n}`),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Pg(e)){if(!e.method.endsWith(r5))return;const t=e.params,{topic:n,message:s,publishedAt:i,attestation:o}=t.data,a={topic:n,message:s,publishedAt:i,transportType:Be.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(_w({type:"event",event:t.id},a)),this.events.emit(t.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else Uh(e)&&this.events.emit(Le.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,bu.inbound),this.events.emit(Le.message,e))}async acknowledgePayload(e){const t=Jc(e.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(ur.payload,this.onPayloadHandler),this.provider.off(ur.connect,this.onConnectHandler),this.provider.off(ur.disconnect,this.onDisconnectHandler),this.provider.off(ur.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await Ym();H4(async t=>{e!==t&&(e=t,t?await this.transportOpen().catch(n=>this.logger.error(n,n==null?void 0:n.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(oo.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&K4())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(t){this.logger.warn(t,t==null?void 0:t.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(Le.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e==null?void 0:e.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},J.toMiliseconds(n5)))))}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function P$(r,e){return r===e||Number.isNaN(r)&&Number.isNaN(e)}function Tw(r){return Object.getOwnPropertySymbols(r).filter(e=>Object.prototype.propertyIsEnumerable.call(r,e))}function Nw(r){return r==null?r===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(r)}const O$="[object RegExp]",D$="[object String]",C$="[object Number]",B$="[object Boolean]",Rw="[object Arguments]",_$="[object Symbol]",T$="[object Date]",N$="[object Map]",R$="[object Set]",U$="[object Array]",k$="[object Function]",$$="[object ArrayBuffer]",Kf="[object Object]",L$="[object Error]",F$="[object DataView]",M$="[object Uint8Array]",j$="[object Uint8ClampedArray]",z$="[object Uint16Array]",H$="[object Uint32Array]",q$="[object BigUint64Array]",V$="[object Int8Array]",K$="[object Int16Array]",G$="[object Int32Array]",Q$="[object BigInt64Array]",W$="[object Float32Array]",J$="[object Float64Array]";function Y$(){}function Uw(r){if(!r||typeof r!="object")return!1;const e=Object.getPrototypeOf(r);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(r)==="[object Object]":!1}function Z$(r,e,t){return Ic(r,e,void 0,void 0,void 0,void 0,t)}function Ic(r,e,t,n,s,i,o){const a=o(r,e,t,n,s,i);if(a!==void 0)return a;if(typeof r==typeof e)switch(typeof r){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return r===e;case"number":return r===e||Object.is(r,e);case"function":return r===e;case"object":return Tc(r,e,i,o)}return Tc(r,e,i,o)}function Tc(r,e,t,n){if(Object.is(r,e))return!0;let s=Nw(r),i=Nw(e);if(s===Rw&&(s=Kf),i===Rw&&(i=Kf),s!==i)return!1;switch(s){case D$:return r.toString()===e.toString();case C$:{const c=r.valueOf(),l=e.valueOf();return P$(c,l)}case B$:case T$:case _$:return Object.is(r.valueOf(),e.valueOf());case O$:return r.source===e.source&&r.flags===e.flags;case k$:return r===e}t=t??new Map;const o=t.get(r),a=t.get(e);if(o!=null&&a!=null)return o===e;t.set(r,e),t.set(e,r);try{switch(s){case N$:{if(r.size!==e.size)return!1;for(const[c,l]of r.entries())if(!e.has(c)||!Ic(l,e.get(c),c,r,e,t,n))return!1;return!0}case R$:{if(r.size!==e.size)return!1;const c=Array.from(r.values()),l=Array.from(e.values());for(let u=0;u<c.length;u++){const h=c[u],f=l.findIndex(d=>Ic(h,d,void 0,r,e,t,n));if(f===-1)return!1;l.splice(f,1)}return!0}case U$:case M$:case j$:case z$:case H$:case q$:case V$:case K$:case G$:case Q$:case W$:case J$:{if(typeof Buffer<"u"&&Buffer.isBuffer(r)!==Buffer.isBuffer(e)||r.length!==e.length)return!1;for(let c=0;c<r.length;c++)if(!Ic(r[c],e[c],c,r,e,t,n))return!1;return!0}case $$:return r.byteLength!==e.byteLength?!1:Tc(new Uint8Array(r),new Uint8Array(e),t,n);case F$:return r.byteLength!==e.byteLength||r.byteOffset!==e.byteOffset?!1:Tc(new Uint8Array(r),new Uint8Array(e),t,n);case L$:return r.name===e.name&&r.message===e.message;case Kf:{if(!(Tc(r.constructor,e.constructor,t,n)||Uw(r)&&Uw(e)))return!1;const c=[...Object.keys(r),...Tw(r)],l=[...Object.keys(e),...Tw(e)];if(c.length!==l.length)return!1;for(let u=0;u<c.length;u++){const h=c[u],f=r[h];if(!Object.hasOwn(e,h))return!1;const d=e[h];if(!Ic(f,d,h,r,e,t,n))return!1}return!0}default:return!1}}finally{t.delete(r),t.delete(e)}}function X$(r,e){return Z$(r,e,Y$)}var eL=Object.defineProperty,kw=Object.getOwnPropertySymbols,tL=Object.prototype.hasOwnProperty,rL=Object.prototype.propertyIsEnumerable,Sp=(r,e,t)=>e in r?eL(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,$w=(r,e)=>{for(var t in e||(e={}))tL.call(e,t)&&Sp(r,t,e[t]);if(kw)for(var t of kw(e))rL.call(e,t)&&Sp(r,t,e[t]);return r},kt=(r,e,t)=>Sp(r,typeof e!="symbol"?e+"":e,t);class co extends uU{constructor(e,t,n,s=vn,i=void 0){super(e,t,n,s),this.core=e,this.logger=t,this.name=n,kt(this,"map",new Map),kt(this,"version",s5),kt(this,"cached",[]),kt(this,"initialized",!1),kt(this,"getKey"),kt(this,"storagePrefix",vn),kt(this,"recentlyDeleted",[]),kt(this,"recentlyDeletedLimit",200),kt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!We(o)?this.map.set(this.getKey(o),o):v4(o)?this.map.set(o.id,o):E4(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),kt(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),kt(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),kt(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>X$(a[c],o[c]))):this.values)),kt(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=$w($w({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),kt(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=Rt(t,this.name),this.storagePrefix=s,this.getKey=i}get context(){return Wt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){if(this.recentlyDeleted.includes(e)){const{message:s}=W("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}const{message:n}=W("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:t}=W("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}}var nL=Object.defineProperty,sL=(r,e,t)=>e in r?nL(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,de=(r,e,t)=>sL(r,typeof e!="symbol"?e+"":e,t);class iL{constructor(e,t){this.core=e,this.logger=t,de(this,"name",c5),de(this,"version",l5),de(this,"events",new eg),de(this,"pairings"),de(this,"initialized",!1),de(this,"storagePrefix",vn),de(this,"ignoredPayloadTypes",[Zn]),de(this,"registeredMethods",[]),de(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),de(this,"register",({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]}),de(this,"create",async n=>{this.isInitialized();const s=pp(),i=await this.core.crypto.setSymKey(s),o=qe(J.FIVE_MINUTES),a={protocol:L2},c={topic:i,expiry:o,relay:a,active:!1,methods:n==null?void 0:n.methods},l=zm({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:s,relay:a,expiryTimestamp:o,methods:n==null?void 0:n.methods});return this.events.emit(fi.create,c),this.core.expirer.set(i,o),await this.pairings.set(i,c),await this.core.relayer.subscribe(i,{transportType:n==null?void 0:n.transportType,internal:n==null?void 0:n.internal}),{topic:i,uri:l}}),de(this,"pair",async n=>{this.isInitialized();const s=this.core.eventClient.createEvent({properties:{topic:n==null?void 0:n.uri,trace:[Yr.pairing_started]}});this.isValidPair(n,s);const{topic:i,symKey:o,relay:a,expiryTimestamp:c,methods:l}=jm(n.uri);s.props.properties.topic=i,s.addTrace(Yr.pairing_uri_validation_success),s.addTrace(Yr.pairing_uri_not_expired);let u;if(this.pairings.keys.includes(i)){if(u=this.pairings.get(i),s.addTrace(Yr.existing_pairing),u.active)throw s.setError(Bn.active_pairing_already_exists),new Error(`Pairing already exists: ${i}. Please try again with a new connection URI.`);s.addTrace(Yr.pairing_not_expired)}const h=c||qe(J.FIVE_MINUTES),f={topic:i,relay:a,expiry:h,active:!1,methods:l};this.core.expirer.set(i,h),await this.pairings.set(i,f),s.addTrace(Yr.store_new_pairing),n.activatePairing&&await this.activate({topic:i}),this.events.emit(fi.create,f),s.addTrace(Yr.emit_inactive_pairing),this.core.crypto.keychain.has(i)||await this.core.crypto.setSymKey(o,i),s.addTrace(Yr.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{s.setError(Bn.no_internet_connection)}try{await this.core.relayer.subscribe(i,{relay:a})}catch(d){throw s.setError(Bn.subscribe_pairing_topic_failure),d}return s.addTrace(Yr.subscribe_pairing_topic_success),f}),de(this,"activate",async({topic:n})=>{this.isInitialized();const s=qe(J.FIVE_MINUTES);this.core.expirer.set(n,s),await this.pairings.update(n,{active:!0,expiry:s})}),de(this,"ping",async n=>{this.isInitialized(),await this.isValidPing(n),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:s}=n;if(this.pairings.keys.includes(s)){const i=await this.sendRequest(s,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=ai();this.events.once(ve("pairing_ping",i),({error:l})=>{l?c(l):a()}),await o()}}),de(this,"updateExpiry",async({topic:n,expiry:s})=>{this.isInitialized(),await this.pairings.update(n,{expiry:s})}),de(this,"updateMetadata",async({topic:n,metadata:s})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:s})}),de(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),de(this,"disconnect",async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:s}=n;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",_e("USER_DISCONNECTED")),await this.deletePairing(s))}),de(this,"formatUriFromPairing",n=>{this.isInitialized();const{topic:s,relay:i,expiry:o,methods:a}=n,c=this.core.crypto.keychain.get(s);return zm({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:c,relay:i,expiryTimestamp:o,methods:a})}),de(this,"sendRequest",async(n,s,i)=>{const o=Mr(s,i),a=await this.core.crypto.encode(n,o),c=uc[s].req;return this.core.history.set(n,o),this.core.relayer.publish(n,a,c),o.id}),de(this,"sendResult",async(n,s,i)=>{const o=Jc(n,i),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,n)).request.method,l=uc[c].res;await this.core.relayer.publish(s,a,l),await this.core.history.resolve(o)}),de(this,"sendError",async(n,s,i)=>{const o=Rh(n,i),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,n)).request.method,l=uc[c]?uc[c].res:uc.unregistered_method.res;await this.core.relayer.publish(s,a,l),await this.core.history.resolve(o)}),de(this,"deletePairing",async(n,s)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,_e("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),s?Promise.resolve():this.core.expirer.del(n)])}),de(this,"cleanup",async()=>{const n=this.pairings.getAll().filter(s=>fn(s.expiry));await Promise.all(n.map(s=>this.deletePairing(s.topic)))}),de(this,"onRelayEventRequest",async n=>{const{topic:s,payload:i}=n;switch(i.method){case"wc_pairingPing":return await this.onPairingPingRequest(s,i);case"wc_pairingDelete":return await this.onPairingDeleteRequest(s,i);default:return await this.onUnknownRpcMethodRequest(s,i)}}),de(this,"onRelayEventResponse",async n=>{const{topic:s,payload:i}=n,o=(await this.core.history.get(s,i.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(s,i);default:return this.onUnknownRpcMethodResponse(o)}}),de(this,"onPairingPingRequest",async(n,s)=>{const{id:i}=s;try{this.isValidPing({topic:n}),await this.sendResult(i,n,!0),this.events.emit(fi.ping,{id:i,topic:n})}catch(o){await this.sendError(i,n,o),this.logger.error(o)}}),de(this,"onPairingPingResponse",(n,s)=>{const{id:i}=s;setTimeout(()=>{Xr(s)?this.events.emit(ve("pairing_ping",i),{}):Ar(s)&&this.events.emit(ve("pairing_ping",i),{error:s.error})},500)}),de(this,"onPairingDeleteRequest",async(n,s)=>{const{id:i}=s;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(fi.delete,{id:i,topic:n})}catch(o){await this.sendError(i,n,o),this.logger.error(o)}}),de(this,"onUnknownRpcMethodRequest",async(n,s)=>{const{id:i,method:o}=s;try{if(this.registeredMethods.includes(o))return;const a=_e("WC_METHOD_UNSUPPORTED",o);await this.sendError(i,n,a),this.logger.error(a)}catch(a){await this.sendError(i,n,a),this.logger.error(a)}}),de(this,"onUnknownRpcMethodResponse",n=>{this.registeredMethods.includes(n)||this.logger.error(_e("WC_METHOD_UNSUPPORTED",n))}),de(this,"isValidPair",(n,s)=>{var i;if(!Lt(n)){const{message:a}=W("MISSING_OR_INVALID",`pair() params: ${n}`);throw s.setError(Bn.malformed_pairing_uri),new Error(a)}if(!b4(n.uri)){const{message:a}=W("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw s.setError(Bn.malformed_pairing_uri),new Error(a)}const o=jm(n==null?void 0:n.uri);if(!((i=o==null?void 0:o.relay)!=null&&i.protocol)){const{message:a}=W("MISSING_OR_INVALID","pair() uri#relay-protocol");throw s.setError(Bn.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=W("MISSING_OR_INVALID","pair() uri#symKey");throw s.setError(Bn.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&J.toMiliseconds(o==null?void 0:o.expiryTimestamp)<Date.now()){s.setError(Bn.pairing_expired);const{message:a}=W("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),de(this,"isValidPing",async n=>{if(!Lt(n)){const{message:i}=W("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(i)}const{topic:s}=n;await this.isValidPairingTopic(s)}),de(this,"isValidDisconnect",async n=>{if(!Lt(n)){const{message:i}=W("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(i)}const{topic:s}=n;await this.isValidPairingTopic(s)}),de(this,"isValidPairingTopic",async n=>{if(!Ve(n,!1)){const{message:s}=W("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(s)}if(!this.pairings.keys.includes(n)){const{message:s}=W("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(s)}if(fn(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:s}=W("EXPIRED",`pairing topic: ${n}`);throw new Error(s)}}),this.core=e,this.logger=Rt(t,this.name),this.pairings=new co(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Wt(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(Le.message,async e=>{const{topic:t,message:n,transportType:s}=e;if(this.pairings.keys.includes(t)&&s!==Be.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))try{const i=await this.core.crypto.decode(t,n);Pg(i)?(this.core.history.set(t,i),await this.onRelayEventRequest({topic:t,payload:i})):Uh(i)&&(await this.core.history.resolve(i),await this.onRelayEventResponse({topic:t,payload:i}),this.core.history.delete(t,i.id)),await this.core.relayer.messages.ack(t,n)}catch(i){this.logger.error(i)}})}registerExpirerEvents(){this.core.expirer.on(dr.expired,async e=>{const{topic:t}=DE(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(fi.expire,{topic:t}))})}}var oL=Object.defineProperty,aL=(r,e,t)=>e in r?oL(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,it=(r,e,t)=>aL(r,typeof e!="symbol"?e+"":e,t);class cL extends oU{constructor(e,t){super(e,t),this.core=e,this.logger=t,it(this,"records",new Map),it(this,"events",new cr.EventEmitter),it(this,"name",u5),it(this,"version",h5),it(this,"cached",[]),it(this,"initialized",!1),it(this,"storagePrefix",vn),it(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),it(this,"set",(n,s,i)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:s,chainId:i}),this.records.has(s.id))return;const o={id:s.id,topic:n,request:{method:s.method,params:s.params||null},chainId:i,expiry:qe(J.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(Or.created,o)}),it(this,"resolve",async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const s=await this.getRecord(n.id);typeof s.response>"u"&&(s.response=Ar(n)?{error:n.error}:{result:n.result},this.records.set(s.id,s),this.persist(),this.events.emit(Or.updated,s))}),it(this,"get",async(n,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:s}),await this.getRecord(s))),it(this,"delete",(n,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(i=>{if(i.topic===n){if(typeof s<"u"&&i.id!==s)return;this.records.delete(i.id),this.events.emit(Or.deleted,i)}}),this.persist()}),it(this,"exists",async(n,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===n:!1)),it(this,"on",(n,s)=>{this.events.on(n,s)}),it(this,"once",(n,s)=>{this.events.once(n,s)}),it(this,"off",(n,s)=>{this.events.off(n,s)}),it(this,"removeListener",(n,s)=>{this.events.removeListener(n,s)}),this.logger=Rt(t,this.name)}get context(){return Wt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const n={topic:t.topic,request:Mr(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(n)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:n}=W("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Or.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:t}=W("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Or.created,e=>{const t=Or.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(Or.updated,e=>{const t=Or.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(Or.deleted,e=>{const t=Or.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.core.heartbeat.on(oo.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(t=>{J.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.records.delete(t.id),this.events.emit(Or.deleted,t,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}}var lL=Object.defineProperty,uL=(r,e,t)=>e in r?lL(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,wt=(r,e,t)=>uL(r,typeof e!="symbol"?e+"":e,t);class hL extends fU{constructor(e,t){super(e,t),this.core=e,this.logger=t,wt(this,"expirations",new Map),wt(this,"events",new cr.EventEmitter),wt(this,"name",f5),wt(this,"version",d5),wt(this,"cached",[]),wt(this,"initialized",!1),wt(this,"storagePrefix",vn),wt(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),wt(this,"has",n=>{try{const s=this.formatTarget(n);return typeof this.getExpiration(s)<"u"}catch{return!1}}),wt(this,"set",(n,s)=>{this.isInitialized();const i=this.formatTarget(n),o={target:i,expiry:s};this.expirations.set(i,o),this.checkExpiry(i,o),this.events.emit(dr.created,{target:i,expiration:o})}),wt(this,"get",n=>{this.isInitialized();const s=this.formatTarget(n);return this.getExpiration(s)}),wt(this,"del",n=>{if(this.isInitialized(),this.has(n)){const s=this.formatTarget(n),i=this.getExpiration(s);this.expirations.delete(s),this.events.emit(dr.deleted,{target:s,expiration:i})}}),wt(this,"on",(n,s)=>{this.events.on(n,s)}),wt(this,"once",(n,s)=>{this.events.once(n,s)}),wt(this,"off",(n,s)=>{this.events.off(n,s)}),wt(this,"removeListener",(n,s)=>{this.events.removeListener(n,s)}),this.logger=Rt(t,this.name)}get context(){return Wt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return Y_(e);if(typeof e=="number")return Z_(e);const{message:t}=W("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(dr.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:t}=W("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:n}=W("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(n),new Error(n)}return t}checkExpiry(e,t){const{expiry:n}=t;J.toMiliseconds(n)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(dr.expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(oo.pulse,()=>this.checkExpirations()),this.events.on(dr.created,e=>{const t=dr.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(dr.expired,e=>{const t=dr.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(dr.deleted,e=>{const t=dr.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}}var fL=Object.defineProperty,dL=(r,e,t)=>e in r?fL(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,He=(r,e,t)=>dL(r,typeof e!="symbol"?e+"":e,t);class pL extends dU{constructor(e,t,n){super(e,t,n),this.core=e,this.logger=t,this.store=n,He(this,"name",p5),He(this,"abortController"),He(this,"isDevEnv"),He(this,"verifyUrlV3",y5),He(this,"storagePrefix",vn),He(this,"version",$2),He(this,"publicKey"),He(this,"fetchPromise"),He(this,"init",async()=>{var s;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&J.toMiliseconds((s=this.publicKey)==null?void 0:s.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),He(this,"register",async s=>{if(!Ga()||this.isDevEnv)return;const i=window.location.origin,{id:o,decryptedId:a}=s,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${i}&id=${o}&decryptedId=${a}`;try{const l=ts.getDocument(),u=this.startAbortTimer(J.ONE_SECOND*5),h=await new Promise((f,d)=>{const p=()=>{window.removeEventListener("message",m),l.body.removeChild(g),d("attestation aborted")};this.abortController.signal.addEventListener("abort",p);const g=l.createElement("iframe");g.src=c,g.style.display="none",g.addEventListener("error",p,{signal:this.abortController.signal});const m=b=>{if(b.data&&typeof b.data=="string")try{const x=JSON.parse(b.data);if(x.type==="verify_attestation"){if(ep(x.attestation).payload.id!==o)return;clearInterval(u),l.body.removeChild(g),this.abortController.signal.removeEventListener("abort",p),window.removeEventListener("message",m),f(x.attestation===null?"":x.attestation)}}catch(x){this.logger.warn(x)}};l.body.appendChild(g),window.addEventListener("message",m,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",h),h}catch(l){this.logger.warn(l)}return""}),He(this,"resolve",async s=>{if(this.isDevEnv)return"";const{attestationId:i,hash:o,encryptedId:a}=s;if(i===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(i){if(ep(i).payload.id!==a)return;const l=await this.isValidJwtAttestation(i);if(l){if(!l.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return l}}if(!o)return;const c=this.getVerifyUrl(s==null?void 0:s.verifyUrl);return this.fetchAttestation(o,c)}),He(this,"fetchAttestation",async(s,i)=>{this.logger.debug(`resolving attestation: ${s} from url: ${i}`);const o=this.startAbortTimer(J.ONE_SECOND*5),a=await fetch(`${i}/attestation/${s}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),He(this,"getVerifyUrl",s=>{let i=s||_c;return m5.includes(i)||(this.logger.info(`verify url: ${i}, not included in trusted list, assigning default: ${_c}`),i=_c),i}),He(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const s=this.startAbortTimer(J.FIVE_SECONDS),i=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(s),await i.json()}catch(s){this.logger.warn(s)}}),He(this,"persistPublicKey",async s=>{this.logger.debug("persisting public key to local storage",s),await this.store.setItem(this.storeKey,s),this.publicKey=s}),He(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),He(this,"isValidJwtAttestation",async s=>{const i=await this.getPublicKey();try{if(i)return this.validateAttestation(s,i)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(s,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),He(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),He(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async i=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),i(o))});const s=await this.fetchPromise;return this.fetchPromise=void 0,s}),He(this,"validateAttestation",(s,i)=>{const o=KR(s,i.publicKey),a={hasExpired:J.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=Rt(t,this.name),this.abortController=new AbortController,this.isDevEnv=fg(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return Wt(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),J.toMiliseconds(e))}}var gL=Object.defineProperty,yL=(r,e,t)=>e in r?gL(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Lw=(r,e,t)=>yL(r,typeof e!="symbol"?e+"":e,t);class mL extends pU{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,Lw(this,"context",w5),Lw(this,"registerDeviceToken",async n=>{const{clientId:s,token:i,notificationType:o,enableEncrypted:a=!1}=n,c=`${b5}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:s,type:o,token:i,always_raw:a})})}),this.logger=Rt(t,this.context)}}var wL=Object.defineProperty,Fw=Object.getOwnPropertySymbols,bL=Object.prototype.hasOwnProperty,vL=Object.prototype.propertyIsEnumerable,Pp=(r,e,t)=>e in r?wL(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,pc=(r,e)=>{for(var t in e||(e={}))bL.call(e,t)&&Pp(r,t,e[t]);if(Fw)for(var t of Fw(e))vL.call(e,t)&&Pp(r,t,e[t]);return r},Ye=(r,e,t)=>Pp(r,typeof e!="symbol"?e+"":e,t);class EL extends gU{constructor(e,t,n=!0){super(e,t,n),this.core=e,this.logger=t,Ye(this,"context",E5),Ye(this,"storagePrefix",vn),Ye(this,"storageVersion",v5),Ye(this,"events",new Map),Ye(this,"shouldPersist",!1),Ye(this,"init",async()=>{if(!fg())try{const s={eventId:am(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:PE(this.core.relayer.protocol,this.core.relayer.version,wp)}}};await this.sendEvent([s])}catch(s){this.logger.warn(s)}}),Ye(this,"createEvent",s=>{const{event:i="ERROR",type:o="",properties:{topic:a,trace:c}}=s,l=am(),u=this.core.projectId||"",h=Date.now(),f=pc({eventId:l,timestamp:h,props:{event:i,type:o,properties:{topic:a,trace:c}},bundleId:u,domain:this.getAppDomain()},this.setMethods(l));return this.telemetryEnabled&&(this.events.set(l,f),this.shouldPersist=!0),f}),Ye(this,"getEvent",s=>{const{eventId:i,topic:o}=s;if(i)return this.events.get(i);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return pc(pc({},a),this.setMethods(a.eventId))}),Ye(this,"deleteEvent",s=>{const{eventId:i}=s;this.events.delete(i),this.shouldPersist=!0}),Ye(this,"setEventListeners",()=>{this.core.heartbeat.on(oo.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(s=>{J.fromMiliseconds(Date.now())-J.fromMiliseconds(s.timestamp)>A5&&(this.events.delete(s.eventId),this.shouldPersist=!0)})})}),Ye(this,"setMethods",s=>({addTrace:i=>this.addTrace(s,i),setError:i=>this.setError(s,i)})),Ye(this,"addTrace",(s,i)=>{const o=this.events.get(s);o&&(o.props.properties.trace.push(i),this.events.set(s,o),this.shouldPersist=!0)}),Ye(this,"setError",(s,i)=>{const o=this.events.get(s);o&&(o.props.type=i,o.timestamp=Date.now(),this.events.set(s,o),this.shouldPersist=!0)}),Ye(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),Ye(this,"restore",async()=>{try{const s=await this.core.storage.getItem(this.storageKey)||[];if(!s.length)return;s.forEach(i=>{this.events.set(i.eventId,pc(pc({},i),this.setMethods(i.eventId)))})}catch(s){this.logger.warn(s)}}),Ye(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const s=[];for(const[i,o]of this.events)o.props.type&&s.push(o);if(s.length!==0)try{if((await this.sendEvent(s)).ok)for(const i of s)this.events.delete(i.eventId),this.shouldPersist=!0}catch(i){this.logger.warn(i)}}),Ye(this,"sendEvent",async s=>{const i=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${x5}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${wp}${i}`,{method:"POST",body:JSON.stringify(s)})}),Ye(this,"getAppDomain",()=>SE().url),this.logger=Rt(t,this.context),this.telemetryEnabled=n,n?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var AL=Object.defineProperty,Mw=Object.getOwnPropertySymbols,xL=Object.prototype.hasOwnProperty,IL=Object.prototype.propertyIsEnumerable,Op=(r,e,t)=>e in r?AL(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,jw=(r,e)=>{for(var t in e||(e={}))xL.call(e,t)&&Op(r,t,e[t]);if(Mw)for(var t of Mw(e))IL.call(e,t)&&Op(r,t,e[t]);return r},De=(r,e,t)=>Op(r,typeof e!="symbol"?e+"":e,t);let SL=class Z2 extends rU{constructor(e){var t;super(e),De(this,"protocol",k2),De(this,"version",$2),De(this,"name",mp),De(this,"relayUrl"),De(this,"projectId"),De(this,"customStoragePrefix"),De(this,"events",new cr.EventEmitter),De(this,"logger"),De(this,"heartbeat"),De(this,"relayer"),De(this,"crypto"),De(this,"storage"),De(this,"history"),De(this,"expirer"),De(this,"pairing"),De(this,"verify"),De(this,"echoClient"),De(this,"linkModeSupportedApps"),De(this,"eventClient"),De(this,"initialized",!1),De(this,"logChunkController"),De(this,"on",(a,c)=>this.events.on(a,c)),De(this,"once",(a,c)=>this.events.once(a,c)),De(this,"off",(a,c)=>this.events.off(a,c)),De(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),De(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:l})=>{if(!a||!c)return;const u={topic:a,message:c,publishedAt:Date.now(),transportType:Be.link_mode};this.relayer.onLinkMessageEvent(u,{sessionExists:l})});const n=this.getGlobalCore(e==null?void 0:e.customStoragePrefix);if(n)try{return this.customStoragePrefix=n.customStoragePrefix,this.logger=n.logger,this.heartbeat=n.heartbeat,this.crypto=n.crypto,this.history=n.history,this.expirer=n.expirer,this.storage=n.storage,this.relayer=n.relayer,this.pairing=n.pairing,this.verify=n.verify,this.echoClient=n.echoClient,this.linkModeSupportedApps=n.linkModeSupportedApps,this.eventClient=n.eventClient,this.initialized=n.initialized,this.logChunkController=n.logChunkController,n}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||F2,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const s=Nh({level:typeof(e==null?void 0:e.logger)=="string"&&e.logger?e.logger:qU.logger,name:mp}),{logger:i,chunkLoggerController:o}=X6({opts:s,maxSizeInBytes:e==null?void 0:e.maxLogBlobSizeInBytes,loggerOverride:e==null?void 0:e.logger});this.logChunkController=o,(t=this.logChunkController)!=null&&t.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Rt(i,this.name),this.heartbeat=new r6,this.crypto=new Zk(this,this.logger,e==null?void 0:e.keychain),this.history=new cL(this,this.logger),this.expirer=new hL(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new k6(jw(jw({},VU),e==null?void 0:e.storageOptions)),this.relayer=new S$({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new iL(this,this.logger),this.verify=new pL(this,this.logger,this.storage),this.echoClient=new mL(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new EL(this,this.logger,e==null?void 0:e.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const t=new Z2(e);await t.initialize();const n=await t.crypto.getClientId();return await t.storage.setItem(i5,n),t}get context(){return Wt(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(bw,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(bw)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const t=`_walletConnectCore_${e}`,n=`${t}_count`;return globalThis[n]=(globalThis[n]||0)+1,globalThis[n]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[n]} times.`),globalThis[t]}catch(t){console.warn("Failed to get global WalletConnect core",t);return}}setGlobalCore(e){var t;try{if(this.isGlobalCoreDisabled())return;const n=`_walletConnectCore_${((t=e.opts)==null?void 0:t.customStoragePrefix)||""}`;globalThis[n]=e}catch(n){console.warn("Failed to set global WalletConnect core",n)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&HU.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}};const PL=SL,X2="wc",eA=2,tA="client",Dg=`${X2}@${eA}:${tA}:`,Gf={name:tA,logger:"error"},zw="WALLETCONNECT_DEEPLINK_CHOICE",OL="proposal",Hw="Proposal expired",DL="session",Eo=J.SEVEN_DAYS,CL="engine",ot={wc_sessionPropose:{req:{ttl:J.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:J.ONE_DAY,prompt:!1,tag:1104},res:{ttl:J.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:J.ONE_DAY,prompt:!1,tag:1106},res:{ttl:J.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:J.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:J.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:J.ONE_DAY,prompt:!1,tag:1112},res:{ttl:J.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:J.ONE_DAY,prompt:!1,tag:1114},res:{ttl:J.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:J.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:J.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1119}}},Qf={min:J.FIVE_MINUTES,max:J.SEVEN_DAYS},Jr={idle:"IDLE",active:"ACTIVE"},BL={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},_L="request",TL=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],NL="wc",RL="auth",UL="authKeys",kL="pairingTopics",$L="requests",$h=`${NL}@${1.5}:${RL}:`,vu=`${$h}:PUB_KEY`;var LL=Object.defineProperty,FL=Object.defineProperties,ML=Object.getOwnPropertyDescriptors,qw=Object.getOwnPropertySymbols,jL=Object.prototype.hasOwnProperty,zL=Object.prototype.propertyIsEnumerable,Dp=(r,e,t)=>e in r?LL(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,xe=(r,e)=>{for(var t in e||(e={}))jL.call(e,t)&&Dp(r,t,e[t]);if(qw)for(var t of qw(e))zL.call(e,t)&&Dp(r,t,e[t]);return r},bt=(r,e)=>FL(r,ML(e)),V=(r,e,t)=>Dp(r,typeof e!="symbol"?e+"":e,t);class HL extends bU{constructor(e){super(e),V(this,"name",CL),V(this,"events",new eg),V(this,"initialized",!1),V(this,"requestQueue",{state:Jr.idle,queue:[]}),V(this,"sessionRequestQueue",{state:Jr.idle,queue:[]}),V(this,"emittedSessionRequests",new aT({limit:500})),V(this,"requestQueueDelay",J.ONE_SECOND),V(this,"expectedPairingMethodMap",new Map),V(this,"recentlyDeletedMap",new Map),V(this,"recentlyDeletedLimit",200),V(this,"relayMessageCache",[]),V(this,"pendingSessions",new Map),V(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(ot)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},J.toMiliseconds(this.requestQueueDelay)))}),V(this,"connect",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const n=bt(xe({},t),{requiredNamespaces:t.requiredNamespaces||{},optionalNamespaces:t.optionalNamespaces||{}});await this.isValidConnect(n),n.optionalNamespaces=p4(n.requiredNamespaces,n.optionalNamespaces),n.requiredNamespaces={};const{pairingTopic:s,requiredNamespaces:i,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:l}=n;let u=s,h,f=!1;try{if(u){const A=this.client.core.pairing.pairings.get(u);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),f=A.active}}catch(A){throw this.client.logger.error(`connect() -> pairing.get(${u}) failed`),A}if(!u||!f){const{topic:A,uri:O}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});u=A,h=O}if(!u){const{message:A}=W("NO_MATCHING_KEY",`connect() pairing topic: ${u}`);throw new Error(A)}const d=await this.client.core.crypto.generateKeyPair(),p=ot.wc_sessionPropose.req.ttl||J.FIVE_MINUTES,g=qe(p),m=bt(xe(xe({requiredNamespaces:i,optionalNamespaces:o,relays:l??[{protocol:L2}],proposer:{publicKey:d,metadata:this.client.metadata},expiryTimestamp:g,pairingTopic:u},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:Zr()}),b=ve("session_connect",m.id),{reject:x,resolve:v,done:S}=ai(p,Hw),I=({id:A})=>{A===m.id&&(this.client.events.off("proposal_expire",I),this.pendingSessions.delete(m.id),this.events.emit(b,{error:{message:Hw,code:0}}))};return this.client.events.on("proposal_expire",I),this.events.once(b,({error:A,session:O})=>{this.client.events.off("proposal_expire",I),A?x(A):O&&v(O)}),await this.sendProposeSession({proposal:m,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:m.id}}}),await this.setProposal(m.id,m),{uri:h,approval:S}}),V(this,"pair",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(t)}catch(n){throw this.client.logger.error("pair() failed"),n}}),V(this,"approve",async t=>{var n,s,i;const o=this.client.core.eventClient.createEvent({properties:{topic:(n=t==null?void 0:t.id)==null?void 0:n.toString(),trace:[ms.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(B){throw o.setError(hc.no_internet_connection),B}try{await this.isValidProposalId(t==null?void 0:t.id)}catch(B){throw this.client.logger.error(`approve() -> proposal.get(${t==null?void 0:t.id}) failed`),o.setError(hc.proposal_not_found),B}try{await this.isValidApprove(t)}catch(B){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(hc.session_approve_namespace_validation_failure),B}const{id:a,relayProtocol:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:f}=t,d=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:p,proposer:g,requiredNamespaces:m,optionalNamespaces:b}=d;let x=(s=this.client.core.eventClient)==null?void 0:s.getEvent({topic:p});x||(x=(i=this.client.core.eventClient)==null?void 0:i.createEvent({type:ms.session_approve_started,properties:{topic:p,trace:[ms.session_approve_started,ms.session_namespaces_validation_success]}}));const v=await this.client.core.crypto.generateKeyPair(),S=g.publicKey,I=await this.client.core.crypto.generateSharedKey(v,S),A=xe(xe(xe({relay:{protocol:c??"irn"},namespaces:l,controller:{publicKey:v,metadata:this.client.metadata},expiry:qe(Eo)},u&&{sessionProperties:u}),h&&{scopedProperties:h}),f&&{sessionConfig:f}),O=Be.relay;x.addTrace(ms.subscribing_session_topic);try{await this.client.core.relayer.subscribe(I,{transportType:O,internal:{skipSubscribe:!0}})}catch(B){throw x.setError(hc.subscribe_session_topic_failure),B}x.addTrace(ms.subscribe_session_topic_success);const D=bt(xe({},A),{topic:I,requiredNamespaces:m,optionalNamespaces:b,pairingTopic:p,acknowledged:!1,self:A.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:v,transportType:Be.relay});await this.client.session.set(I,D),x.addTrace(ms.store_session);try{await this.sendApproveSession({sessionTopic:I,proposal:d,pairingProposalResponse:{relay:{protocol:c??"irn"},responderPublicKey:v},sessionSettleRequest:A,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:a}}}),x.addTrace(ms.session_approve_publish_success)}catch(B){throw this.client.logger.error(B),this.client.session.delete(I,_e("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(I),B}return this.client.core.eventClient.deleteEvent({eventId:x.eventId}),await this.client.core.pairing.updateMetadata({topic:p,metadata:g.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:p}),await this.setExpiry(I,qe(Eo)),{topic:I,acknowledged:()=>Promise.resolve(this.client.session.get(I))}}),V(this,"reject",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(t)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:n,reason:s}=t;let i;try{i=this.client.proposal.get(n).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${n}) failed`),o}i&&await this.sendError({id:n,topic:i,error:s,rpcOpts:ot.wc_sessionPropose.reject}),await this.deleteProposal(n)}),V(this,"update",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(t)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:n,namespaces:s}=t,{done:i,resolve:o,reject:a}=ai(),c=Zr(),l=zs().toString(),u=this.client.session.get(n).namespaces;return this.events.once(ve("session_update",c),({error:h})=>{h?a(h):o()}),await this.client.session.update(n,{namespaces:s}),await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:s},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:l}).catch(h=>{this.client.logger.error(h),this.client.session.update(n,{namespaces:u}),a(h)}),{acknowledged:i}}),V(this,"extend",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(t)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:n}=t,s=Zr(),{done:i,resolve:o,reject:a}=ai();return this.events.once(ve("session_extend",s),({error:c})=>{c?a(c):o()}),await this.setExpiry(n,qe(Eo)),this.sendRequest({topic:n,method:"wc_sessionExtend",params:{},clientRpcId:s,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:i}}),V(this,"request",async t=>{this.isInitialized();try{await this.isValidRequest(t)}catch(m){throw this.client.logger.error("request() -> isValidRequest() failed"),m}const{chainId:n,request:s,topic:i,expiry:o=ot.wc_sessionRequest.req.ttl}=t,a=this.client.session.get(i);(a==null?void 0:a.transportType)===Be.relay&&await this.confirmOnlineStateOrThrow();const c=Zr(),l=zs().toString(),{done:u,resolve:h,reject:f}=ai(o,"Request expired. Please try again.");this.events.once(ve("session_request",c),({error:m,result:b})=>{m?f(m):h(b)});const d="wc_sessionRequest",p=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(p)return await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:i,method:d,params:{request:bt(xe({},s),{expiryTimestamp:qe(o)}),chainId:n},expiry:o,throwOnFailedPublish:!0,appLink:p}).catch(m=>f(m)),this.client.events.emit("session_request_sent",{topic:i,request:s,chainId:n,id:c}),await u();const g={request:bt(xe({},s),{expiryTimestamp:qe(o)}),chainId:n};return await Promise.all([new Promise(async m=>{await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:i,method:d,params:g,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,g)}).catch(b=>f(b)),this.client.events.emit("session_request_sent",{topic:i,request:s,chainId:n,id:c}),m()}),new Promise(async m=>{var b;if(!((b=a.sessionConfig)!=null&&b.disableDeepLink)){const x=await rT(this.client.core.storage,zw);await X_({id:c,topic:i,wcDeepLink:x})}m()}),u()]).then(m=>m[2])}),V(this,"respond",async t=>{this.isInitialized(),await this.isValidRespond(t);const{topic:n,response:s}=t,{id:i}=s,o=this.client.session.get(n);o.transportType===Be.relay&&await this.confirmOnlineStateOrThrow();const a=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);Xr(s)?await this.sendResult({id:i,topic:n,result:s.result,throwOnFailedPublish:!0,appLink:a}):Ar(s)&&await this.sendError({id:i,topic:n,error:s.error,appLink:a}),this.cleanupAfterResponse(t)}),V(this,"ping",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(t)}catch(s){throw this.client.logger.error("ping() -> isValidPing() failed"),s}const{topic:n}=t;if(this.client.session.keys.includes(n)){const s=Zr(),i=zs().toString(),{done:o,resolve:a,reject:c}=ai();this.events.once(ve("session_ping",s),({error:l})=>{l?c(l):a()}),await Promise.all([this.sendRequest({topic:n,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:s,relayRpcId:i}),o()])}else this.client.core.pairing.pairings.keys.includes(n)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:n}))}),V(this,"emit",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(t);const{topic:n,event:s,chainId:i}=t,o=zs().toString(),a=Zr();await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:s,chainId:i},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),V(this,"disconnect",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(t);const{topic:n}=t;if(this.client.session.keys.includes(n))await this.sendRequest({topic:n,method:"wc_sessionDelete",params:_e("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:n,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(n))await this.client.core.pairing.disconnect({topic:n});else{const{message:s}=W("MISMATCHED_TOPIC",`Session or pairing topic not found: ${n}`);throw new Error(s)}}),V(this,"find",t=>(this.isInitialized(),this.client.session.getAll().filter(n=>m4(n,t)))),V(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),V(this,"authenticate",async(t,n)=>{var s;this.isInitialized(),this.isValidAuthenticate(t);const i=n&&this.client.core.linkModeSupportedApps.includes(n)&&((s=this.client.metadata.redirect)==null?void 0:s.linkMode),o=i?Be.link_mode:Be.relay;o===Be.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:l,domain:u,nonce:h,type:f,exp:d,nbf:p,methods:g=[],expiry:m}=t,b=[...t.resources||[]],{topic:x,uri:v}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:x,uri:v}});const S=await this.client.core.crypto.generateKeyPair(),I=yu(S);if(await Promise.all([this.client.auth.authKeys.set(vu,{responseTopic:I,publicKey:S}),this.client.auth.pairingTopics.set(I,{topic:I,pairingTopic:x})]),await this.client.core.relayer.subscribe(I,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${x}`),g.length>0){const{namespace:_}=Yn(a[0]);let N=wN(_,"request",g);gu(b)&&(N=vN(N,b.pop())),b.push(N)}const A=m&&m>ot.wc_sessionAuthenticate.req.ttl?m:ot.wc_sessionAuthenticate.req.ttl,O={authPayload:{type:f??"caip122",chains:a,statement:c,aud:l,domain:u,version:"1",nonce:h,iat:new Date().toISOString(),exp:d,nbf:p,resources:b},requester:{publicKey:S,metadata:this.client.metadata},expiryTimestamp:qe(A)},D={eip155:{chains:a,methods:[...new Set(["personal_sign",...g])],events:["chainChanged","accountsChanged"]}},B={requiredNamespaces:{},optionalNamespaces:D,relays:[{protocol:"irn"}],pairingTopic:x,proposer:{publicKey:S,metadata:this.client.metadata},expiryTimestamp:qe(ot.wc_sessionPropose.req.ttl),id:Zr()},{done:L,resolve:j,reject:$}=ai(A,"Request expired"),U=Zr(),T=ve("session_connect",B.id),w=ve("session_request",U),E=async({error:_,session:N})=>{this.events.off(w,C),_?$(_):N&&j({session:N})},C=async _=>{var N,z,H;if(await this.deletePendingAuthRequest(U,{message:"fulfilled",code:0}),_.error){const ne=_e("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return _.error.code===ne.code?void 0:(this.events.off(T,E),$(_.error.message))}await this.deleteProposal(B.id),this.events.off(T,E);const{cacaos:Y,responder:G}=_.result,Q=[],ee=[];for(const ne of Y){await wm({cacao:ne,projectId:this.client.core.projectId})||(this.client.logger.error(ne,"Signature verification failed"),$(_e("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:fe}=ne,Re=gu(fe.resources),ze=[sp(fe.iss)],Ue=Hu(fe.iss);if(Re){const pt=bm(Re),lo=vm(Re);Q.push(...pt),ze.push(...lo)}for(const pt of ze)ee.push(`${pt}:${Ue}`)}const se=await this.client.core.crypto.generateSharedKey(S,G.publicKey);let le;Q.length>0&&(le={topic:se,acknowledged:!0,self:{publicKey:S,metadata:this.client.metadata},peer:G,controller:G.publicKey,expiry:qe(Eo),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:x,namespaces:Km([...new Set(Q)],[...new Set(ee)]),transportType:o},await this.client.core.relayer.subscribe(se,{transportType:o}),await this.client.session.set(se,le),x&&await this.client.core.pairing.updateMetadata({topic:x,metadata:G.metadata}),le=this.client.session.get(se)),(N=this.client.metadata.redirect)!=null&&N.linkMode&&(z=G.metadata.redirect)!=null&&z.linkMode&&(H=G.metadata.redirect)!=null&&H.universal&&n&&(this.client.core.addLinkModeSupportedApp(G.metadata.redirect.universal),this.client.session.update(se,{transportType:Be.link_mode})),j({auths:Y,session:le})};this.events.once(T,E),this.events.once(w,C);let k;try{if(i){const _=Mr("wc_sessionAuthenticate",O,U);this.client.core.history.set(x,_);const N=await this.client.core.crypto.encode("",_,{type:xl,encoding:Is});k=Wl(n,x,N)}else await Promise.all([this.sendRequest({topic:x,method:"wc_sessionAuthenticate",params:O,expiry:t.expiry,throwOnFailedPublish:!0,clientRpcId:U}),this.sendRequest({topic:x,method:"wc_sessionPropose",params:B,expiry:ot.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:B.id})])}catch(_){throw this.events.off(T,E),this.events.off(w,C),_}return await this.setProposal(B.id,B),await this.setAuthRequest(U,{request:bt(xe({},O),{verifyContext:{}}),pairingTopic:x,transportType:o}),{uri:k??v,response:L}}),V(this,"approveSessionAuthenticate",async t=>{const{id:n,auths:s}=t,i=this.client.core.eventClient.createEvent({properties:{topic:n.toString(),trace:[ni.authenticated_session_approve_started]}});try{this.isInitialized()}catch(m){throw i.setError(fc.no_internet_connection),m}const o=this.getPendingAuthRequest(n);if(!o)throw i.setError(fc.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${n}`);const a=o.transportType||Be.relay;a===Be.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),u=yu(c),h={type:Zn,receiverPublicKey:c,senderPublicKey:l},f=[],d=[];for(const m of s){if(!await wm({cacao:m,projectId:this.client.core.projectId})){i.setError(fc.invalid_cacao);const I=_e("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:n,topic:u,error:I,encodeOpts:h}),new Error(I.message)}i.addTrace(ni.cacaos_verified);const{p:b}=m,x=gu(b.resources),v=[sp(b.iss)],S=Hu(b.iss);if(x){const I=bm(x),A=vm(x);f.push(...I),v.push(...A)}for(const I of v)d.push(`${I}:${S}`)}const p=await this.client.core.crypto.generateSharedKey(l,c);i.addTrace(ni.create_authenticated_session_topic);let g;if((f==null?void 0:f.length)>0){g={topic:p,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:qe(Eo),authentication:s,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:Km([...new Set(f)],[...new Set(d)]),transportType:a},i.addTrace(ni.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(p,{transportType:a})}catch(m){throw i.setError(fc.subscribe_authenticated_session_topic_failure),m}i.addTrace(ni.subscribe_authenticated_session_topic_success),await this.client.session.set(p,g),i.addTrace(ni.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}i.addTrace(ni.publishing_authenticated_session_approve);try{await this.sendResult({topic:u,id:n,result:{cacaos:s,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(m){throw i.setError(fc.authenticated_session_approve_publish_failure),m}return await this.client.auth.requests.delete(n,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:i.eventId}),{session:g}}),V(this,"rejectSessionAuthenticate",async t=>{this.isInitialized();const{id:n,reason:s}=t,i=this.getPendingAuthRequest(n);if(!i)throw new Error(`Could not find pending auth request with id ${n}`);i.transportType===Be.relay&&await this.confirmOnlineStateOrThrow();const o=i.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=yu(o),l={type:Zn,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:n,topic:c,error:s,encodeOpts:l,rpcOpts:ot.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(i.requester.metadata,i.transportType)}),await this.client.auth.requests.delete(n,{message:"rejected",code:0}),await this.deleteProposal(n)}),V(this,"formatAuthMessage",t=>{this.isInitialized();const{request:n,iss:s}=t;return qE(n,s)}),V(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const t=this.relayMessageCache.shift();t&&await this.onRelayMessage(t)}catch(t){this.client.logger.error(t)}},50)}),V(this,"cleanupDuplicatePairings",async t=>{if(t.pairingTopic)try{const n=this.client.core.pairing.pairings.get(t.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(i=>{var o,a;return((o=i.peerMetadata)==null?void 0:o.url)&&((a=i.peerMetadata)==null?void 0:a.url)===t.peer.metadata.url&&i.topic&&i.topic!==n.topic});if(s.length===0)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(i=>this.client.core.pairing.disconnect({topic:i.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}}),V(this,"deleteSession",async t=>{var n;const{topic:s,expirerHasDeleted:i=!1,emitEvent:o=!0,id:a=0}=t,{self:c}=this.client.session.get(s);await this.client.core.relayer.unsubscribe(s),await this.client.session.delete(s,_e("USER_DISCONNECTED")),this.addToRecentlyDeleted(s,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(s)&&await this.client.core.crypto.deleteSymKey(s),i||this.client.core.expirer.del(s),this.client.core.storage.removeItem(zw).catch(l=>this.client.logger.warn(l)),this.getPendingSessionRequests().forEach(l=>{l.topic===s&&this.deletePendingSessionRequest(l.id,_e("USER_DISCONNECTED"))}),s===((n=this.sessionRequestQueue.queue[0])==null?void 0:n.topic)&&(this.sessionRequestQueue.state=Jr.idle),o&&this.client.events.emit("session_delete",{id:a,topic:s})}),V(this,"deleteProposal",async(t,n)=>{if(n)try{const s=this.client.proposal.get(t),i=this.client.core.eventClient.getEvent({topic:s.pairingTopic});i==null||i.setError(hc.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(t,_e("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(t)]),this.addToRecentlyDeleted(t,"proposal")}),V(this,"deletePendingSessionRequest",async(t,n,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,n),s?Promise.resolve():this.client.core.expirer.del(t)]),this.addToRecentlyDeleted(t,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(i=>i.id!==t),s&&(this.sessionRequestQueue.state=Jr.idle,this.client.events.emit("session_request_expire",{id:t}))}),V(this,"deletePendingAuthRequest",async(t,n,s=!1)=>{await Promise.all([this.client.auth.requests.delete(t,n),s?Promise.resolve():this.client.core.expirer.del(t)])}),V(this,"setExpiry",async(t,n)=>{this.client.session.keys.includes(t)&&(this.client.core.expirer.set(t,n),await this.client.session.update(t,{expiry:n}))}),V(this,"setProposal",async(t,n)=>{this.client.core.expirer.set(t,qe(ot.wc_sessionPropose.req.ttl)),await this.client.proposal.set(t,n)}),V(this,"setAuthRequest",async(t,n)=>{const{request:s,pairingTopic:i,transportType:o=Be.relay}=n;this.client.core.expirer.set(t,s.expiryTimestamp),await this.client.auth.requests.set(t,{authPayload:s.authPayload,requester:s.requester,expiryTimestamp:s.expiryTimestamp,id:t,pairingTopic:i,verifyContext:s.verifyContext,transportType:o})}),V(this,"setPendingSessionRequest",async t=>{const{id:n,topic:s,params:i,verifyContext:o}=t,a=i.request.expiryTimestamp||qe(ot.wc_sessionRequest.req.ttl);this.client.core.expirer.set(n,a),await this.client.pendingRequest.set(n,{id:n,topic:s,params:i,verifyContext:o})}),V(this,"sendRequest",async t=>{const{topic:n,method:s,params:i,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:l,appLink:u,tvf:h,publishOpts:f={}}=t,d=Mr(s,i,c);let p;const g=!!u;try{const x=g?Is:Ht;p=await this.client.core.crypto.encode(n,d,{encoding:x})}catch(x){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${n} failed`),x}let m;if(TL.includes(s)){const x=Er(JSON.stringify(d)),v=Er(p);m=await this.client.core.verify.register({id:v,decryptedId:x})}const b=xe(xe({},ot[s].req),f);if(b.attestation=m,o&&(b.ttl=o),a&&(b.id=a),this.client.core.history.set(n,d),g){const x=Wl(u,n,p);await global.Linking.openURL(x,this.client.name)}else b.tvf=bt(xe({},h),{correlationId:d.id}),l?(b.internal=bt(xe({},b.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,p,b)):this.client.core.relayer.publish(n,p,b).catch(x=>this.client.logger.error(x));return d.id}),V(this,"sendProposeSession",async t=>{const{proposal:n,publishOpts:s}=t,i=Mr("wc_sessionPropose",n,n.id);this.client.core.history.set(n.pairingTopic,i);const o=await this.client.core.crypto.encode(n.pairingTopic,i,{encoding:Ht}),a=Er(JSON.stringify(i)),c=Er(o),l=await this.client.core.verify.register({id:c,decryptedId:a});await this.client.core.relayer.publishCustom({payload:{pairingTopic:n.pairingTopic,sessionProposal:o},opts:bt(xe({},s),{publishMethod:"wc_proposeSession",attestation:l})})}),V(this,"sendApproveSession",async t=>{const{sessionTopic:n,pairingProposalResponse:s,proposal:i,sessionSettleRequest:o,publishOpts:a}=t,c=Jc(i.id,s),l=await this.client.core.crypto.encode(i.pairingTopic,c,{encoding:Ht}),u=Mr("wc_sessionSettle",o,a==null?void 0:a.id),h=await this.client.core.crypto.encode(n,u,{encoding:Ht});this.client.core.history.set(n,u),await this.client.core.relayer.publishCustom({payload:{sessionTopic:n,pairingTopic:i.pairingTopic,sessionProposalResponse:l,sessionSettlementRequest:h},opts:bt(xe({},a),{publishMethod:"wc_approveSession"})})}),V(this,"sendResult",async t=>{const{id:n,topic:s,result:i,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=t,l=Jc(n,i);let u;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const p=h?Is:Ht;u=await this.client.core.crypto.encode(s,l,bt(xe({},a||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${s} failed`),p}let f,d;try{f=await this.client.core.history.get(s,n);const p=f.request;try{d=this.getTVFParams(n,p.params,i)}catch(g){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${g==null?void 0:g.message}`)}}catch(p){throw this.client.logger.error(`sendResult() -> history.get(${s}, ${n}) failed`),p}if(h){const p=Wl(c,s,u);await global.Linking.openURL(p,this.client.name)}else{const p=f.request.method,g=ot[p].res;g.tvf=bt(xe({},d),{correlationId:n}),o?(g.internal=bt(xe({},g.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,u,g)):this.client.core.relayer.publish(s,u,g).catch(m=>this.client.logger.error(m))}await this.client.core.history.resolve(l)}),V(this,"sendError",async t=>{const{id:n,topic:s,error:i,encodeOpts:o,rpcOpts:a,appLink:c}=t,l=Rh(n,i);let u;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const d=h?Is:Ht;u=await this.client.core.crypto.encode(s,l,bt(xe({},o||{}),{encoding:d}))}catch(d){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${s} failed`),d}let f;try{f=await this.client.core.history.get(s,n)}catch(d){throw this.client.logger.error(`sendError() -> history.get(${s}, ${n}) failed`),d}if(h){const d=Wl(c,s,u);await global.Linking.openURL(d,this.client.name)}else{const d=f.request.method,p=a||ot[d].res;this.client.core.relayer.publish(s,u,p)}await this.client.core.history.resolve(l)}),V(this,"cleanup",async()=>{const t=[],n=[];this.client.session.getAll().forEach(s=>{let i=!1;fn(s.expiry)&&(i=!0),this.client.core.crypto.keychain.has(s.topic)||(i=!0),i&&t.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{fn(s.expiryTimestamp)&&n.push(s.id)}),await Promise.all([...t.map(s=>this.deleteSession({topic:s})),...n.map(s=>this.deleteProposal(s))])}),V(this,"onProviderMessageEvent",async t=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(t):await this.onRelayMessage(t)}),V(this,"onRelayEventRequest",async t=>{this.requestQueue.queue.push(t),await this.processRequestsQueue()}),V(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===Jr.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Jr.active;const t=this.requestQueue.queue.shift();if(t)try{await this.processRequest(t)}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=Jr.idle}),V(this,"processRequest",async t=>{const{topic:n,payload:s,attestation:i,transportType:o,encryptedId:a}=t,c=s.method;if(!this.shouldIgnorePairingRequest({topic:n,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:n,payload:s,attestation:i,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(n,s);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(n,s);case"wc_sessionExtend":return await this.onSessionExtendRequest(n,s);case"wc_sessionPing":return await this.onSessionPingRequest(n,s);case"wc_sessionDelete":return await this.onSessionDeleteRequest(n,s);case"wc_sessionRequest":return await this.onSessionRequest({topic:n,payload:s,attestation:i,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(n,s);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:n,payload:s,attestation:i,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),V(this,"onRelayEventResponse",async t=>{const{topic:n,payload:s,transportType:i}=t,o=(await this.client.core.history.get(n,s.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(n,s,i);case"wc_sessionSettle":return this.onSessionSettleResponse(n,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,s);case"wc_sessionExtend":return this.onSessionExtendResponse(n,s);case"wc_sessionPing":return this.onSessionPingResponse(n,s);case"wc_sessionRequest":return this.onSessionRequestResponse(n,s);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(n,s);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),V(this,"onRelayEventUnknownPayload",t=>{const{topic:n}=t,{message:s}=W("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)}),V(this,"shouldIgnorePairingRequest",t=>{const{topic:n,requestMethod:s}=t,i=this.expectedPairingMethodMap.get(n);return!i||i.includes(s)?!1:!!(i.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),V(this,"onSessionProposeRequest",async t=>{const{topic:n,payload:s,attestation:i,encryptedId:o}=t,{params:a,id:c}=s;try{const l=this.client.core.eventClient.getEvent({topic:n});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),l==null||l.setError(Bn.proposal_listener_not_found)),this.isValidConnect(xe({},s.params));const u=a.expiryTimestamp||qe(ot.wc_sessionPropose.req.ttl),h=xe({id:c,pairingTopic:n,expiryTimestamp:u,attestation:i,encryptedId:o},a);await this.setProposal(c,h);const f=await this.getVerifyContext({attestationId:i,hash:Er(JSON.stringify(s)),encryptedId:o,metadata:h.proposer.metadata});l==null||l.addTrace(Yr.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:h,verifyContext:f})}catch(l){await this.sendError({id:c,topic:n,error:l,rpcOpts:ot.wc_sessionPropose.autoReject}),this.client.logger.error(l)}}),V(this,"onSessionProposeResponse",async(t,n,s)=>{const{id:i}=n;if(Xr(n)){const{result:o}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(i);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const l=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});const u=await this.client.core.crypto.generateSharedKey(c,l);this.pendingSessions.set(i,{sessionTopic:u,pairingTopic:t,proposalId:i,publicKey:c});const h=await this.client.core.relayer.subscribe(u,{transportType:s});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:t})}else if(Ar(n)){await this.deleteProposal(i);const o=ve("session_connect",i);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:n.error})}}),V(this,"onSessionSettleRequest",async(t,n)=>{const{id:s,params:i}=n;try{this.isValidSessionSettleRequest(i);const{relay:o,controller:a,expiry:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:f}=n.params,d=[...this.pendingSessions.values()].find(m=>m.sessionTopic===t);if(!d)return this.client.logger.error(`Pending session not found for topic ${t}`);const p=this.client.proposal.get(d.proposalId),g=bt(xe(xe(xe({topic:t,relay:o,expiry:c,namespaces:l,acknowledged:!0,pairingTopic:d.pairingTopic,requiredNamespaces:p.requiredNamespaces,optionalNamespaces:p.optionalNamespaces,controller:a.publicKey,self:{publicKey:d.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},u&&{sessionProperties:u}),h&&{scopedProperties:h}),f&&{sessionConfig:f}),{transportType:Be.relay});await this.client.session.set(g.topic,g),await this.setExpiry(g.topic,g.expiry),await this.client.core.pairing.updateMetadata({topic:d.pairingTopic,metadata:g.peer.metadata}),this.client.events.emit("session_connect",{session:g}),this.events.emit(ve("session_connect",d.proposalId),{session:g}),this.pendingSessions.delete(d.proposalId),this.deleteProposal(d.proposalId,!1),this.cleanupDuplicatePairings(g),await this.sendResult({id:n.id,topic:t,result:!0})}catch(o){await this.sendError({id:s,topic:t,error:o}),this.client.logger.error(o)}}),V(this,"onSessionSettleResponse",async(t,n)=>{const{id:s}=n;Xr(n)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit(ve("session_approve",s),{})):Ar(n)&&(await this.client.session.delete(t,_e("USER_DISCONNECTED")),this.events.emit(ve("session_approve",s),{error:n.error}))}),V(this,"onSessionUpdateRequest",async(t,n)=>{const{params:s,id:i}=n;try{const o=`${t}_session_update`,a=lc.get(o);if(a&&this.isRequestOutOfSync(a,i)){this.client.logger.warn(`Discarding out of sync request - ${i}`),this.sendError({id:i,topic:t,error:_e("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(xe({topic:t},s));try{lc.set(o,i),await this.client.session.update(t,{namespaces:s.namespaces}),await this.sendResult({id:i,topic:t,result:!0})}catch(c){throw lc.delete(o),c}this.client.events.emit("session_update",{id:i,topic:t,params:s})}catch(o){await this.sendError({id:i,topic:t,error:o}),this.client.logger.error(o)}}),V(this,"isRequestOutOfSync",(t,n)=>n.toString().slice(0,-3)<t.toString().slice(0,-3)),V(this,"onSessionUpdateResponse",(t,n)=>{const{id:s}=n,i=ve("session_update",s);if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners`);Xr(n)?this.events.emit(ve("session_update",s),{}):Ar(n)&&this.events.emit(ve("session_update",s),{error:n.error})}),V(this,"onSessionExtendRequest",async(t,n)=>{const{id:s}=n;try{this.isValidExtend({topic:t}),await this.setExpiry(t,qe(Eo)),await this.sendResult({id:s,topic:t,result:!0}),this.client.events.emit("session_extend",{id:s,topic:t})}catch(i){await this.sendError({id:s,topic:t,error:i}),this.client.logger.error(i)}}),V(this,"onSessionExtendResponse",(t,n)=>{const{id:s}=n,i=ve("session_extend",s);if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners`);Xr(n)?this.events.emit(ve("session_extend",s),{}):Ar(n)&&this.events.emit(ve("session_extend",s),{error:n.error})}),V(this,"onSessionPingRequest",async(t,n)=>{const{id:s}=n;try{this.isValidPing({topic:t}),await this.sendResult({id:s,topic:t,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:s,topic:t})}catch(i){await this.sendError({id:s,topic:t,error:i}),this.client.logger.error(i)}}),V(this,"onSessionPingResponse",(t,n)=>{const{id:s}=n,i=ve("session_ping",s);setTimeout(()=>{if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners 2176`);Xr(n)?this.events.emit(ve("session_ping",s),{}):Ar(n)&&this.events.emit(ve("session_ping",s),{error:n.error})},500)}),V(this,"onSessionDeleteRequest",async(t,n)=>{const{id:s}=n;try{this.isValidDisconnect({topic:t,reason:n.params}),await Promise.all([new Promise(i=>{this.client.core.relayer.once(Le.publish,async()=>{i(await this.deleteSession({topic:t,id:s}))})}),this.sendResult({id:s,topic:t,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:t,error:_e("USER_DISCONNECTED")})]).catch(i=>this.client.logger.error(i))}catch(i){this.client.logger.error(i)}}),V(this,"onSessionRequest",async t=>{var n,s,i;const{topic:o,payload:a,attestation:c,encryptedId:l,transportType:u}=t,{id:h,params:f}=a;try{await this.isValidRequest(xe({topic:o},f));const d=this.client.session.get(o),p=await this.getVerifyContext({attestationId:c,hash:Er(JSON.stringify(Mr("wc_sessionRequest",f,h))),encryptedId:l,metadata:d.peer.metadata,transportType:u}),g={id:h,topic:o,params:f,verifyContext:p};await this.setPendingSessionRequest(g),u===Be.link_mode&&(n=d.peer.metadata.redirect)!=null&&n.universal&&this.client.core.addLinkModeSupportedApp((s=d.peer.metadata.redirect)==null?void 0:s.universal),(i=this.client.signConfig)!=null&&i.disableRequestQueue?this.emitSessionRequest(g):(this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue())}catch(d){await this.sendError({id:h,topic:o,error:d}),this.client.logger.error(d)}}),V(this,"onSessionRequestResponse",(t,n)=>{const{id:s}=n,i=ve("session_request",s);if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners`);Xr(n)?this.events.emit(ve("session_request",s),{result:n.result}):Ar(n)&&this.events.emit(ve("session_request",s),{error:n.error})}),V(this,"onSessionEventRequest",async(t,n)=>{const{id:s,params:i}=n;try{const o=`${t}_session_event_${i.event.name}`,a=lc.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.info(`Discarding out of sync request - ${s}`);return}this.isValidEmit(xe({topic:t},i)),this.client.events.emit("session_event",{id:s,topic:t,params:i}),lc.set(o,s)}catch(o){await this.sendError({id:s,topic:t,error:o}),this.client.logger.error(o)}}),V(this,"onSessionAuthenticateResponse",(t,n)=>{const{id:s}=n;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:t,payload:n}),Xr(n)?this.events.emit(ve("session_request",s),{result:n.result}):Ar(n)&&this.events.emit(ve("session_request",s),{error:n.error})}),V(this,"onSessionAuthenticateRequest",async t=>{var n;const{topic:s,payload:i,attestation:o,encryptedId:a,transportType:c}=t;try{const{requester:l,authPayload:u,expiryTimestamp:h}=i.params,f=await this.getVerifyContext({attestationId:o,hash:Er(JSON.stringify(i)),encryptedId:a,metadata:l.metadata,transportType:c}),d={requester:l,pairingTopic:s,id:i.id,authPayload:u,verifyContext:f,expiryTimestamp:h};await this.setAuthRequest(i.id,{request:d,pairingTopic:s,transportType:c}),c===Be.link_mode&&(n=l.metadata.redirect)!=null&&n.universal&&this.client.core.addLinkModeSupportedApp(l.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:s,params:i.params,id:i.id,verifyContext:f})}catch(l){this.client.logger.error(l);const u=i.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),f=this.getAppLinkIfEnabled(i.params.requester.metadata,c),d={type:Zn,receiverPublicKey:u,senderPublicKey:h};await this.sendError({id:i.id,topic:s,error:l,encodeOpts:d,rpcOpts:ot.wc_sessionAuthenticate.autoReject,appLink:f})}}),V(this,"addSessionRequestToSessionRequestQueue",t=>{this.sessionRequestQueue.queue.push(t)}),V(this,"cleanupAfterResponse",t=>{this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Jr.idle,this.processSessionRequestQueue()},J.toMiliseconds(this.requestQueueDelay))}),V(this,"cleanupPendingSentRequestsForTopic",({topic:t,error:n})=>{const s=this.client.core.history.pending;s.length>0&&s.filter(i=>i.topic===t&&i.request.method==="wc_sessionRequest").forEach(i=>{const o=i.request.id,a=ve("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(ve("session_request",i.request.id),{error:n})})}),V(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===Jr.active){this.client.logger.info("session request queue is already active.");return}const t=this.sessionRequestQueue.queue[0];if(!t){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(t)}catch(n){this.client.logger.error(n)}}),V(this,"emitSessionRequest",t=>{if(this.emittedSessionRequests.has(t.id)){this.client.logger.warn({id:t.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${t.id}`);return}this.sessionRequestQueue.state=Jr.active,this.emittedSessionRequests.add(t.id),this.client.events.emit("session_request",t)}),V(this,"onPairingCreated",t=>{if(t.methods&&this.expectedPairingMethodMap.set(t.topic,t.methods),t.active)return;const n=this.client.proposal.getAll().find(s=>s.pairingTopic===t.topic);n&&this.onSessionProposeRequest({topic:t.topic,payload:Mr("wc_sessionPropose",bt(xe({},n),{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer,sessionProperties:n.sessionProperties,scopedProperties:n.scopedProperties}),n.id),attestation:n.attestation,encryptedId:n.encryptedId})}),V(this,"isValidConnect",async t=>{if(!Lt(t)){const{message:l}=W("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(l)}const{pairingTopic:n,requiredNamespaces:s,optionalNamespaces:i,sessionProperties:o,scopedProperties:a,relays:c}=t;if(We(n)||await this.isValidPairingTopic(n),!C4(c)){const{message:l}=W("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(l)}if(!We(s)&&wn(s)!==0){const l="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(l):this.client.logger.warn(l),this.validateNamespaces(s,"requiredNamespaces")}if(!We(i)&&wn(i)!==0&&this.validateNamespaces(i,"optionalNamespaces"),We(o)||this.validateSessionProps(o,"sessionProperties"),!We(a)){this.validateSessionProps(a,"scopedProperties");const l=Object.keys(s||{}).concat(Object.keys(i||{}));if(!Object.keys(a).every(u=>l.includes(u.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(l)}`)}}),V(this,"validateNamespaces",(t,n)=>{const s=D4(t,"connect()",n);if(s)throw new Error(s.message)}),V(this,"isValidApprove",async t=>{if(!Lt(t))throw new Error(W("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:n,namespaces:s,relayProtocol:i,sessionProperties:o,scopedProperties:a}=t;this.checkRecentlyDeleted(n),await this.isValidProposalId(n);const c=this.client.proposal.get(n),l=$f(s,"approve()");if(l)throw new Error(l.message);const u=Wm(c.requiredNamespaces,s,"approve()");if(u)throw new Error(u.message);if(!Ve(i,!0)){const{message:h}=W("MISSING_OR_INVALID",`approve() relayProtocol: ${i}`);throw new Error(h)}if(We(o)||this.validateSessionProps(o,"sessionProperties"),!We(a)){this.validateSessionProps(a,"scopedProperties");const h=new Set(Object.keys(s));if(!Object.keys(a).every(f=>h.has(f.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),V(this,"isValidReject",async t=>{if(!Lt(t)){const{message:i}=W("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(i)}const{id:n,reason:s}=t;if(this.checkRecentlyDeleted(n),await this.isValidProposalId(n),!_4(s)){const{message:i}=W("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(i)}}),V(this,"isValidSessionSettleRequest",t=>{if(!Lt(t)){const{message:l}=W("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(l)}const{relay:n,controller:s,namespaces:i,expiry:o}=t;if(!O2(n)){const{message:l}=W("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const a=A4(s,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=$f(i,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(fn(o)){const{message:l}=W("EXPIRED","onSessionSettleRequest()");throw new Error(l)}}),V(this,"isValidUpdate",async t=>{if(!Lt(t)){const{message:c}=W("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(c)}const{topic:n,namespaces:s}=t;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n);const i=this.client.session.get(n),o=$f(s,"update()");if(o)throw new Error(o.message);const a=Wm(i.requiredNamespaces,s,"update()");if(a)throw new Error(a.message)}),V(this,"isValidExtend",async t=>{if(!Lt(t)){const{message:s}=W("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(s)}const{topic:n}=t;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n)}),V(this,"isValidRequest",async t=>{if(!Lt(t)){const{message:c}=W("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(c)}const{topic:n,request:s,chainId:i,expiry:o}=t;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n);const{namespaces:a}=this.client.session.get(n);if(!Qm(a,i)){const{message:c}=W("MISSING_OR_INVALID",`request() chainId: ${i}`);throw new Error(c)}if(!T4(s)){const{message:c}=W("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(c)}if(!U4(a,i,s.method)){const{message:c}=W("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(c)}if(o&&!F4(o,Qf)){const{message:c}=W("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${Qf.min} and ${Qf.max}`);throw new Error(c)}}),V(this,"isValidRespond",async t=>{var n;if(!Lt(t)){const{message:o}=W("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(o)}const{topic:s,response:i}=t;try{await this.isValidSessionTopic(s)}catch(o){throw(n=t==null?void 0:t.response)!=null&&n.id&&this.cleanupAfterResponse(t),o}if(!N4(i)){const{message:o}=W("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(i)}`);throw new Error(o)}}),V(this,"isValidPing",async t=>{if(!Lt(t)){const{message:s}=W("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(s)}const{topic:n}=t;await this.isValidSessionOrPairingTopic(n)}),V(this,"isValidEmit",async t=>{if(!Lt(t)){const{message:a}=W("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(a)}const{topic:n,event:s,chainId:i}=t;await this.isValidSessionTopic(n);const{namespaces:o}=this.client.session.get(n);if(!Qm(o,i)){const{message:a}=W("MISSING_OR_INVALID",`emit() chainId: ${i}`);throw new Error(a)}if(!R4(s)){const{message:a}=W("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}if(!k4(o,i,s.name)){const{message:a}=W("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}}),V(this,"isValidDisconnect",async t=>{if(!Lt(t)){const{message:s}=W("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(s)}const{topic:n}=t;await this.isValidSessionOrPairingTopic(n)}),V(this,"isValidAuthenticate",t=>{const{chains:n,uri:s,domain:i,nonce:o}=t;if(!Array.isArray(n)||n.length===0)throw new Error("chains is required and must be a non-empty array");if(!Ve(s,!1))throw new Error("uri is required parameter");if(!Ve(i,!1))throw new Error("domain is required parameter");if(!Ve(o,!1))throw new Error("nonce is required parameter");if([...new Set(n.map(c=>Yn(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=Yn(n[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),V(this,"getVerifyContext",async t=>{const{attestationId:n,hash:s,encryptedId:i,metadata:o,transportType:a}=t,c={verified:{verifyUrl:o.verifyUrl||_c,validation:"UNKNOWN",origin:o.url||""}};try{if(a===Be.link_mode){const u=this.getAppLinkIfEnabled(o,a);return c.verified.validation=u&&new URL(u).origin===new URL(o.url).origin?"VALID":"INVALID",c}const l=await this.client.core.verify.resolve({attestationId:n,hash:s,encryptedId:i,verifyUrl:o.verifyUrl});l&&(c.verified.origin=l.origin,c.verified.isScam=l.isScam,c.verified.validation=l.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.warn(l)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),V(this,"validateSessionProps",(t,n)=>{Object.values(t).forEach((s,i)=>{if(s==null){const{message:o}=W("MISSING_OR_INVALID",`${n} must contain an existing value for each key. Received: ${s} for key ${Object.keys(t)[i]}`);throw new Error(o)}})}),V(this,"getPendingAuthRequest",t=>{const n=this.client.auth.requests.get(t);return typeof n=="object"?n:void 0}),V(this,"addToRecentlyDeleted",(t,n)=>{if(this.recentlyDeletedMap.set(t,n),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let s=0;const i=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(s++>=i)break;this.recentlyDeletedMap.delete(o)}}}),V(this,"checkRecentlyDeleted",t=>{const n=this.recentlyDeletedMap.get(t);if(n){const{message:s}=W("MISSING_OR_INVALID",`Record was recently deleted - ${n}: ${t}`);throw new Error(s)}}),V(this,"isLinkModeEnabled",(t,n)=>{var s,i,o,a,c,l,u,h,f;return!t||n!==Be.link_mode?!1:((i=(s=this.client.metadata)==null?void 0:s.redirect)==null?void 0:i.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((l=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:l.universal)!==""&&((u=t==null?void 0:t.redirect)==null?void 0:u.universal)!==void 0&&((h=t==null?void 0:t.redirect)==null?void 0:h.universal)!==""&&((f=t==null?void 0:t.redirect)==null?void 0:f.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(t.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),V(this,"getAppLinkIfEnabled",(t,n)=>{var s;return this.isLinkModeEnabled(t,n)?(s=t==null?void 0:t.redirect)==null?void 0:s.universal:void 0}),V(this,"handleLinkModeMessage",({url:t})=>{if(!t||!t.includes("wc_ev")||!t.includes("topic"))return;const n=om(t,"topic")||"",s=decodeURIComponent(om(t,"wc_ev")||""),i=this.client.session.keys.includes(n);i&&this.client.session.update(n,{transportType:Be.link_mode}),this.client.core.dispatchEnvelope({topic:n,message:s,sessionExists:i})}),V(this,"registerLinkModeListeners",async()=>{var t;if(fg()||Ys()&&(t=this.client.metadata.redirect)!=null&&t.linkMode){const n=global==null?void 0:global.Linking;if(typeof n<"u"){n.addEventListener("url",this.handleLinkModeMessage,this.client.name);const s=await n.getInitialURL();s&&setTimeout(()=>{this.handleLinkModeMessage({url:s})},50)}}}),V(this,"getTVFParams",(t,n,s)=>{var i,o,a;if(!((i=n.request)!=null&&i.method))return{};const c={correlationId:t,rpcMethods:[n.request.method],chainId:n.chainId};try{const l=this.extractTxHashesFromResult(n.request,s);c.txHashes=l,c.contractAddresses=this.isValidContractData(n.request.params)?[(a=(o=n.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(l){this.client.logger.warn("Error getting TVF params",l)}return c}),V(this,"isValidContractData",t=>{var n;if(!t)return!1;try{const s=(t==null?void 0:t.data)||((n=t==null?void 0:t[0])==null?void 0:n.data);if(!s.startsWith("0x"))return!1;const i=s.slice(2);return/^[0-9a-fA-F]*$/.test(i)?i.length%2===0:!1}catch{}return!1}),V(this,"extractTxHashesFromResult",(t,n)=>{var s;try{if(!n)return[];const i=t.method,o=BL[i];if(i==="sui_signTransaction")return[tN(n.transactionBytes)];if(i==="near_signTransaction")return[pm(n)];if(i==="near_signTransactions")return n.map(c=>pm(c));if(i==="xrpl_signTransactionFor"||i==="xrpl_signTransaction")return[(s=n.tx_json)==null?void 0:s.hash];if(i==="polkadot_signTransaction")return[e6({transaction:t.params.transactionPayload,signature:n.signature})];if(i==="algo_signTxn")return Ir(n)?n.map(c=>gm(c)):[gm(n)];if(i==="cosmos_signDirect")return[nN(n)];if(i==="wallet_sendCalls")return sN(n);if(typeof n=="string")return[n];const a=n[o.key];if(Ir(a))return i==="solana_signAllTransactions"?a.map(c=>eN(c)):a;if(typeof a=="string")return[a]}catch(i){this.client.logger.warn("Error extracting tx hashes from result",i)}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,t=this.client.core.relayer.messages.getWithoutAck(e);for(const[n,s]of Object.entries(t))for(const i of s)try{await this.onProviderMessageEvent({topic:n,message:i,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${n}, message: ${i}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Le.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:t,message:n,attestation:s,transportType:i}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(vu)?this.client.auth.authKeys.get(vu):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(t,n,{receiverPublicKey:o,encoding:i===Be.link_mode?Is:Ht});Pg(a)?(this.client.core.history.set(t,a),await this.onRelayEventRequest({topic:t,payload:a,attestation:s,transportType:i,encryptedId:Er(n)})):Uh(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:t,payload:a,transportType:i}),this.client.core.history.delete(t,a.id)):await this.onRelayEventUnknownPayload({topic:t,payload:a,transportType:i}),await this.client.core.relayer.messages.ack(t,n)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(dr.expired,async e=>{const{topic:t,id:n}=DE(e.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,W("EXPIRED"),!0);if(n&&this.client.auth.requests.keys.includes(n))return await this.deletePendingAuthRequest(n,W("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession({topic:t,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:t})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(fi.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(fi.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!Ve(e,!1)){const{message:t}=W("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=W("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(fn(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=W("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}async isValidSessionTopic(e){if(!Ve(e,!1)){const{message:t}=W("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(t)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:t}=W("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(t)}if(fn(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:t}=W("EXPIRED",`session topic: ${e}`);throw new Error(t)}if(!this.client.core.crypto.keychain.has(e)){const{message:t}=W("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(t)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Ve(e,!1)){const{message:t}=W("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(t)}else{const{message:t}=W("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(t)}}async isValidProposalId(e){if(!B4(e)){const{message:t}=W("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(t)}if(!this.client.proposal.keys.includes(e)){const{message:t}=W("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(t)}if(fn(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:t}=W("EXPIRED",`proposal id: ${e}`);throw new Error(t)}}}class qL extends co{constructor(e,t){super(e,t,OL,Dg),this.core=e,this.logger=t}}let VL=class extends co{constructor(e,t){super(e,t,DL,Dg),this.core=e,this.logger=t}};class KL extends co{constructor(e,t){super(e,t,_L,Dg,n=>n.id),this.core=e,this.logger=t}}class GL extends co{constructor(e,t){super(e,t,UL,$h,()=>vu),this.core=e,this.logger=t}}class QL extends co{constructor(e,t){super(e,t,kL,$h),this.core=e,this.logger=t}}class WL extends co{constructor(e,t){super(e,t,$L,$h,n=>n.id),this.core=e,this.logger=t}}var JL=Object.defineProperty,YL=(r,e,t)=>e in r?JL(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Wf=(r,e,t)=>YL(r,typeof e!="symbol"?e+"":e,t);class ZL{constructor(e,t){this.core=e,this.logger=t,Wf(this,"authKeys"),Wf(this,"pairingTopics"),Wf(this,"requests"),this.authKeys=new GL(this.core,this.logger),this.pairingTopics=new QL(this.core,this.logger),this.requests=new WL(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var XL=Object.defineProperty,eF=(r,e,t)=>e in r?XL(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,pe=(r,e,t)=>eF(r,typeof e!="symbol"?e+"":e,t);let tF=class rA extends wU{constructor(e){super(e),pe(this,"protocol",X2),pe(this,"version",eA),pe(this,"name",Gf.name),pe(this,"metadata"),pe(this,"core"),pe(this,"logger"),pe(this,"events",new cr.EventEmitter),pe(this,"engine"),pe(this,"session"),pe(this,"proposal"),pe(this,"pendingRequest"),pe(this,"auth"),pe(this,"signConfig"),pe(this,"on",(n,s)=>this.events.on(n,s)),pe(this,"once",(n,s)=>this.events.once(n,s)),pe(this,"off",(n,s)=>this.events.off(n,s)),pe(this,"removeListener",(n,s)=>this.events.removeListener(n,s)),pe(this,"removeAllListeners",n=>this.events.removeAllListeners(n)),pe(this,"connect",async n=>{try{return await this.engine.connect(n)}catch(s){throw this.logger.error(s.message),s}}),pe(this,"pair",async n=>{try{return await this.engine.pair(n)}catch(s){throw this.logger.error(s.message),s}}),pe(this,"approve",async n=>{try{return await this.engine.approve(n)}catch(s){throw this.logger.error(s.message),s}}),pe(this,"reject",async n=>{try{return await this.engine.reject(n)}catch(s){throw this.logger.error(s.message),s}}),pe(this,"update",async n=>{try{return await this.engine.update(n)}catch(s){throw this.logger.error(s.message),s}}),pe(this,"extend",async n=>{try{return await this.engine.extend(n)}catch(s){throw this.logger.error(s.message),s}}),pe(this,"request",async n=>{try{return await this.engine.request(n)}catch(s){throw this.logger.error(s.message),s}}),pe(this,"respond",async n=>{try{return await this.engine.respond(n)}catch(s){throw this.logger.error(s.message),s}}),pe(this,"ping",async n=>{try{return await this.engine.ping(n)}catch(s){throw this.logger.error(s.message),s}}),pe(this,"emit",async n=>{try{return await this.engine.emit(n)}catch(s){throw this.logger.error(s.message),s}}),pe(this,"disconnect",async n=>{try{return await this.engine.disconnect(n)}catch(s){throw this.logger.error(s.message),s}}),pe(this,"find",n=>{try{return this.engine.find(n)}catch(s){throw this.logger.error(s.message),s}}),pe(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}}),pe(this,"authenticate",async(n,s)=>{try{return await this.engine.authenticate(n,s)}catch(i){throw this.logger.error(i.message),i}}),pe(this,"formatAuthMessage",n=>{try{return this.engine.formatAuthMessage(n)}catch(s){throw this.logger.error(s.message),s}}),pe(this,"approveSessionAuthenticate",async n=>{try{return await this.engine.approveSessionAuthenticate(n)}catch(s){throw this.logger.error(s.message),s}}),pe(this,"rejectSessionAuthenticate",async n=>{try{return await this.engine.rejectSessionAuthenticate(n)}catch(s){throw this.logger.error(s.message),s}}),this.name=(e==null?void 0:e.name)||Gf.name,this.metadata=G_(e==null?void 0:e.metadata),this.signConfig=e==null?void 0:e.signConfig;const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Sl(Nh({level:(e==null?void 0:e.logger)||Gf.logger}));this.core=(e==null?void 0:e.core)||new PL(e),this.logger=Rt(t,this.name),this.session=new VL(this.core,this.logger),this.proposal=new qL(this.core,this.logger),this.pendingRequest=new KL(this.core,this.logger),this.engine=new HL(this),this.auth=new ZL(this.core,this.logger)}static async init(e){const t=new rA(e);return await t.initialize(),t}get context(){return Wt(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};var Zl={exports:{}},Vw;function rF(){return Vw||(Vw=1,(function(r,e){var t=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof hn<"u"&&hn,n=(function(){function i(){this.fetch=!1,this.DOMException=t.DOMException}return i.prototype=t,new i})();(function(i){(function(o){var a=typeof i<"u"&&i||typeof self<"u"&&self||typeof hn<"u"&&hn||{},c={searchParams:"URLSearchParams"in a,iterable:"Symbol"in a&&"iterator"in Symbol,blob:"FileReader"in a&&"Blob"in a&&(function(){try{return new Blob,!0}catch{return!1}})(),formData:"FormData"in a,arrayBuffer:"ArrayBuffer"in a};function l(w){return w&&DataView.prototype.isPrototypeOf(w)}if(c.arrayBuffer)var u=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],h=ArrayBuffer.isView||function(w){return w&&u.indexOf(Object.prototype.toString.call(w))>-1};function f(w){if(typeof w!="string"&&(w=String(w)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(w)||w==="")throw new TypeError('Invalid character in header field name: "'+w+'"');return w.toLowerCase()}function d(w){return typeof w!="string"&&(w=String(w)),w}function p(w){var E={next:function(){var C=w.shift();return{done:C===void 0,value:C}}};return c.iterable&&(E[Symbol.iterator]=function(){return E}),E}function g(w){this.map={},w instanceof g?w.forEach(function(E,C){this.append(C,E)},this):Array.isArray(w)?w.forEach(function(E){if(E.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+E.length);this.append(E[0],E[1])},this):w&&Object.getOwnPropertyNames(w).forEach(function(E){this.append(E,w[E])},this)}g.prototype.append=function(w,E){w=f(w),E=d(E);var C=this.map[w];this.map[w]=C?C+", "+E:E},g.prototype.delete=function(w){delete this.map[f(w)]},g.prototype.get=function(w){return w=f(w),this.has(w)?this.map[w]:null},g.prototype.has=function(w){return this.map.hasOwnProperty(f(w))},g.prototype.set=function(w,E){this.map[f(w)]=d(E)},g.prototype.forEach=function(w,E){for(var C in this.map)this.map.hasOwnProperty(C)&&w.call(E,this.map[C],C,this)},g.prototype.keys=function(){var w=[];return this.forEach(function(E,C){w.push(C)}),p(w)},g.prototype.values=function(){var w=[];return this.forEach(function(E){w.push(E)}),p(w)},g.prototype.entries=function(){var w=[];return this.forEach(function(E,C){w.push([C,E])}),p(w)},c.iterable&&(g.prototype[Symbol.iterator]=g.prototype.entries);function m(w){if(!w._noBody){if(w.bodyUsed)return Promise.reject(new TypeError("Already read"));w.bodyUsed=!0}}function b(w){return new Promise(function(E,C){w.onload=function(){E(w.result)},w.onerror=function(){C(w.error)}})}function x(w){var E=new FileReader,C=b(E);return E.readAsArrayBuffer(w),C}function v(w){var E=new FileReader,C=b(E),k=/charset=([A-Za-z0-9_-]+)/.exec(w.type),_=k?k[1]:"utf-8";return E.readAsText(w,_),C}function S(w){for(var E=new Uint8Array(w),C=new Array(E.length),k=0;k<E.length;k++)C[k]=String.fromCharCode(E[k]);return C.join("")}function I(w){if(w.slice)return w.slice(0);var E=new Uint8Array(w.byteLength);return E.set(new Uint8Array(w)),E.buffer}function A(){return this.bodyUsed=!1,this._initBody=function(w){this.bodyUsed=this.bodyUsed,this._bodyInit=w,w?typeof w=="string"?this._bodyText=w:c.blob&&Blob.prototype.isPrototypeOf(w)?this._bodyBlob=w:c.formData&&FormData.prototype.isPrototypeOf(w)?this._bodyFormData=w:c.searchParams&&URLSearchParams.prototype.isPrototypeOf(w)?this._bodyText=w.toString():c.arrayBuffer&&c.blob&&l(w)?(this._bodyArrayBuffer=I(w.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):c.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(w)||h(w))?this._bodyArrayBuffer=I(w):this._bodyText=w=Object.prototype.toString.call(w):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof w=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):c.searchParams&&URLSearchParams.prototype.isPrototypeOf(w)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},c.blob&&(this.blob=function(){var w=m(this);if(w)return w;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var w=m(this);return w||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(c.blob)return this.blob().then(x);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var w=m(this);if(w)return w;if(this._bodyBlob)return v(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(S(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},c.formData&&(this.formData=function(){return this.text().then(L)}),this.json=function(){return this.text().then(JSON.parse)},this}var O=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function D(w){var E=w.toUpperCase();return O.indexOf(E)>-1?E:w}function B(w,E){if(!(this instanceof B))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');E=E||{};var C=E.body;if(w instanceof B){if(w.bodyUsed)throw new TypeError("Already read");this.url=w.url,this.credentials=w.credentials,E.headers||(this.headers=new g(w.headers)),this.method=w.method,this.mode=w.mode,this.signal=w.signal,!C&&w._bodyInit!=null&&(C=w._bodyInit,w.bodyUsed=!0)}else this.url=String(w);if(this.credentials=E.credentials||this.credentials||"same-origin",(E.headers||!this.headers)&&(this.headers=new g(E.headers)),this.method=D(E.method||this.method||"GET"),this.mode=E.mode||this.mode||null,this.signal=E.signal||this.signal||(function(){if("AbortController"in a){var N=new AbortController;return N.signal}})(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&C)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(C),(this.method==="GET"||this.method==="HEAD")&&(E.cache==="no-store"||E.cache==="no-cache")){var k=/([?&])_=[^&]*/;if(k.test(this.url))this.url=this.url.replace(k,"$1_="+new Date().getTime());else{var _=/\?/;this.url+=(_.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}B.prototype.clone=function(){return new B(this,{body:this._bodyInit})};function L(w){var E=new FormData;return w.trim().split("&").forEach(function(C){if(C){var k=C.split("="),_=k.shift().replace(/\+/g," "),N=k.join("=").replace(/\+/g," ");E.append(decodeURIComponent(_),decodeURIComponent(N))}}),E}function j(w){var E=new g,C=w.replace(/\r?\n[\t ]+/g," ");return C.split("\r").map(function(k){return k.indexOf(`
`)===0?k.substr(1,k.length):k}).forEach(function(k){var _=k.split(":"),N=_.shift().trim();if(N){var z=_.join(":").trim();try{E.append(N,z)}catch(H){console.warn("Response "+H.message)}}}),E}A.call(B.prototype);function $(w,E){if(!(this instanceof $))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(E||(E={}),this.type="default",this.status=E.status===void 0?200:E.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=E.statusText===void 0?"":""+E.statusText,this.headers=new g(E.headers),this.url=E.url||"",this._initBody(w)}A.call($.prototype),$.prototype.clone=function(){return new $(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new g(this.headers),url:this.url})},$.error=function(){var w=new $(null,{status:200,statusText:""});return w.ok=!1,w.status=0,w.type="error",w};var U=[301,302,303,307,308];$.redirect=function(w,E){if(U.indexOf(E)===-1)throw new RangeError("Invalid status code");return new $(null,{status:E,headers:{location:w}})},o.DOMException=a.DOMException;try{new o.DOMException}catch{o.DOMException=function(E,C){this.message=E,this.name=C;var k=Error(E);this.stack=k.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function T(w,E){return new Promise(function(C,k){var _=new B(w,E);if(_.signal&&_.signal.aborted)return k(new o.DOMException("Aborted","AbortError"));var N=new XMLHttpRequest;function z(){N.abort()}N.onload=function(){var G={statusText:N.statusText,headers:j(N.getAllResponseHeaders()||"")};_.url.indexOf("file://")===0&&(N.status<200||N.status>599)?G.status=200:G.status=N.status,G.url="responseURL"in N?N.responseURL:G.headers.get("X-Request-URL");var Q="response"in N?N.response:N.responseText;setTimeout(function(){C(new $(Q,G))},0)},N.onerror=function(){setTimeout(function(){k(new TypeError("Network request failed"))},0)},N.ontimeout=function(){setTimeout(function(){k(new TypeError("Network request timed out"))},0)},N.onabort=function(){setTimeout(function(){k(new o.DOMException("Aborted","AbortError"))},0)};function H(G){try{return G===""&&a.location.href?a.location.href:G}catch{return G}}if(N.open(_.method,H(_.url),!0),_.credentials==="include"?N.withCredentials=!0:_.credentials==="omit"&&(N.withCredentials=!1),"responseType"in N&&(c.blob?N.responseType="blob":c.arrayBuffer&&(N.responseType="arraybuffer")),E&&typeof E.headers=="object"&&!(E.headers instanceof g||a.Headers&&E.headers instanceof a.Headers)){var Y=[];Object.getOwnPropertyNames(E.headers).forEach(function(G){Y.push(f(G)),N.setRequestHeader(G,d(E.headers[G]))}),_.headers.forEach(function(G,Q){Y.indexOf(Q)===-1&&N.setRequestHeader(Q,G)})}else _.headers.forEach(function(G,Q){N.setRequestHeader(Q,G)});_.signal&&(_.signal.addEventListener("abort",z),N.onreadystatechange=function(){N.readyState===4&&_.signal.removeEventListener("abort",z)}),N.send(typeof _._bodyInit>"u"?null:_._bodyInit)})}return T.polyfill=!0,a.fetch||(a.fetch=T,a.Headers=g,a.Request=B,a.Response=$),o.Headers=g,o.Request=B,o.Response=$,o.fetch=T,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var s=t.fetch?t:n;e=s.fetch,e.default=s.fetch,e.fetch=s.fetch,e.Headers=s.Headers,e.Request=s.Request,e.Response=s.Response,r.exports=e})(Zl,Zl.exports)),Zl.exports}var nF=rF();const Kw=Xp(nF);var sF=Object.defineProperty,iF=Object.defineProperties,oF=Object.getOwnPropertyDescriptors,Gw=Object.getOwnPropertySymbols,aF=Object.prototype.hasOwnProperty,cF=Object.prototype.propertyIsEnumerable,Qw=(r,e,t)=>e in r?sF(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ww=(r,e)=>{for(var t in e||(e={}))aF.call(e,t)&&Qw(r,t,e[t]);if(Gw)for(var t of Gw(e))cF.call(e,t)&&Qw(r,t,e[t]);return r},Jw=(r,e)=>iF(r,oF(e));const lF={Accept:"application/json","Content-Type":"application/json"},uF="POST",Yw={headers:lF,method:uF},Zw=10;let nA=class{constructor(e,t=!1){if(this.url=e,this.disableProviderPing=t,this.events=new cr.EventEmitter,this.isAvailable=!1,this.registering=!1,!pw(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=t}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e){this.isAvailable||await this.register();try{const t=rs(e),n=await(await Kw(this.url,Jw(Ww({},Yw),{body:t}))).json();this.onPayload({data:n})}catch(t){this.onError(e.id,t)}}async register(e=this.url){if(!pw(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((n,s)=>{this.events.once("register_error",i=>{this.resetMaxListeners(),s(i)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return s(new Error("HTTP connection is missing or invalid"));n()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const t=rs({id:1,jsonrpc:"2.0",method:"test",params:[]});await Kw(e,Jw(Ww({},Yw),{body:t}))}this.onOpen()}catch(t){const n=this.parseError(t);throw this.events.emit("register_error",n),this.onClose(),n}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const t=typeof e.data=="string"?Zi(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const n=this.parseError(t),s=n.message||n.toString(),i=Rh(e,s);this.events.emit("payload",i)}parseError(e,t=this.url){return N2(e,t,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>Zw&&this.events.setMaxListeners(Zw)}};const Xw="error",hF="wss://relay.walletconnect.org",fF="wc",dF="universal_provider",Xl=`${fF}@2:${dF}:`,sA="https://rpc.walletconnect.org/v1/",iA="generic",pF=`${sA}bundler`,Ho="call_status",gF=86400,Cg={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};function Bg(r){return r==null||typeof r!="object"&&typeof r!="function"}function oA(r){return Object.getOwnPropertySymbols(r).filter(e=>Object.prototype.propertyIsEnumerable.call(r,e))}function aA(r){return r==null?r===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(r)}const yF="[object RegExp]",cA="[object String]",lA="[object Number]",uA="[object Boolean]",hA="[object Arguments]",mF="[object Symbol]",wF="[object Date]",bF="[object Map]",vF="[object Set]",EF="[object Array]",AF="[object ArrayBuffer]",xF="[object Object]",IF="[object DataView]",SF="[object Uint8Array]",PF="[object Uint8ClampedArray]",OF="[object Uint16Array]",DF="[object Uint32Array]",CF="[object Int8Array]",BF="[object Int16Array]",_F="[object Int32Array]",TF="[object Float32Array]",NF="[object Float64Array]";function _g(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function RF(r,e){return No(r,void 0,r,new Map,e)}function No(r,e,t,n=new Map,s=void 0){const i=s==null?void 0:s(r,e,t,n);if(i!=null)return i;if(Bg(r))return r;if(n.has(r))return n.get(r);if(Array.isArray(r)){const o=new Array(r.length);n.set(r,o);for(let a=0;a<r.length;a++)o[a]=No(r[a],a,t,n,s);return Object.hasOwn(r,"index")&&(o.index=r.index),Object.hasOwn(r,"input")&&(o.input=r.input),o}if(r instanceof Date)return new Date(r.getTime());if(r instanceof RegExp){const o=new RegExp(r.source,r.flags);return o.lastIndex=r.lastIndex,o}if(r instanceof Map){const o=new Map;n.set(r,o);for(const[a,c]of r)o.set(a,No(c,a,t,n,s));return o}if(r instanceof Set){const o=new Set;n.set(r,o);for(const a of r)o.add(No(a,void 0,t,n,s));return o}if(typeof Buffer<"u"&&Buffer.isBuffer(r))return r.subarray();if(_g(r)){const o=new(Object.getPrototypeOf(r)).constructor(r.length);n.set(r,o);for(let a=0;a<r.length;a++)o[a]=No(r[a],a,t,n,s);return o}if(r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer)return r.slice(0);if(r instanceof DataView){const o=new DataView(r.buffer.slice(0),r.byteOffset,r.byteLength);return n.set(r,o),di(o,r,t,n,s),o}if(typeof File<"u"&&r instanceof File){const o=new File([r],r.name,{type:r.type});return n.set(r,o),di(o,r,t,n,s),o}if(r instanceof Blob){const o=new Blob([r],{type:r.type});return n.set(r,o),di(o,r,t,n,s),o}if(r instanceof Error){const o=new r.constructor;return n.set(r,o),o.message=r.message,o.name=r.name,o.stack=r.stack,o.cause=r.cause,di(o,r,t,n,s),o}if(typeof r=="object"&&UF(r)){const o=Object.create(Object.getPrototypeOf(r));return n.set(r,o),di(o,r,t,n,s),o}return r}function di(r,e,t=r,n,s){const i=[...Object.keys(e),...oA(e)];for(let o=0;o<i.length;o++){const a=i[o],c=Object.getOwnPropertyDescriptor(r,a);(c==null||c.writable)&&(r[a]=No(e[a],a,t,n,s))}}function UF(r){switch(aA(r)){case hA:case EF:case AF:case IF:case uA:case wF:case TF:case NF:case CF:case BF:case _F:case bF:case lA:case xF:case yF:case vF:case cA:case mF:case SF:case PF:case OF:case DF:return!0;default:return!1}}function kF(r,e){return RF(r,(t,n,s,i)=>{if(typeof r=="object")switch(Object.prototype.toString.call(r)){case lA:case cA:case uA:{const o=new r.constructor(r==null?void 0:r.valueOf());return di(o,r),o}case hA:{const o={};return di(o,r),o.length=r.length,o[Symbol.iterator]=r[Symbol.iterator],o}default:return}})}function eb(r){return kF(r)}function tb(r){return r!==null&&typeof r=="object"&&aA(r)==="[object Arguments]"}function rb(r){return typeof r=="object"&&r!==null}function $F(){}function LF(r){return _g(r)}function FF(r){var t;if(typeof r!="object"||r==null)return!1;if(Object.getPrototypeOf(r)===null)return!0;if(Object.prototype.toString.call(r)!=="[object Object]"){const n=r[Symbol.toStringTag];return n==null||!((t=Object.getOwnPropertyDescriptor(r,Symbol.toStringTag))!=null&&t.writable)?!1:r.toString()===`[object ${n}]`}let e=r;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(r)===e}function MF(r){if(Bg(r))return r;if(Array.isArray(r)||_g(r)||r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer)return r.slice(0);const e=Object.getPrototypeOf(r),t=e.constructor;if(r instanceof Date||r instanceof Map||r instanceof Set)return new t(r);if(r instanceof RegExp){const n=new t(r);return n.lastIndex=r.lastIndex,n}if(r instanceof DataView)return new t(r.buffer.slice(0));if(r instanceof Error){const n=new t(r.message);return n.stack=r.stack,n.name=r.name,n.cause=r.cause,n}if(typeof File<"u"&&r instanceof File)return new t([r],r.name,{type:r.type,lastModified:r.lastModified});if(typeof r=="object"){const n=Object.create(e);return Object.assign(n,r)}return r}function jF(r,...e){const t=e.slice(0,-1),n=e[e.length-1];let s=r;for(let i=0;i<t.length;i++){const o=t[i];s=Cp(s,o,n,new Map)}return s}function Cp(r,e,t,n){if(Bg(r)&&(r=Object(r)),e==null||typeof e!="object")return r;if(n.has(e))return MF(n.get(e));if(n.set(e,r),Array.isArray(e)){e=e.slice();for(let i=0;i<e.length;i++)e[i]=e[i]??void 0}const s=[...Object.keys(e),...oA(e)];for(let i=0;i<s.length;i++){const o=s[i];let a=e[o],c=r[o];if(tb(a)&&(a={...a}),tb(c)&&(c={...c}),typeof Buffer<"u"&&Buffer.isBuffer(a)&&(a=eb(a)),Array.isArray(a))if(typeof c=="object"&&c!=null){const u=[],h=Reflect.ownKeys(c);for(let f=0;f<h.length;f++){const d=h[f];u[d]=c[d]}c=u}else c=[];const l=t(c,a,o,r,e,n);l!=null?r[o]=l:Array.isArray(a)||rb(c)&&rb(a)?r[o]=Cp(c,a,t,n):c==null&&FF(a)?r[o]=Cp({},a,t,n):c==null&&LF(a)?r[o]=eb(a):(c===void 0||a!==void 0)&&(r[o]=a)}return r}function zF(r,...e){return jF(r,...e,$F)}var HF=Object.defineProperty,qF=Object.defineProperties,VF=Object.getOwnPropertyDescriptors,nb=Object.getOwnPropertySymbols,KF=Object.prototype.hasOwnProperty,GF=Object.prototype.propertyIsEnumerable,sb=(r,e,t)=>e in r?HF(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,eu=(r,e)=>{for(var t in e||(e={}))KF.call(e,t)&&sb(r,t,e[t]);if(nb)for(var t of nb(e))GF.call(e,t)&&sb(r,t,e[t]);return r},QF=(r,e)=>qF(r,VF(e));function fA(r,e,t){var n;const s=Yn(r);return((n=e.rpcMap)==null?void 0:n[s.reference])||`${sA}?chainId=${s.namespace}:${s.reference}&projectId=${t}`}function WF(r){return r.includes(":")?r.split(":")[1]:r}function dA(r){return r.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function JF(r,e){const t=Object.keys(e.namespaces).filter(s=>s.includes(r));if(!t.length)return[];const n=[];return t.forEach(s=>{const i=e.namespaces[s].accounts;n.push(...i)}),n}function ib(r){return Object.fromEntries(Object.entries(r).filter(([e,t])=>{var n,s;return((n=t==null?void 0:t.chains)==null?void 0:n.length)&&((s=t==null?void 0:t.chains)==null?void 0:s.length)>0}))}function tu(r={},e={}){const t=ib(ob(r)),n=ib(ob(e));return zF(t,n)}function ob(r){var e,t,n,s,i;const o={};if(!wn(r))return o;for(const[a,c]of Object.entries(r)){const l=Th(a)?[a]:c.chains,u=c.methods||[],h=c.events||[],f=c.rpcMap||{},d=To(a);o[d]=QF(eu(eu({},o[d]),c),{chains:mn(l,(e=o[d])==null?void 0:e.chains),methods:mn(u,(t=o[d])==null?void 0:t.methods),events:mn(h,(n=o[d])==null?void 0:n.events)}),(wn(f)||wn(((s=o[d])==null?void 0:s.rpcMap)||{}))&&(o[d].rpcMap=eu(eu({},f),(i=o[d])==null?void 0:i.rpcMap))}return o}function ab(r){return r.includes(":")?r.split(":")[2]:r}function cb(r){const e={};for(const[t,n]of Object.entries(r)){const s=n.methods||[],i=n.events||[],o=n.accounts||[],a=Th(t)?[t]:n.chains?n.chains:dA(n.accounts);e[t]={chains:a,methods:s,events:i,accounts:o}}return e}function Jf(r){return typeof r=="number"?r:r.includes("0x")?parseInt(r,16):(r=r.includes(":")?r.split(":")[1]:r,isNaN(Number(r))?r:Number(r))}function YF(r){try{const e=JSON.parse(r);return typeof e=="object"&&e!==null&&!Array.isArray(e)}catch{return!1}}const pA={},qo=r=>pA[r],Yf=(r,e)=>{pA[r]=e};var ZF=Object.defineProperty,lb=Object.getOwnPropertySymbols,XF=Object.prototype.hasOwnProperty,e9=Object.prototype.propertyIsEnumerable,ub=(r,e,t)=>e in r?ZF(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,hb=(r,e)=>{for(var t in e||(e={}))XF.call(e,t)&&ub(r,t,e[t]);if(lb)for(var t of lb(e))e9.call(e,t)&&ub(r,t,e[t]);return r};const fb="eip155",t9=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],r9=r=>r&&r.startsWith("0x")?BigInt(r).toString(10):r,Zf=r=>r&&r.startsWith("0x")?r:`0x${BigInt(r).toString(16)}`,db=r=>Object.keys(r).filter(e=>t9.includes(e)).reduce((e,t)=>(e[t]=n9(r[t]),e),{}),n9=r=>typeof r=="string"&&YF(r)?JSON.parse(r):r,s9=(r,e,t)=>{const{sessionProperties:n={},scopedProperties:s={}}=r,i={};if(!wn(s)&&!wn(n))return;const o=db(n);for(const a of t){const c=r9(a);if(!c)continue;i[Zf(c)]=o;const l=s==null?void 0:s[`${fb}:${c}`];if(l){const u=l==null?void 0:l[`${fb}:${c}:${e}`];i[Zf(c)]=hb(hb({},i[Zf(c)]),db(u||l))}}for(const[a,c]of Object.entries(i))Object.keys(c).length===0&&delete i[a];return Object.keys(i).length>0?i:void 0};var i9=Object.defineProperty,o9=(r,e,t)=>e in r?i9(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,a9=(r,e,t)=>o9(r,e+"",t);let Xf,c9=class gA{constructor(e){a9(this,"storage"),this.storage=e}async getItem(e){return await this.storage.getItem(e)}async setItem(e,t){return await this.storage.setItem(e,t)}async removeItem(e){return await this.storage.removeItem(e)}static getStorage(e){return Xf||(Xf=new gA(e)),Xf}};var l9=Object.defineProperty,u9=Object.defineProperties,h9=Object.getOwnPropertyDescriptors,pb=Object.getOwnPropertySymbols,f9=Object.prototype.hasOwnProperty,d9=Object.prototype.propertyIsEnumerable,gb=(r,e,t)=>e in r?l9(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,p9=(r,e)=>{for(var t in e||(e={}))f9.call(e,t)&&gb(r,t,e[t]);if(pb)for(var t of pb(e))d9.call(e,t)&&gb(r,t,e[t]);return r},g9=(r,e)=>u9(r,h9(e));async function y9(r,e){const t=Yn(r.result.capabilities.caip345.caip2),n=r.result.capabilities.caip345.transactionHashes,s=await Promise.allSettled(n.map(h=>m9(t.reference,h,e))),i=s.filter(h=>h.status==="fulfilled").map(h=>h.value).filter(h=>h);s.filter(h=>h.status==="rejected").forEach(h=>console.warn("Failed to fetch transaction receipt:",h.reason));const o=!i.length||i.some(h=>!h),a=i.every(h=>(h==null?void 0:h.status)==="0x1"),c=i.every(h=>(h==null?void 0:h.status)==="0x0"),l=i.some(h=>(h==null?void 0:h.status)==="0x0");let u;return o?u=100:a?u=200:c?u=500:l&&(u=600),{id:r.result.id,version:r.request.version,atomic:r.request.atomicRequired,chainId:r.request.chainId,capabilities:r.result.capabilities,receipts:i,status:u}}async function m9(r,e,t){return await t(parseInt(r)).request(Mr("eth_getTransactionReceipt",[e]))}async function w9({sendCalls:r,storage:e}){const t=await e.getItem(Ho);await e.setItem(Ho,g9(p9({},t),{[r.result.id]:{request:r.request,result:r.result,expiry:qe(gF)}}))}async function b9({resultId:r,storage:e}){const t=await e.getItem(Ho);if(t){delete t[r],await e.setItem(Ho,t);for(const n in t)fn(t[n].expiry)&&delete t[n];await e.setItem(Ho,t)}}async function v9({resultId:r,storage:e}){const t=await e.getItem(Ho),n=t==null?void 0:t[r];if(n&&!fn(n.expiry))return n;await b9({resultId:r,storage:e})}var E9=Object.defineProperty,A9=Object.defineProperties,x9=Object.getOwnPropertyDescriptors,yb=Object.getOwnPropertySymbols,I9=Object.prototype.hasOwnProperty,S9=Object.prototype.propertyIsEnumerable,Bp=(r,e,t)=>e in r?E9(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ed=(r,e)=>{for(var t in e||(e={}))I9.call(e,t)&&Bp(r,t,e[t]);if(yb)for(var t of yb(e))S9.call(e,t)&&Bp(r,t,e[t]);return r},td=(r,e)=>A9(r,x9(e)),si=(r,e,t)=>Bp(r,typeof e!="symbol"?e+"":e,t);class P9{constructor(e){si(this,"name","eip155"),si(this,"client"),si(this,"chainId"),si(this,"namespace"),si(this,"httpProviders"),si(this,"events"),si(this,"storage"),this.namespace=e.namespace,this.events=qo("events"),this.client=qo("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain()),this.storage=c9.getStorage(this.client.core.storage)}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e);case"wallet_sendCalls":return await this.sendCalls(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t);const n=this.chainId;this.chainId=parseInt(e),this.events.emit(Cg.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${n}`})}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){const n=t||fA(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${e}`);return new Og(new nA(n,qo("disableProviderPing")))}setHttpProvider(e,t){const n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var n;const s=parseInt(WF(t));e[s]=this.createHttpProvider(s,(n=this.namespace.rpcMap)==null?void 0:n[t])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}getHttpProvider(e){const t=e||this.chainId;return this.httpProviders[t]||(this.httpProviders=td(ed({},this.httpProviders),{[t]:this.createHttpProvider(t)}),this.httpProviders[t])}async handleSwitchChain(e){var t,n;let s=e.request.params?(t=e.request.params[0])==null?void 0:t.chainId:"0x0";s=s.startsWith("0x")?s:`0x${s}`;const i=parseInt(s,16);if(this.isChainApproved(i))this.setDefaultChain(`${i}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:s}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${i}`);else throw new Error(`Failed to switch to chain 'eip155:${i}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var t,n,s,i,o;const a=(n=(t=e.request)==null?void 0:t.params)==null?void 0:n[0],c=((i=(s=e.request)==null?void 0:s.params)==null?void 0:i[1])||[];if(!a)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const l=this.client.session.get(e.topic),u=((o=l==null?void 0:l.sessionProperties)==null?void 0:o.capabilities)||{},h=`${a}${c.join(",")}`,f=u==null?void 0:u[h];if(f)return f;let d;try{d=s9(l,a,c)}catch(g){console.warn("Failed to extract capabilities from session",g)}if(d)return d;const p=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:td(ed({},l.sessionProperties||{}),{capabilities:td(ed({},u||{}),{[h]:p})})})}catch(g){console.warn("Failed to update session with capabilities",g)}return p}async getCallStatus(e){var t,n,s;const i=this.client.session.get(e.topic),o=(t=i.sessionProperties)==null?void 0:t.bundler_name;if(o){const l=this.getBundlerUrl(e.chainId,o);try{return await this.getUserOperationReceipt(l,e)}catch(u){console.warn("Failed to fetch call status from bundler",u,l)}}const a=(n=i.sessionProperties)==null?void 0:n.bundler_url;if(a)try{return await this.getUserOperationReceipt(a,e)}catch(l){console.warn("Failed to fetch call status from custom bundler",l,a)}const c=await v9({resultId:(s=e.request.params)==null?void 0:s[0],storage:this.storage});if(c)try{return await y9(c,this.getHttpProvider.bind(this))}catch(l){console.warn("Failed to fetch call status from stored send calls",l,c)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,t){var n;const s=new URL(e),i=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Mr("eth_getUserOperationReceipt",[(n=t.request.params)==null?void 0:n[0]]))});if(!i.ok)throw new Error(`Failed to fetch user operation receipt - ${i.status}`);return await i.json()}getBundlerUrl(e,t){return`${pF}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${t}`}async sendCalls(e){var t,n,s;const i=await this.client.request(e),o=(t=e.request.params)==null?void 0:t[0],a=i==null?void 0:i.id,c=(i==null?void 0:i.capabilities)||{},l=(n=c==null?void 0:c.caip345)==null?void 0:n.caip2,u=(s=c==null?void 0:c.caip345)==null?void 0:s.transactionHashes;return!a||!l||!(u!=null&&u.length)||await w9({sendCalls:{request:o,result:i},storage:this.storage}),i}}var O9=Object.defineProperty,D9=(r,e,t)=>e in r?O9(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ao=(r,e,t)=>D9(r,typeof e!="symbol"?e+"":e,t);class C9{constructor(e){Ao(this,"name",iA),Ao(this,"client"),Ao(this,"httpProviders"),Ao(this,"events"),Ao(this,"namespace"),Ao(this,"chainId"),this.namespace=e.namespace,this.events=qo("events"),this.client=qo("client"),this.chainId=this.getDefaultChain(),this.name=this.getNamespaceName(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t);const n=this.chainId;this.chainId=e,this.events.emit(Cg.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${n}`})}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getNamespaceName(){const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return Yn(e).namespace}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){var e,t;const n={};return(t=(e=this.namespace)==null?void 0:e.accounts)==null||t.forEach(s=>{var i,o;const a=Yn(s),c=(o=(i=this.namespace)==null?void 0:i.rpcMap)==null?void 0:o[`${a.namespace}:${a.reference}`];n[a.reference]=this.createHttpProvider(s,c)}),n}getHttpProvider(e){const t=Yn(e).reference,n=this.httpProviders[t];if(typeof n>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return n}setHttpProvider(e,t){const n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}createHttpProvider(e,t){const n=t||fA(e,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${e}`);return new Og(new nA(n,qo("disableProviderPing")))}}var B9=Object.defineProperty,_9=Object.defineProperties,T9=Object.getOwnPropertyDescriptors,mb=Object.getOwnPropertySymbols,N9=Object.prototype.hasOwnProperty,R9=Object.prototype.propertyIsEnumerable,_p=(r,e,t)=>e in r?B9(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,gc=(r,e)=>{for(var t in e||(e={}))N9.call(e,t)&&_p(r,t,e[t]);if(mb)for(var t of mb(e))R9.call(e,t)&&_p(r,t,e[t]);return r},ru=(r,e)=>_9(r,T9(e)),fr=(r,e,t)=>_p(r,typeof e!="symbol"?e+"":e,t);class Tg{constructor(e){fr(this,"client"),fr(this,"namespaces"),fr(this,"optionalNamespaces"),fr(this,"sessionProperties"),fr(this,"scopedProperties"),fr(this,"events",new eg),fr(this,"rpcProviders",{}),fr(this,"session"),fr(this,"providerOpts"),fr(this,"logger"),fr(this,"uri"),fr(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Sl(Nh({level:(e==null?void 0:e.logger)||Xw})),this.disableProviderPing=(e==null?void 0:e.disableProviderPing)||!1}static async init(e){const t=new Tg(e);return await t.initialize(),t}async request(e,t,n){const[s,i]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:gc({},e),chainId:`${s}:${i}`,topic:this.session.topic,expiry:n})}sendAsync(e,t,n,s){const i=new Date().getTime();this.request(e,n,s).then(o=>t(null,Jc(i,o))).catch(o=>t(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:_e("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,t){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:n,response:s}=await this.client.authenticate(e,t);n&&(this.uri=n,this.events.emit("display_uri",n));const i=await s();if(this.session=i.session,this.session){const o=cb(this.session.namespaces);this.namespaces=tu(this.namespaces,o),await this.persist("namespaces",this.namespaces),this.onConnect()}return i}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){const{uri:t,approval:n}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});t&&(this.uri=t,this.events.emit("display_uri",t));const s=await n();this.session=s;const i=cb(s.namespaces);return this.namespaces=tu(this.namespaces,i),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,t){try{if(!this.session)return;const[n,s]=this.validateChain(e);this.getProvider(n).setDefaultChain(s,t)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(e={}){try{this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(!Ir(t))return;for(const n of t)e.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}catch(t){this.logger.warn("Failed to cleanup pending pairings",t)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,t;if(this.client=this.providerOpts.client||await tF.init({core:this.providerOpts.core,logger:this.providerOpts.logger||Xw,relayUrl:this.providerOpts.relayUrl||hF,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(n){throw this.logger.error("Failed to get session",n),new Error(`The provided session: ${(t=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:t.topic} doesn't exist in the Sign client`)}else{const n=this.client.session.getAll();this.session=n[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(t=>To(t)))];Yf("client",this.client),Yf("events",this.events),Yf("disableProviderPing",this.disableProviderPing),e.forEach(t=>{if(!this.session)return;const n=JF(t,this.session);if((n==null?void 0:n.length)===0)return;const s=dA(n),i=tu(this.namespaces,this.optionalNamespaces),o=ru(gc({},i[t]),{accounts:n,chains:s});switch(t){case"eip155":this.rpcProviders[t]=new P9({namespace:o});break;default:this.rpcProviders[t]=new C9({namespace:o})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var t;const{topic:n}=e;n===((t=this.session)==null?void 0:t.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var t;const{params:n,topic:s}=e;if(s!==((t=this.session)==null?void 0:t.topic))return;const{event:i}=n;if(i.name==="accountsChanged"){const o=i.data;o&&Ir(o)&&this.events.emit("accountsChanged",o.map(ab))}else if(i.name==="chainChanged"){const o=n.chainId,a=n.event.data,c=To(o),l=Jf(o)!==Jf(a)?`${c}:${Jf(a)}`:o;this.onChainChanged({currentCaipChainId:l})}else this.events.emit(i.name,i.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var n,s;if(e!==((n=this.session)==null?void 0:n.topic))return;const{namespaces:i}=t,o=(s=this.client)==null?void 0:s.session.get(e);this.session=ru(gc({},o),{namespaces:i}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{var t;e.topic===((t=this.session)==null?void 0:t.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",ru(gc({},_e("USER_DISCONNECTED")),{data:e.topic})))}),this.on(Cg.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(ru(gc({},e),{internal:!0}))})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[iA]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace((t=this.session)==null?void 0:t.namespaces[e])})}setNamespaces(e){const{namespaces:t={},optionalNamespaces:n={},sessionProperties:s,scopedProperties:i}=e;this.optionalNamespaces=tu(t,n),this.sessionProperties=s,this.scopedProperties=i}validateChain(e){const[t,n]=(e==null?void 0:e.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,n];if(t&&!Object.keys(this.namespaces||{}).map(o=>To(o)).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&n)return[t,n];const s=To(Object.keys(this.namespaces)[0]),i=this.rpcProviders[s].getDefaultChain();return[s,i]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged({currentCaipChainId:e,previousCaipChainId:t,internal:n=!1}){if(!this.namespaces)return;const[s,i]=this.validateChain(e);i&&(this.updateNamespaceChain(s,i),n?(this.events.emit("chainChanged",i),this.emitAccountsChangedOnChainChange({namespace:s,currentCaipChainId:e,previousCaipChainId:t})):this.getProvider(s).setDefaultChain(i),await this.persist("namespaces",this.namespaces))}emitAccountsChangedOnChainChange({namespace:e,currentCaipChainId:t,previousCaipChainId:n}){var s,i;try{if(n===t)return;const o=(i=(s=this.session)==null?void 0:s.namespaces[e])==null?void 0:i.accounts;if(!o)return;const a=o.filter(c=>c.includes(`${t}:`)).map(ab);if(!Ir(a))return;this.events.emit("accountsChanged",a)}catch(o){this.logger.warn("Failed to emit accountsChanged on chain change",o)}}updateNamespaceChain(e,t){if(!this.namespaces)return;const n=this.namespaces[e]?e:`${e}:${t}`,s={chains:[],methods:[],events:[],defaultChain:t};this.namespaces[n]?this.namespaces[n]&&(this.namespaces[n].defaultChain=t):this.namespaces[n]=s}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,t){var n;const s=((n=this.session)==null?void 0:n.topic)||"";await this.client.core.storage.setItem(`${Xl}/${e}${s}`,t)}async getFromStore(e){var t;const n=((t=this.session)==null?void 0:t.topic)||"";return await this.client.core.storage.getItem(`${Xl}/${e}${n}`)}async deleteFromStore(e){var t;const n=((t=this.session)==null?void 0:t.topic)||"";await this.client.core.storage.removeItem(`${Xl}/${e}${n}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;const t=await this.client.core.storage.getKeys();for(const n of t)n.startsWith(Xl)&&await this.client.core.storage.removeItem(n)}catch(t){this.logger.warn("Failed to cleanup storage",t)}}}const U9=Tg,k9="wc",$9="ethereum_provider",L9=`${k9}@2:${$9}:`,F9="https://rpc.walletconnect.org/v1/",Tp=["eth_sendTransaction","personal_sign"],M9=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],Np=["chainChanged","accountsChanged"],j9=["chainChanged","accountsChanged","message","disconnect","connect"],z9=async()=>{const{createAppKit:r}=await yv(()=>import("./core-BDoqn90y.js").then(e=>e.ac),[]);return r};var H9=Object.defineProperty,q9=Object.defineProperties,V9=Object.getOwnPropertyDescriptors,wb=Object.getOwnPropertySymbols,K9=Object.prototype.hasOwnProperty,G9=Object.prototype.propertyIsEnumerable,Rp=(r,e,t)=>e in r?H9(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ci=(r,e)=>{for(var t in e||(e={}))K9.call(e,t)&&Rp(r,t,e[t]);if(wb)for(var t of wb(e))G9.call(e,t)&&Rp(r,t,e[t]);return r},yc=(r,e)=>q9(r,V9(e)),Yt=(r,e,t)=>Rp(r,typeof e!="symbol"?e+"":e,t);function Yu(r){return Number(r[0].split(":")[1])}function nu(r){return`0x${r.toString(16)}`}function Q9(r){const{chains:e,optionalChains:t,methods:n,optionalMethods:s,events:i,optionalEvents:o,rpcMap:a}=r;if(!Ir(e))throw new Error("Invalid chains");const c={chains:e,methods:n||Tp,events:i||Np,rpcMap:ci({},e.length?{[Yu(e)]:a[Yu(e)]}:{})},l=i==null?void 0:i.filter(d=>!Np.includes(d)),u=n==null?void 0:n.filter(d=>!Tp.includes(d));if(!t&&!o&&!s&&!(l!=null&&l.length)&&!(u!=null&&u.length))return{required:e.length?c:void 0};const h=(l==null?void 0:l.length)&&(u==null?void 0:u.length)||!t,f={chains:[...new Set(h?c.chains.concat(t||[]):t)],methods:[...new Set(c.methods.concat(s!=null&&s.length?s:M9))],events:[...new Set(c.events.concat(o!=null&&o.length?o:j9))],rpcMap:a};return{required:e.length?c:void 0,optional:t.length?f:void 0}}class Ng{constructor(){Yt(this,"events",new cr.EventEmitter),Yt(this,"namespace","eip155"),Yt(this,"accounts",[]),Yt(this,"signer"),Yt(this,"chainId",1),Yt(this,"modal"),Yt(this,"rpc"),Yt(this,"STORAGE_KEY",L9),Yt(this,"on",(e,t)=>(this.events.on(e,t),this)),Yt(this,"once",(e,t)=>(this.events.once(e,t),this)),Yt(this,"removeListener",(e,t)=>(this.events.removeListener(e,t),this)),Yt(this,"off",(e,t)=>(this.events.off(e,t),this)),Yt(this,"parseAccount",e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e),this.signer={},this.rpc={}}static async init(e){const t=new Ng;return await t.initialize(e),t}async request(e,t){return await this.signer.request(e,this.formatChainId(this.chainId),t)}sendAsync(e,t,n){this.signer.sendAsync(e,t,this.formatChainId(this.chainId),n)}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){var t;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);const{required:n,optional:s}=Q9(this.rpc);try{const i=await new Promise(async(a,c)=>{var l,u;this.rpc.showQrModal&&((l=this.modal)==null||l.open(),(u=this.modal)==null||u.subscribeState(f=>{!f.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),c(new Error("Connection request reset. Please try again.")))}));const h=e!=null&&e.scopedProperties?{[this.namespace]:e.scopedProperties}:void 0;await this.signer.connect(yc(ci({namespaces:ci({},n&&{[this.namespace]:n})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:e==null?void 0:e.pairingTopic,scopedProperties:h})).then(f=>{a(f)}).catch(f=>{var d;(d=this.modal)==null||d.showErrorMessage("Unable to connect"),c(new Error(f.message))})});if(!i)return;const o=tm(i.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:nu(this.chainId)})}catch(i){throw this.signer.logger.error(i),i}finally{(t=this.modal)==null||t.close()}}async authenticate(e,t){var n;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:e==null?void 0:e.chains});try{const s=await new Promise(async(o,a)=>{var c,l;this.rpc.showQrModal&&((c=this.modal)==null||c.open(),(l=this.modal)==null||l.subscribeState(u=>{!u.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),a(new Error("Connection request reset. Please try again.")))})),await this.signer.authenticate(yc(ci({},e),{chains:this.rpc.chains}),t).then(u=>{o(u)}).catch(u=>{var h;(h=this.modal)==null||h.showErrorMessage("Unable to connect"),a(new Error(u.message))})}),i=s.session;if(i){const o=tm(i.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:nu(this.chainId)})}return s}catch(s){throw this.signer.logger.error(s),s}finally{(n=this.modal)==null||n.close()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:t}=e,{event:n}=t;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",e)}),this.signer.on("accountsChanged",e=>{this.accounts=this.parseAccounts(e),this.events.emit("accountsChanged",this.accounts)}),this.signer.on("chainChanged",e=>{const t=parseInt(e);this.chainId=t,this.events.emit("chainChanged",nu(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",yc(ci({},_e("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const t=e.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));t.length&&(this.chainId=t[0],this.events.emit("chainChanged",nu(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const t=this.parseChainId(e);this.chainId=t,this.switchEthereumChain(t)}}parseAccountId(e){const[t,n,s]=e.split(":");return{chainId:`${t}:${n}`,address:s}}setAccounts(e){this.accounts=e.filter(t=>this.parseChainId(this.parseAccountId(t).chainId)===this.chainId).map(t=>this.parseAccountId(t).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var t,n;const s=(t=e==null?void 0:e.chains)!=null?t:[],i=(n=e==null?void 0:e.optionalChains)!=null?n:[],o=s.concat(i);if(!o.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const a=s.length?(e==null?void 0:e.methods)||Tp:[],c=s.length?(e==null?void 0:e.events)||Np:[],l=(e==null?void 0:e.optionalMethods)||[],u=(e==null?void 0:e.optionalEvents)||[],h=(e==null?void 0:e.rpcMap)||this.buildRpcMap(o,e.projectId),f=(e==null?void 0:e.qrModalOptions)||void 0;return{chains:s==null?void 0:s.map(d=>this.formatChainId(d)),optionalChains:i.map(d=>this.formatChainId(d)),methods:a,events:c,optionalMethods:l,optionalEvents:u,rpcMap:h,showQrModal:!!(e!=null&&e.showQrModal),qrModalOptions:f,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,t){const n={};return e.forEach(s=>{n[s]=this.getRpcUrl(s,t)}),n}async initialize(e){if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?Yu(this.rpc.chains):Yu(this.rpc.optionalChains),this.signer=await U9.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storage:e.storage,storageOptions:e.storageOptions,customStoragePrefix:e.customStoragePrefix,telemetryEnabled:e.telemetryEnabled,logger:e.logger}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let t;try{const n=await z9(),{convertWCMToAppKitOptions:s}=await Promise.resolve().then(function(){return sM}),i=s(yc(ci({},this.rpc.qrModalOptions),{chains:[...new Set([...this.rpc.chains,...this.rpc.optionalChains])],metadata:this.rpc.metadata,projectId:this.rpc.projectId}));if(!i.networks.length)throw new Error("No networks found for WalletConnect·");t=n(yc(ci({},i),{universalProvider:this.signer,manualWCControl:!0}))}catch(n){throw console.warn(n),new Error("To use QR modal, please install @reown/appkit package")}if(t)try{this.modal=t}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(e){if(!e)return;const{chains:t,optionalChains:n,rpcMap:s}=e;t&&Ir(t)&&(this.rpc.chains=t.map(i=>this.formatChainId(i)),t.forEach(i=>{this.rpc.rpcMap[i]=(s==null?void 0:s[i])||this.getRpcUrl(i)})),n&&Ir(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n==null?void 0:n.map(i=>this.formatChainId(i)),n.forEach(i=>{this.rpc.rpcMap[i]=(s==null?void 0:s[i])||this.getRpcUrl(i)}))}getRpcUrl(e,t){var n;return((n=this.rpc.rpcMap)==null?void 0:n[e])||`${F9}?chainId=eip155:${e}&projectId=${t||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{const e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),t=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:t==null?void 0:t.accounts),this.setAccounts(t==null?void 0:t.accounts)}catch(e){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(e),await this.disconnect().catch(t=>this.signer.logger.warn(t))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return typeof e=="string"||e instanceof String?[this.parseAccount(e)]:e.map(t=>this.parseAccount(t))}}var W9=Object.defineProperty,J9=Object.defineProperties,Y9=Object.getOwnPropertyDescriptors,bb=Object.getOwnPropertySymbols,Z9=Object.prototype.hasOwnProperty,X9=Object.prototype.propertyIsEnumerable,vb=(r,e,t)=>e in r?W9(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,yA=(r,e)=>{for(var t in e||(e={}))Z9.call(e,t)&&vb(r,t,e[t]);if(bb)for(var t of bb(e))X9.call(e,t)&&vb(r,t,e[t]);return r},eM=(r,e)=>J9(r,Y9(e));function tM(r){if(r)return{"--w3m-font-family":r["--wcm-font-family"],"--w3m-accent":r["--wcm-accent-color"],"--w3m-color-mix":r["--wcm-background-color"],"--w3m-z-index":r["--wcm-z-index"]?Number(r["--wcm-z-index"]):void 0,"--w3m-qr-color":r["--wcm-accent-color"],"--w3m-font-size-master":r["--wcm-text-medium-regular-size"],"--w3m-border-radius-master":r["--wcm-container-border-radius"],"--w3m-color-mix-strength":0}}const rM=r=>{const[e,t]=r.split(":");return mA({id:t,caipNetworkId:r,chainNamespace:e,name:"",nativeCurrency:{name:"",symbol:"",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}})};function nM(r){var e,t,n,s,i,o,a;const c=(e=r.chains)==null?void 0:e.map(rM).filter(Boolean);if(c.length===0)throw new Error("At least one chain must be specified");const l=c.find(h=>{var f;return h.id===((f=r.defaultChain)==null?void 0:f.id)}),u={projectId:r.projectId,networks:c,themeMode:r.themeMode,themeVariables:tM(r.themeVariables),chainImages:r.chainImages,connectorImages:r.walletImages,defaultNetwork:l,metadata:eM(yA({},r.metadata),{name:((t=r.metadata)==null?void 0:t.name)||"WalletConnect",description:((n=r.metadata)==null?void 0:n.description)||"Connect to WalletConnect-compatible wallets",url:((s=r.metadata)==null?void 0:s.url)||"https://walletconnect.org",icons:((i=r.metadata)==null?void 0:i.icons)||["https://walletconnect.org/walletconnect-logo.png"]}),showWallets:!0,featuredWalletIds:r.explorerRecommendedWalletIds==="NONE"?[]:Array.isArray(r.explorerRecommendedWalletIds)?r.explorerRecommendedWalletIds:[],excludeWalletIds:r.explorerExcludedWalletIds==="ALL"?[]:Array.isArray(r.explorerExcludedWalletIds)?r.explorerExcludedWalletIds:[],enableEIP6963:!1,enableInjected:!1,enableCoinbase:!0,enableWalletConnect:!0,features:{email:!1,socials:!1}};if((o=r.mobileWallets)!=null&&o.length||(a=r.desktopWallets)!=null&&a.length){const h=[...(r.mobileWallets||[]).map(p=>({id:p.id,name:p.name,links:p.links})),...(r.desktopWallets||[]).map(p=>({id:p.id,name:p.name,links:{native:p.links.native,universal:p.links.universal}}))],f=[...u.featuredWalletIds||[],...u.excludeWalletIds||[]],d=h.filter(p=>!f.includes(p.id));d.length&&(u.customWallets=d)}return u}function mA(r){return yA({formatters:void 0,fees:void 0,serializers:void 0},r)}var sM=Object.freeze({__proto__:null,convertWCMToAppKitOptions:nM,defineChain:mA});async function iM(){const r=await Ng.init({projectId:"611536788e4297012ef34993004d5565",chains:[137,80001],showQrModal:!0});await r.enable();const e=new Fd(r),n=await(await e.getSigner()).getAddress();console.log("Connected:",n),document.getElementById("walletAddr").innerText=n,Eb(e,n),e.on("block",()=>Eb(e,n));const s=document.querySelector('meta[name="csrf-token"]').content,o=await(await fetch("/customer/wallet/save",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":s,Accept:"application/json"},body:JSON.stringify({wallet_address:n,user_id:window.USER_ID})})).json();o.ok&&o.redirect?window.location.href=o.redirect:(console.error("Save failed:",o),alert("Wallet save failed"))}async function Eb(r,e){try{const t=await r.getBalance(e),n=JA(t);document.getElementById("walletBalance").innerText=parseFloat(n).toFixed(4)+" MATIC"}catch(t){console.error("Balance fetch failed:",t),document.getElementById("walletBalance").innerText="Error"}}window.connectWalletConnect=iM;export{fM as $,X6 as A,eg as B,C_ as C,TB as D,Rt as E,rs as F,Zi as G,zs as H,io as I,Rh as J,Xr as K,Ar as L,Zr as M,nA as N,TO as O,Q0 as P,mE as Q,uM as R,A0 as S,Cv as T,Fa as U,SO as V,Ov as W,NO as X,hM as Y,lM as Z,yv as _,J as a,IO as a0,dM as a1,pM as a2,Ru as a3,gM as a4,Xp as a5,ts as b,sO as c,AP as d,Dc as e,xr as f,yl as g,T8 as h,x8 as i,M8 as j,N_ as k,cr as l,Nh as m,r6 as n,k6 as o,Mr as p,Sl as q,oo as r,ep as s,Gt as t,Og as u,zU as v,Pg as w,Uh as x,Wt as y,Jc as z};
