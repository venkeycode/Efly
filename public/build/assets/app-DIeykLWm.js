var HA=Object.defineProperty;var ny=r=>{throw TypeError(r)};var qA=(r,e,t)=>e in r?HA(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var F=(r,e,t)=>qA(r,typeof e!="symbol"?e+"":e,t),Xh=(r,e,t)=>e.has(r)||ny("Cannot "+t);var y=(r,e,t)=>(Xh(r,e,"read from private field"),t?t.call(r):e.get(r)),M=(r,e,t)=>e.has(r)?ny("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),O=(r,e,t,n)=>(Xh(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t),K=(r,e,t)=>(Xh(r,e,"access private method"),t);var ic=(r,e,t,n)=>({set _(s){O(r,e,s,t)},get _(){return y(r,e,n)}});const VA="6.15.0";function KA(r,e,t){const n=e.split("|").map(i=>i.trim());for(let i=0;i<n.length;i++)switch(e){case"any":return;case"bigint":case"boolean":case"number":case"string":if(typeof r===e)return}const s=new Error(`invalid value for type ${e}`);throw s.code="INVALID_ARGUMENT",s.argument=`value.${t}`,s.value=r,s}async function Bt(r){const e=Object.keys(r);return(await Promise.all(e.map(n=>Promise.resolve(r[n])))).reduce((n,s,i)=>(n[e[i]]=s,n),{})}function ie(r,e,t){for(let n in e){let s=e[n];const i=t?t[n]:null;i&&KA(s,i,n),Object.defineProperty(r,n,{enumerable:!0,value:s,writable:!1})}}function ko(r,e){if(r==null)return"null";if(e==null&&(e=new Set),typeof r=="object"){if(e.has(r))return"[Circular]";e.add(r)}if(Array.isArray(r))return"[ "+r.map(t=>ko(t,e)).join(", ")+" ]";if(r instanceof Uint8Array){const t="0123456789abcdef";let n="0x";for(let s=0;s<r.length;s++)n+=t[r[s]>>4],n+=t[r[s]&15];return n}if(typeof r=="object"&&typeof r.toJSON=="function")return ko(r.toJSON(),e);switch(typeof r){case"boolean":case"number":case"symbol":return r.toString();case"bigint":return BigInt(r).toString();case"string":return JSON.stringify(r);case"object":{const t=Object.keys(r);return t.sort(),"{ "+t.map(n=>`${ko(n,e)}: ${ko(r[n],e)}`).join(", ")+" }"}}return"[ COULD NOT SERIALIZE ]"}function ht(r,e){return r&&r.code===e}function Qp(r){return ht(r,"CALL_EXCEPTION")}function Re(r,e,t){let n=r;{const i=[];if(t){if("message"in t||"code"in t||"name"in t)throw new Error(`value will overwrite populated values: ${ko(t)}`);for(const o in t){if(o==="shortMessage")continue;const a=t[o];i.push(o+"="+ko(a))}}i.push(`code=${e}`),i.push(`version=${VA}`),i.length&&(r+=" ("+i.join(", ")+")")}let s;switch(e){case"INVALID_ARGUMENT":s=new TypeError(r);break;case"NUMERIC_FAULT":case"BUFFER_OVERRUN":s=new RangeError(r);break;default:s=new Error(r)}return ie(s,{code:e}),t&&Object.assign(s,t),s.shortMessage==null&&ie(s,{shortMessage:n}),s}function q(r,e,t,n){if(!r)throw Re(e,t,n)}function R(r,e,t,n){q(r,e,"INVALID_ARGUMENT",{argument:t,value:n})}function Lb(r,e,t){t==null&&(t=""),t&&(t=": "+t),q(r>=e,"missing argument"+t,"MISSING_ARGUMENT",{count:r,expectedCount:e}),q(r<=e,"too many arguments"+t,"UNEXPECTED_ARGUMENT",{count:r,expectedCount:e})}["NFD","NFC","NFKD","NFKC"].reduce((r,e)=>{try{if("test".normalize(e)!=="test")throw new Error("bad");if(e==="NFD"&&"é".normalize("NFD")!=="é")throw new Error("broken");r.push(e)}catch{}return r},[]);function bl(r,e,t){if(t==null&&(t=""),r!==e){let n=t,s="new";t&&(n+=".",s+=" "+t),q(!1,`private constructor; use ${n}from* methods`,"UNSUPPORTED_OPERATION",{operation:s})}}function Fb(r,e,t){if(r instanceof Uint8Array)return t?new Uint8Array(r):r;if(typeof r=="string"&&r.match(/^0x(?:[0-9a-f][0-9a-f])*$/i)){const n=new Uint8Array((r.length-2)/2);let s=2;for(let i=0;i<n.length;i++)n[i]=parseInt(r.substring(s,s+2),16),s+=2;return n}R(!1,"invalid BytesLike value",e||"value",r)}function ue(r,e){return Fb(r,e,!1)}function _t(r,e){return Fb(r,e,!0)}function _e(r,e){return!(typeof r!="string"||!r.match(/^0x[0-9A-Fa-f]*$/)||typeof e=="number"&&r.length!==2+2*e||e===!0&&r.length%2!==0)}function Wp(r){return _e(r,!0)||r instanceof Uint8Array}const sy="0123456789abcdef";function X(r){const e=ue(r);let t="0x";for(let n=0;n<e.length;n++){const s=e[n];t+=sy[(s&240)>>4]+sy[s&15]}return t}function Fe(r){return"0x"+r.map(e=>X(e).substring(2)).join("")}function Ko(r){return _e(r,!0)?(r.length-2)/2:ue(r).length}function Le(r,e,t){const n=ue(r);return t!=null&&t>n.length&&q(!1,"cannot slice beyond data bounds","BUFFER_OVERRUN",{buffer:n,length:n.length,offset:t}),X(n.slice(e??0,t??n.length))}function Mb(r,e,t){const n=ue(r);q(e>=n.length,"padding exceeds data length","BUFFER_OVERRUN",{buffer:new Uint8Array(n),length:e,offset:e+1});const s=new Uint8Array(e);return s.fill(0),t?s.set(n,e-n.length):s.set(n,0),X(s)}function as(r,e){return Mb(r,e,!0)}function GA(r,e){return Mb(r,e,!1)}const bh=BigInt(0),Kr=BigInt(1),$o=9007199254740991;function Tu(r,e){const t=vh(r,"value"),n=BigInt(oe(e,"width"));if(q(t>>n===bh,"overflow","NUMERIC_FAULT",{operation:"fromTwos",fault:"overflow",value:r}),t>>n-Kr){const s=(Kr<<n)-Kr;return-((~t&s)+Kr)}return t}function jb(r,e){let t=re(r,"value");const n=BigInt(oe(e,"width")),s=Kr<<n-Kr;if(t<bh){t=-t,q(t<=s,"too low","NUMERIC_FAULT",{operation:"toTwos",fault:"overflow",value:r});const i=(Kr<<n)-Kr;return(~t&i)+Kr}else q(t<s,"too high","NUMERIC_FAULT",{operation:"toTwos",fault:"overflow",value:r});return t}function Si(r,e){const t=vh(r,"value"),n=BigInt(oe(e,"bits"));return t&(Kr<<n)-Kr}function re(r,e){switch(typeof r){case"bigint":return r;case"number":return R(Number.isInteger(r),"underflow",e||"value",r),R(r>=-$o&&r<=$o,"overflow",e||"value",r),BigInt(r);case"string":try{if(r==="")throw new Error("empty string");return r[0]==="-"&&r[1]!=="-"?-BigInt(r.substring(1)):BigInt(r)}catch(t){R(!1,`invalid BigNumberish string: ${t.message}`,e||"value",r)}}R(!1,"invalid BigNumberish value",e||"value",r)}function vh(r,e){const t=re(r,e);return q(t>=bh,"unsigned value cannot be negative","NUMERIC_FAULT",{fault:"overflow",operation:"getUint",value:r}),t}const iy="0123456789abcdef";function Eh(r){if(r instanceof Uint8Array){let e="0x0";for(const t of r)e+=iy[t>>4],e+=iy[t&15];return BigInt(e)}return re(r)}function oe(r,e){switch(typeof r){case"bigint":return R(r>=-$o&&r<=$o,"overflow",e||"value",r),Number(r);case"number":return R(Number.isInteger(r),"underflow",e||"value",r),R(r>=-$o&&r<=$o,"overflow",e||"value",r),r;case"string":try{if(r==="")throw new Error("empty string");return oe(BigInt(r),e)}catch(t){R(!1,`invalid numeric string: ${t.message}`,e||"value",r)}}R(!1,"invalid numeric value",e||"value",r)}function QA(r){return oe(Eh(r))}function Xs(r,e){let n=vh(r,"value").toString(16);if(e==null)n.length%2&&(n="0"+n);else{const s=oe(e,"width");for(q(s*2>=n.length,`value exceeds width (${s} bytes)`,"NUMERIC_FAULT",{operation:"toBeHex",fault:"overflow",value:r});n.length<s*2;)n="0"+n}return"0x"+n}function Ze(r){const e=vh(r,"value");if(e===bh)return new Uint8Array([]);let t=e.toString(16);t.length%2&&(t="0"+t);const n=new Uint8Array(t.length/2);for(let s=0;s<n.length;s++){const i=s*2;n[s]=parseInt(t.substring(i,i+2),16)}return n}function qr(r){let e=X(Wp(r)?r:Ze(r)).substring(2);for(;e.startsWith("0");)e=e.substring(1);return e===""&&(e="0"),"0x"+e}const oy="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";BigInt(0);const ay=BigInt(58);function WA(r){const e=ue(r);let t=Eh(e),n="";for(;t;)n=oy[Number(t%ay)]+n,t/=ay;for(let s=0;s<e.length&&!e[s];s++)n=oy[0]+n;return n}function JA(r){r=atob(r);const e=new Uint8Array(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return ue(e)}function YA(r){const e=ue(r);let t="";for(let n=0;n<e.length;n++)t+=String.fromCharCode(e[n]);return btoa(t)}var ta;class zb{constructor(e,t,n){F(this,"filter");F(this,"emitter");M(this,ta);O(this,ta,t),ie(this,{emitter:e,filter:n})}async removeListener(){y(this,ta)!=null&&await this.emitter.off(this.filter,y(this,ta))}}ta=new WeakMap;function ZA(r,e,t,n,s){R(!1,`invalid codepoint at offset ${e}; ${r}`,"bytes",t)}function Hb(r,e,t,n,s){if(r==="BAD_PREFIX"||r==="UNEXPECTED_CONTINUE"){let i=0;for(let o=e+1;o<t.length&&t[o]>>6===2;o++)i++;return i}return r==="OVERRUN"?t.length-e-1:0}function XA(r,e,t,n,s){return r==="OVERLONG"?(R(typeof s=="number","invalid bad code point for replacement","badCodepoint",s),n.push(s),0):(n.push(65533),Hb(r,e,t))}const ex=Object.freeze({error:ZA,ignore:Hb,replace:XA});function tx(r,e){e==null&&(e=ex.error);const t=ue(r,"bytes"),n=[];let s=0;for(;s<t.length;){const i=t[s++];if(i>>7===0){n.push(i);continue}let o=null,a=null;if((i&224)===192)o=1,a=127;else if((i&240)===224)o=2,a=2047;else if((i&248)===240)o=3,a=65535;else{(i&192)===128?s+=e("UNEXPECTED_CONTINUE",s-1,t,n):s+=e("BAD_PREFIX",s-1,t,n);continue}if(s-1+o>=t.length){s+=e("OVERRUN",s-1,t,n);continue}let c=i&(1<<8-o-1)-1;for(let l=0;l<o;l++){let u=t[s];if((u&192)!=128){s+=e("MISSING_CONTINUE",s,t,n),c=null;break}c=c<<6|u&63,s++}if(c!==null){if(c>1114111){s+=e("OUT_OF_RANGE",s-1-o,t,n,c);continue}if(c>=55296&&c<=57343){s+=e("UTF16_SURROGATE",s-1-o,t,n,c);continue}if(c<=a){s+=e("OVERLONG",s-1-o,t,n,c);continue}n.push(c)}}return n}function rs(r,e){R(typeof r=="string","invalid string value","str",r);let t=[];for(let n=0;n<r.length;n++){const s=r.charCodeAt(n);if(s<128)t.push(s);else if(s<2048)t.push(s>>6|192),t.push(s&63|128);else if((s&64512)==55296){n++;const i=r.charCodeAt(n);R(n<r.length&&(i&64512)===56320,"invalid surrogate pair","str",r);const o=65536+((s&1023)<<10)+(i&1023);t.push(o>>18|240),t.push(o>>12&63|128),t.push(o>>6&63|128),t.push(o&63|128)}else t.push(s>>12|224),t.push(s>>6&63|128),t.push(s&63|128)}return new Uint8Array(t)}function rx(r){return r.map(e=>e<=65535?String.fromCharCode(e):(e-=65536,String.fromCharCode((e>>10&1023)+55296,(e&1023)+56320))).join("")}function Nu(r,e){return rx(tx(r,e))}function qb(r){async function e(t,n){q(n==null||!n.cancelled,"request cancelled before sending","CANCELLED");const s=t.url.split(":")[0].toLowerCase();q(s==="http"||s==="https",`unsupported protocol ${s}`,"UNSUPPORTED_OPERATION",{info:{protocol:s},operation:"request"}),q(s==="https"||!t.credentials||t.allowInsecureAuthentication,"insecure authorized connections unsupported","UNSUPPORTED_OPERATION",{operation:"request"});let i=null;const o=new AbortController,a=setTimeout(()=>{i=Re("request timeout","TIMEOUT"),o.abort()},t.timeout);n&&n.addListener(()=>{i=Re("request cancelled","CANCELLED"),o.abort()});const c=Object.assign({},r,{method:t.method,headers:new Headers(Array.from(t)),body:t.body||void 0,signal:o.signal});let l;try{l=await fetch(t.url,c)}catch(d){throw clearTimeout(a),i||d}clearTimeout(a);const u={};l.headers.forEach((d,p)=>{u[p.toLowerCase()]=d});const h=await l.arrayBuffer(),f=h==null?null:new Uint8Array(h);return{statusCode:l.status,statusMessage:l.statusText,headers:u,body:f}}return e}const nx=12,sx=250;let cy=qb();const ix=new RegExp("^data:([^;:]*)?(;base64)?,(.*)$","i"),ox=new RegExp("^ipfs://(ipfs/)?(.*)$","i");let ef=!1;async function Vb(r,e){try{const t=r.match(ix);if(!t)throw new Error("invalid data");return new Ys(200,"OK",{"content-type":t[1]||"text/plain"},t[2]?JA(t[3]):cx(t[3]))}catch{return new Ys(599,"BAD REQUEST (invalid data: URI)",{},null,new ei(r))}}function Kb(r){async function e(t,n){try{const s=t.match(ox);if(!s)throw new Error("invalid link");return new ei(`${r}${s[2]}`)}catch{return new Ys(599,"BAD REQUEST (invalid IPFS URI)",{},null,new ei(t))}}return e}const Fl={data:Vb,ipfs:Kb("https://gateway.ipfs.io/ipfs/")},Gb=new WeakMap;var Ni,Ns;class ax{constructor(e){M(this,Ni);M(this,Ns);O(this,Ni,[]),O(this,Ns,!1),Gb.set(e,()=>{if(!y(this,Ns)){O(this,Ns,!0);for(const t of y(this,Ni))setTimeout(()=>{t()},0);O(this,Ni,[])}})}addListener(e){q(!y(this,Ns),"singal already cancelled","UNSUPPORTED_OPERATION",{operation:"fetchCancelSignal.addCancelListener"}),y(this,Ni).push(e)}get cancelled(){return y(this,Ns)}checkSignal(){q(!this.cancelled,"cancelled","CANCELLED",{})}}Ni=new WeakMap,Ns=new WeakMap;function Ml(r){if(r==null)throw new Error("missing signal; should not happen");return r.checkSignal(),r}var ra,na,Lr,zn,sa,ia,tt,sr,Hn,Ri,Ui,ki,cn,Fr,Rs,$i,Oc;const fh=class fh{constructor(e){M(this,$i);M(this,ra);M(this,na);M(this,Lr);M(this,zn);M(this,sa);M(this,ia);M(this,tt);M(this,sr);M(this,Hn);M(this,Ri);M(this,Ui);M(this,ki);M(this,cn);M(this,Fr);M(this,Rs);O(this,ia,String(e)),O(this,ra,!1),O(this,na,!0),O(this,Lr,{}),O(this,zn,""),O(this,sa,3e5),O(this,Fr,{slotInterval:sx,maxAttempts:nx}),O(this,Rs,null)}get url(){return y(this,ia)}set url(e){O(this,ia,String(e))}get body(){return y(this,tt)==null?null:new Uint8Array(y(this,tt))}set body(e){if(e==null)O(this,tt,void 0),O(this,sr,void 0);else if(typeof e=="string")O(this,tt,rs(e)),O(this,sr,"text/plain");else if(e instanceof Uint8Array)O(this,tt,e),O(this,sr,"application/octet-stream");else if(typeof e=="object")O(this,tt,rs(JSON.stringify(e))),O(this,sr,"application/json");else throw new Error("invalid body")}hasBody(){return y(this,tt)!=null}get method(){return y(this,zn)?y(this,zn):this.hasBody()?"POST":"GET"}set method(e){e==null&&(e=""),O(this,zn,String(e).toUpperCase())}get headers(){const e=Object.assign({},y(this,Lr));return y(this,Hn)&&(e.authorization=`Basic ${YA(rs(y(this,Hn)))}`),this.allowGzip&&(e["accept-encoding"]="gzip"),e["content-type"]==null&&y(this,sr)&&(e["content-type"]=y(this,sr)),this.body&&(e["content-length"]=String(this.body.length)),e}getHeader(e){return this.headers[e.toLowerCase()]}setHeader(e,t){y(this,Lr)[String(e).toLowerCase()]=String(t)}clearHeaders(){O(this,Lr,{})}[Symbol.iterator](){const e=this.headers,t=Object.keys(e);let n=0;return{next:()=>{if(n<t.length){const s=t[n++];return{value:[s,e[s]],done:!1}}return{value:void 0,done:!0}}}}get credentials(){return y(this,Hn)||null}setCredentials(e,t){R(!e.match(/:/),"invalid basic authentication username","username","[REDACTED]"),O(this,Hn,`${e}:${t}`)}get allowGzip(){return y(this,na)}set allowGzip(e){O(this,na,!!e)}get allowInsecureAuthentication(){return!!y(this,ra)}set allowInsecureAuthentication(e){O(this,ra,!!e)}get timeout(){return y(this,sa)}set timeout(e){R(e>=0,"timeout must be non-zero","timeout",e),O(this,sa,e)}get preflightFunc(){return y(this,Ri)||null}set preflightFunc(e){O(this,Ri,e)}get processFunc(){return y(this,Ui)||null}set processFunc(e){O(this,Ui,e)}get retryFunc(){return y(this,ki)||null}set retryFunc(e){O(this,ki,e)}get getUrlFunc(){return y(this,Rs)||cy}set getUrlFunc(e){O(this,Rs,e)}toString(){return`<FetchRequest method=${JSON.stringify(this.method)} url=${JSON.stringify(this.url)} headers=${JSON.stringify(this.headers)} body=${y(this,tt)?X(y(this,tt)):"null"}>`}setThrottleParams(e){e.slotInterval!=null&&(y(this,Fr).slotInterval=e.slotInterval),e.maxAttempts!=null&&(y(this,Fr).maxAttempts=e.maxAttempts)}send(){return q(y(this,cn)==null,"request already sent","UNSUPPORTED_OPERATION",{operation:"fetchRequest.send"}),O(this,cn,new ax(this)),K(this,$i,Oc).call(this,0,ly()+this.timeout,0,this,new Ys(0,"",{},null,this))}cancel(){q(y(this,cn)!=null,"request has not been sent","UNSUPPORTED_OPERATION",{operation:"fetchRequest.cancel"});const e=Gb.get(this);if(!e)throw new Error("missing signal; should not happen");e()}redirect(e){const t=this.url.split(":")[0].toLowerCase(),n=e.split(":")[0].toLowerCase();q(this.method==="GET"&&(t!=="https"||n!=="http")&&e.match(/^https?:/),"unsupported redirect","UNSUPPORTED_OPERATION",{operation:`redirect(${this.method} ${JSON.stringify(this.url)} => ${JSON.stringify(e)})`});const s=new fh(e);return s.method="GET",s.allowGzip=this.allowGzip,s.timeout=this.timeout,O(s,Lr,Object.assign({},y(this,Lr))),y(this,tt)&&O(s,tt,new Uint8Array(y(this,tt))),O(s,sr,y(this,sr)),s}clone(){const e=new fh(this.url);return O(e,zn,y(this,zn)),y(this,tt)&&O(e,tt,y(this,tt)),O(e,sr,y(this,sr)),O(e,Lr,Object.assign({},y(this,Lr))),O(e,Hn,y(this,Hn)),this.allowGzip&&(e.allowGzip=!0),e.timeout=this.timeout,this.allowInsecureAuthentication&&(e.allowInsecureAuthentication=!0),O(e,Ri,y(this,Ri)),O(e,Ui,y(this,Ui)),O(e,ki,y(this,ki)),O(e,Fr,Object.assign({},y(this,Fr))),O(e,Rs,y(this,Rs)),e}static lockConfig(){ef=!0}static getGateway(e){return Fl[e.toLowerCase()]||null}static registerGateway(e,t){if(e=e.toLowerCase(),e==="http"||e==="https")throw new Error(`cannot intercept ${e}; use registerGetUrl`);if(ef)throw new Error("gateways locked");Fl[e]=t}static registerGetUrl(e){if(ef)throw new Error("gateways locked");cy=e}static createGetUrlFunc(e){return qb(e)}static createDataGateway(){return Vb}static createIpfsGatewayFunc(e){return Kb(e)}};ra=new WeakMap,na=new WeakMap,Lr=new WeakMap,zn=new WeakMap,sa=new WeakMap,ia=new WeakMap,tt=new WeakMap,sr=new WeakMap,Hn=new WeakMap,Ri=new WeakMap,Ui=new WeakMap,ki=new WeakMap,cn=new WeakMap,Fr=new WeakMap,Rs=new WeakMap,$i=new WeakSet,Oc=async function(e,t,n,s,i){var u,h,f;if(e>=y(this,Fr).maxAttempts)return i.makeServerError("exceeded maximum retry limit");q(ly()<=t,"timeout","TIMEOUT",{operation:"request.send",reason:"timeout",request:s}),n>0&&await lx(n);let o=this.clone();const a=(o.url.split(":")[0]||"").toLowerCase();if(a in Fl){const d=await Fl[a](o.url,Ml(y(s,cn)));if(d instanceof Ys){let p=d;if(this.processFunc){Ml(y(s,cn));try{p=await this.processFunc(o,p)}catch(g){(g.throttle==null||typeof g.stall!="number")&&p.makeServerError("error in post-processing function",g).assertOk()}}return p}o=d}this.preflightFunc&&(o=await this.preflightFunc(o));const c=await this.getUrlFunc(o,Ml(y(s,cn)));let l=new Ys(c.statusCode,c.statusMessage,c.headers,c.body,s);if(l.statusCode===301||l.statusCode===302){try{const d=l.headers.location||"";return K(u=o.redirect(d),$i,Oc).call(u,e+1,t,0,s,l)}catch{}return l}else if(l.statusCode===429&&(this.retryFunc==null||await this.retryFunc(o,l,e))){const d=l.headers["retry-after"];let p=y(this,Fr).slotInterval*Math.trunc(Math.random()*Math.pow(2,e));return typeof d=="string"&&d.match(/^[1-9][0-9]*$/)&&(p=parseInt(d)),K(h=o.clone(),$i,Oc).call(h,e+1,t,p,s,l)}if(this.processFunc){Ml(y(s,cn));try{l=await this.processFunc(o,l)}catch(d){(d.throttle==null||typeof d.stall!="number")&&l.makeServerError("error in post-processing function",d).assertOk();let p=y(this,Fr).slotInterval*Math.trunc(Math.random()*Math.pow(2,e));return d.stall>=0&&(p=d.stall),K(f=o.clone(),$i,Oc).call(f,e+1,t,p,s,l)}}return l};let ei=fh;var al,cl,ll,ir,oa,Li;const Gg=class Gg{constructor(e,t,n,s,i){M(this,al);M(this,cl);M(this,ll);M(this,ir);M(this,oa);M(this,Li);O(this,al,e),O(this,cl,t),O(this,ll,Object.keys(n).reduce((o,a)=>(o[a.toLowerCase()]=String(n[a]),o),{})),O(this,ir,s==null?null:new Uint8Array(s)),O(this,oa,i||null),O(this,Li,{message:""})}toString(){return`<FetchResponse status=${this.statusCode} body=${y(this,ir)?X(y(this,ir)):"null"}>`}get statusCode(){return y(this,al)}get statusMessage(){return y(this,cl)}get headers(){return Object.assign({},y(this,ll))}get body(){return y(this,ir)==null?null:new Uint8Array(y(this,ir))}get bodyText(){try{return y(this,ir)==null?"":Nu(y(this,ir))}catch{q(!1,"response body is not valid UTF-8 data","UNSUPPORTED_OPERATION",{operation:"bodyText",info:{response:this}})}}get bodyJson(){try{return JSON.parse(this.bodyText)}catch{q(!1,"response body is not valid JSON","UNSUPPORTED_OPERATION",{operation:"bodyJson",info:{response:this}})}}[Symbol.iterator](){const e=this.headers,t=Object.keys(e);let n=0;return{next:()=>{if(n<t.length){const s=t[n++];return{value:[s,e[s]],done:!1}}return{value:void 0,done:!0}}}}makeServerError(e,t){let n;e?n=`CLIENT ESCALATED SERVER ERROR (${this.statusCode} ${this.statusMessage}; ${e})`:(e=`${this.statusCode} ${this.statusMessage}`,n=`CLIENT ESCALATED SERVER ERROR (${e})`);const s=new Gg(599,n,this.headers,this.body,y(this,oa)||void 0);return O(s,Li,{message:e,error:t}),s}throwThrottleError(e,t){t==null?t=-1:R(Number.isInteger(t)&&t>=0,"invalid stall timeout","stall",t);const n=new Error(e||"throttling requests");throw ie(n,{stall:t,throttle:!0}),n}getHeader(e){return this.headers[e.toLowerCase()]}hasBody(){return y(this,ir)!=null}get request(){return y(this,oa)}ok(){return y(this,Li).message===""&&this.statusCode>=200&&this.statusCode<300}assertOk(){if(this.ok())return;let{message:e,error:t}=y(this,Li);e===""&&(e=`server response ${this.statusCode} ${this.statusMessage}`);let n=null;this.request&&(n=this.request.url);let s=null;try{y(this,ir)&&(s=Nu(y(this,ir)))}catch{}q(!1,e,"SERVER_ERROR",{request:this.request||"unknown request",response:this,error:t,info:{requestUrl:n,responseBody:s,responseStatus:`${this.statusCode} ${this.statusMessage}`}})}};al=new WeakMap,cl=new WeakMap,ll=new WeakMap,ir=new WeakMap,oa=new WeakMap,Li=new WeakMap;let Ys=Gg;function ly(){return new Date().getTime()}function cx(r){return rs(r.replace(/%([0-9a-f][0-9a-f])/gi,(e,t)=>String.fromCharCode(parseInt(t,16))))}function lx(r){return new Promise(e=>setTimeout(e,r))}const ux=BigInt(-1),Rr=BigInt(0),Lo=BigInt(1),hx=BigInt(5),vo={};let Go="0000";for(;Go.length<80;)Go+=Go;function ai(r){let e=Go;for(;e.length<r;)e+=e;return BigInt("1"+e.substring(0,r))}function oc(r,e,t){const n=BigInt(e.width);if(e.signed){const s=Lo<<n-Lo;q(t==null||r>=-s&&r<s,"overflow","NUMERIC_FAULT",{operation:t,fault:"overflow",value:r}),r>Rr?r=Tu(Si(r,n),n):r=-Tu(Si(-r,n),n)}else{const s=Lo<<n;q(t==null||r>=0&&r<s,"overflow","NUMERIC_FAULT",{operation:t,fault:"overflow",value:r}),r=(r%s+s)%s&s-Lo}return r}function tf(r){typeof r=="number"&&(r=`fixed128x${r}`);let e=!0,t=128,n=18;if(typeof r=="string"){if(r!=="fixed")if(r==="ufixed")e=!1;else{const i=r.match(/^(u?)fixed([0-9]+)x([0-9]+)$/);R(i,"invalid fixed format","format",r),e=i[1]!=="u",t=parseInt(i[2]),n=parseInt(i[3])}}else if(r){const i=r,o=(a,c,l)=>i[a]==null?l:(R(typeof i[a]===c,"invalid fixed format ("+a+" not "+c+")","format."+a,i[a]),i[a]);e=o("signed","boolean",e),t=o("width","number",t),n=o("decimals","number",n)}R(t%8===0,"invalid FixedNumber width (not byte aligned)","format.width",t),R(n<=80,"invalid FixedNumber decimals (too large)","format.decimals",n);const s=(e?"":"u")+"fixed"+String(t)+"x"+String(n);return{signed:e,width:t,decimals:n,name:s}}function fx(r,e){let t="";r<Rr&&(t="-",r*=ux);let n=r.toString();if(e===0)return t+n;for(;n.length<=e;)n=Go+n;const s=n.length-e;for(n=n.substring(0,s)+"."+n.substring(s);n[0]==="0"&&n[1]!==".";)n=n.substring(1);for(;n[n.length-1]==="0"&&n[n.length-2]!==".";)n=n.substring(0,n.length-1);return t+n}var Mr,Pe,Dt,xe,di,Un,md,wd,bd,vd;const Bs=class Bs{constructor(e,t,n){M(this,xe);F(this,"format");M(this,Mr);M(this,Pe);M(this,Dt);F(this,"_value");bl(e,vo,"FixedNumber"),O(this,Pe,t),O(this,Mr,n);const s=fx(t,n.decimals);ie(this,{format:n.name,_value:s}),O(this,Dt,ai(n.decimals))}get signed(){return y(this,Mr).signed}get width(){return y(this,Mr).width}get decimals(){return y(this,Mr).decimals}get value(){return y(this,Pe)}addUnsafe(e){return K(this,xe,md).call(this,e)}add(e){return K(this,xe,md).call(this,e,"add")}subUnsafe(e){return K(this,xe,wd).call(this,e)}sub(e){return K(this,xe,wd).call(this,e,"sub")}mulUnsafe(e){return K(this,xe,bd).call(this,e)}mul(e){return K(this,xe,bd).call(this,e,"mul")}mulSignal(e){K(this,xe,di).call(this,e);const t=y(this,Pe)*y(e,Pe);return q(t%y(this,Dt)===Rr,"precision lost during signalling mul","NUMERIC_FAULT",{operation:"mulSignal",fault:"underflow",value:this}),K(this,xe,Un).call(this,t/y(this,Dt),"mulSignal")}divUnsafe(e){return K(this,xe,vd).call(this,e)}div(e){return K(this,xe,vd).call(this,e,"div")}divSignal(e){q(y(e,Pe)!==Rr,"division by zero","NUMERIC_FAULT",{operation:"div",fault:"divide-by-zero",value:this}),K(this,xe,di).call(this,e);const t=y(this,Pe)*y(this,Dt);return q(t%y(e,Pe)===Rr,"precision lost during signalling div","NUMERIC_FAULT",{operation:"divSignal",fault:"underflow",value:this}),K(this,xe,Un).call(this,t/y(e,Pe),"divSignal")}cmp(e){let t=this.value,n=e.value;const s=this.decimals-e.decimals;return s>0?n*=ai(s):s<0&&(t*=ai(-s)),t<n?-1:t>n?1:0}eq(e){return this.cmp(e)===0}lt(e){return this.cmp(e)<0}lte(e){return this.cmp(e)<=0}gt(e){return this.cmp(e)>0}gte(e){return this.cmp(e)>=0}floor(){let e=y(this,Pe);return y(this,Pe)<Rr&&(e-=y(this,Dt)-Lo),e=y(this,Pe)/y(this,Dt)*y(this,Dt),K(this,xe,Un).call(this,e,"floor")}ceiling(){let e=y(this,Pe);return y(this,Pe)>Rr&&(e+=y(this,Dt)-Lo),e=y(this,Pe)/y(this,Dt)*y(this,Dt),K(this,xe,Un).call(this,e,"ceiling")}round(e){if(e==null&&(e=0),e>=this.decimals)return this;const t=this.decimals-e,n=hx*ai(t-1);let s=this.value+n;const i=ai(t);return s=s/i*i,oc(s,y(this,Mr),"round"),new Bs(vo,s,y(this,Mr))}isZero(){return y(this,Pe)===Rr}isNegative(){return y(this,Pe)<Rr}toString(){return this._value}toUnsafeFloat(){return parseFloat(this.toString())}toFormat(e){return Bs.fromString(this.toString(),e)}static fromValue(e,t,n){const s=t==null?0:oe(t),i=tf(n);let o=re(e,"value");const a=s-i.decimals;if(a>0){const c=ai(a);q(o%c===Rr,"value loses precision for format","NUMERIC_FAULT",{operation:"fromValue",fault:"underflow",value:e}),o/=c}else a<0&&(o*=ai(-a));return oc(o,i,"fromValue"),new Bs(vo,o,i)}static fromString(e,t){const n=e.match(/^(-?)([0-9]*)\.?([0-9]*)$/);R(n&&n[2].length+n[3].length>0,"invalid FixedNumber string value","value",e);const s=tf(t);let i=n[2]||"0",o=n[3]||"";for(;o.length<s.decimals;)o+=Go;q(o.substring(s.decimals).match(/^0*$/),"too many decimals for format","NUMERIC_FAULT",{operation:"fromString",fault:"underflow",value:e}),o=o.substring(0,s.decimals);const a=BigInt(n[1]+i+o);return oc(a,s,"fromString"),new Bs(vo,a,s)}static fromBytes(e,t){let n=Eh(ue(e,"value"));const s=tf(t);return s.signed&&(n=Tu(n,s.width)),oc(n,s,"fromBytes"),new Bs(vo,n,s)}};Mr=new WeakMap,Pe=new WeakMap,Dt=new WeakMap,xe=new WeakSet,di=function(e){R(this.format===e.format,"incompatible format; use fixedNumber.toFormat","other",e)},Un=function(e,t){return e=oc(e,y(this,Mr),t),new Bs(vo,e,y(this,Mr))},md=function(e,t){return K(this,xe,di).call(this,e),K(this,xe,Un).call(this,y(this,Pe)+y(e,Pe),t)},wd=function(e,t){return K(this,xe,di).call(this,e),K(this,xe,Un).call(this,y(this,Pe)-y(e,Pe),t)},bd=function(e,t){return K(this,xe,di).call(this,e),K(this,xe,Un).call(this,y(this,Pe)*y(e,Pe)/y(this,Dt),t)},vd=function(e,t){return q(y(e,Pe)!==Rr,"division by zero","NUMERIC_FAULT",{operation:"div",fault:"divide-by-zero",value:this}),K(this,xe,di).call(this,e),K(this,xe,Un).call(this,y(this,Pe)*y(this,Dt)/y(e,Pe),t)};let Ru=Bs;function dx(r){let e=r.toString(16);for(;e.length<2;)e="0"+e;return"0x"+e}function uy(r,e,t){let n=0;for(let s=0;s<t;s++)n=n*256+r[e+s];return n}function hy(r,e,t,n){const s=[];for(;t<e+1+n;){const i=Qb(r,t);s.push(i.result),t+=i.consumed,q(t<=e+1+n,"child data too short","BUFFER_OVERRUN",{buffer:r,length:n,offset:e})}return{consumed:1+n,result:s}}function Qb(r,e){q(r.length!==0,"data too short","BUFFER_OVERRUN",{buffer:r,length:0,offset:1});const t=n=>{q(n<=r.length,"data short segment too short","BUFFER_OVERRUN",{buffer:r,length:r.length,offset:n})};if(r[e]>=248){const n=r[e]-247;t(e+1+n);const s=uy(r,e+1,n);return t(e+1+n+s),hy(r,e,e+1+n,n+s)}else if(r[e]>=192){const n=r[e]-192;return t(e+1+n),hy(r,e,e+1,n)}else if(r[e]>=184){const n=r[e]-183;t(e+1+n);const s=uy(r,e+1,n);t(e+1+n+s);const i=X(r.slice(e+1+n,e+1+n+s));return{consumed:1+n+s,result:i}}else if(r[e]>=128){const n=r[e]-128;t(e+1+n);const s=X(r.slice(e+1,e+1+n));return{consumed:1+n,result:s}}return{consumed:1,result:dx(r[e])}}function vl(r){const e=ue(r,"data"),t=Qb(e,0);return R(t.consumed===e.length,"unexpected junk after rlp payload","data",r),t.result}function fy(r){const e=[];for(;r;)e.unshift(r&255),r>>=8;return e}function Wb(r){if(Array.isArray(r)){let n=[];if(r.forEach(function(i){n=n.concat(Wb(i))}),n.length<=55)return n.unshift(192+n.length),n;const s=fy(n.length);return s.unshift(247+s.length),s.concat(n)}const e=Array.prototype.slice.call(ue(r,"object"));if(e.length===1&&e[0]<=127)return e;if(e.length<=55)return e.unshift(128+e.length),e;const t=fy(e.length);return t.unshift(183+t.length),t.concat(e)}const dy="0123456789abcdef";function ti(r){let e="0x";for(const t of Wb(r))e+=dy[t>>4],e+=dy[t&15];return e}const Jb=["wei","kwei","mwei","gwei","szabo","finney","ether"];function Yb(r,e){let t=18;if(typeof e=="string"){const n=Jb.indexOf(e);R(n>=0,"invalid unit","unit",e),t=3*n}else e!=null&&(t=oe(e,"unit"));return Ru.fromValue(r,t,{decimals:t,width:512}).toString()}function rf(r,e){R(typeof r=="string","value must be a string","value",r);let t=18;if(typeof e=="string"){const n=Jb.indexOf(e);R(n>=0,"invalid unit","unit",e),t=3*n}else e!=null&&(t=oe(e,"unit"));return Ru.fromString(r,{decimals:t,width:512}).value}function py(r){return Yb(r,18)}const Tt=32,Ed=new Uint8Array(Tt),px=["then"],jl={},Zb=new WeakMap;function mi(r){return Zb.get(r)}function gy(r,e){Zb.set(r,e)}function ac(r,e){const t=new Error(`deferred error during ABI decoding triggered accessing ${r}`);throw t.error=e,t}function Ad(r,e,t){return r.indexOf(null)>=0?e.map((n,s)=>n instanceof ja?Ad(mi(n),n,t):n):r.reduce((n,s,i)=>{let o=e.getValue(s);return s in n||(t&&o instanceof ja&&(o=Ad(mi(o),o,t)),n[s]=o),n},{})}var aa;const Ho=class Ho extends Array{constructor(...t){const n=t[0];let s=t[1],i=(t[2]||[]).slice(),o=!0;n!==jl&&(s=t,i=[],o=!1);super(s.length);M(this,aa);s.forEach((l,u)=>{this[u]=l});const a=i.reduce((l,u)=>(typeof u=="string"&&l.set(u,(l.get(u)||0)+1),l),new Map);if(gy(this,Object.freeze(s.map((l,u)=>{const h=i[u];return h!=null&&a.get(h)===1?h:null}))),O(this,aa,[]),y(this,aa)==null&&y(this,aa),!o)return;Object.freeze(this);const c=new Proxy(this,{get:(l,u,h)=>{if(typeof u=="string"){if(u.match(/^[0-9]+$/)){const d=oe(u,"%index");if(d<0||d>=this.length)throw new RangeError("out of result range");const p=l[d];return p instanceof Error&&ac(`index ${d}`,p),p}if(px.indexOf(u)>=0)return Reflect.get(l,u,h);const f=l[u];if(f instanceof Function)return function(...d){return f.apply(this===h?l:this,d)};if(!(u in l))return l.getValue.apply(this===h?l:this,[u])}return Reflect.get(l,u,h)}});return gy(c,mi(this)),c}toArray(t){const n=[];return this.forEach((s,i)=>{s instanceof Error&&ac(`index ${i}`,s),t&&s instanceof Ho&&(s=s.toArray(t)),n.push(s)}),n}toObject(t){const n=mi(this);return n.reduce((s,i,o)=>(q(i!=null,`value at index ${o} unnamed`,"UNSUPPORTED_OPERATION",{operation:"toObject()"}),Ad(n,this,t)),{})}slice(t,n){t==null&&(t=0),t<0&&(t+=this.length,t<0&&(t=0)),n==null&&(n=this.length),n<0&&(n+=this.length,n<0&&(n=0)),n>this.length&&(n=this.length);const s=mi(this),i=[],o=[];for(let a=t;a<n;a++)i.push(this[a]),o.push(s[a]);return new Ho(jl,i,o)}filter(t,n){const s=mi(this),i=[],o=[];for(let a=0;a<this.length;a++){const c=this[a];c instanceof Error&&ac(`index ${a}`,c),t.call(n,c,a,this)&&(i.push(c),o.push(s[a]))}return new Ho(jl,i,o)}map(t,n){const s=[];for(let i=0;i<this.length;i++){const o=this[i];o instanceof Error&&ac(`index ${i}`,o),s.push(t.call(n,o,i,this))}return s}getValue(t){const n=mi(this).indexOf(t);if(n===-1)return;const s=this[n];return s instanceof Error&&ac(`property ${JSON.stringify(t)}`,s.error),s}static fromItems(t,n){return new Ho(jl,t,n)}};aa=new WeakMap;let ja=Ho;function yy(r){let e=Ze(r);return q(e.length<=Tt,"value out-of-bounds","BUFFER_OVERRUN",{buffer:e,length:Tt,offset:e.length}),e.length!==Tt&&(e=_t(Fe([Ed.slice(e.length%Tt),e]))),e}class fs{constructor(e,t,n,s){F(this,"name");F(this,"type");F(this,"localName");F(this,"dynamic");ie(this,{name:e,type:t,localName:n,dynamic:s},{name:"string",type:"string",localName:"string",dynamic:"boolean"})}_throwError(e,t){R(!1,e,this.localName,t)}}var qn,Fi,ca,pu;class xd{constructor(){M(this,ca);M(this,qn);M(this,Fi);O(this,qn,[]),O(this,Fi,0)}get data(){return Fe(y(this,qn))}get length(){return y(this,Fi)}appendWriter(e){return K(this,ca,pu).call(this,_t(e.data))}writeBytes(e){let t=_t(e);const n=t.length%Tt;return n&&(t=_t(Fe([t,Ed.slice(n)]))),K(this,ca,pu).call(this,t)}writeValue(e){return K(this,ca,pu).call(this,yy(e))}writeUpdatableValue(){const e=y(this,qn).length;return y(this,qn).push(Ed),O(this,Fi,y(this,Fi)+Tt),t=>{y(this,qn)[e]=yy(t)}}}qn=new WeakMap,Fi=new WeakMap,ca=new WeakSet,pu=function(e){return y(this,qn).push(e),O(this,Fi,y(this,Fi)+e.length),e.length};var zt,or,Mi,ji,Us,uo,Sd,Xb;const Qg=class Qg{constructor(e,t,n){M(this,uo);F(this,"allowLoose");M(this,zt);M(this,or);M(this,Mi);M(this,ji);M(this,Us);ie(this,{allowLoose:!!t}),O(this,zt,_t(e)),O(this,Mi,0),O(this,ji,null),O(this,Us,n??1024),O(this,or,0)}get data(){return X(y(this,zt))}get dataLength(){return y(this,zt).length}get consumed(){return y(this,or)}get bytes(){return new Uint8Array(y(this,zt))}subReader(e){const t=new Qg(y(this,zt).slice(y(this,or)+e),this.allowLoose,y(this,Us));return O(t,ji,this),t}readBytes(e,t){let n=K(this,uo,Xb).call(this,0,e,!!t);return K(this,uo,Sd).call(this,e),O(this,or,y(this,or)+n.length),n.slice(0,e)}readValue(){return Eh(this.readBytes(Tt))}readIndex(){return QA(this.readBytes(Tt))}};zt=new WeakMap,or=new WeakMap,Mi=new WeakMap,ji=new WeakMap,Us=new WeakMap,uo=new WeakSet,Sd=function(e){var t;if(y(this,ji))return K(t=y(this,ji),uo,Sd).call(t,e);O(this,Mi,y(this,Mi)+e),q(y(this,Us)<1||y(this,Mi)<=y(this,Us)*this.dataLength,`compressed ABI data exceeds inflation ratio of ${y(this,Us)} ( see: https://github.com/ethers-io/ethers.js/issues/4537 )`,"BUFFER_OVERRUN",{buffer:_t(y(this,zt)),offset:y(this,or),length:e,info:{bytesRead:y(this,Mi),dataLength:this.dataLength}})},Xb=function(e,t,n){let s=Math.ceil(t/Tt)*Tt;return y(this,or)+s>y(this,zt).length&&(this.allowLoose&&n&&y(this,or)+t<=y(this,zt).length?s=t:q(!1,"data out-of-bounds","BUFFER_OVERRUN",{buffer:_t(y(this,zt)),length:y(this,zt).length,offset:y(this,or)+s})),y(this,zt).slice(y(this,or),y(this,or)+s)};let Id=Qg;function Uu(r){if(!Number.isSafeInteger(r)||r<0)throw new Error(`Wrong positive integer: ${r}`)}function Jp(r,...e){if(!(r instanceof Uint8Array))throw new Error("Expected Uint8Array");if(e.length>0&&!e.includes(r.length))throw new Error(`Expected Uint8Array of length ${e}, not of length=${r.length}`)}function gx(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.wrapConstructor");Uu(r.outputLen),Uu(r.blockLen)}function za(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function e1(r,e){Jp(r);const t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}const nf=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const t1=r=>r instanceof Uint8Array,yx=r=>new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4)),sf=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),Zr=(r,e)=>r<<32-e|r>>>e,mx=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;if(!mx)throw new Error("Non little-endian hardware is not supported");function wx(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function Ah(r){if(typeof r=="string"&&(r=wx(r)),!t1(r))throw new Error(`expected Uint8Array, got ${typeof r}`);return r}function bx(...r){const e=new Uint8Array(r.reduce((n,s)=>n+s.length,0));let t=0;return r.forEach(n=>{if(!t1(n))throw new Error("Uint8Array expected");e.set(n,t),t+=n.length}),e}let Yp=class{clone(){return this._cloneInto()}};function Zp(r){const e=n=>r().update(Ah(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function vx(r=32){if(nf&&typeof nf.getRandomValues=="function")return nf.getRandomValues(new Uint8Array(r));throw new Error("crypto.getRandomValues must be defined")}class r1 extends Yp{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,gx(e);const n=Ah(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,i=new Uint8Array(s);i.set(n.length>s?e.create().update(n).digest():n);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),i.fill(0)}update(e){return za(this),this.iHash.update(e),this}digestInto(e){za(this),Jp(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:s,destroyed:i,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=i,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const n1=(r,e,t)=>new r1(r,e).update(t).digest();n1.create=(r,e)=>new r1(r,e);function Ex(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(t>>s&i),a=Number(t&i),c=n?4:0,l=n?0:4;r.setUint32(e+c,o,n),r.setUint32(e+l,a,n)}class s1 extends Yp{constructor(e,t,n,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=sf(this.buffer)}update(e){za(this);const{view:t,buffer:n,blockLen:s}=this;e=Ah(e);const i=e.length;for(let o=0;o<i;){const a=Math.min(s-this.pos,i-o);if(a===s){const c=sf(e);for(;s<=i-o;o+=s)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){za(this),e1(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:s,isLE:i}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(n,0),o=0);for(let h=o;h<s;h++)t[h]=0;Ex(n,s-8,BigInt(this.length*8),i),this.process(n,0);const a=sf(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return e.length=s,e.pos=a,e.finished=i,e.destroyed=o,s%t&&e.buffer.set(n),e}}const Ax=(r,e,t)=>r&e^~r&t,xx=(r,e,t)=>r&e^r&t^e&t,Ix=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),ds=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),ps=new Uint32Array(64);class Sx extends s1{constructor(){super(64,32,8,!1),this.A=ds[0]|0,this.B=ds[1]|0,this.C=ds[2]|0,this.D=ds[3]|0,this.E=ds[4]|0,this.F=ds[5]|0,this.G=ds[6]|0,this.H=ds[7]|0}get(){const{A:e,B:t,C:n,D:s,E:i,F:o,G:a,H:c}=this;return[e,t,n,s,i,o,a,c]}set(e,t,n,s,i,o,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let h=0;h<16;h++,t+=4)ps[h]=e.getUint32(t,!1);for(let h=16;h<64;h++){const f=ps[h-15],d=ps[h-2],p=Zr(f,7)^Zr(f,18)^f>>>3,g=Zr(d,17)^Zr(d,19)^d>>>10;ps[h]=g+ps[h-7]+p+ps[h-16]|0}let{A:n,B:s,C:i,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){const f=Zr(a,6)^Zr(a,11)^Zr(a,25),d=u+f+Ax(a,c,l)+Ix[h]+ps[h]|0,g=(Zr(n,2)^Zr(n,13)^Zr(n,22))+xx(n,s,i)|0;u=l,l=c,c=a,a=o+d|0,o=i,i=s,s=n,n=d+g|0}n=n+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(n,s,i,o,a,c,l,u)}roundClean(){ps.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}}const i1=Zp(()=>new Sx),zl=BigInt(2**32-1),Pd=BigInt(32);function o1(r,e=!1){return e?{h:Number(r&zl),l:Number(r>>Pd&zl)}:{h:Number(r>>Pd&zl)|0,l:Number(r&zl)|0}}function a1(r,e=!1){let t=new Uint32Array(r.length),n=new Uint32Array(r.length);for(let s=0;s<r.length;s++){const{h:i,l:o}=o1(r[s],e);[t[s],n[s]]=[i,o]}return[t,n]}const Px=(r,e)=>BigInt(r>>>0)<<Pd|BigInt(e>>>0),Ox=(r,e,t)=>r>>>t,Dx=(r,e,t)=>r<<32-t|e>>>t,Cx=(r,e,t)=>r>>>t|e<<32-t,Bx=(r,e,t)=>r<<32-t|e>>>t,_x=(r,e,t)=>r<<64-t|e>>>t-32,Tx=(r,e,t)=>r>>>t-32|e<<64-t,Nx=(r,e)=>e,Rx=(r,e)=>r,c1=(r,e,t)=>r<<t|e>>>32-t,l1=(r,e,t)=>e<<t|r>>>32-t,u1=(r,e,t)=>e<<t-32|r>>>64-t,h1=(r,e,t)=>r<<t-32|e>>>64-t;function Ux(r,e,t,n){const s=(e>>>0)+(n>>>0);return{h:r+t+(s/2**32|0)|0,l:s|0}}const kx=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),$x=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,Lx=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),Fx=(r,e,t,n,s)=>e+t+n+s+(r/2**32|0)|0,Mx=(r,e,t,n,s)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(s>>>0),jx=(r,e,t,n,s,i)=>e+t+n+s+i+(r/2**32|0)|0,ae={fromBig:o1,split:a1,toBig:Px,shrSH:Ox,shrSL:Dx,rotrSH:Cx,rotrSL:Bx,rotrBH:_x,rotrBL:Tx,rotr32H:Nx,rotr32L:Rx,rotlSH:c1,rotlSL:l1,rotlBH:u1,rotlBL:h1,add:Ux,add3L:kx,add3H:$x,add4L:Lx,add4H:Fx,add5H:jx,add5L:Mx},[zx,Hx]=ae.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),gs=new Uint32Array(80),ys=new Uint32Array(80);class qx extends s1{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:n,Bl:s,Ch:i,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:f,Gh:d,Gl:p,Hh:g,Hl:m}=this;return[e,t,n,s,i,o,a,c,l,u,h,f,d,p,g,m]}set(e,t,n,s,i,o,a,c,l,u,h,f,d,p,g,m){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=f|0,this.Gh=d|0,this.Gl=p|0,this.Hh=g|0,this.Hl=m|0}process(e,t){for(let v=0;v<16;v++,t+=4)gs[v]=e.getUint32(t),ys[v]=e.getUint32(t+=4);for(let v=16;v<80;v++){const I=gs[v-15]|0,S=ys[v-15]|0,E=ae.rotrSH(I,S,1)^ae.rotrSH(I,S,8)^ae.shrSH(I,S,7),P=ae.rotrSL(I,S,1)^ae.rotrSL(I,S,8)^ae.shrSL(I,S,7),D=gs[v-2]|0,B=ys[v-2]|0,L=ae.rotrSH(D,B,19)^ae.rotrBH(D,B,61)^ae.shrSH(D,B,6),j=ae.rotrSL(D,B,19)^ae.rotrBL(D,B,61)^ae.shrSL(D,B,6),$=ae.add4L(P,j,ys[v-7],ys[v-16]),U=ae.add4H($,E,L,gs[v-7],gs[v-16]);gs[v]=U|0,ys[v]=$|0}let{Ah:n,Al:s,Bh:i,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:f,Fh:d,Fl:p,Gh:g,Gl:m,Hh:b,Hl:x}=this;for(let v=0;v<80;v++){const I=ae.rotrSH(h,f,14)^ae.rotrSH(h,f,18)^ae.rotrBH(h,f,41),S=ae.rotrSL(h,f,14)^ae.rotrSL(h,f,18)^ae.rotrBL(h,f,41),E=h&d^~h&g,P=f&p^~f&m,D=ae.add5L(x,S,P,Hx[v],ys[v]),B=ae.add5H(D,b,I,E,zx[v],gs[v]),L=D|0,j=ae.rotrSH(n,s,28)^ae.rotrBH(n,s,34)^ae.rotrBH(n,s,39),$=ae.rotrSL(n,s,28)^ae.rotrBL(n,s,34)^ae.rotrBL(n,s,39),U=n&i^n&a^i&a,T=s&o^s&c^o&c;b=g|0,x=m|0,g=d|0,m=p|0,d=h|0,p=f|0,{h,l:f}=ae.add(l|0,u|0,B|0,L|0),l=a|0,u=c|0,a=i|0,c=o|0,i=n|0,o=s|0;const w=ae.add3L(L,$,T);n=ae.add3H(w,B,j,U),s=w|0}({h:n,l:s}=ae.add(this.Ah|0,this.Al|0,n|0,s|0)),{h:i,l:o}=ae.add(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=ae.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=ae.add(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:f}=ae.add(this.Eh|0,this.El|0,h|0,f|0),{h:d,l:p}=ae.add(this.Fh|0,this.Fl|0,d|0,p|0),{h:g,l:m}=ae.add(this.Gh|0,this.Gl|0,g|0,m|0),{h:b,l:x}=ae.add(this.Hh|0,this.Hl|0,b|0,x|0),this.set(n,s,i,o,a,c,l,u,h,f,d,p,g,m,b,x)}roundClean(){gs.fill(0),ys.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const Vx=Zp(()=>new qx);function Kx(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")}const my=Kx();my.crypto||my.msCrypto;function Gx(r){switch(r){case"sha256":return i1.create();case"sha512":return Vx.create()}R(!1,"invalid hashing algorithm name","algorithm",r)}const[f1,d1,p1]=[[],[],[]],Qx=BigInt(0),cc=BigInt(1),Wx=BigInt(2),Jx=BigInt(7),Yx=BigInt(256),Zx=BigInt(113);for(let r=0,e=cc,t=1,n=0;r<24;r++){[t,n]=[n,(2*t+3*n)%5],f1.push(2*(5*n+t)),d1.push((r+1)*(r+2)/2%64);let s=Qx;for(let i=0;i<7;i++)e=(e<<cc^(e>>Jx)*Zx)%Yx,e&Wx&&(s^=cc<<(cc<<BigInt(i))-cc);p1.push(s)}const[Xx,eI]=a1(p1,!0),wy=(r,e,t)=>t>32?u1(r,e,t):c1(r,e,t),by=(r,e,t)=>t>32?h1(r,e,t):l1(r,e,t);function tI(r,e=24){const t=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)t[o]=r[o]^r[o+10]^r[o+20]^r[o+30]^r[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=t[c],u=t[c+1],h=wy(l,u,1)^t[a],f=by(l,u,1)^t[a+1];for(let d=0;d<50;d+=10)r[o+d]^=h,r[o+d+1]^=f}let s=r[2],i=r[3];for(let o=0;o<24;o++){const a=d1[o],c=wy(s,i,a),l=by(s,i,a),u=f1[o];s=r[u],i=r[u+1],r[u]=c,r[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)t[a]=r[o+a];for(let a=0;a<10;a++)r[o+a]^=~t[(a+2)%10]&t[(a+4)%10]}r[0]^=Xx[n],r[1]^=eI[n]}t.fill(0)}let rI=class g1 extends Yp{constructor(e,t,n,s=!1,i=24){if(super(),this.blockLen=e,this.suffix=t,this.outputLen=n,this.enableXOF=s,this.rounds=i,this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,Uu(n),0>=this.blockLen||this.blockLen>=200)throw new Error("Sha3 supports only keccak-f1600 function");this.state=new Uint8Array(200),this.state32=yx(this.state)}keccak(){tI(this.state32,this.rounds),this.posOut=0,this.pos=0}update(e){za(this);const{blockLen:t,state:n}=this;e=Ah(e);const s=e.length;for(let i=0;i<s;){const o=Math.min(t-this.pos,s-i);for(let a=0;a<o;a++)n[this.pos++]^=e[i++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:n,blockLen:s}=this;e[n]^=t,(t&128)!==0&&n===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){za(this,!1),Jp(e),this.finish();const t=this.state,{blockLen:n}=this;for(let s=0,i=e.length;s<i;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,i-s);e.set(t.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Uu(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(e1(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,this.state.fill(0)}_cloneInto(e){const{blockLen:t,suffix:n,outputLen:s,rounds:i,enableXOF:o}=this;return e||(e=new g1(t,n,s,o,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=n,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}};const nI=(r,e,t)=>Zp(()=>new rI(e,r,t)),sI=nI(1,136,256/8);let y1=!1;const m1=function(r){return sI(r)};let w1=m1;function Qe(r){const e=ue(r,"data");return X(w1(e))}Qe._=m1;Qe.lock=function(){y1=!0};Qe.register=function(r){if(y1)throw new TypeError("keccak256 is locked");w1=r};Object.freeze(Qe);const b1=function(r){return Gx("sha256").update(r).digest()};let v1=b1,E1=!1;function Za(r){const e=ue(r,"data");return X(v1(e))}Za._=b1;Za.lock=function(){E1=!0};Za.register=function(r){if(E1)throw new Error("sha256 is locked");v1=r};Object.freeze(Za);Object.freeze(Za);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const A1=BigInt(0),xh=BigInt(1),iI=BigInt(2),Ih=r=>r instanceof Uint8Array,oI=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function Ha(r){if(!Ih(r))throw new Error("Uint8Array expected");let e="";for(let t=0;t<r.length;t++)e+=oI[r[t]];return e}function x1(r){const e=r.toString(16);return e.length&1?`0${e}`:e}function Xp(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return BigInt(r===""?"0":`0x${r}`)}function qa(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);const e=r.length;if(e%2)throw new Error("padded hex string expected, got unpadded hex of length "+e);const t=new Uint8Array(e/2);for(let n=0;n<t.length;n++){const s=n*2,i=r.slice(s,s+2),o=Number.parseInt(i,16);if(Number.isNaN(o)||o<0)throw new Error("Invalid byte sequence");t[n]=o}return t}function Xi(r){return Xp(Ha(r))}function eg(r){if(!Ih(r))throw new Error("Uint8Array expected");return Xp(Ha(Uint8Array.from(r).reverse()))}function Va(r,e){return qa(r.toString(16).padStart(e*2,"0"))}function tg(r,e){return Va(r,e).reverse()}function aI(r){return qa(x1(r))}function $r(r,e,t){let n;if(typeof e=="string")try{n=qa(e)}catch(i){throw new Error(`${r} must be valid hex string, got "${e}". Cause: ${i}`)}else if(Ih(e))n=Uint8Array.from(e);else throw new Error(`${r} must be hex string or Uint8Array`);const s=n.length;if(typeof t=="number"&&s!==t)throw new Error(`${r} expected ${t} bytes, got ${s}`);return n}function qc(...r){const e=new Uint8Array(r.reduce((n,s)=>n+s.length,0));let t=0;return r.forEach(n=>{if(!Ih(n))throw new Error("Uint8Array expected");e.set(n,t),t+=n.length}),e}function cI(r,e){if(r.length!==e.length)return!1;for(let t=0;t<r.length;t++)if(r[t]!==e[t])return!1;return!0}function lI(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function uI(r){let e;for(e=0;r>A1;r>>=xh,e+=1);return e}function hI(r,e){return r>>BigInt(e)&xh}const fI=(r,e,t)=>r|(t?xh:A1)<<BigInt(e),rg=r=>(iI<<BigInt(r-1))-xh,of=r=>new Uint8Array(r),vy=r=>Uint8Array.from(r);function I1(r,e,t){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");let n=of(r),s=of(r),i=0;const o=()=>{n.fill(1),s.fill(0),i=0},a=(...h)=>t(s,n,...h),c=(h=of())=>{s=a(vy([0]),h),n=a(),h.length!==0&&(s=a(vy([1]),h),n=a())},l=()=>{if(i++>=1e3)throw new Error("drbg: tried 1000 values");let h=0;const f=[];for(;h<e;){n=a();const d=n.slice();f.push(d),h+=n.length}return qc(...f)};return(h,f)=>{o(),c(h);let d;for(;!(d=f(l()));)c();return o(),d}}const dI={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||r instanceof Uint8Array,isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function El(r,e,t={}){const n=(s,i,o)=>{const a=dI[i];if(typeof a!="function")throw new Error(`Invalid validator "${i}", expected function`);const c=r[s];if(!(o&&c===void 0)&&!a(c,r))throw new Error(`Invalid param ${String(s)}=${c} (${typeof c}), expected ${i}`)};for(const[s,i]of Object.entries(e))n(s,i,!1);for(const[s,i]of Object.entries(t))n(s,i,!0);return r}const pI=Object.freeze(Object.defineProperty({__proto__:null,bitGet:hI,bitLen:uI,bitMask:rg,bitSet:fI,bytesToHex:Ha,bytesToNumberBE:Xi,bytesToNumberLE:eg,concatBytes:qc,createHmacDrbg:I1,ensureBytes:$r,equalBytes:cI,hexToBytes:qa,hexToNumber:Xp,numberToBytesBE:Va,numberToBytesLE:tg,numberToHexUnpadded:x1,numberToVarBytesBE:aI,utf8ToBytes:lI,validateObject:El},Symbol.toStringTag,{value:"Module"}));/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const nt=BigInt(0),ze=BigInt(1),wi=BigInt(2),gI=BigInt(3),Od=BigInt(4),Ey=BigInt(5),Ay=BigInt(8);BigInt(9);BigInt(16);function qt(r,e){const t=r%e;return t>=nt?t:e+t}function yI(r,e,t){if(t<=nt||e<nt)throw new Error("Expected power/modulo > 0");if(t===ze)return nt;let n=ze;for(;e>nt;)e&ze&&(n=n*r%t),r=r*r%t,e>>=ze;return n}function fr(r,e,t){let n=r;for(;e-- >nt;)n*=n,n%=t;return n}function Dd(r,e){if(r===nt||e<=nt)throw new Error(`invert: expected positive integers, got n=${r} mod=${e}`);let t=qt(r,e),n=e,s=nt,i=ze;for(;t!==nt;){const a=n/t,c=n%t,l=s-i*a;n=t,t=c,s=i,i=l}if(n!==ze)throw new Error("invert: does not exist");return qt(s,e)}function mI(r){const e=(r-ze)/wi;let t,n,s;for(t=r-ze,n=0;t%wi===nt;t/=wi,n++);for(s=wi;s<r&&yI(s,e,r)!==r-ze;s++);if(n===1){const o=(r+ze)/Od;return function(c,l){const u=c.pow(l,o);if(!c.eql(c.sqr(u),l))throw new Error("Cannot find square root");return u}}const i=(t+ze)/wi;return function(a,c){if(a.pow(c,e)===a.neg(a.ONE))throw new Error("Cannot find square root");let l=n,u=a.pow(a.mul(a.ONE,s),t),h=a.pow(c,i),f=a.pow(c,t);for(;!a.eql(f,a.ONE);){if(a.eql(f,a.ZERO))return a.ZERO;let d=1;for(let g=a.sqr(f);d<l&&!a.eql(g,a.ONE);d++)g=a.sqr(g);const p=a.pow(u,ze<<BigInt(l-d-1));u=a.sqr(p),h=a.mul(h,p),f=a.mul(f,u),l=d}return h}}function wI(r){if(r%Od===gI){const e=(r+ze)/Od;return function(n,s){const i=n.pow(s,e);if(!n.eql(n.sqr(i),s))throw new Error("Cannot find square root");return i}}if(r%Ay===Ey){const e=(r-Ey)/Ay;return function(n,s){const i=n.mul(s,wi),o=n.pow(i,e),a=n.mul(s,o),c=n.mul(n.mul(a,wi),o),l=n.mul(a,n.sub(c,n.ONE));if(!n.eql(n.sqr(l),s))throw new Error("Cannot find square root");return l}}return mI(r)}const bI=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function vI(r){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=bI.reduce((n,s)=>(n[s]="function",n),e);return El(r,t)}function EI(r,e,t){if(t<nt)throw new Error("Expected power > 0");if(t===nt)return r.ONE;if(t===ze)return e;let n=r.ONE,s=e;for(;t>nt;)t&ze&&(n=r.mul(n,s)),s=r.sqr(s),t>>=ze;return n}function AI(r,e){const t=new Array(e.length),n=e.reduce((i,o,a)=>r.is0(o)?i:(t[a]=i,r.mul(i,o)),r.ONE),s=r.inv(n);return e.reduceRight((i,o,a)=>r.is0(o)?i:(t[a]=r.mul(i,t[a]),r.mul(i,o)),s),t}function S1(r,e){const t=e!==void 0?e:r.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}function xI(r,e,t=!1,n={}){if(r<=nt)throw new Error(`Expected Field ORDER > 0, got ${r}`);const{nBitLength:s,nByteLength:i}=S1(r,e);if(i>2048)throw new Error("Field lengths over 2048 bytes are not supported");const o=wI(r),a=Object.freeze({ORDER:r,BITS:s,BYTES:i,MASK:rg(s),ZERO:nt,ONE:ze,create:c=>qt(c,r),isValid:c=>{if(typeof c!="bigint")throw new Error(`Invalid field element: expected bigint, got ${typeof c}`);return nt<=c&&c<r},is0:c=>c===nt,isOdd:c=>(c&ze)===ze,neg:c=>qt(-c,r),eql:(c,l)=>c===l,sqr:c=>qt(c*c,r),add:(c,l)=>qt(c+l,r),sub:(c,l)=>qt(c-l,r),mul:(c,l)=>qt(c*l,r),pow:(c,l)=>EI(a,c,l),div:(c,l)=>qt(c*Dd(l,r),r),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>Dd(c,r),sqrt:n.sqrt||(c=>o(a,c)),invertBatch:c=>AI(a,c),cmov:(c,l,u)=>u?l:c,toBytes:c=>t?tg(c,i):Va(c,i),fromBytes:c=>{if(c.length!==i)throw new Error(`Fp.fromBytes: expected ${i}, got ${c.length}`);return t?eg(c):Xi(c)}});return Object.freeze(a)}function P1(r){if(typeof r!="bigint")throw new Error("field order must be bigint");const e=r.toString(2).length;return Math.ceil(e/8)}function O1(r){const e=P1(r);return e+Math.ceil(e/2)}function II(r,e,t=!1){const n=r.length,s=P1(e),i=O1(e);if(n<16||n<i||n>1024)throw new Error(`expected ${i}-1024 bytes of input, got ${n}`);const o=t?Xi(r):eg(r),a=qt(o,e-ze)+ze;return t?tg(a,s):Va(a,s)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const SI=BigInt(0),af=BigInt(1);function PI(r,e){const t=(s,i)=>{const o=i.negate();return s?o:i},n=s=>{const i=Math.ceil(e/s)+1,o=2**(s-1);return{windows:i,windowSize:o}};return{constTimeNegate:t,unsafeLadder(s,i){let o=r.ZERO,a=s;for(;i>SI;)i&af&&(o=o.add(a)),a=a.double(),i>>=af;return o},precomputeWindow(s,i){const{windows:o,windowSize:a}=n(i),c=[];let l=s,u=l;for(let h=0;h<o;h++){u=l,c.push(u);for(let f=1;f<a;f++)u=u.add(l),c.push(u);l=u.double()}return c},wNAF(s,i,o){const{windows:a,windowSize:c}=n(s);let l=r.ZERO,u=r.BASE;const h=BigInt(2**s-1),f=2**s,d=BigInt(s);for(let p=0;p<a;p++){const g=p*c;let m=Number(o&h);o>>=d,m>c&&(m-=f,o+=af);const b=g,x=g+Math.abs(m)-1,v=p%2!==0,I=m<0;m===0?u=u.add(t(v,i[b])):l=l.add(t(I,i[x]))}return{p:l,f:u}},wNAFCached(s,i,o,a){const c=s._WINDOW_SIZE||1;let l=i.get(s);return l||(l=this.precomputeWindow(s,c),c!==1&&i.set(s,a(l))),this.wNAF(c,l,o)}}}function D1(r){return vI(r.Fp),El(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...S1(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function OI(r){const e=D1(r);El(e,{a:"field",b:"field"},{allowedPrivateKeyLengths:"array",wrapPrivateKey:"boolean",isTorsionFree:"function",clearCofactor:"function",allowInfinityPoint:"boolean",fromBytes:"function",toBytes:"function"});const{endo:t,Fp:n,a:s}=e;if(t){if(!n.eql(s,n.ZERO))throw new Error("Endomorphism can only be defined for Koblitz curves that have a=0");if(typeof t!="object"||typeof t.beta!="bigint"||typeof t.splitScalar!="function")throw new Error("Expected endomorphism with beta: bigint and splitScalar: function")}return Object.freeze({...e})}const{bytesToNumberBE:DI,hexToBytes:CI}=pI,Pi={Err:class extends Error{constructor(e=""){super(e)}},_parseInt(r){const{Err:e}=Pi;if(r.length<2||r[0]!==2)throw new e("Invalid signature integer tag");const t=r[1],n=r.subarray(2,t+2);if(!t||n.length!==t)throw new e("Invalid signature integer: wrong length");if(n[0]&128)throw new e("Invalid signature integer: negative");if(n[0]===0&&!(n[1]&128))throw new e("Invalid signature integer: unnecessary leading zero");return{d:DI(n),l:r.subarray(t+2)}},toSig(r){const{Err:e}=Pi,t=typeof r=="string"?CI(r):r;if(!(t instanceof Uint8Array))throw new Error("ui8a expected");let n=t.length;if(n<2||t[0]!=48)throw new e("Invalid signature tag");if(t[1]!==n-2)throw new e("Invalid signature: incorrect length");const{d:s,l:i}=Pi._parseInt(t.subarray(2)),{d:o,l:a}=Pi._parseInt(i);if(a.length)throw new e("Invalid signature: left bytes after parsing");return{r:s,s:o}},hexFromSig(r){const e=l=>Number.parseInt(l[0],16)&8?"00"+l:l,t=l=>{const u=l.toString(16);return u.length&1?`0${u}`:u},n=e(t(r.s)),s=e(t(r.r)),i=n.length/2,o=s.length/2,a=t(i),c=t(o);return`30${t(o+i+4)}02${c}${s}02${a}${n}`}},Xn=BigInt(0),xr=BigInt(1);BigInt(2);const xy=BigInt(3);BigInt(4);function BI(r){const e=OI(r),{Fp:t}=e,n=e.toBytes||((p,g,m)=>{const b=g.toAffine();return qc(Uint8Array.from([4]),t.toBytes(b.x),t.toBytes(b.y))}),s=e.fromBytes||(p=>{const g=p.subarray(1),m=t.fromBytes(g.subarray(0,t.BYTES)),b=t.fromBytes(g.subarray(t.BYTES,2*t.BYTES));return{x:m,y:b}});function i(p){const{a:g,b:m}=e,b=t.sqr(p),x=t.mul(b,p);return t.add(t.add(x,t.mul(p,g)),m)}if(!t.eql(t.sqr(e.Gy),i(e.Gx)))throw new Error("bad generator point: equation left != right");function o(p){return typeof p=="bigint"&&Xn<p&&p<e.n}function a(p){if(!o(p))throw new Error("Expected valid bigint: 0 < bigint < curve.n")}function c(p){const{allowedPrivateKeyLengths:g,nByteLength:m,wrapPrivateKey:b,n:x}=e;if(g&&typeof p!="bigint"){if(p instanceof Uint8Array&&(p=Ha(p)),typeof p!="string"||!g.includes(p.length))throw new Error("Invalid key");p=p.padStart(m*2,"0")}let v;try{v=typeof p=="bigint"?p:Xi($r("private key",p,m))}catch{throw new Error(`private key must be ${m} bytes, hex or bigint, not ${typeof p}`)}return b&&(v=qt(v,x)),a(v),v}const l=new Map;function u(p){if(!(p instanceof h))throw new Error("ProjectivePoint expected")}class h{constructor(g,m,b){if(this.px=g,this.py=m,this.pz=b,g==null||!t.isValid(g))throw new Error("x required");if(m==null||!t.isValid(m))throw new Error("y required");if(b==null||!t.isValid(b))throw new Error("z required")}static fromAffine(g){const{x:m,y:b}=g||{};if(!g||!t.isValid(m)||!t.isValid(b))throw new Error("invalid affine point");if(g instanceof h)throw new Error("projective point not allowed");const x=v=>t.eql(v,t.ZERO);return x(m)&&x(b)?h.ZERO:new h(m,b,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(g){const m=t.invertBatch(g.map(b=>b.pz));return g.map((b,x)=>b.toAffine(m[x])).map(h.fromAffine)}static fromHex(g){const m=h.fromAffine(s($r("pointHex",g)));return m.assertValidity(),m}static fromPrivateKey(g){return h.BASE.multiply(c(g))}_setWindowSize(g){this._WINDOW_SIZE=g,l.delete(this)}assertValidity(){if(this.is0()){if(e.allowInfinityPoint&&!t.is0(this.py))return;throw new Error("bad point: ZERO")}const{x:g,y:m}=this.toAffine();if(!t.isValid(g)||!t.isValid(m))throw new Error("bad point: x or y not FE");const b=t.sqr(m),x=i(g);if(!t.eql(b,x))throw new Error("bad point: equation left != right");if(!this.isTorsionFree())throw new Error("bad point: not in prime-order subgroup")}hasEvenY(){const{y:g}=this.toAffine();if(t.isOdd)return!t.isOdd(g);throw new Error("Field doesn't support isOdd")}equals(g){u(g);const{px:m,py:b,pz:x}=this,{px:v,py:I,pz:S}=g,E=t.eql(t.mul(m,S),t.mul(v,x)),P=t.eql(t.mul(b,S),t.mul(I,x));return E&&P}negate(){return new h(this.px,t.neg(this.py),this.pz)}double(){const{a:g,b:m}=e,b=t.mul(m,xy),{px:x,py:v,pz:I}=this;let S=t.ZERO,E=t.ZERO,P=t.ZERO,D=t.mul(x,x),B=t.mul(v,v),L=t.mul(I,I),j=t.mul(x,v);return j=t.add(j,j),P=t.mul(x,I),P=t.add(P,P),S=t.mul(g,P),E=t.mul(b,L),E=t.add(S,E),S=t.sub(B,E),E=t.add(B,E),E=t.mul(S,E),S=t.mul(j,S),P=t.mul(b,P),L=t.mul(g,L),j=t.sub(D,L),j=t.mul(g,j),j=t.add(j,P),P=t.add(D,D),D=t.add(P,D),D=t.add(D,L),D=t.mul(D,j),E=t.add(E,D),L=t.mul(v,I),L=t.add(L,L),D=t.mul(L,j),S=t.sub(S,D),P=t.mul(L,B),P=t.add(P,P),P=t.add(P,P),new h(S,E,P)}add(g){u(g);const{px:m,py:b,pz:x}=this,{px:v,py:I,pz:S}=g;let E=t.ZERO,P=t.ZERO,D=t.ZERO;const B=e.a,L=t.mul(e.b,xy);let j=t.mul(m,v),$=t.mul(b,I),U=t.mul(x,S),T=t.add(m,b),w=t.add(v,I);T=t.mul(T,w),w=t.add(j,$),T=t.sub(T,w),w=t.add(m,x);let A=t.add(v,S);return w=t.mul(w,A),A=t.add(j,U),w=t.sub(w,A),A=t.add(b,x),E=t.add(I,S),A=t.mul(A,E),E=t.add($,U),A=t.sub(A,E),D=t.mul(B,w),E=t.mul(L,U),D=t.add(E,D),E=t.sub($,D),D=t.add($,D),P=t.mul(E,D),$=t.add(j,j),$=t.add($,j),U=t.mul(B,U),w=t.mul(L,w),$=t.add($,U),U=t.sub(j,U),U=t.mul(B,U),w=t.add(w,U),j=t.mul($,w),P=t.add(P,j),j=t.mul(A,w),E=t.mul(T,E),E=t.sub(E,j),j=t.mul(T,$),D=t.mul(A,D),D=t.add(D,j),new h(E,P,D)}subtract(g){return this.add(g.negate())}is0(){return this.equals(h.ZERO)}wNAF(g){return d.wNAFCached(this,l,g,m=>{const b=t.invertBatch(m.map(x=>x.pz));return m.map((x,v)=>x.toAffine(b[v])).map(h.fromAffine)})}multiplyUnsafe(g){const m=h.ZERO;if(g===Xn)return m;if(a(g),g===xr)return this;const{endo:b}=e;if(!b)return d.unsafeLadder(this,g);let{k1neg:x,k1:v,k2neg:I,k2:S}=b.splitScalar(g),E=m,P=m,D=this;for(;v>Xn||S>Xn;)v&xr&&(E=E.add(D)),S&xr&&(P=P.add(D)),D=D.double(),v>>=xr,S>>=xr;return x&&(E=E.negate()),I&&(P=P.negate()),P=new h(t.mul(P.px,b.beta),P.py,P.pz),E.add(P)}multiply(g){a(g);let m=g,b,x;const{endo:v}=e;if(v){const{k1neg:I,k1:S,k2neg:E,k2:P}=v.splitScalar(m);let{p:D,f:B}=this.wNAF(S),{p:L,f:j}=this.wNAF(P);D=d.constTimeNegate(I,D),L=d.constTimeNegate(E,L),L=new h(t.mul(L.px,v.beta),L.py,L.pz),b=D.add(L),x=B.add(j)}else{const{p:I,f:S}=this.wNAF(m);b=I,x=S}return h.normalizeZ([b,x])[0]}multiplyAndAddUnsafe(g,m,b){const x=h.BASE,v=(S,E)=>E===Xn||E===xr||!S.equals(x)?S.multiplyUnsafe(E):S.multiply(E),I=v(this,m).add(v(g,b));return I.is0()?void 0:I}toAffine(g){const{px:m,py:b,pz:x}=this,v=this.is0();g==null&&(g=v?t.ONE:t.inv(x));const I=t.mul(m,g),S=t.mul(b,g),E=t.mul(x,g);if(v)return{x:t.ZERO,y:t.ZERO};if(!t.eql(E,t.ONE))throw new Error("invZ was invalid");return{x:I,y:S}}isTorsionFree(){const{h:g,isTorsionFree:m}=e;if(g===xr)return!0;if(m)return m(h,this);throw new Error("isTorsionFree() has not been declared for the elliptic curve")}clearCofactor(){const{h:g,clearCofactor:m}=e;return g===xr?this:m?m(h,this):this.multiplyUnsafe(e.h)}toRawBytes(g=!0){return this.assertValidity(),n(h,this,g)}toHex(g=!0){return Ha(this.toRawBytes(g))}}h.BASE=new h(e.Gx,e.Gy,t.ONE),h.ZERO=new h(t.ZERO,t.ONE,t.ZERO);const f=e.nBitLength,d=PI(h,e.endo?Math.ceil(f/2):f);return{CURVE:e,ProjectivePoint:h,normPrivateKeyToScalar:c,weierstrassEquation:i,isWithinCurveOrder:o}}function _I(r){const e=D1(r);return El(e,{hash:"hash",hmac:"function",randomBytes:"function"},{bits2int:"function",bits2int_modN:"function",lowS:"boolean"}),Object.freeze({lowS:!0,...e})}function TI(r){const e=_I(r),{Fp:t,n}=e,s=t.BYTES+1,i=2*t.BYTES+1;function o(w){return Xn<w&&w<t.ORDER}function a(w){return qt(w,n)}function c(w){return Dd(w,n)}const{ProjectivePoint:l,normPrivateKeyToScalar:u,weierstrassEquation:h,isWithinCurveOrder:f}=BI({...e,toBytes(w,A,C){const k=A.toAffine(),_=t.toBytes(k.x),N=qc;return C?N(Uint8Array.from([A.hasEvenY()?2:3]),_):N(Uint8Array.from([4]),_,t.toBytes(k.y))},fromBytes(w){const A=w.length,C=w[0],k=w.subarray(1);if(A===s&&(C===2||C===3)){const _=Xi(k);if(!o(_))throw new Error("Point is not on curve");const N=h(_);let z=t.sqrt(N);const H=(z&xr)===xr;return(C&1)===1!==H&&(z=t.neg(z)),{x:_,y:z}}else if(A===i&&C===4){const _=t.fromBytes(k.subarray(0,t.BYTES)),N=t.fromBytes(k.subarray(t.BYTES,2*t.BYTES));return{x:_,y:N}}else throw new Error(`Point of length ${A} was invalid. Expected ${s} compressed bytes or ${i} uncompressed bytes`)}}),d=w=>Ha(Va(w,e.nByteLength));function p(w){const A=n>>xr;return w>A}function g(w){return p(w)?a(-w):w}const m=(w,A,C)=>Xi(w.slice(A,C));class b{constructor(A,C,k){this.r=A,this.s=C,this.recovery=k,this.assertValidity()}static fromCompact(A){const C=e.nByteLength;return A=$r("compactSignature",A,C*2),new b(m(A,0,C),m(A,C,2*C))}static fromDER(A){const{r:C,s:k}=Pi.toSig($r("DER",A));return new b(C,k)}assertValidity(){if(!f(this.r))throw new Error("r must be 0 < r < CURVE.n");if(!f(this.s))throw new Error("s must be 0 < s < CURVE.n")}addRecoveryBit(A){return new b(this.r,this.s,A)}recoverPublicKey(A){const{r:C,s:k,recovery:_}=this,N=P($r("msgHash",A));if(_==null||![0,1,2,3].includes(_))throw new Error("recovery id invalid");const z=_===2||_===3?C+e.n:C;if(z>=t.ORDER)throw new Error("recovery id 2 or 3 invalid");const H=(_&1)===0?"02":"03",Y=l.fromHex(H+d(z)),G=c(z),Q=a(-N*G),ee=a(k*G),se=l.BASE.multiplyAndAddUnsafe(Y,Q,ee);if(!se)throw new Error("point at infinify");return se.assertValidity(),se}hasHighS(){return p(this.s)}normalizeS(){return this.hasHighS()?new b(this.r,a(-this.s),this.recovery):this}toDERRawBytes(){return qa(this.toDERHex())}toDERHex(){return Pi.hexFromSig({r:this.r,s:this.s})}toCompactRawBytes(){return qa(this.toCompactHex())}toCompactHex(){return d(this.r)+d(this.s)}}const x={isValidPrivateKey(w){try{return u(w),!0}catch{return!1}},normPrivateKeyToScalar:u,randomPrivateKey:()=>{const w=O1(e.n);return II(e.randomBytes(w),e.n)},precompute(w=8,A=l.BASE){return A._setWindowSize(w),A.multiply(BigInt(3)),A}};function v(w,A=!0){return l.fromPrivateKey(w).toRawBytes(A)}function I(w){const A=w instanceof Uint8Array,C=typeof w=="string",k=(A||C)&&w.length;return A?k===s||k===i:C?k===2*s||k===2*i:w instanceof l}function S(w,A,C=!0){if(I(w))throw new Error("first arg must be private key");if(!I(A))throw new Error("second arg must be public key");return l.fromHex(A).multiply(u(w)).toRawBytes(C)}const E=e.bits2int||function(w){const A=Xi(w),C=w.length*8-e.nBitLength;return C>0?A>>BigInt(C):A},P=e.bits2int_modN||function(w){return a(E(w))},D=rg(e.nBitLength);function B(w){if(typeof w!="bigint")throw new Error("bigint expected");if(!(Xn<=w&&w<D))throw new Error(`bigint expected < 2^${e.nBitLength}`);return Va(w,e.nByteLength)}function L(w,A,C=j){if(["recovered","canonical"].some(ne=>ne in C))throw new Error("sign() legacy options not supported");const{hash:k,randomBytes:_}=e;let{lowS:N,prehash:z,extraEntropy:H}=C;N==null&&(N=!0),w=$r("msgHash",w),z&&(w=$r("prehashed msgHash",k(w)));const Y=P(w),G=u(A),Q=[B(G),B(Y)];if(H!=null){const ne=H===!0?_(t.BYTES):H;Q.push($r("extraEntropy",ne))}const ee=qc(...Q),se=Y;function le(ne){const fe=E(ne);if(!f(fe))return;const ke=c(fe),qe=l.BASE.multiply(fe).toAffine(),$e=a(qe.x);if($e===Xn)return;const mt=a(ke*a(se+$e*G));if(mt===Xn)return;let bo=(qe.x===$e?0:2)|Number(qe.y&xr),Ll=mt;return N&&p(mt)&&(Ll=g(mt),bo^=1),new b($e,Ll,bo)}return{seed:ee,k2sig:le}}const j={lowS:e.lowS,prehash:!1},$={lowS:e.lowS,prehash:!1};function U(w,A,C=j){const{seed:k,k2sig:_}=L(w,A,C),N=e;return I1(N.hash.outputLen,N.nByteLength,N.hmac)(k,_)}l.BASE._setWindowSize(8);function T(w,A,C,k=$){var qe;const _=w;if(A=$r("msgHash",A),C=$r("publicKey",C),"strict"in k)throw new Error("options.strict was renamed to lowS");const{lowS:N,prehash:z}=k;let H,Y;try{if(typeof _=="string"||_ instanceof Uint8Array)try{H=b.fromDER(_)}catch($e){if(!($e instanceof Pi.Err))throw $e;H=b.fromCompact(_)}else if(typeof _=="object"&&typeof _.r=="bigint"&&typeof _.s=="bigint"){const{r:$e,s:mt}=_;H=new b($e,mt)}else throw new Error("PARSE");Y=l.fromHex(C)}catch($e){if($e.message==="PARSE")throw new Error("signature must be Signature instance, Uint8Array or hex string");return!1}if(N&&H.hasHighS())return!1;z&&(A=e.hash(A));const{r:G,s:Q}=H,ee=P(A),se=c(Q),le=a(ee*se),ne=a(G*se),fe=(qe=l.BASE.multiplyAndAddUnsafe(Y,le,ne))==null?void 0:qe.toAffine();return fe?a(fe.x)===G:!1}return{CURVE:e,getPublicKey:v,getSharedSecret:S,sign:U,verify:T,ProjectivePoint:l,Signature:b,utils:x}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function NI(r){return{hash:r,hmac:(e,...t)=>n1(r,e,bx(...t)),randomBytes:vx}}function RI(r,e){const t=n=>TI({...r,...NI(n)});return Object.freeze({...t(e),create:t})}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const C1=BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),Iy=BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),UI=BigInt(1),Cd=BigInt(2),Sy=(r,e)=>(r+e/Cd)/e;function kI(r){const e=C1,t=BigInt(3),n=BigInt(6),s=BigInt(11),i=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=r*r*r%e,u=l*l*r%e,h=fr(u,t,e)*u%e,f=fr(h,t,e)*u%e,d=fr(f,Cd,e)*l%e,p=fr(d,s,e)*d%e,g=fr(p,i,e)*p%e,m=fr(g,a,e)*g%e,b=fr(m,c,e)*m%e,x=fr(b,a,e)*g%e,v=fr(x,t,e)*u%e,I=fr(v,o,e)*p%e,S=fr(I,n,e)*l%e,E=fr(S,Cd,e);if(!Bd.eql(Bd.sqr(E),r))throw new Error("Cannot find square root");return E}const Bd=xI(C1,void 0,void 0,{sqrt:kI}),Ps=RI({a:BigInt(0),b:BigInt(7),Fp:Bd,n:Iy,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),h:BigInt(1),lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:r=>{const e=Iy,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-UI*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),s=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),i=t,o=BigInt("0x100000000000000000000000000000000"),a=Sy(i*r,e),c=Sy(-n*r,e);let l=qt(r-a*t-c*s,e),u=qt(-a*n-c*i,e);const h=l>o,f=u>o;if(h&&(l=e-l),f&&(u=e-u),l>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+r);return{k1neg:h,k1:l,k2neg:f,k2:u}}}},i1);BigInt(0);Ps.ProjectivePoint;const Vc="0x0000000000000000000000000000000000000000",Py="0x0000000000000000000000000000000000000000000000000000000000000000",Oy=BigInt(0),Dy=BigInt(1),Cy=BigInt(2),By=BigInt(27),_y=BigInt(28),Hl=BigInt(35),Eo={};function Ty(r){return as(Ze(r),32)}var la,ln,ua,zi;const kr=class kr{constructor(e,t,n,s){M(this,la);M(this,ln);M(this,ua);M(this,zi);bl(e,Eo,"Signature"),O(this,la,t),O(this,ln,n),O(this,ua,s),O(this,zi,null)}get r(){return y(this,la)}set r(e){R(Ko(e)===32,"invalid r","value",e),O(this,la,X(e))}get s(){return R(parseInt(y(this,ln).substring(0,3))<8,"non-canonical s; use ._s","s",y(this,ln)),y(this,ln)}set s(e){R(Ko(e)===32,"invalid s","value",e),O(this,ln,X(e))}get _s(){return y(this,ln)}isValid(){return parseInt(y(this,ln).substring(0,3))<8}get v(){return y(this,ua)}set v(e){const t=oe(e,"value");R(t===27||t===28,"invalid v","v",e),O(this,ua,t)}get networkV(){return y(this,zi)}get legacyChainId(){const e=this.networkV;return e==null?null:kr.getChainId(e)}get yParity(){return this.v===27?0:1}get yParityAndS(){const e=ue(this.s);return this.yParity&&(e[0]|=128),X(e)}get compactSerialized(){return Fe([this.r,this.yParityAndS])}get serialized(){return Fe([this.r,this.s,this.yParity?"0x1c":"0x1b"])}[Symbol.for("nodejs.util.inspect.custom")](){return`Signature { r: "${this.r}", s: "${this._s}"${this.isValid()?"":', valid: "false"'}, yParity: ${this.yParity}, networkV: ${this.networkV} }`}clone(){const e=new kr(Eo,this.r,this._s,this.v);return this.networkV&&O(e,zi,this.networkV),e}toJSON(){const e=this.networkV;return{_type:"signature",networkV:e!=null?e.toString():null,r:this.r,s:this._s,v:this.v}}static getChainId(e){const t=re(e,"v");return t==By||t==_y?Oy:(R(t>=Hl,"invalid EIP-155 v","v",e),(t-Hl)/Cy)}static getChainIdV(e,t){return re(e)*Cy+BigInt(35+t-27)}static getNormalizedV(e){const t=re(e);return t===Oy||t===By?27:t===Dy||t===_y?28:(R(t>=Hl,"invalid v","v",e),t&Dy?27:28)}static from(e){function t(l,u){R(l,u,"signature",e)}if(e==null)return new kr(Eo,Py,Py,27);if(typeof e=="string"){const l=ue(e,"signature");if(l.length===64){const u=X(l.slice(0,32)),h=l.slice(32,64),f=h[0]&128?28:27;return h[0]&=127,new kr(Eo,u,X(h),f)}if(l.length===65){const u=X(l.slice(0,32)),h=X(l.slice(32,64)),f=kr.getNormalizedV(l[64]);return new kr(Eo,u,h,f)}t(!1,"invalid raw signature length")}if(e instanceof kr)return e.clone();const n=e.r;t(n!=null,"missing r");const s=Ty(n),i=(function(l,u){if(l!=null)return Ty(l);if(u!=null){t(_e(u,32),"invalid yParityAndS");const h=ue(u);return h[0]&=127,X(h)}t(!1,"missing s")})(e.s,e.yParityAndS),{networkV:o,v:a}=(function(l,u,h){if(l!=null){const f=re(l);return{networkV:f>=Hl?f:void 0,v:kr.getNormalizedV(f)}}if(u!=null)return t(_e(u,32),"invalid yParityAndS"),{v:ue(u)[0]&128?28:27};if(h!=null){switch(oe(h,"sig.yParity")){case 0:return{v:27};case 1:return{v:28}}t(!1,"invalid yParity")}t(!1,"missing v")})(e.v,e.yParityAndS,e.yParity),c=new kr(Eo,s,i,a);return o&&O(c,zi,o),t(e.yParity==null||oe(e.yParity,"sig.yParity")===c.yParity,"yParity mismatch"),t(e.yParityAndS==null||e.yParityAndS===c.yParityAndS,"yParityAndS mismatch"),c}};la=new WeakMap,ln=new WeakMap,ua=new WeakMap,zi=new WeakMap;let Wt=kr;var Vn;const Ai=class Ai{constructor(e){M(this,Vn);R(Ko(e)===32,"invalid private key","privateKey","[REDACTED]"),O(this,Vn,X(e))}get privateKey(){return y(this,Vn)}get publicKey(){return Ai.computePublicKey(y(this,Vn))}get compressedPublicKey(){return Ai.computePublicKey(y(this,Vn),!0)}sign(e){R(Ko(e)===32,"invalid digest length","digest",e);const t=Ps.sign(_t(e),_t(y(this,Vn)),{lowS:!0});return Wt.from({r:Xs(t.r,32),s:Xs(t.s,32),v:t.recovery?28:27})}computeSharedSecret(e){const t=Ai.computePublicKey(e);return X(Ps.getSharedSecret(_t(y(this,Vn)),ue(t),!1))}static computePublicKey(e,t){let n=ue(e,"key");if(n.length===32){const i=Ps.getPublicKey(n,!!t);return X(i)}if(n.length===64){const i=new Uint8Array(65);i[0]=4,i.set(n,1),n=i}const s=Ps.ProjectivePoint.fromHex(n);return X(s.toRawBytes(t))}static recoverPublicKey(e,t){R(Ko(e)===32,"invalid digest length","digest",e);const n=Wt.from(t);let s=Ps.Signature.fromCompact(_t(Fe([n.r,n.s])));s=s.addRecoveryBit(n.yParity);const i=s.recoverPublicKey(_t(e));return R(i!=null,"invalid signature for digest","signature",t),"0x"+i.toHex(!1)}static addPoints(e,t,n){const s=Ps.ProjectivePoint.fromHex(Ai.computePublicKey(e).substring(2)),i=Ps.ProjectivePoint.fromHex(Ai.computePublicKey(t).substring(2));return"0x"+s.add(i).toHex(!!n)}};Vn=new WeakMap;let Kc=Ai;const $I=BigInt(0),LI=BigInt(36);function Ny(r){r=r.toLowerCase();const e=r.substring(2).split(""),t=new Uint8Array(40);for(let s=0;s<40;s++)t[s]=e[s].charCodeAt(0);const n=ue(Qe(t));for(let s=0;s<40;s+=2)n[s>>1]>>4>=8&&(e[s]=e[s].toUpperCase()),(n[s>>1]&15)>=8&&(e[s+1]=e[s+1].toUpperCase());return"0x"+e.join("")}const ng={};for(let r=0;r<10;r++)ng[String(r)]=String(r);for(let r=0;r<26;r++)ng[String.fromCharCode(65+r)]=String(10+r);const Ry=15;function FI(r){r=r.toUpperCase(),r=r.substring(4)+r.substring(0,2)+"00";let e=r.split("").map(n=>ng[n]).join("");for(;e.length>=Ry;){let n=e.substring(0,Ry);e=parseInt(n,10)%97+e.substring(n.length)}let t=String(98-parseInt(e,10)%97);for(;t.length<2;)t="0"+t;return t}const MI=(function(){const r={};for(let e=0;e<36;e++){const t="0123456789abcdefghijklmnopqrstuvwxyz"[e];r[t]=BigInt(e)}return r})();function jI(r){r=r.toLowerCase();let e=$I;for(let t=0;t<r.length;t++)e=e*LI+MI[r[t]];return e}function Ie(r){if(R(typeof r=="string","invalid address","address",r),r.match(/^(0x)?[0-9a-fA-F]{40}$/)){r.startsWith("0x")||(r="0x"+r);const e=Ny(r);return R(!r.match(/([A-F].*[a-f])|([a-f].*[A-F])/)||e===r,"bad address checksum","address",r),e}if(r.match(/^XE[0-9]{2}[0-9A-Za-z]{30,31}$/)){R(r.substring(2,4)===FI(r),"bad icap checksum","address",r);let e=jI(r.substring(4)).toString(16);for(;e.length<40;)e="0"+e;return Ny("0x"+e)}R(!1,"invalid address","address",r)}function zI(r){const e=Ie(r.from);let n=re(r.nonce,"tx.nonce").toString(16);return n==="0"?n="0x":n.length%2?n="0x0"+n:n="0x"+n,Ie(Le(Qe(ti([e,n])),12))}function B1(r){return r&&typeof r.getAddress=="function"}async function cf(r,e){const t=await e;return(t==null||t==="0x0000000000000000000000000000000000000000")&&(q(typeof r!="string","unconfigured name","UNCONFIGURED_NAME",{value:r}),R(!1,"invalid AddressLike value; did not resolve to a value address","target",r)),Ie(t)}function Nt(r,e){if(typeof r=="string")return r.match(/^0x[0-9a-f]{40}$/i)?Ie(r):(q(e!=null,"ENS resolution requires a provider","UNSUPPORTED_OPERATION",{operation:"resolveName"}),cf(r,e.resolveName(r)));if(B1(r))return cf(r,r.getAddress());if(r&&typeof r.then=="function")return cf(r,r);R(!1,"unsupported addressable value","target",r)}const Ln={};function te(r,e){let t=!1;return e<0&&(t=!0,e*=-1),new Ot(Ln,`${t?"":"u"}int${e}`,r,{signed:t,width:e})}function me(r,e){return new Ot(Ln,`bytes${e||""}`,r,{size:e})}const Uy=Symbol.for("_ethers_typed");var Hi;const Fn=class Fn{constructor(e,t,n,s){F(this,"type");F(this,"value");M(this,Hi);F(this,"_typedSymbol");s==null&&(s=null),bl(Ln,e,"Typed"),ie(this,{_typedSymbol:Uy,type:t,value:n}),O(this,Hi,s),this.format()}format(){if(this.type==="array")throw new Error("");if(this.type==="dynamicArray")throw new Error("");return this.type==="tuple"?`tuple(${this.value.map(e=>e.format()).join(",")})`:this.type}defaultValue(){return 0}minValue(){return 0}maxValue(){return 0}isBigInt(){return!!this.type.match(/^u?int[0-9]+$/)}isData(){return this.type.startsWith("bytes")}isString(){return this.type==="string"}get tupleName(){if(this.type!=="tuple")throw TypeError("not a tuple");return y(this,Hi)}get arrayLength(){if(this.type!=="array")throw TypeError("not an array");return y(this,Hi)===!0?-1:y(this,Hi)===!1?this.value.length:null}static from(e,t){return new Fn(Ln,e,t)}static uint8(e){return te(e,8)}static uint16(e){return te(e,16)}static uint24(e){return te(e,24)}static uint32(e){return te(e,32)}static uint40(e){return te(e,40)}static uint48(e){return te(e,48)}static uint56(e){return te(e,56)}static uint64(e){return te(e,64)}static uint72(e){return te(e,72)}static uint80(e){return te(e,80)}static uint88(e){return te(e,88)}static uint96(e){return te(e,96)}static uint104(e){return te(e,104)}static uint112(e){return te(e,112)}static uint120(e){return te(e,120)}static uint128(e){return te(e,128)}static uint136(e){return te(e,136)}static uint144(e){return te(e,144)}static uint152(e){return te(e,152)}static uint160(e){return te(e,160)}static uint168(e){return te(e,168)}static uint176(e){return te(e,176)}static uint184(e){return te(e,184)}static uint192(e){return te(e,192)}static uint200(e){return te(e,200)}static uint208(e){return te(e,208)}static uint216(e){return te(e,216)}static uint224(e){return te(e,224)}static uint232(e){return te(e,232)}static uint240(e){return te(e,240)}static uint248(e){return te(e,248)}static uint256(e){return te(e,256)}static uint(e){return te(e,256)}static int8(e){return te(e,-8)}static int16(e){return te(e,-16)}static int24(e){return te(e,-24)}static int32(e){return te(e,-32)}static int40(e){return te(e,-40)}static int48(e){return te(e,-48)}static int56(e){return te(e,-56)}static int64(e){return te(e,-64)}static int72(e){return te(e,-72)}static int80(e){return te(e,-80)}static int88(e){return te(e,-88)}static int96(e){return te(e,-96)}static int104(e){return te(e,-104)}static int112(e){return te(e,-112)}static int120(e){return te(e,-120)}static int128(e){return te(e,-128)}static int136(e){return te(e,-136)}static int144(e){return te(e,-144)}static int152(e){return te(e,-152)}static int160(e){return te(e,-160)}static int168(e){return te(e,-168)}static int176(e){return te(e,-176)}static int184(e){return te(e,-184)}static int192(e){return te(e,-192)}static int200(e){return te(e,-200)}static int208(e){return te(e,-208)}static int216(e){return te(e,-216)}static int224(e){return te(e,-224)}static int232(e){return te(e,-232)}static int240(e){return te(e,-240)}static int248(e){return te(e,-248)}static int256(e){return te(e,-256)}static int(e){return te(e,-256)}static bytes1(e){return me(e,1)}static bytes2(e){return me(e,2)}static bytes3(e){return me(e,3)}static bytes4(e){return me(e,4)}static bytes5(e){return me(e,5)}static bytes6(e){return me(e,6)}static bytes7(e){return me(e,7)}static bytes8(e){return me(e,8)}static bytes9(e){return me(e,9)}static bytes10(e){return me(e,10)}static bytes11(e){return me(e,11)}static bytes12(e){return me(e,12)}static bytes13(e){return me(e,13)}static bytes14(e){return me(e,14)}static bytes15(e){return me(e,15)}static bytes16(e){return me(e,16)}static bytes17(e){return me(e,17)}static bytes18(e){return me(e,18)}static bytes19(e){return me(e,19)}static bytes20(e){return me(e,20)}static bytes21(e){return me(e,21)}static bytes22(e){return me(e,22)}static bytes23(e){return me(e,23)}static bytes24(e){return me(e,24)}static bytes25(e){return me(e,25)}static bytes26(e){return me(e,26)}static bytes27(e){return me(e,27)}static bytes28(e){return me(e,28)}static bytes29(e){return me(e,29)}static bytes30(e){return me(e,30)}static bytes31(e){return me(e,31)}static bytes32(e){return me(e,32)}static address(e){return new Fn(Ln,"address",e)}static bool(e){return new Fn(Ln,"bool",!!e)}static bytes(e){return new Fn(Ln,"bytes",e)}static string(e){return new Fn(Ln,"string",e)}static array(e,t){throw new Error("not implemented yet")}static tuple(e,t){throw new Error("not implemented yet")}static overrides(e){return new Fn(Ln,"overrides",Object.assign({},e))}static isTyped(e){return e&&typeof e=="object"&&"_typedSymbol"in e&&e._typedSymbol===Uy}static dereference(e,t){if(Fn.isTyped(e)){if(e.type!==t)throw new Error(`invalid type: expecetd ${t}, got ${e.type}`);return e.value}return e}};Hi=new WeakMap;let Ot=Fn;class HI extends fs{constructor(e){super("address","address",e,!1)}defaultValue(){return"0x0000000000000000000000000000000000000000"}encode(e,t){let n=Ot.dereference(t,"string");try{n=Ie(n)}catch(s){return this._throwError(s.message,t)}return e.writeValue(n)}decode(e){return Ie(Xs(e.readValue(),20))}}class qI extends fs{constructor(t){super(t.name,t.type,"_",t.dynamic);F(this,"coder");this.coder=t}defaultValue(){return this.coder.defaultValue()}encode(t,n){return this.coder.encode(t,n)}decode(t){return this.coder.decode(t)}}function _1(r,e,t){let n=[];if(Array.isArray(t))n=t;else if(t&&typeof t=="object"){let c={};n=e.map(l=>{const u=l.localName;return q(u,"cannot encode object for signature with missing names","INVALID_ARGUMENT",{argument:"values",info:{coder:l},value:t}),q(!c[u],"cannot encode object for signature with duplicate names","INVALID_ARGUMENT",{argument:"values",info:{coder:l},value:t}),c[u]=!0,t[u]})}else R(!1,"invalid tuple value","tuple",t);R(e.length===n.length,"types/value length mismatch","tuple",t);let s=new xd,i=new xd,o=[];e.forEach((c,l)=>{let u=n[l];if(c.dynamic){let h=i.length;c.encode(i,u);let f=s.writeUpdatableValue();o.push(d=>{f(d+h)})}else c.encode(s,u)}),o.forEach(c=>{c(s.length)});let a=r.appendWriter(s);return a+=r.appendWriter(i),a}function T1(r,e){let t=[],n=[],s=r.subReader(0);return e.forEach(i=>{let o=null;if(i.dynamic){let a=r.readIndex(),c=s.subReader(a);try{o=i.decode(c)}catch(l){if(ht(l,"BUFFER_OVERRUN"))throw l;o=l,o.baseType=i.name,o.name=i.localName,o.type=i.type}}else try{o=i.decode(r)}catch(a){if(ht(a,"BUFFER_OVERRUN"))throw a;o=a,o.baseType=i.name,o.name=i.localName,o.type=i.type}if(o==null)throw new Error("investigate");t.push(o),n.push(i.localName||null)}),ja.fromItems(t,n)}class VI extends fs{constructor(t,n,s){const i=t.type+"["+(n>=0?n:"")+"]",o=n===-1||t.dynamic;super("array",i,s,o);F(this,"coder");F(this,"length");ie(this,{coder:t,length:n})}defaultValue(){const t=this.coder.defaultValue(),n=[];for(let s=0;s<this.length;s++)n.push(t);return n}encode(t,n){const s=Ot.dereference(n,"array");Array.isArray(s)||this._throwError("expected array value",s);let i=this.length;i===-1&&(i=s.length,t.writeValue(s.length)),Lb(s.length,i,"coder array"+(this.localName?" "+this.localName:""));let o=[];for(let a=0;a<s.length;a++)o.push(this.coder);return _1(t,o,s)}decode(t){let n=this.length;n===-1&&(n=t.readIndex(),q(n*Tt<=t.dataLength,"insufficient data length","BUFFER_OVERRUN",{buffer:t.bytes,offset:n*Tt,length:t.dataLength}));let s=[];for(let i=0;i<n;i++)s.push(new qI(this.coder));return T1(t,s)}}class KI extends fs{constructor(e){super("bool","bool",e,!1)}defaultValue(){return!1}encode(e,t){const n=Ot.dereference(t,"bool");return e.writeValue(n?1:0)}decode(e){return!!e.readValue()}}class N1 extends fs{constructor(e,t){super(e,e,t,!0)}defaultValue(){return"0x"}encode(e,t){t=_t(t);let n=e.writeValue(t.length);return n+=e.writeBytes(t),n}decode(e){return e.readBytes(e.readIndex(),!0)}}class GI extends N1{constructor(e){super("bytes",e)}decode(e){return X(super.decode(e))}}class QI extends fs{constructor(t,n){let s="bytes"+String(t);super(s,s,n,!1);F(this,"size");ie(this,{size:t},{size:"number"})}defaultValue(){return"0x0000000000000000000000000000000000000000000000000000000000000000".substring(0,2+this.size*2)}encode(t,n){let s=_t(Ot.dereference(n,this.type));return s.length!==this.size&&this._throwError("incorrect data length",n),t.writeBytes(s)}decode(t){return X(t.readBytes(this.size))}}const WI=new Uint8Array([]);class JI extends fs{constructor(e){super("null","",e,!1)}defaultValue(){return null}encode(e,t){return t!=null&&this._throwError("not null",t),e.writeBytes(WI)}decode(e){return e.readBytes(0),null}}const YI=BigInt(0),ZI=BigInt(1),XI=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");class e3 extends fs{constructor(t,n,s){const i=(n?"int":"uint")+t*8;super(i,i,s,!1);F(this,"size");F(this,"signed");ie(this,{size:t,signed:n},{size:"number",signed:"boolean"})}defaultValue(){return 0}encode(t,n){let s=re(Ot.dereference(n,this.type)),i=Si(XI,Tt*8);if(this.signed){let o=Si(i,this.size*8-1);(s>o||s<-(o+ZI))&&this._throwError("value out-of-bounds",n),s=jb(s,8*Tt)}else(s<YI||s>Si(i,this.size*8))&&this._throwError("value out-of-bounds",n);return t.writeValue(s)}decode(t){let n=Si(t.readValue(),this.size*8);return this.signed&&(n=Tu(n,this.size*8)),n}}class t3 extends N1{constructor(e){super("string",e)}defaultValue(){return""}encode(e,t){return super.encode(e,rs(Ot.dereference(t,"string")))}decode(e){return Nu(super.decode(e))}}class ql extends fs{constructor(t,n){let s=!1;const i=[];t.forEach(a=>{a.dynamic&&(s=!0),i.push(a.type)});const o="tuple("+i.join(",")+")";super("tuple",o,n,s);F(this,"coders");ie(this,{coders:Object.freeze(t.slice())})}defaultValue(){const t=[];this.coders.forEach(s=>{t.push(s.defaultValue())});const n=this.coders.reduce((s,i)=>{const o=i.localName;return o&&(s[o]||(s[o]=0),s[o]++),s},{});return this.coders.forEach((s,i)=>{let o=s.localName;!o||n[o]!==1||(o==="length"&&(o="_length"),t[o]==null&&(t[o]=t[i]))}),Object.freeze(t)}encode(t,n){const s=Ot.dereference(n,"tuple");return _1(t,this.coders,s)}decode(t){return T1(t,this.coders)}}function lf(r,e){return{address:Ie(r),storageKeys:e.map((t,n)=>(R(_e(t,32),"invalid slot",`storageKeys[${n}]`,t),t.toLowerCase()))}}function ho(r){if(Array.isArray(r))return r.map((t,n)=>Array.isArray(t)?(R(t.length===2,"invalid slot set",`value[${n}]`,t),lf(t[0],t[1])):(R(t!=null&&typeof t=="object","invalid address-slot set","value",r),lf(t.address,t.storageKeys)));R(r!=null&&typeof r=="object","invalid access list","value",r);const e=Object.keys(r).map(t=>{const n=r[t].reduce((s,i)=>(s[i]=!0,s),{});return lf(t,Object.keys(n).sort())});return e.sort((t,n)=>t.address.localeCompare(n.address)),e}function R1(r){return{address:Ie(r.address),nonce:re(r.nonce!=null?r.nonce:0),chainId:re(r.chainId!=null?r.chainId:0),signature:Wt.from(r.signature)}}function r3(r){let e;return typeof r=="string"?e=Kc.computePublicKey(r,!1):e=r.publicKey,Ie(Qe("0x"+e.substring(4)).substring(26))}function n3(r,e){return r3(Kc.recoverPublicKey(r,e))}const rt=BigInt(0),s3=BigInt(2),i3=BigInt(27),o3=BigInt(28),a3=BigInt(35),c3=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),uf=4096*32;function l3(r){return{blobToKzgCommitment:n=>{if("computeBlobProof"in r){if("blobToKzgCommitment"in r&&typeof r.blobToKzgCommitment=="function")return ue(r.blobToKzgCommitment(X(n)))}else if("blobToKzgCommitment"in r&&typeof r.blobToKzgCommitment=="function")return ue(r.blobToKzgCommitment(n));if("blobToKZGCommitment"in r&&typeof r.blobToKZGCommitment=="function")return ue(r.blobToKZGCommitment(X(n)));R(!1,"unsupported KZG library","kzg",r)},computeBlobKzgProof:(n,s)=>{if("computeBlobProof"in r&&typeof r.computeBlobProof=="function")return ue(r.computeBlobProof(X(n),X(s)));if("computeBlobKzgProof"in r&&typeof r.computeBlobKzgProof=="function")return r.computeBlobKzgProof(n,s);if("computeBlobKZGProof"in r&&typeof r.computeBlobKZGProof=="function")return ue(r.computeBlobKZGProof(X(n),X(s)));R(!1,"unsupported KZG library","kzg",r)}}}function ky(r,e){let t=r.toString(16);for(;t.length<2;)t="0"+t;return t+=Za(e).substring(4),"0x"+t}function Xa(r){return r==="0x"?null:Ie(r)}function Sh(r,e){try{return ho(r)}catch(t){R(!1,t.message,e,r)}}function u3(r,e){try{if(!Array.isArray(r))throw new Error("authorizationList: invalid array");const t=[];for(let n=0;n<r.length;n++){const s=r[n];if(!Array.isArray(s))throw new Error(`authorization[${n}]: invalid array`);if(s.length!==6)throw new Error(`authorization[${n}]: wrong length`);if(!s[1])throw new Error(`authorization[${n}]: null address`);t.push({address:Xa(s[1]),nonce:Oe(s[2],"nonce"),chainId:Oe(s[0],"chainId"),signature:Wt.from({yParity:fo(s[3],"yParity"),r:as(s[4],32),s:as(s[5],32)})})}return t}catch(t){R(!1,t.message,e,r)}}function fo(r,e){return r==="0x"?0:oe(r,e)}function Oe(r,e){if(r==="0x")return rt;const t=re(r,e);return R(t<=c3,"value exceeds uint size",e,t),t}function ye(r,e){const t=re(r,"value"),n=Ze(t);return R(n.length<=32,"value too large",`tx.${e}`,t),n}function Ph(r){return ho(r).map(e=>[e.address,e.storageKeys])}function h3(r){return r.map(e=>[ye(e.chainId,"chainId"),e.address,ye(e.nonce,"nonce"),ye(e.signature.yParity,"yParity"),Ze(e.signature.r),Ze(e.signature.s)])}function f3(r,e){R(Array.isArray(r),`invalid ${e}`,"value",r);for(let t=0;t<r.length;t++)R(_e(r[t],32),"invalid ${ param } hash",`value[${t}]`,r[t]);return r}function d3(r){const e=vl(r);R(Array.isArray(e)&&(e.length===9||e.length===6),"invalid field count for legacy transaction","data",r);const t={type:0,nonce:fo(e[0],"nonce"),gasPrice:Oe(e[1],"gasPrice"),gasLimit:Oe(e[2],"gasLimit"),to:Xa(e[3]),value:Oe(e[4],"value"),data:X(e[5]),chainId:rt};if(e.length===6)return t;const n=Oe(e[6],"v"),s=Oe(e[7],"r"),i=Oe(e[8],"s");if(s===rt&&i===rt)t.chainId=n;else{let o=(n-a3)/s3;o<rt&&(o=rt),t.chainId=o,R(o!==rt||n===i3||n===o3,"non-canonical legacy v","v",e[6]),t.signature=Wt.from({r:as(e[7],32),s:as(e[8],32),v:n})}return t}function p3(r,e){const t=[ye(r.nonce,"nonce"),ye(r.gasPrice||0,"gasPrice"),ye(r.gasLimit,"gasLimit"),r.to||"0x",ye(r.value,"value"),r.data];let n=rt;if(r.chainId!=rt)n=re(r.chainId,"tx.chainId"),R(!e||e.networkV==null||e.legacyChainId===n,"tx.chainId/sig.v mismatch","sig",e);else if(r.signature){const i=r.signature.legacyChainId;i!=null&&(n=i)}if(!e)return n!==rt&&(t.push(Ze(n)),t.push("0x"),t.push("0x")),ti(t);let s=BigInt(27+e.yParity);return n!==rt?s=Wt.getChainIdV(n,e.v):BigInt(e.v)!==s&&R(!1,"tx.chainId/sig.v mismatch","sig",e),t.push(Ze(s)),t.push(Ze(e.r)),t.push(Ze(e.s)),ti(t)}function Oh(r,e){let t;try{if(t=fo(e[0],"yParity"),t!==0&&t!==1)throw new Error("bad yParity")}catch{R(!1,"invalid yParity","yParity",e[0])}const n=as(e[1],32),s=as(e[2],32),i=Wt.from({r:n,s,yParity:t});r.signature=i}function g3(r){const e=vl(ue(r).slice(1));R(Array.isArray(e)&&(e.length===9||e.length===12),"invalid field count for transaction type: 2","data",X(r));const t={type:2,chainId:Oe(e[0],"chainId"),nonce:fo(e[1],"nonce"),maxPriorityFeePerGas:Oe(e[2],"maxPriorityFeePerGas"),maxFeePerGas:Oe(e[3],"maxFeePerGas"),gasPrice:null,gasLimit:Oe(e[4],"gasLimit"),to:Xa(e[5]),value:Oe(e[6],"value"),data:X(e[7]),accessList:Sh(e[8],"accessList")};return e.length===9||Oh(t,e.slice(9)),t}function y3(r,e){const t=[ye(r.chainId,"chainId"),ye(r.nonce,"nonce"),ye(r.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),ye(r.maxFeePerGas||0,"maxFeePerGas"),ye(r.gasLimit,"gasLimit"),r.to||"0x",ye(r.value,"value"),r.data,Ph(r.accessList||[])];return e&&(t.push(ye(e.yParity,"yParity")),t.push(Ze(e.r)),t.push(Ze(e.s))),Fe(["0x02",ti(t)])}function m3(r){const e=vl(ue(r).slice(1));R(Array.isArray(e)&&(e.length===8||e.length===11),"invalid field count for transaction type: 1","data",X(r));const t={type:1,chainId:Oe(e[0],"chainId"),nonce:fo(e[1],"nonce"),gasPrice:Oe(e[2],"gasPrice"),gasLimit:Oe(e[3],"gasLimit"),to:Xa(e[4]),value:Oe(e[5],"value"),data:X(e[6]),accessList:Sh(e[7],"accessList")};return e.length===8||Oh(t,e.slice(8)),t}function w3(r,e){const t=[ye(r.chainId,"chainId"),ye(r.nonce,"nonce"),ye(r.gasPrice||0,"gasPrice"),ye(r.gasLimit,"gasLimit"),r.to||"0x",ye(r.value,"value"),r.data,Ph(r.accessList||[])];return e&&(t.push(ye(e.yParity,"recoveryParam")),t.push(Ze(e.r)),t.push(Ze(e.s))),Fe(["0x01",ti(t)])}function b3(r){let e=vl(ue(r).slice(1)),t="3",n=null;if(e.length===4&&Array.isArray(e[0])){t="3 (network format)";const i=e[1],o=e[2],a=e[3];R(Array.isArray(i),"invalid network format: blobs not an array","fields[1]",i),R(Array.isArray(o),"invalid network format: commitments not an array","fields[2]",o),R(Array.isArray(a),"invalid network format: proofs not an array","fields[3]",a),R(i.length===o.length,"invalid network format: blobs/commitments length mismatch","fields",e),R(i.length===a.length,"invalid network format: blobs/proofs length mismatch","fields",e),n=[];for(let c=0;c<e[1].length;c++)n.push({data:i[c],commitment:o[c],proof:a[c]});e=e[0]}R(Array.isArray(e)&&(e.length===11||e.length===14),`invalid field count for transaction type: ${t}`,"data",X(r));const s={type:3,chainId:Oe(e[0],"chainId"),nonce:fo(e[1],"nonce"),maxPriorityFeePerGas:Oe(e[2],"maxPriorityFeePerGas"),maxFeePerGas:Oe(e[3],"maxFeePerGas"),gasPrice:null,gasLimit:Oe(e[4],"gasLimit"),to:Xa(e[5]),value:Oe(e[6],"value"),data:X(e[7]),accessList:Sh(e[8],"accessList"),maxFeePerBlobGas:Oe(e[9],"maxFeePerBlobGas"),blobVersionedHashes:e[10]};n&&(s.blobs=n),R(s.to!=null,`invalid address for transaction type: ${t}`,"data",r),R(Array.isArray(s.blobVersionedHashes),"invalid blobVersionedHashes: must be an array","data",r);for(let i=0;i<s.blobVersionedHashes.length;i++)R(_e(s.blobVersionedHashes[i],32),`invalid blobVersionedHash at index ${i}: must be length 32`,"data",r);return e.length===11||Oh(s,e.slice(11)),s}function v3(r,e,t){const n=[ye(r.chainId,"chainId"),ye(r.nonce,"nonce"),ye(r.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),ye(r.maxFeePerGas||0,"maxFeePerGas"),ye(r.gasLimit,"gasLimit"),r.to||Vc,ye(r.value,"value"),r.data,Ph(r.accessList||[]),ye(r.maxFeePerBlobGas||0,"maxFeePerBlobGas"),f3(r.blobVersionedHashes||[],"blobVersionedHashes")];return e&&(n.push(ye(e.yParity,"yParity")),n.push(Ze(e.r)),n.push(Ze(e.s)),t)?Fe(["0x03",ti([n,t.map(s=>s.data),t.map(s=>s.commitment),t.map(s=>s.proof)])]):Fe(["0x03",ti(n)])}function E3(r){const e=vl(ue(r).slice(1));R(Array.isArray(e)&&(e.length===10||e.length===13),"invalid field count for transaction type: 4","data",X(r));const t={type:4,chainId:Oe(e[0],"chainId"),nonce:fo(e[1],"nonce"),maxPriorityFeePerGas:Oe(e[2],"maxPriorityFeePerGas"),maxFeePerGas:Oe(e[3],"maxFeePerGas"),gasPrice:null,gasLimit:Oe(e[4],"gasLimit"),to:Xa(e[5]),value:Oe(e[6],"value"),data:X(e[7]),accessList:Sh(e[8],"accessList"),authorizationList:u3(e[9],"authorizationList")};return e.length===10||Oh(t,e.slice(10)),t}function A3(r,e){const t=[ye(r.chainId,"chainId"),ye(r.nonce,"nonce"),ye(r.maxPriorityFeePerGas||0,"maxPriorityFeePerGas"),ye(r.maxFeePerGas||0,"maxFeePerGas"),ye(r.gasLimit,"gasLimit"),r.to||"0x",ye(r.value,"value"),r.data,Ph(r.accessList||[]),h3(r.authorizationList||[])];return e&&(t.push(ye(e.yParity,"yParity")),t.push(Ze(e.r)),t.push(Ze(e.s))),Fe(["0x04",ti(t)])}var jr,ha,fa,da,pa,ga,ya,ma,wa,ba,va,Ea,qi,ks,un,$s,Aa,xa,gu;const an=class an{constructor(){M(this,xa);M(this,jr);M(this,ha);M(this,fa);M(this,da);M(this,pa);M(this,ga);M(this,ya);M(this,ma);M(this,wa);M(this,ba);M(this,va);M(this,Ea);M(this,qi);M(this,ks);M(this,un);M(this,$s);M(this,Aa);O(this,jr,null),O(this,ha,null),O(this,da,0),O(this,pa,rt),O(this,ga,null),O(this,ya,null),O(this,ma,null),O(this,fa,"0x"),O(this,wa,rt),O(this,ba,rt),O(this,va,null),O(this,Ea,null),O(this,qi,null),O(this,ks,null),O(this,un,null),O(this,$s,null),O(this,Aa,null)}get type(){return y(this,jr)}set type(e){switch(e){case null:O(this,jr,null);break;case 0:case"legacy":O(this,jr,0);break;case 1:case"berlin":case"eip-2930":O(this,jr,1);break;case 2:case"london":case"eip-1559":O(this,jr,2);break;case 3:case"cancun":case"eip-4844":O(this,jr,3);break;case 4:case"pectra":case"eip-7702":O(this,jr,4);break;default:R(!1,"unsupported transaction type","type",e)}}get typeName(){switch(this.type){case 0:return"legacy";case 1:return"eip-2930";case 2:return"eip-1559";case 3:return"eip-4844";case 4:return"eip-7702"}return null}get to(){const e=y(this,ha);return e==null&&this.type===3?Vc:e}set to(e){O(this,ha,e==null?null:Ie(e))}get nonce(){return y(this,da)}set nonce(e){O(this,da,oe(e,"value"))}get gasLimit(){return y(this,pa)}set gasLimit(e){O(this,pa,re(e))}get gasPrice(){const e=y(this,ga);return e==null&&(this.type===0||this.type===1)?rt:e}set gasPrice(e){O(this,ga,e==null?null:re(e,"gasPrice"))}get maxPriorityFeePerGas(){const e=y(this,ya);return e??(this.type===2||this.type===3?rt:null)}set maxPriorityFeePerGas(e){O(this,ya,e==null?null:re(e,"maxPriorityFeePerGas"))}get maxFeePerGas(){const e=y(this,ma);return e??(this.type===2||this.type===3?rt:null)}set maxFeePerGas(e){O(this,ma,e==null?null:re(e,"maxFeePerGas"))}get data(){return y(this,fa)}set data(e){O(this,fa,X(e))}get value(){return y(this,wa)}set value(e){O(this,wa,re(e,"value"))}get chainId(){return y(this,ba)}set chainId(e){O(this,ba,re(e))}get signature(){return y(this,va)||null}set signature(e){O(this,va,e==null?null:Wt.from(e))}get accessList(){const e=y(this,Ea)||null;return e??(this.type===1||this.type===2||this.type===3?[]:null)}set accessList(e){O(this,Ea,e==null?null:ho(e))}get authorizationList(){const e=y(this,Aa)||null;return e==null&&this.type===4?[]:e}set authorizationList(e){O(this,Aa,e==null?null:e.map(t=>R1(t)))}get maxFeePerBlobGas(){const e=y(this,qi);return e==null&&this.type===3?rt:e}set maxFeePerBlobGas(e){O(this,qi,e==null?null:re(e,"maxFeePerBlobGas"))}get blobVersionedHashes(){let e=y(this,ks);return e==null&&this.type===3?[]:e}set blobVersionedHashes(e){if(e!=null){R(Array.isArray(e),"blobVersionedHashes must be an Array","value",e),e=e.slice();for(let t=0;t<e.length;t++)R(_e(e[t],32),"invalid blobVersionedHash",`value[${t}]`,e[t])}O(this,ks,e)}get blobs(){return y(this,$s)==null?null:y(this,$s).map(e=>Object.assign({},e))}set blobs(e){if(e==null){O(this,$s,null);return}const t=[],n=[];for(let s=0;s<e.length;s++){const i=e[s];if(Wp(i)){q(y(this,un),"adding a raw blob requires a KZG library","UNSUPPORTED_OPERATION",{operation:"set blobs()"});let o=ue(i);if(R(o.length<=uf,"blob is too large",`blobs[${s}]`,i),o.length!==uf){const l=new Uint8Array(uf);l.set(o),o=l}const a=y(this,un).blobToKzgCommitment(o),c=X(y(this,un).computeBlobKzgProof(o,a));t.push({data:X(o),commitment:X(a),proof:c}),n.push(ky(1,a))}else{const o=X(i.commitment);t.push({data:X(i.data),commitment:o,proof:X(i.proof)}),n.push(ky(1,o))}}O(this,$s,t),O(this,ks,n)}get kzg(){return y(this,un)}set kzg(e){e==null?O(this,un,null):O(this,un,l3(e))}get hash(){return this.signature==null?null:Qe(K(this,xa,gu).call(this,!0,!1))}get unsignedHash(){return Qe(this.unsignedSerialized)}get from(){return this.signature==null?null:n3(this.unsignedHash,this.signature)}get fromPublicKey(){return this.signature==null?null:Kc.recoverPublicKey(this.unsignedHash,this.signature)}isSigned(){return this.signature!=null}get serialized(){return K(this,xa,gu).call(this,!0,!0)}get unsignedSerialized(){return K(this,xa,gu).call(this,!1,!1)}inferType(){const e=this.inferTypes();return e.indexOf(2)>=0?2:e.pop()}inferTypes(){const e=this.gasPrice!=null,t=this.maxFeePerGas!=null||this.maxPriorityFeePerGas!=null,n=this.accessList!=null,s=y(this,qi)!=null||y(this,ks);this.maxFeePerGas!=null&&this.maxPriorityFeePerGas!=null&&q(this.maxFeePerGas>=this.maxPriorityFeePerGas,"priorityFee cannot be more than maxFee","BAD_DATA",{value:this}),q(!t||this.type!==0&&this.type!==1,"transaction type cannot have maxFeePerGas or maxPriorityFeePerGas","BAD_DATA",{value:this}),q(this.type!==0||!n,"legacy transaction cannot have accessList","BAD_DATA",{value:this});const i=[];return this.type!=null?i.push(this.type):this.authorizationList&&this.authorizationList.length?i.push(4):t?i.push(2):e?(i.push(1),n||i.push(0)):n?(i.push(1),i.push(2)):(s&&this.to||(i.push(0),i.push(1),i.push(2)),i.push(3)),i.sort(),i}isLegacy(){return this.type===0}isBerlin(){return this.type===1}isLondon(){return this.type===2}isCancun(){return this.type===3}clone(){return an.from(this)}toJSON(){const e=t=>t==null?null:t.toString();return{type:this.type,to:this.to,data:this.data,nonce:this.nonce,gasLimit:e(this.gasLimit),gasPrice:e(this.gasPrice),maxPriorityFeePerGas:e(this.maxPriorityFeePerGas),maxFeePerGas:e(this.maxFeePerGas),value:e(this.value),chainId:e(this.chainId),sig:this.signature?this.signature.toJSON():null,accessList:this.accessList}}static from(e){if(e==null)return new an;if(typeof e=="string"){const n=ue(e);if(n[0]>=127)return an.from(d3(n));switch(n[0]){case 1:return an.from(m3(n));case 2:return an.from(g3(n));case 3:return an.from(b3(n));case 4:return an.from(E3(n))}q(!1,"unsupported transaction type","UNSUPPORTED_OPERATION",{operation:"from"})}const t=new an;return e.type!=null&&(t.type=e.type),e.to!=null&&(t.to=e.to),e.nonce!=null&&(t.nonce=e.nonce),e.gasLimit!=null&&(t.gasLimit=e.gasLimit),e.gasPrice!=null&&(t.gasPrice=e.gasPrice),e.maxPriorityFeePerGas!=null&&(t.maxPriorityFeePerGas=e.maxPriorityFeePerGas),e.maxFeePerGas!=null&&(t.maxFeePerGas=e.maxFeePerGas),e.maxFeePerBlobGas!=null&&(t.maxFeePerBlobGas=e.maxFeePerBlobGas),e.data!=null&&(t.data=e.data),e.value!=null&&(t.value=e.value),e.chainId!=null&&(t.chainId=e.chainId),e.signature!=null&&(t.signature=Wt.from(e.signature)),e.accessList!=null&&(t.accessList=e.accessList),e.authorizationList!=null&&(t.authorizationList=e.authorizationList),e.blobVersionedHashes!=null&&(t.blobVersionedHashes=e.blobVersionedHashes),e.kzg!=null&&(t.kzg=e.kzg),e.blobs!=null&&(t.blobs=e.blobs),e.hash!=null&&(R(t.isSigned(),"unsigned transaction cannot define '.hash'","tx",e),R(t.hash===e.hash,"hash mismatch","tx",e)),e.from!=null&&(R(t.isSigned(),"unsigned transaction cannot define '.from'","tx",e),R(t.from.toLowerCase()===(e.from||"").toLowerCase(),"from mismatch","tx",e)),t}};jr=new WeakMap,ha=new WeakMap,fa=new WeakMap,da=new WeakMap,pa=new WeakMap,ga=new WeakMap,ya=new WeakMap,ma=new WeakMap,wa=new WeakMap,ba=new WeakMap,va=new WeakMap,Ea=new WeakMap,qi=new WeakMap,ks=new WeakMap,un=new WeakMap,$s=new WeakMap,Aa=new WeakMap,xa=new WeakSet,gu=function(e,t){q(!e||this.signature!=null,"cannot serialize unsigned transaction; maybe you meant .unsignedSerialized","UNSUPPORTED_OPERATION",{operation:".serialized"});const n=e?this.signature:null;switch(this.inferType()){case 0:return p3(this,n);case 1:return w3(this,n);case 2:return y3(this,n);case 3:return v3(this,n,t?this.blobs:null);case 4:return A3(this,n)}q(!1,"unsupported transaction type","UNSUPPORTED_OPERATION",{operation:".serialized"})};let ku=an;function to(r){return Qe(rs(r))}var x3="AEEUdwmgDS8BxQKKAP4BOgDjATAAngDUAIMAoABoAOAAagCOAEQAhABMAHIAOwA9ACsANgAmAGIAHgAuACgAJwAXAC0AGgAjAB8ALwAUACkAEgAeAAkAGwARABkAFgA5ACgALQArADcAFQApABAAHgAiABAAGgAeABMAGAUhBe8BFxREN8sF2wC5AK5HAW8ArQkDzQCuhzc3NzcBP68NEfMABQdHBuw5BV8FYAA9MzkI9r4ZBg7QyQAWA9CeOwLNCjcCjqkChuA/lm+RAsXTAoP6ASfnEQDytQFJAjWVCkeXAOsA6godAB/cwdAUE0WlBCN/AQUCQRjFD/MRBjHxDQSJbw0jBzUAswBxme+tnIcAYwabAysG8QAjAEMMmxcDqgPKQyDXCMMxA7kUQwD3NXOrAKmFIAAfBC0D3x4BJQDBGdUFAhEgVD8JnwmQJiNWYUzrg0oAGwAUAB0AFnNcACkAFgBP9h3gPfsDOWDKneY2ChglX1UDYD30ABsAFAAdABZzIGRAnwDD8wAjAEEMzRbDqgMB2sAFYwXqAtCnAsS4AwpUJKRtFHsadUz9AMMVbwLpABM1NJEX0ZkCgYMBEyMAxRVvAukAEzUBUFAtmUwSAy4DBTER33EftQHfSwB5MxJ/AjkWKQLzL8E/cwBB6QH9LQDPDtO9ASNriQC5DQANAwCK21EFI91zHwCoL9kBqQcHBwcHKzUDowBvAQohPvU3fAQgHwCyAc8CKQMA5zMSezr7ULgFmDp/LzVQBgEGAi8FYQVgt8AFcTtlQhpCWEmfe5tmZ6IAExsDzQ8t+X8rBKtTAltbAn0jsy8Bl6utPWMDTR8Ei2kRANkDBrNHNysDBzECQWUAcwFpJ3kAiyUhAJ0BUb8AL3EfAbfNAz81KUsFWwF3YQZtAm0A+VEfAzEJDQBRSQCzAQBlAHsAM70GD/v3IZWHBwARKQAxALsjTwHZAeMPEzmXgIHwABIAGQA8AEUAQDt3gdvIEGcQZAkGTRFMdEIVEwK0D64L7REdDNkq09PgADSxB/MDWwfzA1sDWwfzB/MDWwfzA1sDWwNbA1scEvAi28gQZw9QBHUFlgWTBN4IiyZREYkHMAjaVBV0JhxPA00BBCMtSSQ7mzMTJUpMFE0LCAQ2SmyvfUADTzGzVP2QqgPTMlc5dAkGHnkSqAAyD3skNb1OhnpPcagKU0+2tYdJak5vAsY6sEAACikJm2/Dd1YGRRAfJ6kQ+ww3AbkBPw3xS9wE9QY/BM0fgRkdD9GVoAipLeEM8SbnLqWAXiP5KocF8Uv4POELUVFsD10LaQnnOmeBUgMlAREijwrhDT0IcRD3Cs1vDekRSQc9A9lJngCpBwULFR05FbkmFGKwCw05ewb/GvoLkyazEy17AAXXGiUGUQEtGwMA0y7rhbRaNVwgT2MGBwspI8sUrFAkDSlAu3hMGh8HGSWtApVDdEqLUToelyH6PEENai4XUYAH+TwJGVMLhTyiRq9FEhHWPpE9TCJNTDAEOYMsMyePCdMPiQy9fHYBXQklCbUMdRM1ERs3yQg9Bx0xlygnGQglRplgngT7owP3E9UDDwVDCUUHFwO5HDETMhUtBRGBKNsC9zbZLrcCk1aEARsFzw8pH+MQVEfkDu0InwJpA4cl7wAxFSUAGyKfCEdnAGOP3FMJLs8Iy2pwI3gDaxTrZRF3B5UOWwerHDcVwxzlcMxeD4YMKKezCV8BeQmdAWME5wgNNV+MpCBFZ1eLXBifIGVBQ14AAjUMaRWjRMGHfAKPD28SHwE5AXcHPQ0FAnsR8RFvEJkI74YINbkz/DopBFMhhyAVCisDU2zSCysm/Qz8bQGnEmYDEDRBd/Jnr2C6KBgBBx0yyUFkIfULlk/RDKAaxRhGVDIZ6AfDA/ca9yfuQVsGAwOnBxc6UTPyBMELbQiPCUMATQ6nGwfbGG4KdYzUATWPAbudA1uVhwJzkwY7Bw8Aaw+LBX3pACECqwinAAkA0wNbAD0CsQehAB0AiUUBQQMrMwEl6QKTA5cINc8BmTMB9y0EH8cMGQD7O25OAsO1AoBuZqYF4VwCkgJNOQFRKQQJUktVA7N15QDfAE8GF+NLARmvTs8e50cB43MvAMsA/wAJOQcJRQHRAfdxALsBYws1Caa3uQFR7S0AhwAZbwHbAo0A4QA5AIP1AVcAUQVd/QXXAlNNARU1HC9bZQG/AyMBNwERAH0Gz5GpzQsjBHEH1wIQHxXlAu8yB7kFAyLjE9FCyQK94lkAMhoKPAqrCqpgX2Q3CjV2PVQAEh+sPss/UgVVO1c7XDtXO1w7VztcO1c7XDtXO1wDm8Pmw+YKcF9JYe8Mqg3YRMw6TRPfYFVgNhPMLbsUxRXSJVoZQRrAJwkl6FUNDwgt12Y0CDA0eRfAAEMpbINFY4oeNApPHOtTlVT8LR8AtUumM7MNsBsZREQFS3XxYi4WEgomAmSFAmJGX1GzAV83JAKh+wJonAJmDQKfiDgfDwJmPwJmKgRyBIMDfxcDfpY5Cjl7GzmGOicnAmwhAjI6OA4CbcsCbbLzjgM3a0kvAWsA4gDlAE4JB5wMkQECD8YAEbkCdzMCdqZDAnlPRwJ4viFg30WyRvcCfEMCeswCfQ0CfPRIBEiBZygALxlJXEpfGRtK0ALRBQLQ0EsrA4hTA4fqRMmRNgLypV0HAwOyS9JMMSkH001QTbMCi0MCitzFHwshR2sJuwKOOwKOYESbhQKO3QKOYHxRuFM5AQ5S2FSJApP/ApMQAO0AIFUiVbNV1AosHymZijLleGpFPz0Cl6MC77ZYJawAXSkClpMCloCgAK1ZsFoNhVEAPwKWuQKWUlxIXNUCmc8CmWhczl0LHQKcnznGOqECnBoCn58CnryOACETNS4TAp31Ap6WALlBYThh8wKe1wKgcgGtAp6jIwKeUqljzGQrKS8CJ7MCJoICoP8CoFDbAqYzAqXSAqgDAIECp/ZogGi1AAdNaiBq1QKs5wKssgKtawKtBgJXIQJV4AKx5dsDH1JsmwKywRECsuwbbORtZ21MYwMl0QK2YD9DbpQDKUkCuGICuUsZArkue3A6cOUCvR0DLbYDMhUCvoxyBgMzdQK+HnMmc1MCw88CwwhzhnRPOUl05AM8qwEDPJ4DPcMCxYACxksCxhSNAshtVQLISALJUwLJMgJkoQLd1nh9ZXiyeSlL1AMYp2cGAmH4GfeVKHsPXpZevxUCz28Cz3AzT1fW9xejAMqxAs93AS3uA04Wfk8JAtwrAtuOAtJTA1JgA1NjAQUDVZCAjUMEzxrxZEl5A4LSg5EC2ssC2eKEFIRNp0ADhqkAMwNkEoZ1Xf0AWQLfaQLevHd7AuIz7RgB8zQrAfSfAfLWiwLr9wLpdH0DAur9AuroAP1LAb0C7o0C66CWrpcHAu5DA4XkmH1w5HGlAvMHAG0DjhqZlwL3FwORcgOSiwL3nAL53QL4apogmq+/O5siA52HAv7+AR8APZ8gAZ+3AwWRA6ZuA6bdANXJAwZuoYyiCQ0DDE0BEwEjB3EGZb1rCQC/BG/DFY8etxEAG3k9ACcDNxJRA42DAWcrJQCM8wAlAOanC6OVCLsGI6fJBgCvBRnDBvElRUYFFoAFcD9GSDNCKUK8X3kZX8QAls0FOgCQVCGbwTsuYDoZutcONxjOGJHJ/gVfBWAFXwVgBWsFYAVfBWAFXwVgBV8FYAVfBWBOHQjfjW8KCgoKbF7xMwTRA7kGN8PDAMMEr8MA70gxFroFTj5xPnhCR0K+X30/X/AAWBkzswCNBsxzzASm70aCRS4rDDMeLz49fnXfcsH5GcoscQFz13Y4HwVnBXLJycnACNdRYwgICAqEXoWTxgA7P4kACxbZBu21Kw0AjMsTAwkVAOVtJUUsJ1JCuULESUArXy9gPi9AKwnJRQYKTD9LPoA+iT54PnkCkULEUUpDX9NWV3JVEjQAc1w3A3IBE3YnX+g7QiMJb6MKaiszRCUuQrNCxDPMCcwEX9EWJzYREBEEBwIHKn6l33JCNVIfybPJtAltydPUCmhBZw/tEKsZAJOVJU1CLRuxbUHOQAo7P0s+eEJHHA8SJVRPdGM0NVrpvBoKhfUlM0JHHGUQUhEWO1xLSj8MO0ucNAqJIzVCRxv9EFsqKyA4OQgNj2nwZgp5ZNFgE2A1K3YHS2AhQQojJmC7DgpzGG1WYFUZCQYHZO9gHWCdYIVgu2BTYJlwFh8GvRbcXbG8YgtDHrMBwzPVyQonHQgkCyYBgQJ0Ajc4nVqIAwGSCsBPIgDsK3SWEtIVBa5N8gGjAo+kVwVIZwD/AEUSCDweX4ITrRQsJ8K3TwBXFDwEAB0TvzVcAtoTS20RIwDgVgZ9BBImYgA5AL4Coi8LFnezOkCnIQFjAY4KBAPh9RcGsgZSBsEAJctdsWIRu2kTkQstRw7DAcMBKgpPBGIGMDAwKCYnKTQaLg4AKRSVAFwCdl+YUZ0JdicFD3lPAdt1F9ZZKCGxuE3yBxkFVGcA/wBFEgiCBwAOLHQSjxOtQDg1z7deFRMAZ8QTAGtKb1ApIiPHADkAvgKiLy1DFtYCmBiDAlDDWNB0eo7fpaMO/aEVRRv0ATEQZBIODyMEAc8JQhCbDRgzFD4TAEMAu9YBCgCsAOkAm5I3ABwAYxvONnR+MhXJAxgKQyxL2+kkJhMbhQKDBMkSsvF0AD9BNQ6uQC7WqSQHwxEAEEIu1hkhAH2z4iQPwyJPHNWpdyYBRSpnJALzoBAEVPPsH20MxA0CCEQKRgAFyAtFAlMNwwjEDUQJRArELtapMg7DDZgJIw+TGukEIwvDFkMAqAtDEMMMBhioe+QAO3MMRAACrgnEBSPY9Q0FDnbSBoMAB8MSYxkSxAEJAPIJAAB8FWMOFtMc/HcXwxhDAC7DAvOowwAewwJdKDKHAAHDAALrFUQVwwAbwyvzpWMWv8wA/ABpAy++bcYDUKPD0KhDCwKmJ1MAAmMA5+UZwxAagwipBRL/eADfw6fDGOMCGsOjk3l6BwOpo4sAEsMOGxMAA5sAbcMOAAvDp0MJGkMDwgipnNIPAwfIqUMGAOGDAAPzABXDAAcDAAnDAGmTABrDAA7DChjDjnEWAwABYwAOcwAuUyYABsMAF8MIKQANUgC6wy4AA8MADqMq8wCyYgAcIwAB8wqpAAXOCx0V4wAHowBCwwEKAGnDAAuDAB3DAAjDCakABdIAbqcZ3QCZCCkABdIAAAFDAAfjAB2jCCkABqIACYMAGzMAbSMA5sOIAAhjAAhDABTDBAkpAAbSAOOTAAlDC6kOzPtnAAdDAG6kQFAATwAKwwwAA0MACbUDPwAHIwAZgwACE6cDAAojAApDAAoDp/MGwwAJIwADEwAQQwgAFEMAEXMAD5MADfMADcMAGRMOFiMAFUMAbqMWuwHDAMIAE0MLAGkzEgDhUwACQwAEWgAXgwUjAAbYABjDBSYBgzBaAEFNALcQBxUMegAwMngBrA0IZgJ0KxQHBREPd1N0ZzKRJwaIHAZqNT4DqQq8BwngAB4DAwt2AX56T1ocKQNXAh1GATQGC3tOxYNagkgAMQA5CQADAQEAWxLjAIOYNAEzAH7tFRk6TglSAF8NAAlYAQ+S1ACAQwQorQBiAN4dAJ1wPyeTANVzuQDX3AIeEMp9eyMgXiUAEdkBkJizKltbVVAaRMqRAAEAhyQ/SDEz6BmfVwB6ATEsOClKIRcDOF0E/832AFNt5AByAnkCRxGCOs94NjXdAwINGBonDBwPALW2AwICAgAAAAAAAAYDBQMDARrUAwAtAAAAAgEGBgYGBgYFBQUFBQUEBQYHCAkEBQUFBQQAAAICAAAAIgCNAJAAlT0A6gC7ANwApEQAwgCyAK0AqADuAKYA2gCjAOcBCAEDAMcAgQBiANIA1AEDAN4A8gCQAKkBMQDqAN8A3AsBCQ8yO9ra2tq8xuLT1tRJOB0BUgFcNU0BWgFpAWgBWwFMUUlLbhMBUxsNEAs6PhMOACcUKy0vMj5AQENDQ0RFFEYGJFdXV1dZWVhZL1pbXVxcI2NnZ2ZoZypsbnZ1eHh4eHh4enp6enp6enp6enp8fH18e2IARPIASQCaAHgAMgBm+ACOAFcAVwA3AnbvAIsABfj4AGQAk/IAnwBPAGIAZP//sACFAIUAaQBWALEAJAC2AIMCQAJDAPwA5wD+AP4A6AD/AOkA6QDoAOYALwJ7AVEBQAE+AVQBPgE+AT4BOQE4ATgBOAEcAVgXADEQCAEAUx8SHgsdHhYAjgCWAKYAUQBqIAIxAHYAbwCXAxUDJzIDIUlGTzEAkQJPAMcCVwKkAMAClgKWApYClgKWApYCiwKWApYClgKWApYClgKVApUCmAKgApcClgKWApQClAKUApQCkgKVAnUB1AKXAp8ClgKWApUeAIETBQD+DQOfAmECOh8BVBg9AuIZEjMbAU4/G1WZAXusRAFpYQEFA0FPAQYAmTEeIJdyADFoAHEANgCRA5zMk/C2jGINwjMWygIZCaXdfDILBCs5dAE7YnQBugDlhoiHhoiGiYqKhouOjIaNkI6Ij4qQipGGkoaThpSSlYaWhpeKmIaZhpqGm4aci52QnoqfhuIC4XTpAt90AIp0LHSoAIsAdHQEQwRABEIERQRDBEkERgRBBEcESQRIBEQERgRJAJ5udACrA490ALxuAQ10ANFZdHQA13QCFHQA/mJ0AP4BIQD+APwA/AD9APwDhGZ03ASMK23HAP4A/AD8AP0A/CR0dACRYnQA/gCRASEA/gCRAvQA/gCRA4RmdNwEjCttxyR0AP9idAEhAP4A/gD8APwA/QD8AP8A/AD8AP0A/AOEZnTcBIwrbcckdHQAkWJ0ASEA/gCRAP4AkQL0AP4AkQOEZnTcBIwrbcckdAJLAT50AlIBQXQCU8l0dAJfdHQDpgL0A6YDpgOnA6cDpwOnA4RmdNwEjCttxyR0dACRYnQBIQOmAJEDpgCRAvQDpgCRA4RmdNwEjCttxyR0BDh0AJEEOQCRDpU5dSgCADR03gV2CwArdAEFAM5iCnR0AF1iAAYcOgp0dACRCnQAXAEIwWZ0CnRmdHQAkWZ0CnRmdEXgAFF03gp0dEY0tlT2u3SOAQTwscwhjZZKrhYcBSfFp9XNbKiVDOD2b+cpe4/Z17mQnbtzzhaeQtE2GGj0IDNTjRUSyTxxw/RPHW/+vS7d1NfRt9z9QPZg4X7QFfhCnkvgNPIItOsC2eV6hPannZNHlZ9xrwZXIMOlu3jSoQSq78WEjwLjw1ELSlF1aBvfzwk5ZX7AUvQzjPQKbDuQ+sm4wNOp4A6AdVuRS0t1y/DZpg4R6m7FNjM9HgvW7Bi88zaMjOo6lM8wtBBdj8LP4ylv3zCXPhebMKJc066o9sF71oFW/8JXu86HJbwDID5lzw5GWLR/LhT0Qqnp2JQxNZNfcbLIzPy+YypqRm/lBmGmex+82+PisxUumSeJkALIT6rJezxMH+CTJmQtt5uwTVbL3ptmjDUQzlSIvWi8Tl7ng1NpuRn1Ng4n14Qc+3Iil7OwkvNWogLSPkn3pihIFytyIGmMhOe3n1tWsuMy9BdKyqF4Z3v2SgggTL9KVvMXPnCbRe+oOuFFP3HejBG/w9gvmfNYvg6JuWia2lcSSN1uIjBktzoIazOHPJZ7kKHPz8mRWVdW3lA8WGF9dQF6Bm673boov3BUWDU2JNcahR23GtfHKLOz/viZ+rYnZFaIznXO67CYEJ1fXuTRpZhYZkKe54xeoagkNGLs+NTZHE0rX45/XvQ2RGADX6vcAvdxIUBV27wxGm2zjZo4X3ILgAlrOFheuZ6wtsvaIj4yLY7qqawlliaIcrz2G+c3vscAnCkCuMzMmZvMfu9lLwTvfX+3cVSyPdN9ZwgDZhfjRgNJcLiJ67b9xx8JHswprbiE3v9UphotAPIgnXVIN5KmMc0piXhc6cChPnN+MRhG9adtdttQTTwSIpl8I4/j//d3sz1326qTBTpPRM/Hgh3kzqEXs8ZAk4ErQhNO8hzrQ0DLkWMA/N+91tn2MdOJnWC2FCZehkQrwzwbKOjhvZsbM95QoeL9skYyMf4srVPVJSgg7pOLUtr/n9eT99oe9nLtFRpjA9okV2Kj8h9k5HaC0oivRD8VyXkJ81tcd4fHNXPCfloIQasxsuO18/46dR2jgul/UIet2G0kRvnyONMKhHs6J26FEoqSqd+rfYjeEGwHWVDpX1fh1jBBcKGMqRepju9Y00mDVHC+Xdij/j44rKfvfjGinNs1jO/0F3jB83XCDINN/HB84axlP+3E/klktRo+vl3U/aiyMJbIodE1XSsDn6UAzIoMtUObY2+k/4gY/l+AkZJ5Sj2vQrkyLm3FoxjhDX+31UXBFf9XrAH31fFqoBmDEZvhvvpnZ87N+oZEu7U9O/nnk+QWj3x8uyoRbEnf+O5UMr9i0nHP38IF5AvzrBW8YWBUR0mIAzIvndQq9N3v/Jto3aPjPXUPl8ASdPPyAp7jENf8bk7VMM9ol9XGmlBmeDMuGqt+WzuL6CXAxXjIhCPM5vACchgMJ/8XBGLO/D1isVvGhwwHHr1DLaI5mn2Jr/b1pUD90uciDaS8cXNDzCWvNmT/PhQe5e8nTnnnkt8Ds/SIjibcum/fqDhKopxAY8AkSrPn+IGDEKOO+U3XOP6djFs2H5N9+orhOahiQk5KnEUWa+CzkVzhp8bMHRbg81qhjjXuIKbHjSLSIBKWqockGtKinY+z4/RdBUF6pcc3JmnlxVcNgrI4SEzKUZSwcD2QCyxzKve+gAmg6ZuSRkpPFa6mfThu7LJNu3H5K42uCpNvPAsoedolKV/LHe/eJ+BbaG5MG0NaSGVPRUmNFMFFSSpXEcXwbVh7UETOZZtoVNRGOIbbkig3McEtR68cG0RZAoJevWYo7Dg/lZ1CQzblWeUvVHmr8fY4Nqd9JJiH/zEX24mJviH60fAyFr0A3c4bC1j3yZU60VgJxXn8JgJXLUIsiBnmKmMYz+7yBQFBvqb2eYnuW59joZBf56/wXvWIR4R8wTmV80i1mZy+S4+BUES+hzjk0uXpC///z/IlqHZ1monzlXp8aCfhGKMti73FI1KbL1q6IKO4fuBuZ59gagjn5xU79muMpHXg6S+e+gDM/U9BKLHbl9l6o8czQKl4RUkJJiqftQG2i3BMg/TQlUYFkJDYBOOvAugYuzYSDnZbDDd/aSd9x0Oe6F+bJcHfl9+gp6L5/TgA+BdFFovbfCrQ40s5vMPw8866pNX8zyFGeFWdxIpPVp9Rg1UPOVFbFZrvaFq/YAzHQgqMWpahMYfqHpmwXfHL1/kpYmGuHFwT55mQu0dylfNuq2Oq0hTMCPwqfxnuBIPLXfci4Y1ANy+1CUipQxld/izVh16WyG2Q0CQQ9NqtAnx1HCHwDj7sYxOSB0wopZSnOzxQOcExmxrVTF2BkOthVpGfuhaGECfCJpJKpjnihY+xOT2QJxN61+9K6QSqtv2Shr82I3jgJrqBg0wELFZPjvHpvzTtaJnLK6Vb97Yn933koO/saN7fsjwNKzp4l2lJVx2orjCGzC/4ZL4zCver6aQYtC5sdoychuFE6ufOiog+VWi5UDkbmvmtah/3aArEBIi39s5ILUnlFLgilcGuz9CQshEY7fw2ouoILAYPVT/gyAIq3TFAIwVsl+ktkRz/qGfnCDGrm5gsl/l9QdvCWGsjPz3dU7XuqKfdUrr/6XIgjp4rey6AJBmCmUJMjITHVdFb5m1p+dLMCL8t55zD42cmftmLEJC0Da04YiRCVUBLLa8D071/N5UBNBXDh0LFsmhV/5B5ExOB4j3WVG/S3lfK5o+V6ELHvy6RR9n4ac+VsK4VE4yphPvV+kG9FegTBH4ZRXL2HytUHCduJazB/KykjfetYxOXTLws267aGOd+I+JhKP//+VnXmS90OD/jvLcVu0asyqcuYN1mSb6XTlCkqv1vigZPIYwNF/zpWcT1GR/6aEIRjkh0yhg4LXJfaGobYJTY4JI58KiAKgmmgAKWdl5nYCeLqavRJGQNuYuZtZFGx+IkI4w4NS2xwbetNMunOjBu/hmKCI/w7tfiiyUd//4rbTeWt4izBY8YvGIN6vyKYmP/8X8wHKCeN+WRcKM70+tXKNGyevU9H2Dg5BsljnTf8YbsJ1TmMs74Ce2XlHisleguhyeg44rQOHZuw/6HTkhnnurK2d62q6yS7210SsAIaR+jXMQA+svkrLpsUY+F30Uw89uOdGAR6vo4FIME0EfVVeHTu6eKicfhSqOeXJhbftcd08sWEnNUL1C9fnprTgd83IMut8onVUF0hvqzZfHduPjbjwEXIcoYmy+P6tcJZHmeOv6VrvEdkHDJecjHuHeWANe79VG662qTjA/HCvumVv3qL+LrOcpqGps2ZGwQdFJ7PU4iuyRlBrwfO+xnPyr47s2cXVbWzAyznDiBGjCM3ksxjjqM62GE9C8f5U38kB3VjtabKp/nRdvMESPGDG90bWRLAt1Qk5DyLuazRR1YzdC1c+hZXvAWV8xA72S4A8B67vjVhbba3MMop293FeEXpe7zItMWrJG/LOH9ByOXmYnNJfjmfuX9KbrpgLOba4nZ+fl8Gbdv/ihv+6wFGKHCYrVwmhFC0J3V2bn2tIB1wCc1CST3d3X2OyxhguXcs4sm679UngzofuSeBewMFJboIQHbUh/m2JhW2hG9DIvG2t7yZIzKBTz9wBtnNC+2pCRYhSIuQ1j8xsz5VvqnyUIthvuoyyu7fNIrg/KQUVmGQaqkqZk/Vx5b33/gsEs8yX7SC1J+NV4icz6bvIE7C5G6McBaI8rVg56q5QBJWxn/87Q1sPK4+sQa8fLU5gXo4paaq4cOcQ4wR0VBHPGjKh+UlPCbA1nLXyEUX45qZ8J7/Ln4FPJE2TdzD0Z8MLSNQiykMMmSyOCiFfy84Rq60emYB2vD09KjYwsoIpeDcBDTElBbXxND72yhd9pC/1CMid/5HUMvAL27OtcIJDzNKpRPNqPOpyt2aPGz9QWIs9hQ9LiX5s8m9hjTUu/f7MyIatjjd+tSfQ3ufZxPpmJhTaBtZtKLUcfOCUqADuO+QoH8B9v6U+P0HV1GLQmtoNFTb3s74ivZgjES0qfK+8RdGgBbcCMSy8eBvh98+et1KIFqSe1KQPyXULBMTsIYnysIwiZBJYdI20vseV+wuJkcqGemehKjaAb9L57xZm3g2zX0bZ2xk/fU+bCo7TlnbW7JuF1YdURo/2Gw7VclDG1W7LOtas2LX4upifZ/23rzpsnY/ALfRgrcWP5hYmV9VxVOQA1fZvp9F2UNU+7d7xRyVm5wiLp3/0dlV7vdw1PMiZrbDAYzIVqEjRY2YU03sJhPnlwIPcZUG5ltL6S8XCxU1eYS5cjr34veBmXAvy7yN4ZjArIG0dfD/5UpBNlX1ZPoxJOwyqRi3wQWtOzd4oNKh0LkoTm8cwqgIfKhqqGOhwo71I+zXnMemTv2B2AUzABWyFztGgGULjDDzWYwJUVBTjKCn5K2QGMK1CQT7SzziOjo+BhAmqBjzuc3xYym2eedGeOIRJVyTwDw37iCMe4g5Vbnsb5ZBdxOAnMT7HU4DHpxWGuQ7GeiY30Cpbvzss55+5Km1YsbD5ea3NI9QNYIXol5apgSu9dZ8f8xS5dtHpido5BclDuLWY4lhik0tbJa07yJhH0BOyEut/GRbYTS6RfiTYWGMCkNpfSHi7HvdiTglEVHKZXaVhezH4kkXiIvKopYAlPusftpE4a5IZwvw1x/eLvoDIh/zpo9FiQInsTb2SAkKHV42XYBjpJDg4374XiVb3ws4qM0s9eSQ5HzsMU4OZJKuopFjBM+dAZEl8RUMx5uU2N486Kr141tVsGQfGjORYMCJAMsxELeNT4RmWjRcpdTGBwcx6XN9drWqPmJzcrGrH4+DRc7+n1w3kPZwu0BkNr6hQrqgo7JTB9A5kdJ/H7P4cWBMwsmuixAzJB3yrQpnGIq90lxAXLzDCdn1LPibsRt7rHNjgQBklRgPZ8vTbjXdgXrTWQsK5MdrXXQVPp0Rinq3frzZKJ0qD6Qhc40VzAraUXlob1gvkhK3vpmHgI6FRlQZNx6eRqkp0zy4AQlX813fAPtL3jMRaitGFFjo0zmErloC+h+YYdVQ6k4F/epxAoF0BmqEoKNTt6j4vQZNQ2BoqF9Vj53TOIoNmDiu9Xp15RkIgQIGcoLpfoIbenzpGUAtqFJp5W+LLnx38jHeECTJ/navKY1NWfN0sY1T8/pB8kIH3DU3DX+u6W3YwpypBMYOhbSxGjq84RZ84fWJow8pyHqn4S/9J15EcCMsXqrfwyd9mhiu3+rEo9pPpoJkdZqHjra4NvzFwuThNKy6hao/SlLw3ZADUcUp3w3SRVfW2rhl80zOgTYnKE0Hs2qp1J6H3xqPqIkvUDRMFDYyRbsFI3M9MEyovPk8rlw7/0a81cDVLmBsR2ze2pBuKb23fbeZC0uXoIvDppfTwIDxk1Oq2dGesGc+oJXWJLGkOha3CX+DUnzgAp9HGH9RsPZN63Hn4RMA5eSVhPHO+9RcRb/IOgtW31V1Q5IPGtoxPjC+MEJbVlIMYADd9aHYWUIQKopuPOHmoqSkubnAKnzgKHqgIOfW5RdAgotN6BN+O2ZYHkuemLnvQ8U9THVrS1RtLmKbcC7PeeDsYznvqzeg6VCNwmr0Yyx1wnLjyT84BZz3EJyCptD3yeueAyDWIs0L2qs/VQ3HUyqfrja0V1LdDzqAikeWuV4sc7RLIB69jEIBjCkyZedoUHqCrOvShVzyd73OdrJW0hPOuQv2qOoHDc9xVb6Yu6uq3Xqp2ZaH46A7lzevbxQEmfrzvAYSJuZ4WDk1Hz3QX1LVdiUK0EvlAGAYlG3Md30r7dcPN63yqBCIj25prpvZP0nI4+EgWoFG95V596CurXpKRBGRjQlHCvy5Ib/iW8nZJWwrET3mgd6mEhfP4KCuaLjopWs7h+MdXFdIv8dHQJgg1xi1eYqB0uDYjxwVmri0Sv5XKut/onqapC+FQiC2C1lvYJ9MVco6yDYsS3AANUfMtvtbYI2hfwZatiSsnoUeMZd34GVjkMMKA+XnjJpXgRW2SHTZplVowPmJsvXy6w3cfO1AK2dvtZEKTkC/TY9LFiKHCG0DnrMQdGm2lzlBHM9iEYynH2UcVMhUEjsc0oDBTgo2ZSQ1gzkAHeWeBXYFjYLuuf8yzTCy7/RFR81WDjXMbq2BOH5dURnxo6oivmxL3cKzKInlZkD31nvpHB9Kk7GfcfE1t+1V64b9LtgeJGlpRFxQCAqWJ5DoY77ski8gsOEOr2uywZaoO/NGa0X0y1pNQHBi3b2SUGNpcZxDT7rLbBf1FSnQ8guxGW3W+36BW0gBje4DOz6Ba6SVk0xiKgt+q2JOFyr4SYfnu+Ic1QZYIuwHBrgzr6UvOcSCzPTOo7D6IC4ISeS7zkl4h+2VoeHpnG/uWR3+ysNgPcOIXQbv0n4mr3BwQcdKJxgPSeyuP/z1Jjg4e9nUvoXegqQVIE30EHx5GHv+FAVUNTowYDJgyFhf5IvlYmEqRif6+WN1MkEJmDcQITx9FX23a4mxy1AQRsOHO/+eImX9l8EMJI3oPWzVXxSOeHU1dUWYr2uAA7AMb+vAEZSbU3qob9ibCyXeypEMpZ6863o6QPqlqGHZkuWABSTVNd4cOh9hv3qEpSx2Zy/DJMP6cItEmiBJ5PFqQnDEIt3NrA3COlOSgz43D7gpNFNJ5MBh4oFzhDPiglC2ypsNU4ISywY2erkyb1NC3Qh/IfWj0eDgZI4/ln8WPfBsT3meTjq1Uqt1E7Zl/qftqkx6aM9KueMCekSnMrcHj1CqTWWzEzPsZGcDe3Ue4Ws+XFYVxNbOFF8ezkvQGR6ZOtOLU2lQEnMBStx47vE6Pb7AYMBRj2OOfZXfisjJnpTfSNjo6sZ6qSvNxZNmDeS7Gk3yYyCk1HtKN2UnhMIjOXUzAqDv90lx9O/q/AT1ZMnit5XQe9wmQxnE/WSH0CqZ9/2Hy+Sfmpeg8RwsHI5Z8kC8H293m/LHVVM/BA7HaTJYg5Enk7M/xWpq0192ACfBai2LA/qrCjCr6Dh1BIMzMXINBmX96MJ5Hn2nxln/RXPFhwHxUmSV0EV2V0jm86/dxxuYSU1W7sVkEbN9EzkG0QFwPhyHKyb3t+Fj5WoUUTErcazE/N6EW6Lvp0d//SDPj7EV9UdJN+Amnf3Wwk3A0SlJ9Z00yvXZ7n3z70G47Hfsow8Wq1JXcfwnA+Yxa5mFsgV464KKP4T31wqIgzFPd3eCe3j5ory5fBF2hgCFyVFrLzI9eetNXvM7oQqyFgDo4CTp/hDV9NMX9JDHQ/nyHTLvZLNLF6ftn2OxjGm8+PqOwhxnPHWipkE/8wbtyri80Sr7pMNkQGMfo4ZYK9OcCC4ESVFFbLMIvlxSoRqWie0wxqnLfcLSXMSpMMQEJYDVObYsXIQNv4TGNwjq1kvT1UOkicTrG3IaBZ3XdScS3u8sgeZPVpOLkbiF940FjbCeNRINNvDbd01EPBrTCPpm12m43ze1bBB59Ia6Ovhnur/Nvx3IxwSWol+3H2qfCJR8df6aQf4v6WiONxkK+IqT4pKQrZK/LplgDI/PJZbOep8dtbV7oCr6CgfpWa8NczOkPx81iSHbsNhVSJBOtrLIMrL31LK9TqHqAbAHe0RLmmV806kRLDLNEhUEJfm9u0sxpkL93Zgd6rw+tqBfTMi59xqXHLXSHwSbSBl0EK0+loECOPtrl+/nsaFe197di4yUgoe4jKoAJDXc6DGDjrQOoFDWZJ9HXwt8xDrQP+7aRwWKWI1GF8s8O4KzxWBBcwnl3vnl1Oez3oh6Ea1vjR7/z7DDTrFtqU2W/KAEzAuXDNZ7MY73MF216dzdSbWmUp4lcm7keJfWaMHgut9x5C9mj66Z0lJ+yhsjVvyiWrfk1lzPOTdhG15Y7gQlXtacvI7qv/XNSscDwqkgwHT/gUsD5yB7LdRRvJxQGYINn9hTpodKFVSTPrtGvyQw+HlRFXIkodErAGu9Iy1YpfSPc3jkFh5CX3lPxv7aqjE/JAfTIpEjGb/H7MO0e2vsViSW1qa/Lmi4/n4DEI3g7lYrcanspDfEpKkdV1OjSLOy0BCUqVoECaB55vs06rXl4jqmLsPsFM/7vYJ0vrBhDCm/00A/H81l1uekJ/6Lml3Hb9+NKiLqATJmDpyzfYZFHumEjC662L0Bwkxi7E9U4cQA0XMVDuMYAIeLMPgQaMVOd8fmt5SflFIfuBoszeAw7ow5gXPE2Y/yBc/7jExARUf/BxIHQBF5Sn3i61w4z5xJdCyO1F1X3+3ax+JSvMeZ7S6QSKp1Fp/sjYz6Z+VgCZzibGeEoujryfMulH7Rai5kAft9ebcW50DyJr2uo2z97mTWIu45YsSnNSMrrNUuG1XsYBtD9TDYzQffKB87vWbkM4EbPAFgoBV4GQS+vtFDUqOFAoi1nTtmIOvg38N4hT2Sn8r8clmBCXspBlMBYTnrqFJGBT3wZOzAyJDre9dHH7+x7qaaKDOB4UQALD5ecS0DE4obubQEiuJZ0EpBVpLuYcce8Aa4PYd/V4DLDAJBYKQPCWTcrEaZ5HYbJi11Gd6hjGom1ii18VHYnG28NKpkz2UKVPxlhYSp8uZr367iOmoy7zsxehW9wzcy2zG0a80PBMCRQMb32hnaHeOR8fnNDzZhaNYhkOdDsBUZ3loDMa1YP0uS0cjUP3b/6DBlqmZOeNABDsLl5BI5QJups8uxAuWJdkUB/pO6Zax6tsg7fN5mjjDgMGngO+DPcKqiHIDbFIGudxtPTIyDi9SFMKBDcfdGQRv41q1AqmxgkVfJMnP8w/Bc7N9/TR6C7mGObFqFkIEom8sKi2xYqJLTCHK7cxzaZvqODo22c3wisBCP4HeAgcRbNPAsBkNRhSmD48dHupdBRw4mIvtS5oeF6zeT1KMCyhMnmhpkFAGWnGscoNkwvQ8ZM5lE/vgTHFYL99OuNxdFBxTEDd5v2qLR8y9WkXsWgG6kZNndFG+pO/UAkOCipqIhL3hq7cRSdrCq7YhUsTocEcnaFa6nVkhnSeRYUA1YO0z5itF9Sly3VlxYDw239TJJH6f3EUfYO5lb7bcFcz8Bp7Oo8QmnsUHOz/fagVUBtKEw1iT88j+aKkv8cscKNkMxjYr8344D1kFoZ7/td1W6LCNYN594301tUGRmFjAzeRg5vyoM1F6+bJZ/Q54jN/k8SFd3DxPTYaAUsivsBfgTn7Mx8H2SpPt4GOdYRnEJOH6jHM2p6SgB0gzIRq6fHxGMmSmqaPCmlfwxiuloaVIitLGN8wie2CDWhkzLoCJcODh7KIOAqbHEvXdUxaS4TTTs07Clzj/6GmVs9kiZDerMxEnhUB6QQPlcfqkG9882RqHoLiHGBoHfQuXIsAG8GTAtao2KVwRnvvam8jo1e312GQAKWEa4sUVEAMG4G6ckcONDwRcg1e2D3+ohXgY4UAWF8wHKQMrSnzCgfFpsxh+aHXMGtPQroQasRY4U6UdG0rz1Vjbka0MekOGRZQEvqQFlxseFor8zWFgHek3v29+WqN6gaK5gZOTOMZzpQIC1201LkMCXild3vWXSc5UX9xcFYfbRPzGFa1FDcPfPB/jUEq/FeGt419CI3YmBlVoHsa4KdcwQP5ZSwHHhFJ7/Ph/Rap/4vmG91eDwPP0lDfCDRCLszTqfzM71xpmiKi2HwS4WlqvGNwtvwF5Dqpn6KTq8ax00UMPkxDcZrEEEsIvHiUXXEphdb4GB4FymlPwBz4Gperqq5pW7TQ6/yNRhW8VT5NhuP0udlxo4gILq5ZxAZk8ZGh3g4CqxJlPKY7AQxupfUcVpWT5VItp1+30UqoyP4wWsRo3olRRgkWZZ2ZN6VC3OZFeXB8NbnUrSdikNptD1QiGuKkr8EmSR/AK9Rw+FF3s5uwuPbvHGiPeFOViltMK7AUaOsq9+x9cndk3iJEE5LKZRlWJbKOZweROzmPNVPkjE3K/TyA57Rs68TkZ3MR8akKpm7cFjnjPd/DdkWjgYoKHSr5Wu5ssoBYU4acRs5g2DHxUmdq8VXOXRbunD8QN0LhgkssgahcdoYsNvuXGUK/KXD/7oFb+VGdhqIn02veuM5bLudJOc2Ky0GMaG4W/xWBxIJcL7yliJOXOpx0AkBqUgzlDczmLT4iILXDxxtRR1oZa2JWFgiAb43obrJnG/TZC2KSK2wqOzRZTXavZZFMb1f3bXvVaNaK828w9TO610gk8JNf3gMfETzXXsbcvRGCG9JWQZ6+cDPqc4466Yo2RcKH+PILeKOqtnlbInR3MmBeGG3FH10yzkybuqEC2HSQwpA0An7d9+73BkDUTm30bZmoP/RGbgFN+GrCOfADgqr0WbI1a1okpFms8iHYw9hm0zUvlEMivBRxModrbJJ+9/p3jUdQQ9BCtQdxnOGrT5dzRUmw0593/mbRSdBg0nRvRZM5/E16m7ZHmDEtWhwvfdZCZ8J8M12W0yRMszXamWfQTwIZ4ayYktrnscQuWr8idp3PjT2eF/jmtdhIfcpMnb+IfZY2FebW6UY/AK3jP4u3Tu4zE4qlnQgLFbM19EBIsNf7KhjdbqQ/D6yiDb+NlEi2SKD+ivXVUK8ib0oBo366gXkR8ZxGjpJIDcEgZPa9TcYe0TIbiPl/rPUQDu3XBJ9X/GNq3FAUsKsll57DzaGMrjcT+gctp+9MLYXCq+sqP81eVQ0r9lt+gcQfZbACRbEjvlMskztZG8gbC8Qn9tt26Q7y7nDrbZq/LEz7kR6Jc6pg3N9rVX8Y5MJrGlML9p9lU4jbTkKqCveeZUJjHB03m2KRKR2TytoFkTXOLg7keU1s1lrPMQJpoOKLuAAC+y1HlJucU6ysB5hsXhvSPPLq5J7JtnqHKZ4vYjC4Vy8153QY+6780xDuGARsGbOs1WqzH0QS765rnSKEbbKlkO8oI/VDwUd0is13tKpqILu1mDJFNy/iJAWcvDgjxvusIT+PGz3ST/J9r9Mtfd0jpaGeiLYIqXc7DiHSS8TcjFVksi66PEkxW1z6ujbLLUGNNYnzOWpH8BZGK4bCK7iR+MbIv8ncDAz1u4StN3vTTzewr9IQjk9wxFxn+6N1ddKs0vffJiS08N3a4G1SVrlZ97Q/M+8G9fe5AP6d9/Qq4WRnORVhofPIKEdCr3llspUfE0oKIIYoByBRPh+bX1HLS3JWGJRhIvE1aW4NTd8ePi4Z+kXb+Z8snYfSNcqijhAgVsx4RCM54cXUiYkjeBmmC4ajOHrChoELscJJC7+9jjMjw5BagZKlgRMiSNYz7h7vvZIoQqbtQmspc0cUk1G/73iXtSpROl5wtLgQi0mW2Ex8i3WULhcggx6E1LMVHUsdc9GHI1PH3U2Ko0PyGdn9KdVOLm7FPBui0i9a0HpA60MsewVE4z8CAt5d401Gv6zXlIT5Ybit1VIA0FCs7wtvYreru1fUyW3oLAZ/+aTnZrOcYRNVA8spoRtlRoWflsRClFcgzkqiHOrf0/SVw+EpVaFlJ0g4Kxq1MMOmiQdpMNpte8lMMQqm6cIFXlnGbfJllysKDi+0JJMotkqgIxOSQgU9dn/lWkeVf8nUm3iwX2Nl3WDw9i6AUK3vBAbZZrcJpDQ/N64AVwjT07Jef30GSSmtNu2WlW7YoyW2FlWfZFQUwk867EdLYKk9VG6JgEnBiBxkY7LMo4YLQJJlAo9l/oTvJkSARDF/XtyAzM8O2t3eT/iXa6wDN3WewNmQHdPfsxChU/KtLG2Mn8i4ZqKdSlIaBZadxJmRzVS/o4yA65RTSViq60oa395Lqw0pzY4SipwE0SXXsKV+GZraGSkr/RW08wPRvqvSUkYBMA9lPx4m24az+IHmCbXA+0faxTRE9wuGeO06DIXa6QlKJ3puIyiuAVfPr736vzo2pBirS+Vxel3TMm3JKhz9o2ZoRvaFVpIkykb0Hcm4oHFBMcNSNj7/4GJt43ogonY2Vg4nsDQIWxAcorpXACzgBqQPjYsE/VUpXpwNManEru4NwMCFPkXvMoqvoeLN3qyu/N1eWEHttMD65v19l/0kH2mR35iv/FI+yjoHJ9gPMz67af3Mq/BoWXqu3rphiWMXVkmnPSEkpGpUI2h1MThideGFEOK6YZHPwYzMBvpNC7+ZHxPb7epfefGyIB4JzO9DTNEYnDLVVHdQyvOEVefrk6Uv5kTQYVYWWdqrdcIl7yljwwIWdfQ/y+2QB3eR/qxYObuYyB4gTbo2in4PzarU1sO9nETkmj9/AoxDA+JM3GMqQtJR4jtduHtnoCLxd1gQUscHRB/MoRYIEsP2pDZ9KvHgtlk1iTbWWbHhohwFEYX7y51fUV2nuUmnoUcqnWIQAAgl9LTVX+Bc0QGNEhChxHR4YjfE51PUdGfsSFE6ck7BL3/hTf9jLq4G1IafINxOLKeAtO7quulYvH5YOBc+zX7CrMgWnW47/jfRsWnJjYYoE7xMfWV2HN2iyIqLI";const $y=new Map([[8217,"apostrophe"],[8260,"fraction slash"],[12539,"middle dot"]]),Ly=4;function I3(r){let e=0;function t(){return r[e++]<<8|r[e++]}let n=t(),s=1,i=[0,1];for(let S=1;S<n;S++)i.push(s+=t());let o=t(),a=e;e+=o;let c=0,l=0;function u(){return c==0&&(l=l<<8|r[e++],c=8),l>>--c&1}const h=31,f=2**h,d=f>>>1,p=d>>1,g=f-1;let m=0;for(let S=0;S<h;S++)m=m<<1|u();let b=[],x=0,v=f;for(;;){let S=Math.floor(((m-x+1)*s-1)/v),E=0,P=n;for(;P-E>1;){let L=E+P>>>1;S<i[L]?P=L:E=L}if(E==0)break;b.push(E);let D=x+Math.floor(v*i[E]/s),B=x+Math.floor(v*i[E+1]/s)-1;for(;((D^B)&d)==0;)m=m<<1&g|u(),D=D<<1&g,B=B<<1&g|1;for(;D&~B&p;)m=m&d|m<<1&g>>>1|u(),D=D<<1^d,B=(B^d)<<1|d|1;x=D,v=1+B-D}let I=n-4;return b.map(S=>{switch(S-I){case 3:return I+65792+(r[a++]<<16|r[a++]<<8|r[a++]);case 2:return I+256+(r[a++]<<8|r[a++]);case 1:return I+r[a++];default:return S-1}})}function S3(r){let e=0;return()=>r[e++]}function U1(r){return S3(I3(P3(r)))}function P3(r){let e=[];[..."ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"].forEach((s,i)=>e[s.charCodeAt(0)]=i);let t=r.length,n=new Uint8Array(6*t>>3);for(let s=0,i=0,o=0,a=0;s<t;s++)a=a<<6|e[r.charCodeAt(s)],o+=6,o>=8&&(n[i++]=a>>(o-=8));return n}function O3(r){return r&1?~r>>1:r>>1}function D3(r,e){let t=Array(r);for(let n=0,s=0;n<r;n++)t[n]=s+=O3(e());return t}function Gc(r,e=0){let t=[];for(;;){let n=r(),s=r();if(!s)break;e+=n;for(let i=0;i<s;i++)t.push(e+i);e+=s+1}return t}function k1(r){return Qc(()=>{let e=Gc(r);if(e.length)return e})}function $1(r){let e=[];for(;;){let t=r();if(t==0)break;e.push(C3(t,r))}for(;;){let t=r()-1;if(t<0)break;e.push(B3(t,r))}return e.flat()}function Qc(r){let e=[];for(;;){let t=r(e.length);if(!t)break;e.push(t)}return e}function L1(r,e,t){let n=Array(r).fill().map(()=>[]);for(let s=0;s<e;s++)D3(r,t).forEach((i,o)=>n[o].push(i));return n}function C3(r,e){let t=1+e(),n=e(),s=Qc(e);return L1(s.length,1+r,e).flatMap((o,a)=>{let[c,...l]=o;return Array(s[a]).fill().map((u,h)=>{let f=h*n;return[c+h*t,l.map(d=>d+f)]})})}function B3(r,e){let t=1+e();return L1(t,1+r,e).map(s=>[s[0],s.slice(1)])}function _3(r){let e=[],t=Gc(r);return s(n([]),[]),e;function n(i){let o=r(),a=Qc(()=>{let c=Gc(r).map(l=>t[l]);if(c.length)return n(c)});return{S:o,B:a,Q:i}}function s({S:i,B:o},a,c){if(!(i&4&&c===a[a.length-1])){i&2&&(c=a[a.length-1]),i&1&&e.push(a);for(let l of o)for(let u of l.Q)s(l,[...a,u],c)}}}function T3(r){return r.toString(16).toUpperCase().padStart(2,"0")}function F1(r){return`{${T3(r)}}`}function N3(r){let e=[];for(let t=0,n=r.length;t<n;){let s=r.codePointAt(t);t+=s<65536?1:2,e.push(s)}return e}function Ka(r){let t=r.length;if(t<4096)return String.fromCodePoint(...r);let n=[];for(let s=0;s<t;)n.push(String.fromCodePoint(...r.slice(s,s+=4096)));return n.join("")}function R3(r,e){let t=r.length,n=t-e.length;for(let s=0;n==0&&s<t;s++)n=r[s]-e[s];return n}var U3="AEUDTAHBCFQATQDRADAAcgAgADQAFAAsABQAHwAOACQADQARAAoAFwAHABIACAAPAAUACwAFAAwABAAQAAMABwAEAAoABQAIAAIACgABAAQAFAALAAIACwABAAIAAQAHAAMAAwAEAAsADAAMAAwACgANAA0AAwAKAAkABAAdAAYAZwDSAdsDJgC0CkMB8xhZAqfoC190UGcThgBurwf7PT09Pb09AjgJum8OjDllxHYUKXAPxzq6tABAxgK8ysUvWAgMPT09PT09PSs6LT2HcgWXWwFLoSMEEEl5RFVMKvO0XQ8ExDdJMnIgsj26PTQyy8FfEQ8AY8IPAGcEbwRwBHEEcgRzBHQEdQR2BHcEeAR6BHsEfAR+BIAEgfndBQoBYgULAWIFDAFiBNcE2ATZBRAFEQUvBdALFAsVDPcNBw13DYcOMA4xDjMB4BllHI0B2grbAMDpHLkQ7QHVAPRNQQFnGRUEg0yEB2uaJF8AJpIBpob5AERSMAKNoAXqaQLUBMCzEiACnwRZEkkVsS7tANAsBG0RuAQLEPABv9HICTUBXigPZwRBApMDOwAamhtaABqEAY8KvKx3LQ4ArAB8UhwEBAVSagD8AEFZADkBIadVj2UMUgx5Il4ANQC9AxIB1BlbEPMAs30CGxlXAhwZKQIECBc6EbsCoxngzv7UzRQA8M0BawL6ZwkN7wABAD33OQRcsgLJCjMCjqUChtw/km+NAsXPAoP2BT84PwURAK0RAvptb6cApQS/OMMey5HJS84UdxpxTPkCogVFITaTOwERAK5pAvkNBOVyA7q3BKlOJSALAgUIBRcEdASpBXqzABXFSWZOawLCOqw//AolCZdvv3dSBkEQGyelEPcMMwG1ATsN7UvYBPEGOwTJH30ZGQ/NlZwIpS3dDO0m4y6hgFoj9SqDBe1L9DzdC01RaA9ZC2UJ4zpjgU4DIQENIosK3Q05CG0Q8wrJaw3lEUUHOQPVSZoApQcBCxEdNRW1JhBirAsJOXcG+xr2C48mrxMpevwF0xohBk0BKRr/AM8u54WwWjFcHE9fBgMLJSPHFKhQIA0lQLd4SBobBxUlqQKRQ3BKh1E2HpMh9jw9DWYuE1F8B/U8BRlPC4E8nkarRQ4R0j6NPUgiSUwsBDV/LC8niwnPD4UMuXxyAVkJIQmxDHETMREXN8UIOQcZLZckJxUIIUaVYJoE958D8xPRAwsFPwlBBxMDtRwtEy4VKQUNgSTXAvM21S6zAo9WgAEXBcsPJR/fEFBH4A7pCJsCZQODJesALRUhABcimwhDYwBfj9hTBS7LCMdqbCN0A2cU52ERcweRDlcHpxwzFb8c4XDIXguGCCijrwlbAXUJmQFfBOMICTVbjKAgQWdTi1gYmyBhQT9d/AIxDGUVn0S9h3gCiw9rEhsBNQFzBzkNAQJ3Ee0RaxCVCOuGBDW1M/g6JQRPIYMgEQonA09szgsnJvkM+GkBoxJiAww0PXfuZ6tgtiQX/QcZMsVBYCHxC5JPzQycGsEYQlQuGeQHvwPzGvMn6kFXBf8DowMTOk0z7gS9C2kIiwk/AEkOoxcH1xhqCnGM0AExiwG3mQNXkYMCb48GNwcLAGcLhwV55QAdAqcIowAFAM8DVwA5Aq0HnQAZAIVBAT0DJy8BIeUCjwOTCDHLAZUvAfMpBBvDDBUA9zduSgLDsQKAamaiBd1YAo4CSTUBTSUEBU5HUQOvceEA2wBLBhPfRwEVq0rLGuNDAd9vKwDHAPsABTUHBUEBzQHzbQC3AV8LMQmis7UBTekpAIMAFWsB1wKJAN0ANQB/8QFTAE0FWfkF0wJPSQERMRgrV2EBuwMfATMBDQB5BsuNpckHHwRtB9MCEBsV4QLvLge1AQMi3xPNQsUCvd5VoWACZIECYkJbTa9bNyACofcCaJgCZgkCn4Q4GwsCZjsCZiYEbgR/A38TA36SOQY5dxc5gjojIwJsHQIyNjgKAm3HAm2u74ozZ0UrAWcA3gDhAEoFB5gMjQD+C8IADbUCdy8CdqI/AnlLQwJ4uh1c20WuRtcCfD8CesgCfQkCfPAFWQUgSABIfWMkAoFtAoAAAoAFAn+uSVhKWxUXSswC0QEC0MxLJwOITwOH5kTFkTIC8qFdAwMDrkvOTC0lA89NTE2vAos/AorYwRsHHUNnBbcCjjcCjlxAl4ECjtkCjlx4UbRTNQpS1FSFApP7ApMMAOkAHFUeVa9V0AYsGymVhjLheGZFOzkCl58C77JYIagAWSUClo8ClnycAKlZrFoJgU0AOwKWtQKWTlxEXNECmcsCmWRcyl0HGQKcmznCOp0CnBYCn5sCnriKAB0PMSoPAp3xAp6SALU9YTRh7wKe0wKgbgGpAp6fHwKeTqVjyGQnJSsCJ68CJn4CoPsCoEwCot0CocQCpi8Cpc4Cp/8AfQKn8mh8aLEAA0lqHGrRAqzjAqyuAq1nAq0CAlcdAlXcArHh1wMfTmyXArK9DQKy6Bds4G1jbUhfAyXNArZcOz9ukAMpRQK4XgK5RxUCuSp3cDZw4QK9GQK72nCWAzIRAr6IcgIDM3ECvhpzInNPAsPLAsMEc4J0SzVFdOADPKcDPJoDPb8CxXwCxkcCxhCJAshpUQLIRALJTwLJLgJknQLd0nh5YXiueSVL0AMYo2cCAmH0GfOVJHsLXpJeuxECz2sCz2wvS1PS8xOfAMatAs9zASnqA04SfksFAtwnAtuKAtJPA1JcA1NfAQEDVYyAiT8AyxbtYEWCHILTgs6DjQLaxwLZ3oQQhEmnPAOGpQAvA2QOhnFZ+QBVAt9lAt64c3cC4i/tFAHzMCcB9JsB8tKHAuvzAulweQLq+QLq5AD5RwG5Au6JAuuclqqXAwLuPwOF4Jh5cOBxoQLzAwBpA44WmZMC9xMDkW4DkocC95gC+dkC+GaaHJqruzebHgOdgwL++gEbADmfHJ+zAwWNA6ZqA6bZANHFAwZqoYiiBQkDDEkCwAA/AwDhQRdTARHzA2sHl2cFAJMtK7evvdsBiZkUfxEEOQH7KQUhDp0JnwCS/SlXxQL3AZ0AtwW5AG8LbUEuFCaNLgFDAYD8AbUmAHUDDgRtACwCFgyhAAAKAj0CagPdA34EkQEgRQUhfAoABQBEABMANhICdwEABdUDa+8KxQIA9wqfJ7+xt+UBkSFBQgHpFH8RNMCJAAQAGwBaAkUChIsABjpTOpSNbQC4Oo860ACNOME63AClAOgAywE6gTo7Ofw5+Tt2iTpbO56JOm85GAFWATMBbAUvNV01njWtNWY1dTW2NcU1gjWRNdI14TWeNa017jX9NbI1wTYCNhE1xjXVNhY2JzXeNe02LjY9Ni41LSE2OjY9Njw2yTcIBJA8VzY4Nt03IDcPNsogN4k3MAoEsDxnNiQ3GTdsOo03IULUQwdC4EMLHA8PCZsobShRVQYA6X8A6bABFCnXAukBowC9BbcAbwNzBL8MDAMMAQgDAAkKCwsLCQoGBAVVBI/DvwDz9b29kaUCb0QtsRTNLt4eGBcSHAMZFhYZEhYEARAEBUEcQRxBHEEcQRxBHEEaQRxBHEFCSTxBPElISUhBNkM2QTYbNklISVmBVIgBFLWZAu0BhQCjBcEAbykBvwGJAaQcEZ0ePCklMAAhMvAIMAL54gC7Bm8EescjzQMpARQpKgDUABavAj626xQAJP0A3etzuf4NNRA7efy2Z9NQrCnC0OSyANz5BBIbJ5IFDR6miIavYS6tprjjmuKebxm5C74Q225X1pkaYYPb6f1DK4k3xMEBb9S2WMjEibTNWhsRJIA+vwNVEiXTE5iXs/wezV66oFLfp9NZGYW+Gk19J2+bCT6Ye2w6LDYdgzKMUabk595eLBCXANz9HUpWbATq9vqXVx9XDg+Pc9Xp4+bsS005SVM/BJBM4687WUuf+Uj9dEi8aDNaPxtpbDxcG1THTImUMZq4UCaaNYpsVqraNyKLJXDYsFZ/5jl7bLRtO88t7P3xZaAxhb5OdPMXqsSkp1WCieG8jXm1U99+blvLlXzPCS+M93VnJCiK+09LfaSaBAVBomyDgJua8dfUzR7ga34IvR2Nvj+A9heJ6lsl1KG4NkI1032Cnff1m1wof2B9oHJK4bi6JkEdSqeNeiuo6QoZZincoc73/TH9SXF8sCE7XyuYyW8WSgbGFCjPV0ihLKhdPs08Tx82fYAkLLc4I2wdl4apY7GU5lHRFzRWJep7Ww3wbeA3qmd59/86P4xuNaqDpygXt6M85glSBHOCGgJDnt+pN9bK7HApMguX6+06RZNjzVmcZJ+wcUrJ9//bpRNxNuKpNl9uFds+S9tdx7LaM5ZkIrPj6nIU9mnbFtVbs9s/uLgl8MVczAwet+iOEzzBlYW7RCMgE6gyNLeq6+1tIx4dpgZnd0DksJS5f+JNDpwwcPNXaaVspq1fbQajOrJgK0ofKtJ1Ne90L6VO4MOl5S886p7u6xo7OLjG8TGL+HU1JXGJgppg4nNbNJ5nlzSpuPYy21JUEcUA94PoFiZfjZue+QnyQ80ekOuZVkxx4g+cvhJfHgNl4hy1/a6+RKcKlar/J29y//EztlbVPHVUeQ1zX86eQVAjR/M3dA9w4W8LfaXp4EgM85wOWasli837PzVMOnsLzR+k3o75/lRPAJSE1xAKQzEi5v10ke+VBvRt1cwQRMd+U5mLCTGVd6XiZtgBG5cDi0w22GKcVNvHiu5LQbZEDVtz0onn7k5+heuKXVsZtSzilkLRAUmjMXEMB3J9YC50XBxPiz53SC+EhnPl9WsKCv92SM/OFFIMJZYfl0WW8tIO3UxYcwdMAj7FSmgrsZ2aAZO03BOhP1bNNZItyXYQFTpC3SG1VuPDqH9GkiCDmE+JwxyIVSO5siDErAOpEXFgjy6PQtOVDj+s6e1r8heWVvmZnTciuf4EiNZzCAd7SOMhXERIOlsHIMG399i9aLTy3m2hRLZjJVDNLS53iGIK11dPqQt0zBDyg6qc7YqkDm2M5Ve6dCWCaCbTXX2rToaIgz6+zh4lYUi/+6nqcFMAkQJKHYLK0wYk5N9szV6xihDbDDFr45lN1K4aCXBq/FitPSud9gLt5ZVn+ZqGX7cwm2z5EGMgfFpIFyhGGuDPmso6TItTMwny+7uPnLCf4W6goFQFV0oQSsc9VfMmVLcLr6ZetDZbaSFTLqnSO/bIPjA3/zAUoqgGFAEQS4IhuMzEp2I3jJzbzkk/IEmyax+rhZTwd6f+CGtwPixu8IvzACquPWPREu9ZvGkUzpRwvRRuaNN6cr0W1wWits9ICdYJ7ltbgMiSL3sTPeufgNcVqMVWFkCPDH4jG2jA0XcVgQj62Cb29v9f/z/+2KbYvIv/zzjpQAPkliaVDzNrW57TZ/ZOyZD0nlfMmAIBIAGAI0D3k/mdN4xr9v85ZbZbbqfH2jGd5hUqNZWwl5SPfoGmfElmazUIeNL1j/mkF7VNAzTq4jNt8JoQ11NQOcmhprXoxSxfRGJ9LDEOAQ+dmxAQH90iti9e2u/MoeuaGcDTHoC+xsmEeWmxEKefQuIzHbpw5Tc5cEocboAD09oipWQhtTO1wivf/O+DRe2rpl/E9wlrzBorjJsOeG1B/XPW4EaJEFdNlECEZga5ZoGRHXgYouGRuVkm8tDESiEyFNo+3s5M5puSdTyUL2llnINVHEt91XUNW4ewdMgJ4boJfEyt/iY5WXqbA+A2Fkt5Z0lutiWhe9nZIyIUjyXDC3UsaG1t+eNx6z4W/OYoTB7A6x+dNSTOi9AInctbESqm5gvOLww7OWXPrmHwVZasrl4eD113pm+JtT7JVOvnCXqdzzdTRHgJ0PiGTFYW5Gvt9R9LD6Lzfs0v/TZZHSmyVNq7viIHE6DBK7Qp07Iz55EM8SYtQvZf/obBniTWi5C2/ovHfw4VndkE5XYdjOhCMRjDeOEfXeN/CwfGduiUIfsoFeUxXeQXba7c7972XNv8w+dTjjUM0QeNAReW+J014dKAD/McQYXT7c0GQPIkn3Ll6R7gGjuiQoZD0TEeEqQpKoZ15g/0OPQI17QiSv9AUROa/V/TQN3dvLArec3RrsYlvBm1b8LWzltdugsC50lNKYLEp2a+ZZYqPejULRlOJh5zj/LVMyTDvwKhMxxwuDkxJ1QpoNI0OTWLom4Z71SNzI9TV1iXJrIu9Wcnd+MCaAw8o1jSXd94YU/1gnkrC9BUEOtQvEIQ7g0i6h+KL2JKk8Ydl7HruvgWMSAmNe+LshGhV4qnWHhO9/RIPQzY1tHRj2VqOyNsDpK0cww+56AdDC4gsWwY0XxoucIWIqs/GcwnWqlaT0KPr8mbK5U94/301i1WLt4YINTVvCFBrFZbIbY8eycOdeJ2teD5IfPLCRg7jjcFTwlMFNl9zdh/o3E/hHPwj7BWg0MU09pPrBLbrCgm54A6H+I6v27+jL5gkjWg/iYdks9jbfVP5y/n0dlgWEMlKasl7JvFZd56LfybW1eeaVO0gxTfXZwD8G4SI116yx7UKVRgui6Ya1YpixqXeNLc8IxtAwCU5IhwQgn+NqHnRaDv61CxKhOq4pOX7M6pkA+Pmpd4j1vn6ACUALoLLc4vpXci8VidLxzm7qFBe7s+quuJs6ETYmnpgS3LwSZxPIltgBDXz8M1k/W2ySNv2f9/NPhxLGK2D21dkHeSGmenRT3Yqcdl0m/h3OYr8V+lXNYGf8aCCpd4bWjE4QIPj7vUKN4Nrfs7ML6Y2OyS830JCnofg/k7lpFpt4SqZc5HGg1HCOrHvOdC8bP6FGDbE/VV0mX4IakzbdS/op+Kt3G24/8QbBV7y86sGSQ/vZzU8FXs7u6jIvwchsEP2BpIhW3G8uWNwa3HmjfH/ZjhhCWvluAcF+nMf14ClKg5hGgtPLJ98ueNAkc5Hs2WZlk2QHvfreCK1CCGO6nMZVSb99VM/ajr8WHTte9JSmkXq/i/U943HEbdzW6Re/S88dKgg8pGOLlAeNiqrcLkUR3/aClFpMXcOUP3rmETcWSfMXZE3TUOi8i+fqRnTYLflVx/Vb/6GJ7eIRZUA6k3RYR3iFSK9c4iDdNwJuZL2FKz/IK5VimcNWEqdXjSoxSgmF0UPlDoUlNrPcM7ftmA8Y9gKiqKEHuWN+AZRIwtVSxye2Kf8rM3lhJ5XcBXU9n4v0Oy1RU2M+4qM8AQPVwse8ErNSob5oFPWxuqZnVzo1qB/IBxkM3EVUKFUUlO3e51259GgNcJbCmlvrdjtoTW7rChm1wyCKzpCTwozUUEOIcWLneRLgMXh+SjGSFkAllzbGS5HK7LlfCMRNRDSvbQPjcXaenNYxCvu2Qyznz6StuxVj66SgI0T8B6/sfHAJYZaZ78thjOSIFumNWLQbeZixDCCC+v0YBtkxiBB3jefHqZ/dFHU+crbj6OvS1x/JDD7vlm7zOVPwpUC01nhxZuY/63E7g";const Wc=44032,$u=4352,Lu=4449,Fu=4519,M1=19,j1=21,Ga=28,Mu=j1*Ga,k3=M1*Mu,$3=Wc+k3,L3=$u+M1,F3=Lu+j1,M3=Fu+Ga;function Dc(r){return r>>24&255}function z1(r){return r&16777215}let _d,Fy,Td,yu;function j3(){let r=U1(U3);_d=new Map(k1(r).flatMap((e,t)=>e.map(n=>[n,t+1<<24]))),Fy=new Set(Gc(r)),Td=new Map,yu=new Map;for(let[e,t]of $1(r)){if(!Fy.has(e)&&t.length==2){let[n,s]=t,i=yu.get(n);i||(i=new Map,yu.set(n,i)),i.set(s,e)}Td.set(e,t.reverse())}}function H1(r){return r>=Wc&&r<$3}function z3(r,e){if(r>=$u&&r<L3&&e>=Lu&&e<F3)return Wc+(r-$u)*Mu+(e-Lu)*Ga;if(H1(r)&&e>Fu&&e<M3&&(r-Wc)%Ga==0)return r+(e-Fu);{let t=yu.get(r);return t&&(t=t.get(e),t)?t:-1}}function q1(r){_d||j3();let e=[],t=[],n=!1;function s(i){let o=_d.get(i);o&&(n=!0,i|=o),e.push(i)}for(let i of r)for(;;){if(i<128)e.push(i);else if(H1(i)){let o=i-Wc,a=o/Mu|0,c=o%Mu/Ga|0,l=o%Ga;s($u+a),s(Lu+c),l>0&&s(Fu+l)}else{let o=Td.get(i);o?t.push(...o):s(i)}if(!t.length)break;i=t.pop()}if(n&&e.length>1){let i=Dc(e[0]);for(let o=1;o<e.length;o++){let a=Dc(e[o]);if(a==0||i<=a){i=a;continue}let c=o-1;for(;;){let l=e[c+1];if(e[c+1]=e[c],e[c]=l,!c||(i=Dc(e[--c]),i<=a))break}i=Dc(e[o])}}return e}function H3(r){let e=[],t=[],n=-1,s=0;for(let i of r){let o=Dc(i),a=z1(i);if(n==-1)o==0?n=a:e.push(a);else if(s>0&&s>=o)o==0?(e.push(n,...t),t.length=0,n=a):t.push(a),s=o;else{let c=z3(n,a);c>=0?n=c:s==0&&o==0?(e.push(n),n=a):(t.push(a),s=o)}}return n>=0&&e.push(n,...t),e}function V1(r){return q1(r).map(z1)}function q3(r){return H3(q1(r))}const My=45,K1=".",G1=65039,Q1=1,ju=r=>Array.from(r);function Jc(r,e){return r.P.has(e)||r.Q.has(e)}class V3 extends Array{get is_emoji(){return!0}}let Nd,W1,Oi,Rd,J1,Qo,hf,To,pi,jy,Ud;function sg(){if(Nd)return;let r=U1(x3);const e=()=>Gc(r),t=()=>new Set(e()),n=(u,h)=>h.forEach(f=>u.add(f));Nd=new Map($1(r)),W1=t(),Oi=e(),Rd=new Set(e().map(u=>Oi[u])),Oi=new Set(Oi),J1=t(),t();let s=k1(r),i=r();const o=()=>{let u=new Set;return e().forEach(h=>n(u,s[h])),n(u,e()),u};Qo=Qc(u=>{let h=Qc(r).map(f=>f+96);if(h.length){let f=u>=i;h[0]-=32,h=Ka(h),f&&(h=`Restricted[${h}]`);let d=o(),p=o(),g=!r();return{N:h,P:d,Q:p,M:g,R:f}}}),hf=t(),To=new Map;let a=e().concat(ju(hf)).sort((u,h)=>u-h);a.forEach((u,h)=>{let f=r(),d=a[h]=f?a[h-f]:{V:[],M:new Map};d.V.push(u),hf.has(u)||To.set(u,d)});for(let{V:u,M:h}of new Set(To.values())){let f=[];for(let p of u){let g=Qo.filter(b=>Jc(b,p)),m=f.find(({G:b})=>g.some(x=>b.has(x)));m||(m={G:new Set,V:[]},f.push(m)),m.V.push(p),n(m.G,g)}let d=f.flatMap(p=>ju(p.G));for(let{G:p,V:g}of f){let m=new Set(d.filter(b=>!p.has(b)));for(let b of g)h.set(b,m)}}pi=new Set;let c=new Set;const l=u=>pi.has(u)?c.add(u):pi.add(u);for(let u of Qo){for(let h of u.P)l(h);for(let h of u.Q)l(h)}for(let u of pi)!To.has(u)&&!c.has(u)&&To.set(u,Q1);n(pi,V1(pi)),jy=_3(r).map(u=>V3.from(u)).sort(R3),Ud=new Map;for(let u of jy){let h=[Ud];for(let f of u){let d=h.map(p=>{let g=p.get(f);return g||(g=new Map,p.set(f,g)),g});f===G1?h.push(...d):h=d}for(let f of h)f.V=u}}function ig(r){return(Y1(r)?"":`${og(Dh([r]))} `)+F1(r)}function og(r){return`"${r}"‎`}function K3(r){if(r.length>=4&&r[2]==My&&r[3]==My)throw new Error(`invalid label extension: "${Ka(r.slice(0,4))}"`)}function G3(r){for(let t=r.lastIndexOf(95);t>0;)if(r[--t]!==95)throw new Error("underscore allowed only at start")}function Q3(r){let e=r[0],t=$y.get(e);if(t)throw Uc(`leading ${t}`);let n=r.length,s=-1;for(let i=1;i<n;i++){e=r[i];let o=$y.get(e);if(o){if(s==i)throw Uc(`${t} + ${o}`);s=i+1,t=o}}if(s==n)throw Uc(`trailing ${t}`)}function Dh(r,e=1/0,t=F1){let n=[];W3(r[0])&&n.push("◌"),r.length>e&&(e>>=1,r=[...r.slice(0,e),8230,...r.slice(-e)]);let s=0,i=r.length;for(let o=0;o<i;o++){let a=r[o];Y1(a)&&(n.push(Ka(r.slice(s,o))),n.push(t(a)),s=o+1)}return n.push(Ka(r.slice(s,i))),n.join("")}function W3(r){return sg(),Oi.has(r)}function Y1(r){return sg(),J1.has(r)}function J3(r){return eS(Y3(r,q3,nS))}function Y3(r,e,t){if(!r)return[];sg();let n=0;return r.split(K1).map(s=>{let i=N3(s),o={input:i,offset:n};n+=i.length+1;try{let a=o.tokens=rS(i,e,t),c=a.length,l;if(!c)throw new Error("empty label");let u=o.output=a.flat();if(G3(u),!(o.emoji=c>1||a[0].is_emoji)&&u.every(f=>f<128))K3(u),l="ASCII";else{let f=a.flatMap(d=>d.is_emoji?[]:d);if(!f.length)l="Emoji";else{if(Oi.has(u[0]))throw Uc("leading combining mark");for(let g=1;g<c;g++){let m=a[g];if(!m.is_emoji&&Oi.has(m[0]))throw Uc(`emoji + combining mark: "${Ka(a[g-1])} + ${Dh([m[0]])}"`)}Q3(u);let d=ju(new Set(f)),[p]=X3(d);tS(p,f),Z3(p,d),l=p.N}}o.type=l}catch(a){o.error=a}return o})}function Z3(r,e){let t,n=[];for(let s of e){let i=To.get(s);if(i===Q1)return;if(i){let o=i.M.get(s);if(t=t?t.filter(a=>o.has(a)):ju(o),!t.length)return}else n.push(s)}if(t){for(let s of t)if(n.every(i=>Jc(s,i)))throw new Error(`whole-script confusable: ${r.N}/${s.N}`)}}function X3(r){let e=Qo;for(let t of r){let n=e.filter(s=>Jc(s,t));if(!n.length)throw Qo.some(s=>Jc(s,t))?X1(e[0],t):Z1(t);if(e=n,n.length==1)break}return e}function eS(r){return r.map(({input:e,error:t,output:n})=>{if(t){let s=t.message;throw new Error(r.length==1?s:`Invalid label ${og(Dh(e,63))}: ${s}`)}return Ka(n)}).join(K1)}function Z1(r){return new Error(`disallowed character: ${ig(r)}`)}function X1(r,e){let t=ig(e),n=Qo.find(s=>s.P.has(e));return n&&(t=`${n.N} ${t}`),new Error(`illegal mixture: ${r.N} + ${t}`)}function Uc(r){return new Error(`illegal placement: ${r}`)}function tS(r,e){for(let t of e)if(!Jc(r,t))throw X1(r,t);if(r.M){let t=V1(e);for(let n=1,s=t.length;n<s;n++)if(Rd.has(t[n])){let i=n+1;for(let o;i<s&&Rd.has(o=t[i]);i++)for(let a=n;a<i;a++)if(t[a]==o)throw new Error(`duplicate non-spacing marks: ${ig(o)}`);if(i-n>Ly)throw new Error(`excessive non-spacing marks: ${og(Dh(t.slice(n-1,i)))} (${i-n}/${Ly})`);n=i}}}function rS(r,e,t){let n=[],s=[];for(r=r.slice().reverse();r.length;){let i=sS(r);if(i)s.length&&(n.push(e(s)),s=[]),n.push(t(i));else{let o=r.pop();if(pi.has(o))s.push(o);else{let a=Nd.get(o);if(a)s.push(...a);else if(!W1.has(o))throw Z1(o)}}}return s.length&&n.push(e(s)),n}function nS(r){return r.filter(e=>e!=G1)}function sS(r,e){let t=Ud,n,s=r.length;for(;s&&(t=t.get(r[--s]),!!t);){let{V:i}=t;i&&(n=i,r.length=s)}return n}const ev=new Uint8Array(32);ev.fill(0);function zy(r){return R(r.length!==0,"invalid ENS name; empty component","comp",r),r}function tv(r){const e=rs(iS(r)),t=[];if(r.length===0)return t;let n=0;for(let s=0;s<e.length;s++)e[s]===46&&(t.push(zy(e.slice(n,s))),n=s+1);return R(n<e.length,"invalid ENS name; empty component","name",r),t.push(zy(e.slice(n))),t}function iS(r){try{if(r.length===0)throw new Error("empty label");return J3(r)}catch(e){R(!1,`invalid ENS name (${e.message})`,"name",r)}}function kd(r){R(typeof r=="string","invalid ENS name; not a string","name",r),R(r.length,"invalid ENS name (empty label)","name",r);let e=ev;const t=tv(r);for(;t.length;)e=Qe(Fe([e,Qe(t.pop())]));return X(e)}function oS(r,e){const t=e;return R(t<=255,"DNS encoded label cannot exceed 255","length",t),X(Fe(tv(r).map(n=>{R(n.length<=t,`label ${JSON.stringify(r)} exceeds ${t} bytes`,"name",r);const s=new Uint8Array(n.length+1);return s.set(n,1),s[0]=s.length-1,s})))+"00"}const rv=new Uint8Array(32);rv.fill(0);const aS=BigInt(-1),nv=BigInt(0),sv=BigInt(1),cS=BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff");function lS(r){const e=ue(r),t=e.length%32;return t?Fe([e,rv.slice(t)]):X(e)}const uS=Xs(sv,32),hS=Xs(nv,32),Hy={name:"string",version:"string",chainId:"uint256",verifyingContract:"address",salt:"bytes32"},ff=["name","version","chainId","verifyingContract","salt"];function qy(r){return function(e){return R(typeof e=="string",`invalid domain value for ${JSON.stringify(r)}`,`domain.${r}`,e),e}}const fS={name:qy("name"),version:qy("version"),chainId:function(r){const e=re(r,"domain.chainId");return R(e>=0,"invalid chain ID","domain.chainId",r),Number.isSafeInteger(e)?Number(e):qr(e)},verifyingContract:function(r){try{return Ie(r).toLowerCase()}catch{}R(!1,'invalid domain value "verifyingContract"',"domain.verifyingContract",r)},salt:function(r){const e=ue(r,"domain.salt");return R(e.length===32,'invalid domain value "salt"',"domain.salt",r),X(e)}};function df(r){{const e=r.match(/^(u?)int(\d+)$/);if(e){const t=e[1]==="",n=parseInt(e[2]);R(n%8===0&&n!==0&&n<=256&&e[2]===String(n),"invalid numeric width","type",r);const s=Si(cS,t?n-1:n),i=t?(s+sv)*aS:nv;return function(o){const a=re(o,"value");return R(a>=i&&a<=s,`value out-of-bounds for ${r}`,"value",a),Xs(t?jb(a,256):a,32)}}}{const e=r.match(/^bytes(\d+)$/);if(e){const t=parseInt(e[1]);return R(t!==0&&t<=32&&e[1]===String(t),"invalid bytes width","type",r),function(n){const s=ue(n);return R(s.length===t,`invalid length for ${r}`,"value",n),lS(n)}}}switch(r){case"address":return function(e){return as(Ie(e),32)};case"bool":return function(e){return e?uS:hS};case"bytes":return function(e){return Qe(e)};case"string":return function(e){return to(e)}}return null}function Vy(r,e){return`${r}(${e.map(({name:t,type:n})=>n+" "+t).join(",")})`}function Vl(r){const e=r.match(/^([^\x5b]*)((\x5b\d*\x5d)*)(\x5b(\d*)\x5d)$/);return e?{base:e[1],index:e[2]+e[4],array:{base:e[1],prefix:e[1]+e[2],count:e[5]?parseInt(e[5]):-1}}:{base:r}}var ul,Kn,Ia,dh,iv;const mr=class mr{constructor(e){M(this,dh);F(this,"primaryType");M(this,ul);M(this,Kn);M(this,Ia);O(this,Kn,new Map),O(this,Ia,new Map);const t=new Map,n=new Map,s=new Map,i={};Object.keys(e).forEach(c=>{i[c]=e[c].map(({name:l,type:u})=>{let{base:h,index:f}=Vl(u);return h==="int"&&!e.int&&(h="int256"),h==="uint"&&!e.uint&&(h="uint256"),{name:l,type:h+(f||"")}}),t.set(c,new Set),n.set(c,[]),s.set(c,new Set)}),O(this,ul,JSON.stringify(i));for(const c in i){const l=new Set;for(const u of i[c]){R(!l.has(u.name),`duplicate variable name ${JSON.stringify(u.name)} in ${JSON.stringify(c)}`,"types",e),l.add(u.name);const h=Vl(u.type).base;R(h!==c,`circular type reference to ${JSON.stringify(h)}`,"types",e),!df(h)&&(R(n.has(h),`unknown type ${JSON.stringify(h)}`,"types",e),n.get(h).push(c),t.get(c).add(h))}}const o=Array.from(n.keys()).filter(c=>n.get(c).length===0);R(o.length!==0,"missing primary type","types",e),R(o.length===1,`ambiguous primary types or unused types: ${o.map(c=>JSON.stringify(c)).join(", ")}`,"types",e),ie(this,{primaryType:o[0]});function a(c,l){R(!l.has(c),`circular type reference to ${JSON.stringify(c)}`,"types",e),l.add(c);for(const u of t.get(c))if(n.has(u)){a(u,l);for(const h of l)s.get(h).add(u)}l.delete(c)}a(this.primaryType,new Set);for(const[c,l]of s){const u=Array.from(l);u.sort(),y(this,Kn).set(c,Vy(c,i[c])+u.map(h=>Vy(h,i[h])).join(""))}}get types(){return JSON.parse(y(this,ul))}getEncoder(e){let t=y(this,Ia).get(e);return t||(t=K(this,dh,iv).call(this,e),y(this,Ia).set(e,t)),t}encodeType(e){const t=y(this,Kn).get(e);return R(t,`unknown type: ${JSON.stringify(e)}`,"name",e),t}encodeData(e,t){return this.getEncoder(e)(t)}hashStruct(e,t){return Qe(this.encodeData(e,t))}encode(e){return this.encodeData(this.primaryType,e)}hash(e){return this.hashStruct(this.primaryType,e)}_visit(e,t,n){if(df(e))return n(e,t);const s=Vl(e).array;if(s)return R(s.count===-1||s.count===t.length,`array length mismatch; expected length ${s.count}`,"value",t),t.map(o=>this._visit(s.prefix,o,n));const i=this.types[e];if(i)return i.reduce((o,{name:a,type:c})=>(o[a]=this._visit(c,t[a],n),o),{});R(!1,`unknown type: ${e}`,"type",e)}visit(e,t){return this._visit(this.primaryType,e,t)}static from(e){return new mr(e)}static getPrimaryType(e){return mr.from(e).primaryType}static hashStruct(e,t,n){return mr.from(t).hashStruct(e,n)}static hashDomain(e){const t=[];for(const n in e){if(e[n]==null)continue;const s=Hy[n];R(s,`invalid typed-data domain key: ${JSON.stringify(n)}`,"domain",e),t.push({name:n,type:s})}return t.sort((n,s)=>ff.indexOf(n.name)-ff.indexOf(s.name)),mr.hashStruct("EIP712Domain",{EIP712Domain:t},e)}static encode(e,t,n){return Fe(["0x1901",mr.hashDomain(e),mr.from(t).hash(n)])}static hash(e,t,n){return Qe(mr.encode(e,t,n))}static async resolveNames(e,t,n,s){e=Object.assign({},e);for(const a in e)e[a]==null&&delete e[a];const i={};e.verifyingContract&&!_e(e.verifyingContract,20)&&(i[e.verifyingContract]="0x");const o=mr.from(t);o.visit(n,(a,c)=>(a==="address"&&!_e(c,20)&&(i[c]="0x"),c));for(const a in i)i[a]=await s(a);return e.verifyingContract&&i[e.verifyingContract]&&(e.verifyingContract=i[e.verifyingContract]),n=o.visit(n,(a,c)=>a==="address"&&i[c]?i[c]:c),{domain:e,value:n}}static getPayload(e,t,n){mr.hashDomain(e);const s={},i=[];ff.forEach(c=>{const l=e[c];l!=null&&(s[c]=fS[c](l),i.push({name:c,type:Hy[c]}))});const o=mr.from(t);t=o.types;const a=Object.assign({},t);return R(a.EIP712Domain==null,"types must not contain EIP712Domain type","types.EIP712Domain",t),a.EIP712Domain=i,o.encode(n),{types:a,domain:s,primaryType:o.primaryType,message:o.visit(n,(c,l)=>{if(c.match(/^bytes(\d*)/))return X(ue(l));if(c.match(/^u?int/))return re(l).toString();switch(c){case"address":return l.toLowerCase();case"bool":return!!l;case"string":return R(typeof l=="string","invalid string","value",l),l}R(!1,"unsupported type","type",c)})}}};ul=new WeakMap,Kn=new WeakMap,Ia=new WeakMap,dh=new WeakSet,iv=function(e){{const s=df(e);if(s)return s}const t=Vl(e).array;if(t){const s=t.prefix,i=this.getEncoder(s);return o=>{R(t.count===-1||t.count===o.length,`array length mismatch; expected length ${t.count}`,"value",o);let a=o.map(i);return y(this,Kn).has(s)&&(a=a.map(Qe)),Qe(Fe(a))}}const n=this.types[e];if(n){const s=to(y(this,Kn).get(e));return i=>{const o=n.map(({name:a,type:c})=>{const l=this.getEncoder(c)(i[a]);return y(this,Kn).has(c)?Qe(l):l});return o.unshift(s),Fe(o)}}R(!1,`unknown type: ${e}`,"type",e)};let zu=mr;function Rt(r){const e=new Set;return r.forEach(t=>e.add(t)),Object.freeze(e)}const dS="external public payable override",pS=Rt(dS.split(" ")),ov="constant external internal payable private public pure view override",gS=Rt(ov.split(" ")),av="constructor error event fallback function receive struct",cv=Rt(av.split(" ")),lv="calldata memory storage payable indexed",yS=Rt(lv.split(" ")),mS="tuple returns",wS=[av,lv,mS,ov].join(" "),bS=Rt(wS.split(" ")),vS={"(":"OPEN_PAREN",")":"CLOSE_PAREN","[":"OPEN_BRACKET","]":"CLOSE_BRACKET",",":"COMMA","@":"AT"},ES=new RegExp("^(\\s*)"),AS=new RegExp("^([0-9]+)"),xS=new RegExp("^([a-zA-Z$_][a-zA-Z0-9$_]*)"),uv=new RegExp("^([a-zA-Z$_][a-zA-Z0-9$_]*)$"),hv=new RegExp("^(address|bool|bytes([0-9]*)|string|u?int([0-9]*))$");var lt,zr,hl,$d;const ph=class ph{constructor(e){M(this,hl);M(this,lt);M(this,zr);O(this,lt,0),O(this,zr,e.slice())}get offset(){return y(this,lt)}get length(){return y(this,zr).length-y(this,lt)}clone(){return new ph(y(this,zr))}reset(){O(this,lt,0)}popKeyword(e){const t=this.peek();if(t.type!=="KEYWORD"||!e.has(t.text))throw new Error(`expected keyword ${t.text}`);return this.pop().text}popType(e){if(this.peek().type!==e){const t=this.peek();throw new Error(`expected ${e}; got ${t.type} ${JSON.stringify(t.text)}`)}return this.pop().text}popParen(){const e=this.peek();if(e.type!=="OPEN_PAREN")throw new Error("bad start");const t=K(this,hl,$d).call(this,y(this,lt)+1,e.match+1);return O(this,lt,e.match+1),t}popParams(){const e=this.peek();if(e.type!=="OPEN_PAREN")throw new Error("bad start");const t=[];for(;y(this,lt)<e.match-1;){const n=this.peek().linkNext;t.push(K(this,hl,$d).call(this,y(this,lt)+1,n)),O(this,lt,n)}return O(this,lt,e.match+1),t}peek(){if(y(this,lt)>=y(this,zr).length)throw new Error("out-of-bounds");return y(this,zr)[y(this,lt)]}peekKeyword(e){const t=this.peekType("KEYWORD");return t!=null&&e.has(t)?t:null}peekType(e){if(this.length===0)return null;const t=this.peek();return t.type===e?t.text:null}pop(){const e=this.peek();return ic(this,lt)._++,e}toString(){const e=[];for(let t=y(this,lt);t<y(this,zr).length;t++){const n=y(this,zr)[t];e.push(`${n.type}:${n.text}`)}return`<TokenString ${e.join(" ")}>`}};lt=new WeakMap,zr=new WeakMap,hl=new WeakSet,$d=function(e=0,t=0){return new ph(y(this,zr).slice(e,t).map(n=>Object.freeze(Object.assign({},n,{match:n.match-e,linkBack:n.linkBack-e,linkNext:n.linkNext-e}))))};let Wr=ph;function si(r){const e=[],t=o=>{const a=i<r.length?JSON.stringify(r[i]):"$EOI";throw new Error(`invalid token ${a} at ${i}: ${o}`)};let n=[],s=[],i=0;for(;i<r.length;){let o=r.substring(i),a=o.match(ES);a&&(i+=a[1].length,o=r.substring(i));const c={depth:n.length,linkBack:-1,linkNext:-1,match:-1,type:"",text:"",offset:i,value:-1};e.push(c);let l=vS[o[0]]||"";if(l){if(c.type=l,c.text=o[0],i++,l==="OPEN_PAREN")n.push(e.length-1),s.push(e.length-1);else if(l=="CLOSE_PAREN")n.length===0&&t("no matching open bracket"),c.match=n.pop(),e[c.match].match=e.length-1,c.depth--,c.linkBack=s.pop(),e[c.linkBack].linkNext=e.length-1;else if(l==="COMMA")c.linkBack=s.pop(),e[c.linkBack].linkNext=e.length-1,s.push(e.length-1);else if(l==="OPEN_BRACKET")c.type="BRACKET";else if(l==="CLOSE_BRACKET"){let u=e.pop().text;if(e.length>0&&e[e.length-1].type==="NUMBER"){const h=e.pop().text;u=h+u,e[e.length-1].value=oe(h)}if(e.length===0||e[e.length-1].type!=="BRACKET")throw new Error("missing opening bracket");e[e.length-1].text+=u}continue}if(a=o.match(xS),a){if(c.text=a[1],i+=c.text.length,bS.has(c.text)){c.type="KEYWORD";continue}if(c.text.match(hv)){c.type="TYPE";continue}c.type="ID";continue}if(a=o.match(AS),a){c.text=a[1],c.type="NUMBER",i+=c.text.length;continue}throw new Error(`unexpected token ${JSON.stringify(o[0])} at position ${i}`)}return new Wr(e.map(o=>Object.freeze(o)))}function Ky(r,e){let t=[];for(const n in e.keys())r.has(n)&&t.push(n);if(t.length>1)throw new Error(`conflicting types: ${t.join(", ")}`)}function Ch(r,e){if(e.peekKeyword(cv)){const t=e.pop().text;if(t!==r)throw new Error(`expected ${r}, got ${t}`)}return e.popType("ID")}function cs(r,e){const t=new Set;for(;;){const n=r.peekType("KEYWORD");if(n==null||e&&!e.has(n))break;if(r.pop(),t.has(n))throw new Error(`duplicate keywords: ${JSON.stringify(n)}`);t.add(n)}return Object.freeze(t)}function fv(r){let e=cs(r,gS);return Ky(e,Rt("constant payable nonpayable".split(" "))),Ky(e,Rt("pure view payable nonpayable".split(" "))),e.has("view")?"view":e.has("pure")?"pure":e.has("payable")?"payable":e.has("nonpayable")?"nonpayable":e.has("constant")?"view":"nonpayable"}function ns(r,e){return r.popParams().map(t=>dt.from(t,e))}function dv(r){if(r.peekType("AT")){if(r.pop(),r.peekType("NUMBER"))return re(r.pop().text);throw new Error("invalid gas")}return null}function ro(r){if(r.length)throw new Error(`unexpected tokens at offset ${r.offset}: ${r.toString()}`)}const IS=new RegExp(/^(.*)\[([0-9]*)\]$/);function Gy(r){const e=r.match(hv);if(R(e,"invalid type","type",r),r==="uint")return"uint256";if(r==="int")return"int256";if(e[2]){const t=parseInt(e[2]);R(t!==0&&t<=32,"invalid bytes length","type",r)}else if(e[3]){const t=parseInt(e[3]);R(t!==0&&t<=256&&t%8===0,"invalid numeric width","type",r)}return r}const Ue={},Yt=Symbol.for("_ethers_internal"),Qy="_ParamTypeInternal",Wy="_ErrorInternal",Jy="_EventInternal",Yy="_ConstructorInternal",Zy="_FallbackInternal",Xy="_FunctionInternal",e0="_StructInternal";var Sa,mu;const wr=class wr{constructor(e,t,n,s,i,o,a,c){M(this,Sa);F(this,"name");F(this,"type");F(this,"baseType");F(this,"indexed");F(this,"components");F(this,"arrayLength");F(this,"arrayChildren");if(bl(e,Ue,"ParamType"),Object.defineProperty(this,Yt,{value:Qy}),o&&(o=Object.freeze(o.slice())),s==="array"){if(a==null||c==null)throw new Error("")}else if(a!=null||c!=null)throw new Error("");if(s==="tuple"){if(o==null)throw new Error("")}else if(o!=null)throw new Error("");ie(this,{name:t,type:n,baseType:s,indexed:i,components:o,arrayLength:a,arrayChildren:c})}format(e){if(e==null&&(e="sighash"),e==="json"){const n=this.name||"";if(this.isArray()){const i=JSON.parse(this.arrayChildren.format("json"));return i.name=n,i.type+=`[${this.arrayLength<0?"":String(this.arrayLength)}]`,JSON.stringify(i)}const s={type:this.baseType==="tuple"?"tuple":this.type,name:n};return typeof this.indexed=="boolean"&&(s.indexed=this.indexed),this.isTuple()&&(s.components=this.components.map(i=>JSON.parse(i.format(e)))),JSON.stringify(s)}let t="";return this.isArray()?(t+=this.arrayChildren.format(e),t+=`[${this.arrayLength<0?"":String(this.arrayLength)}]`):this.isTuple()?t+="("+this.components.map(n=>n.format(e)).join(e==="full"?", ":",")+")":t+=this.type,e!=="sighash"&&(this.indexed===!0&&(t+=" indexed"),e==="full"&&this.name&&(t+=" "+this.name)),t}isArray(){return this.baseType==="array"}isTuple(){return this.baseType==="tuple"}isIndexable(){return this.indexed!=null}walk(e,t){if(this.isArray()){if(!Array.isArray(e))throw new Error("invalid array value");if(this.arrayLength!==-1&&e.length!==this.arrayLength)throw new Error("array is wrong length");const n=this;return e.map(s=>n.arrayChildren.walk(s,t))}if(this.isTuple()){if(!Array.isArray(e))throw new Error("invalid tuple value");if(e.length!==this.components.length)throw new Error("array is wrong length");const n=this;return e.map((s,i)=>n.components[i].walk(s,t))}return t(this.type,e)}async walkAsync(e,t){const n=[],s=[e];return K(this,Sa,mu).call(this,n,e,t,i=>{s[0]=i}),n.length&&await Promise.all(n),s[0]}static from(e,t){if(wr.isParamType(e))return e;if(typeof e=="string")try{return wr.from(si(e),t)}catch{R(!1,"invalid param type","obj",e)}else if(e instanceof Wr){let a="",c="",l=null;cs(e,Rt(["tuple"])).has("tuple")||e.peekType("OPEN_PAREN")?(c="tuple",l=e.popParams().map(g=>wr.from(g)),a=`tuple(${l.map(g=>g.format()).join(",")})`):(a=Gy(e.popType("TYPE")),c=a);let u=null,h=null;for(;e.length&&e.peekType("BRACKET");){const g=e.pop();u=new wr(Ue,"",a,c,null,l,h,u),h=g.value,a+=g.text,c="array",l=null}let f=null;if(cs(e,yS).has("indexed")){if(!t)throw new Error("");f=!0}const p=e.peekType("ID")?e.pop().text:"";if(e.length)throw new Error("leftover tokens");return new wr(Ue,p,a,c,f,l,h,u)}const n=e.name;R(!n||typeof n=="string"&&n.match(uv),"invalid name","obj.name",n);let s=e.indexed;s!=null&&(R(t,"parameter cannot be indexed","obj.indexed",e.indexed),s=!!s);let i=e.type,o=i.match(IS);if(o){const a=parseInt(o[2]||"-1"),c=wr.from({type:o[1],components:e.components});return new wr(Ue,n||"",i,"array",s,null,a,c)}if(i==="tuple"||i.startsWith("tuple(")||i.startsWith("(")){const a=e.components!=null?e.components.map(l=>wr.from(l)):null;return new wr(Ue,n||"",i,"tuple",s,a,null,null)}return i=Gy(e.type),new wr(Ue,n||"",i,i,s,null,null,null)}static isParamType(e){return e&&e[Yt]===Qy}};Sa=new WeakSet,mu=function(e,t,n,s){if(this.isArray()){if(!Array.isArray(t))throw new Error("invalid array value");if(this.arrayLength!==-1&&t.length!==this.arrayLength)throw new Error("array is wrong length");const o=this.arrayChildren,a=t.slice();a.forEach((c,l)=>{var u;K(u=o,Sa,mu).call(u,e,c,n,h=>{a[l]=h})}),s(a);return}if(this.isTuple()){const o=this.components;let a;if(Array.isArray(t))a=t.slice();else{if(t==null||typeof t!="object")throw new Error("invalid tuple value");a=o.map(c=>{if(!c.name)throw new Error("cannot use object value with unnamed components");if(!(c.name in t))throw new Error(`missing value for component ${c.name}`);return t[c.name]})}if(a.length!==this.components.length)throw new Error("array is wrong length");a.forEach((c,l)=>{var u;K(u=o[l],Sa,mu).call(u,e,c,n,h=>{a[l]=h})}),s(a);return}const i=n(this.type,t);i.then?e.push((async function(){s(await i)})()):s(i)};let dt=wr;class no{constructor(e,t,n){F(this,"type");F(this,"inputs");bl(e,Ue,"Fragment"),n=Object.freeze(n.slice()),ie(this,{type:t,inputs:n})}static from(e){if(typeof e=="string"){try{no.from(JSON.parse(e))}catch{}return no.from(si(e))}if(e instanceof Wr)switch(e.peekKeyword(cv)){case"constructor":return es.from(e);case"error":return Gt.from(e);case"event":return bn.from(e);case"fallback":case"receive":return Mn.from(e);case"function":return vn.from(e);case"struct":return eo.from(e)}else if(typeof e=="object"){switch(e.type){case"constructor":return es.from(e);case"error":return Gt.from(e);case"event":return bn.from(e);case"fallback":case"receive":return Mn.from(e);case"function":return vn.from(e);case"struct":return eo.from(e)}q(!1,`unsupported type: ${e.type}`,"UNSUPPORTED_OPERATION",{operation:"Fragment.from"})}R(!1,"unsupported frgament object","obj",e)}static isConstructor(e){return es.isFragment(e)}static isError(e){return Gt.isFragment(e)}static isEvent(e){return bn.isFragment(e)}static isFunction(e){return vn.isFragment(e)}static isStruct(e){return eo.isFragment(e)}}class Bh extends no{constructor(t,n,s,i){super(t,n,i);F(this,"name");R(typeof s=="string"&&s.match(uv),"invalid identifier","name",s),i=Object.freeze(i.slice()),ie(this,{name:s})}}function Yc(r,e){return"("+e.map(t=>t.format(r)).join(r==="full"?", ":",")+")"}class Gt extends Bh{constructor(e,t,n){super(e,"error",t,n),Object.defineProperty(this,Yt,{value:Wy})}get selector(){return to(this.format("sighash")).substring(0,10)}format(e){if(e==null&&(e="sighash"),e==="json")return JSON.stringify({type:"error",name:this.name,inputs:this.inputs.map(n=>JSON.parse(n.format(e)))});const t=[];return e!=="sighash"&&t.push("error"),t.push(this.name+Yc(e,this.inputs)),t.join(" ")}static from(e){if(Gt.isFragment(e))return e;if(typeof e=="string")return Gt.from(si(e));if(e instanceof Wr){const t=Ch("error",e),n=ns(e);return ro(e),new Gt(Ue,t,n)}return new Gt(Ue,e.name,e.inputs?e.inputs.map(dt.from):[])}static isFragment(e){return e&&e[Yt]===Wy}}class bn extends Bh{constructor(t,n,s,i){super(t,"event",n,s);F(this,"anonymous");Object.defineProperty(this,Yt,{value:Jy}),ie(this,{anonymous:i})}get topicHash(){return to(this.format("sighash"))}format(t){if(t==null&&(t="sighash"),t==="json")return JSON.stringify({type:"event",anonymous:this.anonymous,name:this.name,inputs:this.inputs.map(s=>JSON.parse(s.format(t)))});const n=[];return t!=="sighash"&&n.push("event"),n.push(this.name+Yc(t,this.inputs)),t!=="sighash"&&this.anonymous&&n.push("anonymous"),n.join(" ")}static getTopicHash(t,n){return n=(n||[]).map(i=>dt.from(i)),new bn(Ue,t,n,!1).topicHash}static from(t){if(bn.isFragment(t))return t;if(typeof t=="string")try{return bn.from(si(t))}catch{R(!1,"invalid event fragment","obj",t)}else if(t instanceof Wr){const n=Ch("event",t),s=ns(t,!0),i=!!cs(t,Rt(["anonymous"])).has("anonymous");return ro(t),new bn(Ue,n,s,i)}return new bn(Ue,t.name,t.inputs?t.inputs.map(n=>dt.from(n,!0)):[],!!t.anonymous)}static isFragment(t){return t&&t[Yt]===Jy}}class es extends no{constructor(t,n,s,i,o){super(t,n,s);F(this,"payable");F(this,"gas");Object.defineProperty(this,Yt,{value:Yy}),ie(this,{payable:i,gas:o})}format(t){if(q(t!=null&&t!=="sighash","cannot format a constructor for sighash","UNSUPPORTED_OPERATION",{operation:"format(sighash)"}),t==="json")return JSON.stringify({type:"constructor",stateMutability:this.payable?"payable":"undefined",payable:this.payable,gas:this.gas!=null?this.gas:void 0,inputs:this.inputs.map(s=>JSON.parse(s.format(t)))});const n=[`constructor${Yc(t,this.inputs)}`];return this.payable&&n.push("payable"),this.gas!=null&&n.push(`@${this.gas.toString()}`),n.join(" ")}static from(t){if(es.isFragment(t))return t;if(typeof t=="string")try{return es.from(si(t))}catch{R(!1,"invalid constuctor fragment","obj",t)}else if(t instanceof Wr){cs(t,Rt(["constructor"]));const n=ns(t),s=!!cs(t,pS).has("payable"),i=dv(t);return ro(t),new es(Ue,"constructor",n,s,i)}return new es(Ue,"constructor",t.inputs?t.inputs.map(dt.from):[],!!t.payable,t.gas!=null?t.gas:null)}static isFragment(t){return t&&t[Yt]===Yy}}class Mn extends no{constructor(t,n,s){super(t,"fallback",n);F(this,"payable");Object.defineProperty(this,Yt,{value:Zy}),ie(this,{payable:s})}format(t){const n=this.inputs.length===0?"receive":"fallback";if(t==="json"){const s=this.payable?"payable":"nonpayable";return JSON.stringify({type:n,stateMutability:s})}return`${n}()${this.payable?" payable":""}`}static from(t){if(Mn.isFragment(t))return t;if(typeof t=="string")try{return Mn.from(si(t))}catch{R(!1,"invalid fallback fragment","obj",t)}else if(t instanceof Wr){const n=t.toString(),s=t.peekKeyword(Rt(["fallback","receive"]));if(R(s,"type must be fallback or receive","obj",n),t.popKeyword(Rt(["fallback","receive"]))==="receive"){const c=ns(t);return R(c.length===0,"receive cannot have arguments","obj.inputs",c),cs(t,Rt(["payable"])),ro(t),new Mn(Ue,[],!0)}let o=ns(t);o.length?R(o.length===1&&o[0].type==="bytes","invalid fallback inputs","obj.inputs",o.map(c=>c.format("minimal")).join(", ")):o=[dt.from("bytes")];const a=fv(t);if(R(a==="nonpayable"||a==="payable","fallback cannot be constants","obj.stateMutability",a),cs(t,Rt(["returns"])).has("returns")){const c=ns(t);R(c.length===1&&c[0].type==="bytes","invalid fallback outputs","obj.outputs",c.map(l=>l.format("minimal")).join(", "))}return ro(t),new Mn(Ue,o,a==="payable")}if(t.type==="receive")return new Mn(Ue,[],!0);if(t.type==="fallback"){const n=[dt.from("bytes")],s=t.stateMutability==="payable";return new Mn(Ue,n,s)}R(!1,"invalid fallback description","obj",t)}static isFragment(t){return t&&t[Yt]===Zy}}class vn extends Bh{constructor(t,n,s,i,o,a){super(t,"function",n,i);F(this,"constant");F(this,"outputs");F(this,"stateMutability");F(this,"payable");F(this,"gas");Object.defineProperty(this,Yt,{value:Xy}),o=Object.freeze(o.slice()),ie(this,{constant:s==="view"||s==="pure",gas:a,outputs:o,payable:s==="payable",stateMutability:s})}get selector(){return to(this.format("sighash")).substring(0,10)}format(t){if(t==null&&(t="sighash"),t==="json")return JSON.stringify({type:"function",name:this.name,constant:this.constant,stateMutability:this.stateMutability!=="nonpayable"?this.stateMutability:void 0,payable:this.payable,gas:this.gas!=null?this.gas:void 0,inputs:this.inputs.map(s=>JSON.parse(s.format(t))),outputs:this.outputs.map(s=>JSON.parse(s.format(t)))});const n=[];return t!=="sighash"&&n.push("function"),n.push(this.name+Yc(t,this.inputs)),t!=="sighash"&&(this.stateMutability!=="nonpayable"&&n.push(this.stateMutability),this.outputs&&this.outputs.length&&(n.push("returns"),n.push(Yc(t,this.outputs))),this.gas!=null&&n.push(`@${this.gas.toString()}`)),n.join(" ")}static getSelector(t,n){return n=(n||[]).map(i=>dt.from(i)),new vn(Ue,t,"view",n,[],null).selector}static from(t){if(vn.isFragment(t))return t;if(typeof t=="string")try{return vn.from(si(t))}catch{R(!1,"invalid function fragment","obj",t)}else if(t instanceof Wr){const s=Ch("function",t),i=ns(t),o=fv(t);let a=[];cs(t,Rt(["returns"])).has("returns")&&(a=ns(t));const c=dv(t);return ro(t),new vn(Ue,s,o,i,a,c)}let n=t.stateMutability;return n==null&&(n="payable",typeof t.constant=="boolean"?(n="view",t.constant||(n="payable",typeof t.payable=="boolean"&&!t.payable&&(n="nonpayable"))):typeof t.payable=="boolean"&&!t.payable&&(n="nonpayable")),new vn(Ue,t.name,n,t.inputs?t.inputs.map(dt.from):[],t.outputs?t.outputs.map(dt.from):[],t.gas!=null?t.gas:null)}static isFragment(t){return t&&t[Yt]===Xy}}class eo extends Bh{constructor(e,t,n){super(e,"struct",t,n),Object.defineProperty(this,Yt,{value:e0})}format(){throw new Error("@TODO")}static from(e){if(typeof e=="string")try{return eo.from(si(e))}catch{R(!1,"invalid struct fragment","obj",e)}else if(e instanceof Wr){const t=Ch("struct",e),n=ns(e);return ro(e),new eo(Ue,t,n)}return new eo(Ue,e.name,e.inputs?e.inputs.map(dt.from):[])}static isFragment(e){return e&&e[Yt]===e0}}const Yr=new Map;Yr.set(0,"GENERIC_PANIC");Yr.set(1,"ASSERT_FALSE");Yr.set(17,"OVERFLOW");Yr.set(18,"DIVIDE_BY_ZERO");Yr.set(33,"ENUM_RANGE_ERROR");Yr.set(34,"BAD_STORAGE_DATA");Yr.set(49,"STACK_UNDERFLOW");Yr.set(50,"ARRAY_RANGE_ERROR");Yr.set(65,"OUT_OF_MEMORY");Yr.set(81,"UNINITIALIZED_FUNCTION_CALL");const SS=new RegExp(/^bytes([0-9]*)$/),PS=new RegExp(/^(u?int)([0-9]*)$/);let pf=null,t0=1024;function OS(r,e,t,n){let s="missing revert data",i=null;const o=null;let a=null;if(t){s="execution reverted";const l=ue(t);if(t=X(t),l.length===0)s+=" (no data present; likely require(false) occurred",i="require(false)";else if(l.length%32!==4)s+=" (could not decode reason; invalid data length)";else if(X(l.slice(0,4))==="0x08c379a0")try{i=n.decode(["string"],l.slice(4))[0],a={signature:"Error(string)",name:"Error",args:[i]},s+=`: ${JSON.stringify(i)}`}catch{s+=" (could not decode reason; invalid string data)"}else if(X(l.slice(0,4))==="0x4e487b71")try{const u=Number(n.decode(["uint256"],l.slice(4))[0]);a={signature:"Panic(uint256)",name:"Panic",args:[u]},i=`Panic due to ${Yr.get(u)||"UNKNOWN"}(${u})`,s+=`: ${i}`}catch{s+=" (could not decode panic code)"}else s+=" (unknown custom error)"}const c={to:e.to?Ie(e.to):null,data:e.data||"0x"};return e.from&&(c.from=Ie(e.from)),Re(s,"CALL_EXCEPTION",{action:r,data:t,reason:i,transaction:c,invocation:o,revert:a})}var Ls,No;const gh=class gh{constructor(){M(this,Ls)}getDefaultValue(e){const t=e.map(s=>K(this,Ls,No).call(this,dt.from(s)));return new ql(t,"_").defaultValue()}encode(e,t){Lb(t.length,e.length,"types/values length mismatch");const n=e.map(o=>K(this,Ls,No).call(this,dt.from(o))),s=new ql(n,"_"),i=new xd;return s.encode(i,t),i.data}decode(e,t,n){const s=e.map(o=>K(this,Ls,No).call(this,dt.from(o)));return new ql(s,"_").decode(new Id(t,n,t0))}static _setDefaultMaxInflation(e){R(typeof e=="number"&&Number.isInteger(e),"invalid defaultMaxInflation factor","value",e),t0=e}static defaultAbiCoder(){return pf==null&&(pf=new gh),pf}static getBuiltinCallException(e,t,n){return OS(e,t,n,gh.defaultAbiCoder())}};Ls=new WeakSet,No=function(e){if(e.isArray())return new VI(K(this,Ls,No).call(this,e.arrayChildren),e.arrayLength,e.name);if(e.isTuple())return new ql(e.components.map(n=>K(this,Ls,No).call(this,n)),e.name);switch(e.baseType){case"address":return new HI(e.name);case"bool":return new KI(e.name);case"string":return new t3(e.name);case"bytes":return new GI(e.name);case"":return new JI(e.name)}let t=e.type.match(PS);if(t){let n=parseInt(t[2]||"256");return R(n!==0&&n<=256&&n%8===0,"invalid "+t[1]+" bit length","param",e),new e3(n/8,t[1]==="int",e.name)}if(t=e.type.match(SS),t){let n=parseInt(t[1]);return R(n!==0&&n<=32,"invalid bytes length","param",e),new QI(n,e.name)}R(!1,"invalid type","type",e.type)};let Zc=gh;class DS{constructor(e,t,n){F(this,"fragment");F(this,"name");F(this,"signature");F(this,"topic");F(this,"args");const s=e.name,i=e.format();ie(this,{fragment:e,name:s,signature:i,topic:t,args:n})}}class CS{constructor(e,t,n,s){F(this,"fragment");F(this,"name");F(this,"args");F(this,"signature");F(this,"selector");F(this,"value");const i=e.name,o=e.format();ie(this,{fragment:e,name:i,args:n,signature:o,selector:t,value:s})}}class BS{constructor(e,t,n){F(this,"fragment");F(this,"name");F(this,"args");F(this,"signature");F(this,"selector");const s=e.name,i=e.format();ie(this,{fragment:e,name:s,args:n,signature:i,selector:t})}}class r0{constructor(e){F(this,"hash");F(this,"_isIndexed");ie(this,{hash:e,_isIndexed:!0})}static isIndexed(e){return!!(e&&e._isIndexed)}}const n0={0:"generic panic",1:"assert(false)",17:"arithmetic overflow",18:"division or modulo by zero",33:"enum overflow",34:"invalid encoded storage byte array accessed",49:"out-of-bounds array access; popping on an empty array",50:"out-of-bounds access of an array or bytesN",65:"out of memory",81:"uninitialized function"},s0={"0x08c379a0":{signature:"Error(string)",name:"Error",inputs:["string"],reason:r=>`reverted with reason string ${JSON.stringify(r)}`},"0x4e487b71":{signature:"Panic(uint256)",name:"Panic",inputs:["uint256"],reason:r=>{let e="unknown panic code";return r>=0&&r<=255&&n0[r.toString()]&&(e=n0[r.toString()]),`reverted with panic code 0x${r.toString(16)} (${e})`}}};var hn,fn,dn,xt,Pn,wu,bu;const xi=class xi{constructor(e){M(this,Pn);F(this,"fragments");F(this,"deploy");F(this,"fallback");F(this,"receive");M(this,hn);M(this,fn);M(this,dn);M(this,xt);let t=[];typeof e=="string"?t=JSON.parse(e):t=e,O(this,dn,new Map),O(this,hn,new Map),O(this,fn,new Map);const n=[];for(const o of t)try{n.push(no.from(o))}catch(a){console.log(`[Warning] Invalid Fragment ${JSON.stringify(o)}:`,a.message)}ie(this,{fragments:Object.freeze(n)});let s=null,i=!1;O(this,xt,this.getAbiCoder()),this.fragments.forEach((o,a)=>{let c;switch(o.type){case"constructor":if(this.deploy){console.log("duplicate definition - constructor");return}ie(this,{deploy:o});return;case"fallback":o.inputs.length===0?i=!0:(R(!s||o.payable!==s.payable,"conflicting fallback fragments",`fragments[${a}]`,o),s=o,i=s.payable);return;case"function":c=y(this,dn);break;case"event":c=y(this,fn);break;case"error":c=y(this,hn);break;default:return}const l=o.format();c.has(l)||c.set(l,o)}),this.deploy||ie(this,{deploy:es.from("constructor()")}),ie(this,{fallback:s,receive:i})}format(e){const t=e?"minimal":"full";return this.fragments.map(s=>s.format(t))}formatJson(){const e=this.fragments.map(t=>t.format("json"));return JSON.stringify(e.map(t=>JSON.parse(t)))}getAbiCoder(){return Zc.defaultAbiCoder()}getFunctionName(e){const t=K(this,Pn,wu).call(this,e,null,!1);return R(t,"no matching function","key",e),t.name}hasFunction(e){return!!K(this,Pn,wu).call(this,e,null,!1)}getFunction(e,t){return K(this,Pn,wu).call(this,e,t||null,!0)}forEachFunction(e){const t=Array.from(y(this,dn).keys());t.sort((n,s)=>n.localeCompare(s));for(let n=0;n<t.length;n++){const s=t[n];e(y(this,dn).get(s),n)}}getEventName(e){const t=K(this,Pn,bu).call(this,e,null,!1);return R(t,"no matching event","key",e),t.name}hasEvent(e){return!!K(this,Pn,bu).call(this,e,null,!1)}getEvent(e,t){return K(this,Pn,bu).call(this,e,t||null,!0)}forEachEvent(e){const t=Array.from(y(this,fn).keys());t.sort((n,s)=>n.localeCompare(s));for(let n=0;n<t.length;n++){const s=t[n];e(y(this,fn).get(s),n)}}getError(e,t){if(_e(e)){const s=e.toLowerCase();if(s0[s])return Gt.from(s0[s].signature);for(const i of y(this,hn).values())if(s===i.selector)return i;return null}if(e.indexOf("(")===-1){const s=[];for(const[i,o]of y(this,hn))i.split("(")[0]===e&&s.push(o);if(s.length===0)return e==="Error"?Gt.from("error Error(string)"):e==="Panic"?Gt.from("error Panic(uint256)"):null;if(s.length>1){const i=s.map(o=>JSON.stringify(o.format())).join(", ");R(!1,`ambiguous error description (i.e. ${i})`,"name",e)}return s[0]}if(e=Gt.from(e).format(),e==="Error(string)")return Gt.from("error Error(string)");if(e==="Panic(uint256)")return Gt.from("error Panic(uint256)");const n=y(this,hn).get(e);return n||null}forEachError(e){const t=Array.from(y(this,hn).keys());t.sort((n,s)=>n.localeCompare(s));for(let n=0;n<t.length;n++){const s=t[n];e(y(this,hn).get(s),n)}}_decodeParams(e,t){return y(this,xt).decode(e,t)}_encodeParams(e,t){return y(this,xt).encode(e,t)}encodeDeploy(e){return this._encodeParams(this.deploy.inputs,e||[])}decodeErrorResult(e,t){if(typeof e=="string"){const n=this.getError(e);R(n,"unknown error","fragment",e),e=n}return R(Le(t,0,4)===e.selector,`data signature does not match error ${e.name}.`,"data",t),this._decodeParams(e.inputs,Le(t,4))}encodeErrorResult(e,t){if(typeof e=="string"){const n=this.getError(e);R(n,"unknown error","fragment",e),e=n}return Fe([e.selector,this._encodeParams(e.inputs,t||[])])}decodeFunctionData(e,t){if(typeof e=="string"){const n=this.getFunction(e);R(n,"unknown function","fragment",e),e=n}return R(Le(t,0,4)===e.selector,`data signature does not match function ${e.name}.`,"data",t),this._decodeParams(e.inputs,Le(t,4))}encodeFunctionData(e,t){if(typeof e=="string"){const n=this.getFunction(e);R(n,"unknown function","fragment",e),e=n}return Fe([e.selector,this._encodeParams(e.inputs,t||[])])}decodeFunctionResult(e,t){if(typeof e=="string"){const i=this.getFunction(e);R(i,"unknown function","fragment",e),e=i}let n="invalid length for result data";const s=_t(t);if(s.length%32===0)try{return y(this,xt).decode(e.outputs,s)}catch{n="could not decode result data"}q(!1,n,"BAD_DATA",{value:X(s),info:{method:e.name,signature:e.format()}})}makeError(e,t){const n=ue(e,"data"),s=Zc.getBuiltinCallException("call",t,n);if(s.message.startsWith("execution reverted (unknown custom error)")){const a=X(n.slice(0,4)),c=this.getError(a);if(c)try{const l=y(this,xt).decode(c.inputs,n.slice(4));s.revert={name:c.name,signature:c.format(),args:l},s.reason=s.revert.signature,s.message=`execution reverted: ${s.reason}`}catch{s.message="execution reverted (coult not decode custom error)"}}const o=this.parseTransaction(t);return o&&(s.invocation={method:o.name,signature:o.signature,args:o.args}),s}encodeFunctionResult(e,t){if(typeof e=="string"){const n=this.getFunction(e);R(n,"unknown function","fragment",e),e=n}return X(y(this,xt).encode(e.outputs,t||[]))}encodeFilterTopics(e,t){if(typeof e=="string"){const i=this.getEvent(e);R(i,"unknown event","eventFragment",e),e=i}q(t.length<=e.inputs.length,`too many arguments for ${e.format()}`,"UNEXPECTED_ARGUMENT",{count:t.length,expectedCount:e.inputs.length});const n=[];e.anonymous||n.push(e.topicHash);const s=(i,o)=>i.type==="string"?to(o):i.type==="bytes"?Qe(X(o)):(i.type==="bool"&&typeof o=="boolean"?o=o?"0x01":"0x00":i.type.match(/^u?int/)?o=Xs(o):i.type.match(/^bytes/)?o=GA(o,32):i.type==="address"&&y(this,xt).encode(["address"],[o]),as(X(o),32));for(t.forEach((i,o)=>{const a=e.inputs[o];if(!a.indexed){R(i==null,"cannot filter non-indexed parameters; must be null","contract."+a.name,i);return}i==null?n.push(null):a.baseType==="array"||a.baseType==="tuple"?R(!1,"filtering with tuples or arrays not supported","contract."+a.name,i):Array.isArray(i)?n.push(i.map(c=>s(a,c))):n.push(s(a,i))});n.length&&n[n.length-1]===null;)n.pop();return n}encodeEventLog(e,t){if(typeof e=="string"){const o=this.getEvent(e);R(o,"unknown event","eventFragment",e),e=o}const n=[],s=[],i=[];return e.anonymous||n.push(e.topicHash),R(t.length===e.inputs.length,"event arguments/values mismatch","values",t),e.inputs.forEach((o,a)=>{const c=t[a];if(o.indexed)if(o.type==="string")n.push(to(c));else if(o.type==="bytes")n.push(Qe(c));else{if(o.baseType==="tuple"||o.baseType==="array")throw new Error("not implemented");n.push(y(this,xt).encode([o.type],[c]))}else s.push(o),i.push(c)}),{data:y(this,xt).encode(s,i),topics:n}}decodeEventLog(e,t,n){if(typeof e=="string"){const d=this.getEvent(e);R(d,"unknown event","eventFragment",e),e=d}if(n!=null&&!e.anonymous){const d=e.topicHash;R(_e(n[0],32)&&n[0].toLowerCase()===d,"fragment/topic mismatch","topics[0]",n[0]),n=n.slice(1)}const s=[],i=[],o=[];e.inputs.forEach((d,p)=>{d.indexed?d.type==="string"||d.type==="bytes"||d.baseType==="tuple"||d.baseType==="array"?(s.push(dt.from({type:"bytes32",name:d.name})),o.push(!0)):(s.push(d),o.push(!1)):(i.push(d),o.push(!1))});const a=n!=null?y(this,xt).decode(s,Fe(n)):null,c=y(this,xt).decode(i,t,!0),l=[],u=[];let h=0,f=0;return e.inputs.forEach((d,p)=>{let g=null;if(d.indexed)if(a==null)g=new r0(null);else if(o[p])g=new r0(a[f++]);else try{g=a[f++]}catch(m){g=m}else try{g=c[h++]}catch(m){g=m}l.push(g),u.push(d.name||null)}),ja.fromItems(l,u)}parseTransaction(e){const t=ue(e.data,"tx.data"),n=re(e.value!=null?e.value:0,"tx.value"),s=this.getFunction(X(t.slice(0,4)));if(!s)return null;const i=y(this,xt).decode(s.inputs,t.slice(4));return new CS(s,s.selector,i,n)}parseCallResult(e){throw new Error("@TODO")}parseLog(e){const t=this.getEvent(e.topics[0]);return!t||t.anonymous?null:new DS(t,t.topicHash,this.decodeEventLog(t,e.data,e.topics))}parseError(e){const t=X(e),n=this.getError(Le(t,0,4));if(!n)return null;const s=y(this,xt).decode(n.inputs,Le(t,4));return new BS(n,n.selector,s)}static from(e){return e instanceof xi?e:typeof e=="string"?new xi(JSON.parse(e)):typeof e.formatJson=="function"?new xi(e.formatJson()):typeof e.format=="function"?new xi(e.format("json")):new xi(e)}};hn=new WeakMap,fn=new WeakMap,dn=new WeakMap,xt=new WeakMap,Pn=new WeakSet,wu=function(e,t,n){if(_e(e)){const i=e.toLowerCase();for(const o of y(this,dn).values())if(i===o.selector)return o;return null}if(e.indexOf("(")===-1){const i=[];for(const[o,a]of y(this,dn))o.split("(")[0]===e&&i.push(a);if(t){const o=t.length>0?t[t.length-1]:null;let a=t.length,c=!0;Ot.isTyped(o)&&o.type==="overrides"&&(c=!1,a--);for(let l=i.length-1;l>=0;l--){const u=i[l].inputs.length;u!==a&&(!c||u!==a-1)&&i.splice(l,1)}for(let l=i.length-1;l>=0;l--){const u=i[l].inputs;for(let h=0;h<t.length;h++)if(Ot.isTyped(t[h])){if(h>=u.length){if(t[h].type==="overrides")continue;i.splice(l,1);break}if(t[h].type!==u[h].baseType){i.splice(l,1);break}}}}if(i.length===1&&t&&t.length!==i[0].inputs.length){const o=t[t.length-1];(o==null||Array.isArray(o)||typeof o!="object")&&i.splice(0,1)}if(i.length===0)return null;if(i.length>1&&n){const o=i.map(a=>JSON.stringify(a.format())).join(", ");R(!1,`ambiguous function description (i.e. matches ${o})`,"key",e)}return i[0]}const s=y(this,dn).get(vn.from(e).format());return s||null},bu=function(e,t,n){if(_e(e)){const i=e.toLowerCase();for(const o of y(this,fn).values())if(i===o.topicHash)return o;return null}if(e.indexOf("(")===-1){const i=[];for(const[o,a]of y(this,fn))o.split("(")[0]===e&&i.push(a);if(t){for(let o=i.length-1;o>=0;o--)i[o].inputs.length<t.length&&i.splice(o,1);for(let o=i.length-1;o>=0;o--){const a=i[o].inputs;for(let c=0;c<t.length;c++)if(Ot.isTyped(t[c])&&t[c].type!==a[c].baseType){i.splice(o,1);break}}}if(i.length===0)return null;if(i.length>1&&n){const o=i.map(a=>JSON.stringify(a.format())).join(", ");R(!1,`ambiguous event description (i.e. matches ${o})`,"key",e)}return i[0]}const s=y(this,fn).get(bn.from(e).format());return s||null};let Ld=xi;const pv=BigInt(0);function Wo(r){return r??null}function je(r){return r==null?null:r.toString()}class i0{constructor(e,t,n){F(this,"gasPrice");F(this,"maxFeePerGas");F(this,"maxPriorityFeePerGas");ie(this,{gasPrice:Wo(e),maxFeePerGas:Wo(t),maxPriorityFeePerGas:Wo(n)})}toJSON(){const{gasPrice:e,maxFeePerGas:t,maxPriorityFeePerGas:n}=this;return{_type:"FeeData",gasPrice:je(e),maxFeePerGas:je(t),maxPriorityFeePerGas:je(n)}}}function Hu(r){const e={};r.to&&(e.to=r.to),r.from&&(e.from=r.from),r.data&&(e.data=X(r.data));const t="chainId,gasLimit,gasPrice,maxFeePerBlobGas,maxFeePerGas,maxPriorityFeePerGas,value".split(/,/);for(const s of t)!(s in r)||r[s]==null||(e[s]=re(r[s],`request.${s}`));const n="type,nonce".split(/,/);for(const s of n)!(s in r)||r[s]==null||(e[s]=oe(r[s],`request.${s}`));return r.accessList&&(e.accessList=ho(r.accessList)),r.authorizationList&&(e.authorizationList=r.authorizationList.slice()),"blockTag"in r&&(e.blockTag=r.blockTag),"enableCcipRead"in r&&(e.enableCcipRead=!!r.enableCcipRead),"customData"in r&&(e.customData=r.customData),"blobVersionedHashes"in r&&r.blobVersionedHashes&&(e.blobVersionedHashes=r.blobVersionedHashes.slice()),"kzg"in r&&(e.kzg=r.kzg),"blobs"in r&&r.blobs&&(e.blobs=r.blobs.map(s=>Wp(s)?X(s):Object.assign({},s))),e}var Gn;class _S{constructor(e,t){F(this,"provider");F(this,"number");F(this,"hash");F(this,"timestamp");F(this,"parentHash");F(this,"parentBeaconBlockRoot");F(this,"nonce");F(this,"difficulty");F(this,"gasLimit");F(this,"gasUsed");F(this,"stateRoot");F(this,"receiptsRoot");F(this,"blobGasUsed");F(this,"excessBlobGas");F(this,"miner");F(this,"prevRandao");F(this,"extraData");F(this,"baseFeePerGas");M(this,Gn);O(this,Gn,e.transactions.map(n=>typeof n!="string"?new Xc(n,t):n)),ie(this,{provider:t,hash:Wo(e.hash),number:e.number,timestamp:e.timestamp,parentHash:e.parentHash,parentBeaconBlockRoot:e.parentBeaconBlockRoot,nonce:e.nonce,difficulty:e.difficulty,gasLimit:e.gasLimit,gasUsed:e.gasUsed,blobGasUsed:e.blobGasUsed,excessBlobGas:e.excessBlobGas,miner:e.miner,prevRandao:Wo(e.prevRandao),extraData:e.extraData,baseFeePerGas:Wo(e.baseFeePerGas),stateRoot:e.stateRoot,receiptsRoot:e.receiptsRoot})}get transactions(){return y(this,Gn).map(e=>typeof e=="string"?e:e.hash)}get prefetchedTransactions(){const e=y(this,Gn).slice();return e.length===0?[]:(q(typeof e[0]=="object","transactions were not prefetched with block request","UNSUPPORTED_OPERATION",{operation:"transactionResponses()"}),e)}toJSON(){const{baseFeePerGas:e,difficulty:t,extraData:n,gasLimit:s,gasUsed:i,hash:o,miner:a,prevRandao:c,nonce:l,number:u,parentHash:h,parentBeaconBlockRoot:f,stateRoot:d,receiptsRoot:p,timestamp:g,transactions:m}=this;return{_type:"Block",baseFeePerGas:je(e),difficulty:je(t),extraData:n,gasLimit:je(s),gasUsed:je(i),blobGasUsed:je(this.blobGasUsed),excessBlobGas:je(this.excessBlobGas),hash:o,miner:a,prevRandao:c,nonce:l,number:u,parentHash:h,timestamp:g,parentBeaconBlockRoot:f,stateRoot:d,receiptsRoot:p,transactions:m}}[Symbol.iterator](){let e=0;const t=this.transactions;return{next:()=>e<this.length?{value:t[e++],done:!1}:{value:void 0,done:!0}}}get length(){return y(this,Gn).length}get date(){return this.timestamp==null?null:new Date(this.timestamp*1e3)}async getTransaction(e){let t;if(typeof e=="number")t=y(this,Gn)[e];else{const n=e.toLowerCase();for(const s of y(this,Gn))if(typeof s=="string"){if(s!==n)continue;t=s;break}else{if(s.hash!==n)continue;t=s;break}}if(t==null)throw new Error("no such tx");return typeof t=="string"?await this.provider.getTransaction(t):t}getPrefetchedTransaction(e){const t=this.prefetchedTransactions;if(typeof e=="number")return t[e];e=e.toLowerCase();for(const n of t)if(n.hash===e)return n;R(!1,"no matching transaction","indexOrHash",e)}isMined(){return!!this.hash}isLondon(){return!!this.baseFeePerGas}orphanedEvent(){if(!this.isMined())throw new Error("");return TS(this)}}Gn=new WeakMap;class Al{constructor(e,t){F(this,"provider");F(this,"transactionHash");F(this,"blockHash");F(this,"blockNumber");F(this,"removed");F(this,"address");F(this,"data");F(this,"topics");F(this,"index");F(this,"transactionIndex");this.provider=t;const n=Object.freeze(e.topics.slice());ie(this,{transactionHash:e.transactionHash,blockHash:e.blockHash,blockNumber:e.blockNumber,removed:e.removed,address:e.address,data:e.data,topics:n,index:e.index,transactionIndex:e.transactionIndex})}toJSON(){const{address:e,blockHash:t,blockNumber:n,data:s,index:i,removed:o,topics:a,transactionHash:c,transactionIndex:l}=this;return{_type:"log",address:e,blockHash:t,blockNumber:n,data:s,index:i,removed:o,topics:a,transactionHash:c,transactionIndex:l}}async getBlock(){const e=await this.provider.getBlock(this.blockHash);return q(!!e,"failed to find transaction","UNKNOWN_ERROR",{}),e}async getTransaction(){const e=await this.provider.getTransaction(this.transactionHash);return q(!!e,"failed to find transaction","UNKNOWN_ERROR",{}),e}async getTransactionReceipt(){const e=await this.provider.getTransactionReceipt(this.transactionHash);return q(!!e,"failed to find transaction receipt","UNKNOWN_ERROR",{}),e}removedEvent(){return NS(this)}}var fl;class gv{constructor(e,t){F(this,"provider");F(this,"to");F(this,"from");F(this,"contractAddress");F(this,"hash");F(this,"index");F(this,"blockHash");F(this,"blockNumber");F(this,"logsBloom");F(this,"gasUsed");F(this,"blobGasUsed");F(this,"cumulativeGasUsed");F(this,"gasPrice");F(this,"blobGasPrice");F(this,"type");F(this,"status");F(this,"root");M(this,fl);O(this,fl,Object.freeze(e.logs.map(s=>new Al(s,t))));let n=pv;e.effectiveGasPrice!=null?n=e.effectiveGasPrice:e.gasPrice!=null&&(n=e.gasPrice),ie(this,{provider:t,to:e.to,from:e.from,contractAddress:e.contractAddress,hash:e.hash,index:e.index,blockHash:e.blockHash,blockNumber:e.blockNumber,logsBloom:e.logsBloom,gasUsed:e.gasUsed,cumulativeGasUsed:e.cumulativeGasUsed,blobGasUsed:e.blobGasUsed,gasPrice:n,blobGasPrice:e.blobGasPrice,type:e.type,status:e.status,root:e.root})}get logs(){return y(this,fl)}toJSON(){const{to:e,from:t,contractAddress:n,hash:s,index:i,blockHash:o,blockNumber:a,logsBloom:c,logs:l,status:u,root:h}=this;return{_type:"TransactionReceipt",blockHash:o,blockNumber:a,contractAddress:n,cumulativeGasUsed:je(this.cumulativeGasUsed),from:t,gasPrice:je(this.gasPrice),blobGasUsed:je(this.blobGasUsed),blobGasPrice:je(this.blobGasPrice),gasUsed:je(this.gasUsed),hash:s,index:i,logs:l,logsBloom:c,root:h,status:u,to:e}}get length(){return this.logs.length}[Symbol.iterator](){let e=0;return{next:()=>e<this.length?{value:this.logs[e++],done:!1}:{value:void 0,done:!0}}}get fee(){return this.gasUsed*this.gasPrice}async getBlock(){const e=await this.provider.getBlock(this.blockHash);if(e==null)throw new Error("TODO");return e}async getTransaction(){const e=await this.provider.getTransaction(this.hash);if(e==null)throw new Error("TODO");return e}async getResult(){return await this.provider.getTransactionResult(this.hash)}async confirmations(){return await this.provider.getBlockNumber()-this.blockNumber+1}removedEvent(){return mv(this)}reorderedEvent(e){return q(!e||e.isMined(),"unmined 'other' transction cannot be orphaned","UNSUPPORTED_OPERATION",{operation:"reorderedEvent(other)"}),yv(this,e)}}fl=new WeakMap;var Fs;const Wg=class Wg{constructor(e,t){F(this,"provider");F(this,"blockNumber");F(this,"blockHash");F(this,"index");F(this,"hash");F(this,"type");F(this,"to");F(this,"from");F(this,"nonce");F(this,"gasLimit");F(this,"gasPrice");F(this,"maxPriorityFeePerGas");F(this,"maxFeePerGas");F(this,"maxFeePerBlobGas");F(this,"data");F(this,"value");F(this,"chainId");F(this,"signature");F(this,"accessList");F(this,"blobVersionedHashes");F(this,"authorizationList");M(this,Fs);this.provider=t,this.blockNumber=e.blockNumber!=null?e.blockNumber:null,this.blockHash=e.blockHash!=null?e.blockHash:null,this.hash=e.hash,this.index=e.index,this.type=e.type,this.from=e.from,this.to=e.to||null,this.gasLimit=e.gasLimit,this.nonce=e.nonce,this.data=e.data,this.value=e.value,this.gasPrice=e.gasPrice,this.maxPriorityFeePerGas=e.maxPriorityFeePerGas!=null?e.maxPriorityFeePerGas:null,this.maxFeePerGas=e.maxFeePerGas!=null?e.maxFeePerGas:null,this.maxFeePerBlobGas=e.maxFeePerBlobGas!=null?e.maxFeePerBlobGas:null,this.chainId=e.chainId,this.signature=e.signature,this.accessList=e.accessList!=null?e.accessList:null,this.blobVersionedHashes=e.blobVersionedHashes!=null?e.blobVersionedHashes:null,this.authorizationList=e.authorizationList!=null?e.authorizationList:null,O(this,Fs,-1)}toJSON(){const{blockNumber:e,blockHash:t,index:n,hash:s,type:i,to:o,from:a,nonce:c,data:l,signature:u,accessList:h,blobVersionedHashes:f}=this;return{_type:"TransactionResponse",accessList:h,blockNumber:e,blockHash:t,blobVersionedHashes:f,chainId:je(this.chainId),data:l,from:a,gasLimit:je(this.gasLimit),gasPrice:je(this.gasPrice),hash:s,maxFeePerGas:je(this.maxFeePerGas),maxPriorityFeePerGas:je(this.maxPriorityFeePerGas),maxFeePerBlobGas:je(this.maxFeePerBlobGas),nonce:c,signature:u,to:o,index:n,type:i,value:je(this.value)}}async getBlock(){let e=this.blockNumber;if(e==null){const n=await this.getTransaction();n&&(e=n.blockNumber)}if(e==null)return null;const t=this.provider.getBlock(e);if(t==null)throw new Error("TODO");return t}async getTransaction(){return this.provider.getTransaction(this.hash)}async confirmations(){if(this.blockNumber==null){const{tx:t,blockNumber:n}=await Bt({tx:this.getTransaction(),blockNumber:this.provider.getBlockNumber()});return t==null||t.blockNumber==null?0:n-t.blockNumber+1}return await this.provider.getBlockNumber()-this.blockNumber+1}async wait(e,t){const n=e??1,s=t??0;let i=y(this,Fs),o=-1,a=i===-1;const c=async()=>{if(a)return null;const{blockNumber:f,nonce:d}=await Bt({blockNumber:this.provider.getBlockNumber(),nonce:this.provider.getTransactionCount(this.from)});if(d<this.nonce){i=f;return}if(a)return null;const p=await this.getTransaction();if(!(p&&p.blockNumber!=null))for(o===-1&&(o=i-3,o<y(this,Fs)&&(o=y(this,Fs)));o<=f;){if(a)return null;const g=await this.provider.getBlock(o,!0);if(g==null)return;for(const m of g)if(m===this.hash)return;for(let m=0;m<g.length;m++){const b=await g.getTransaction(m);if(b.from===this.from&&b.nonce===this.nonce){if(a)return null;const x=await this.provider.getTransactionReceipt(b.hash);if(x==null||f-x.blockNumber+1<n)return;let v="replaced";b.data===this.data&&b.to===this.to&&b.value===this.value?v="repriced":b.data==="0x"&&b.from===b.to&&b.value===pv&&(v="cancelled"),q(!1,"transaction was replaced","TRANSACTION_REPLACED",{cancelled:v==="replaced"||v==="cancelled",reason:v,replacement:b.replaceableTransaction(i),hash:b.hash,receipt:x})}}o++}},l=f=>{if(f==null||f.status!==0)return f;q(!1,"transaction execution reverted","CALL_EXCEPTION",{action:"sendTransaction",data:null,reason:null,invocation:null,revert:null,transaction:{to:f.to,from:f.from,data:""},receipt:f})},u=await this.provider.getTransactionReceipt(this.hash);if(n===0)return l(u);if(u){if(n===1||await u.confirmations()>=n)return l(u)}else if(await c(),n===0)return null;return await new Promise((f,d)=>{const p=[],g=()=>{p.forEach(b=>b())};if(p.push(()=>{a=!0}),s>0){const b=setTimeout(()=>{g(),d(Re("wait for transaction timeout","TIMEOUT"))},s);p.push(()=>{clearTimeout(b)})}const m=async b=>{if(await b.confirmations()>=n){g();try{f(l(b))}catch(x){d(x)}}};if(p.push(()=>{this.provider.off(this.hash,m)}),this.provider.on(this.hash,m),i>=0){const b=async()=>{try{await c()}catch(x){if(ht(x,"TRANSACTION_REPLACED")){g(),d(x);return}}a||this.provider.once("block",b)};p.push(()=>{this.provider.off("block",b)}),this.provider.once("block",b)}})}isMined(){return this.blockHash!=null}isLegacy(){return this.type===0}isBerlin(){return this.type===1}isLondon(){return this.type===2}isCancun(){return this.type===3}removedEvent(){return q(this.isMined(),"unmined transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),mv(this)}reorderedEvent(e){return q(this.isMined(),"unmined transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),q(!e||e.isMined(),"unmined 'other' transaction canot be orphaned","UNSUPPORTED_OPERATION",{operation:"removeEvent()"}),yv(this,e)}replaceableTransaction(e){R(Number.isInteger(e)&&e>=0,"invalid startBlock","startBlock",e);const t=new Wg(this,this.provider);return O(t,Fs,e),t}};Fs=new WeakMap;let Xc=Wg;function TS(r){return{orphan:"drop-block",hash:r.hash,number:r.number}}function yv(r,e){return{orphan:"reorder-transaction",tx:r,other:e}}function mv(r){return{orphan:"drop-transaction",tx:r}}function NS(r){return{orphan:"drop-log",log:{transactionHash:r.transactionHash,blockHash:r.blockHash,blockNumber:r.blockNumber,address:r.address,data:r.data,topics:Object.freeze(r.topics.slice()),index:r.index}}}class ag extends Al{constructor(t,n,s){super(t,t.provider);F(this,"interface");F(this,"fragment");F(this,"args");const i=n.decodeEventLog(s,t.data,t.topics);ie(this,{args:i,fragment:s,interface:n})}get eventName(){return this.fragment.name}get eventSignature(){return this.fragment.format()}}class wv extends Al{constructor(t,n){super(t,t.provider);F(this,"error");ie(this,{error:n})}}var Pa;class RS extends gv{constructor(t,n,s){super(s,n);M(this,Pa);O(this,Pa,t)}get logs(){return super.logs.map(t=>{const n=t.topics.length?y(this,Pa).getEvent(t.topics[0]):null;if(n)try{return new ag(t,y(this,Pa),n)}catch(s){return new wv(t,s)}return t})}}Pa=new WeakMap;var dl;class cg extends Xc{constructor(t,n,s){super(s,n);M(this,dl);O(this,dl,t)}async wait(t,n){const s=await super.wait(t,n);return s==null?null:new RS(y(this,dl),this.provider,s)}}dl=new WeakMap;class bv extends zb{constructor(t,n,s,i){super(t,n,s);F(this,"log");ie(this,{log:i})}async getBlock(){return await this.log.getBlock()}async getTransaction(){return await this.log.getTransaction()}async getTransactionReceipt(){return await this.log.getTransactionReceipt()}}class US extends bv{constructor(e,t,n,s,i){super(e,t,n,new ag(i,e.interface,s));const o=e.interface.decodeEventLog(s,this.log.data,this.log.topics);ie(this,{args:o,fragment:s})}get eventName(){return this.fragment.name}get eventSignature(){return this.fragment.format()}}const o0=BigInt(0);function vv(r){return r&&typeof r.call=="function"}function Ev(r){return r&&typeof r.estimateGas=="function"}function _h(r){return r&&typeof r.resolveName=="function"}function Av(r){return r&&typeof r.sendTransaction=="function"}function xv(r){if(r!=null){if(_h(r))return r;if(r.provider)return r.provider}}var pl;class kS{constructor(e,t,n){M(this,pl);F(this,"fragment");if(ie(this,{fragment:t}),t.inputs.length<n.length)throw new Error("too many arguments");const s=so(e.runner,"resolveName"),i=_h(s)?s:null;O(this,pl,(async function(){const o=await Promise.all(t.inputs.map((a,c)=>n[c]==null?null:a.walkAsync(n[c],(u,h)=>u==="address"?Array.isArray(h)?Promise.all(h.map(f=>Nt(f,i))):Nt(h,i):h)));return e.interface.encodeFilterTopics(t,o)})())}getTopicFilter(){return y(this,pl)}}pl=new WeakMap;function so(r,e){return r==null?null:typeof r[e]=="function"?r:r.provider&&typeof r.provider[e]=="function"?r.provider:null}function Di(r){return r==null?null:r.provider||null}async function Iv(r,e){const t=Ot.dereference(r,"overrides");R(typeof t=="object","invalid overrides parameter","overrides",r);const n=Hu(t);return R(n.to==null||(e||[]).indexOf("to")>=0,"cannot override to","overrides.to",n.to),R(n.data==null||(e||[]).indexOf("data")>=0,"cannot override data","overrides.data",n.data),n.from&&(n.from=n.from),n}async function $S(r,e,t){const n=so(r,"resolveName"),s=_h(n)?n:null;return await Promise.all(e.map((i,o)=>i.walkAsync(t[o],(a,c)=>(c=Ot.dereference(c,a),a==="address"?Nt(c,s):c))))}function LS(r){const e=async function(o){const a=await Iv(o,["data"]);a.to=await r.getAddress(),a.from&&(a.from=await Nt(a.from,xv(r.runner)));const c=r.interface,l=re(a.value||o0,"overrides.value")===o0,u=(a.data||"0x")==="0x";c.fallback&&!c.fallback.payable&&c.receive&&!u&&!l&&R(!1,"cannot send data to receive or send value to non-payable fallback","overrides",o),R(c.fallback||u,"cannot send data to receive-only contract","overrides.data",a.data);const h=c.receive||c.fallback&&c.fallback.payable;return R(h||l,"cannot send value to non-payable fallback","overrides.value",a.value),R(c.fallback||u,"cannot send data to receive-only contract","overrides.data",a.data),a},t=async function(o){const a=so(r.runner,"call");q(vv(a),"contract runner does not support calling","UNSUPPORTED_OPERATION",{operation:"call"});const c=await e(o);try{return await a.call(c)}catch(l){throw Qp(l)&&l.data?r.interface.makeError(l.data,c):l}},n=async function(o){const a=r.runner;q(Av(a),"contract runner does not support sending transactions","UNSUPPORTED_OPERATION",{operation:"sendTransaction"});const c=await a.sendTransaction(await e(o)),l=Di(r.runner);return new cg(r.interface,l,c)},s=async function(o){const a=so(r.runner,"estimateGas");return q(Ev(a),"contract runner does not support gas estimation","UNSUPPORTED_OPERATION",{operation:"estimateGas"}),await a.estimateGas(await e(o))},i=async o=>await n(o);return ie(i,{_contract:r,estimateGas:s,populateTransaction:e,send:n,staticCall:t}),i}function FS(r,e){const t=function(...l){const u=r.interface.getFunction(e,l);return q(u,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e,args:l}}),u},n=async function(...l){const u=t(...l);let h={};if(u.inputs.length+1===l.length&&(h=await Iv(l.pop()),h.from&&(h.from=await Nt(h.from,xv(r.runner)))),u.inputs.length!==l.length)throw new Error("internal error: fragment inputs doesn't match arguments; should not happen");const f=await $S(r.runner,u.inputs,l);return Object.assign({},h,await Bt({to:r.getAddress(),data:r.interface.encodeFunctionData(u,f)}))},s=async function(...l){const u=await a(...l);return u.length===1?u[0]:u},i=async function(...l){const u=r.runner;q(Av(u),"contract runner does not support sending transactions","UNSUPPORTED_OPERATION",{operation:"sendTransaction"});const h=await u.sendTransaction(await n(...l)),f=Di(r.runner);return new cg(r.interface,f,h)},o=async function(...l){const u=so(r.runner,"estimateGas");return q(Ev(u),"contract runner does not support gas estimation","UNSUPPORTED_OPERATION",{operation:"estimateGas"}),await u.estimateGas(await n(...l))},a=async function(...l){const u=so(r.runner,"call");q(vv(u),"contract runner does not support calling","UNSUPPORTED_OPERATION",{operation:"call"});const h=await n(...l);let f="0x";try{f=await u.call(h)}catch(p){throw Qp(p)&&p.data?r.interface.makeError(p.data,h):p}const d=t(...l);return r.interface.decodeFunctionResult(d,f)},c=async(...l)=>t(...l).constant?await s(...l):await i(...l);return ie(c,{name:r.interface.getFunctionName(e),_contract:r,_key:e,getFragment:t,estimateGas:o,populateTransaction:n,send:i,staticCall:s,staticCallResult:a}),Object.defineProperty(c,"fragment",{configurable:!1,enumerable:!0,get:()=>{const l=r.interface.getFunction(e);return q(l,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e}}),l}}),c}function MS(r,e){const t=function(...s){const i=r.interface.getEvent(e,s);return q(i,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e,args:s}}),i},n=function(...s){return new kS(r,t(...s),s)};return ie(n,{name:r.interface.getEventName(e),_contract:r,_key:e,getFragment:t}),Object.defineProperty(n,"fragment",{configurable:!1,enumerable:!0,get:()=>{const s=r.interface.getEvent(e);return q(s,"no matching fragment","UNSUPPORTED_OPERATION",{operation:"fragment",info:{key:e}}),s}}),n}const qu=Symbol.for("_ethersInternal_contract"),Sv=new WeakMap;function jS(r,e){Sv.set(r[qu],e)}function nr(r){return Sv.get(r[qu])}function zS(r){return r&&typeof r=="object"&&"getTopicFilter"in r&&typeof r.getTopicFilter=="function"&&r.fragment}async function lg(r,e){let t,n=null;if(Array.isArray(e)){const i=function(o){if(_e(o,32))return o;const a=r.interface.getEvent(o);return R(a,"unknown fragment","name",o),a.topicHash};t=e.map(o=>o==null?null:Array.isArray(o)?o.map(i):i(o))}else e==="*"?t=[null]:typeof e=="string"?_e(e,32)?t=[e]:(n=r.interface.getEvent(e),R(n,"unknown fragment","event",e),t=[n.topicHash]):zS(e)?t=await e.getTopicFilter():"fragment"in e?(n=e.fragment,t=[n.topicHash]):R(!1,"unknown event name","event",e);t=t.map(i=>{if(i==null)return null;if(Array.isArray(i)){const o=Array.from(new Set(i.map(a=>a.toLowerCase())).values());return o.length===1?o[0]:(o.sort(),o)}return i.toLowerCase()});const s=t.map(i=>i==null?"null":Array.isArray(i)?i.join("|"):i).join("&");return{fragment:n,tag:s,topics:t}}async function Cc(r,e){const{subs:t}=nr(r);return t.get((await lg(r,e)).tag)||null}async function a0(r,e,t){const n=Di(r.runner);q(n,"contract runner does not support subscribing","UNSUPPORTED_OPERATION",{operation:e});const{fragment:s,tag:i,topics:o}=await lg(r,t),{addr:a,subs:c}=nr(r);let l=c.get(i);if(!l){const h={address:a||r,topics:o},f=m=>{let b=s;if(b==null)try{b=r.interface.getEvent(m.topics[0])}catch{}if(b){const x=b,v=s?r.interface.decodeEventLog(s,m.data,m.topics):[];Md(r,t,v,I=>new US(r,I,t,x,m))}else Md(r,t,[],x=>new bv(r,x,t,m))};let d=[];l={tag:i,listeners:[],start:()=>{d.length||d.push(n.on(h,f))},stop:async()=>{if(d.length==0)return;let m=d;d=[],await Promise.all(m),n.off(h,f)}},c.set(i,l)}return l}let Fd=Promise.resolve();async function HS(r,e,t,n){await Fd;const s=await Cc(r,e);if(!s)return!1;const i=s.listeners.length;return s.listeners=s.listeners.filter(({listener:o,once:a})=>{const c=Array.from(t);n&&c.push(n(a?null:o));try{o.call(r,...c)}catch{}return!a}),s.listeners.length===0&&(s.stop(),nr(r).subs.delete(s.tag)),i>0}async function Md(r,e,t,n){try{await Fd}catch{}const s=HS(r,e,t,n);return Fd=s,await s}const Kl=["then"];var $b;$b=qu;const Hc=class Hc{constructor(e,t,n,s){F(this,"target");F(this,"interface");F(this,"runner");F(this,"filters");F(this,$b);F(this,"fallback");R(typeof e=="string"||B1(e),"invalid value for Contract target","target",e),n==null&&(n=null);const i=Ld.from(t);ie(this,{target:e,runner:n,interface:i}),Object.defineProperty(this,qu,{value:{}});let o,a=null,c=null;if(s){const h=Di(n);c=new cg(this.interface,h,s)}let l=new Map;if(typeof e=="string")if(_e(e))a=e,o=Promise.resolve(e);else{const h=so(n,"resolveName");if(!_h(h))throw Re("contract runner does not support name resolution","UNSUPPORTED_OPERATION",{operation:"resolveName"});o=h.resolveName(e).then(f=>{if(f==null)throw Re("an ENS name used for a contract target must be correctly configured","UNCONFIGURED_NAME",{value:e});return nr(this).addr=f,f})}else o=e.getAddress().then(h=>{if(h==null)throw new Error("TODO");return nr(this).addr=h,h});jS(this,{addrPromise:o,addr:a,deployTx:c,subs:l});const u=new Proxy({},{get:(h,f,d)=>{if(typeof f=="symbol"||Kl.indexOf(f)>=0)return Reflect.get(h,f,d);try{return this.getEvent(f)}catch(p){if(!ht(p,"INVALID_ARGUMENT")||p.argument!=="key")throw p}},has:(h,f)=>Kl.indexOf(f)>=0?Reflect.has(h,f):Reflect.has(h,f)||this.interface.hasEvent(String(f))});return ie(this,{filters:u}),ie(this,{fallback:i.receive||i.fallback?LS(this):null}),new Proxy(this,{get:(h,f,d)=>{if(typeof f=="symbol"||f in h||Kl.indexOf(f)>=0)return Reflect.get(h,f,d);try{return h.getFunction(f)}catch(p){if(!ht(p,"INVALID_ARGUMENT")||p.argument!=="key")throw p}},has:(h,f)=>typeof f=="symbol"||f in h||Kl.indexOf(f)>=0?Reflect.has(h,f):h.interface.hasFunction(f)})}connect(e){return new Hc(this.target,this.interface,e)}attach(e){return new Hc(e,this.interface,this.runner)}async getAddress(){return await nr(this).addrPromise}async getDeployedCode(){const e=Di(this.runner);q(e,"runner does not support .provider","UNSUPPORTED_OPERATION",{operation:"getDeployedCode"});const t=await e.getCode(await this.getAddress());return t==="0x"?null:t}async waitForDeployment(){const e=this.deploymentTransaction();if(e)return await e.wait(),this;if(await this.getDeployedCode()!=null)return this;const n=Di(this.runner);return q(n!=null,"contract runner does not support .provider","UNSUPPORTED_OPERATION",{operation:"waitForDeployment"}),new Promise((s,i)=>{const o=async()=>{try{if(await this.getDeployedCode()!=null)return s(this);n.once("block",o)}catch(a){i(a)}};o()})}deploymentTransaction(){return nr(this).deployTx}getFunction(e){return typeof e!="string"&&(e=e.format()),FS(this,e)}getEvent(e){return typeof e!="string"&&(e=e.format()),MS(this,e)}async queryTransaction(e){throw new Error("@TODO")}async queryFilter(e,t,n){t==null&&(t=0),n==null&&(n="latest");const{addr:s,addrPromise:i}=nr(this),o=s||await i,{fragment:a,topics:c}=await lg(this,e),l={address:o,topics:c,fromBlock:t,toBlock:n},u=Di(this.runner);return q(u,"contract runner does not have a provider","UNSUPPORTED_OPERATION",{operation:"queryFilter"}),(await u.getLogs(l)).map(h=>{let f=a;if(f==null)try{f=this.interface.getEvent(h.topics[0])}catch{}if(f)try{return new ag(h,this.interface,f)}catch(d){return new wv(h,d)}return new Al(h,u)})}async on(e,t){const n=await a0(this,"on",e);return n.listeners.push({listener:t,once:!1}),n.start(),this}async once(e,t){const n=await a0(this,"once",e);return n.listeners.push({listener:t,once:!0}),n.start(),this}async emit(e,...t){return await Md(this,e,t,null)}async listenerCount(e){if(e){const s=await Cc(this,e);return s?s.listeners.length:0}const{subs:t}=nr(this);let n=0;for(const{listeners:s}of t.values())n+=s.length;return n}async listeners(e){if(e){const s=await Cc(this,e);return s?s.listeners.map(({listener:i})=>i):[]}const{subs:t}=nr(this);let n=[];for(const{listeners:s}of t.values())n=n.concat(s.map(({listener:i})=>i));return n}async off(e,t){const n=await Cc(this,e);if(!n)return this;if(t){const s=n.listeners.map(({listener:i})=>i).indexOf(t);s>=0&&n.listeners.splice(s,1)}return(t==null||n.listeners.length===0)&&(n.stop(),nr(this).subs.delete(n.tag)),this}async removeAllListeners(e){if(e){const t=await Cc(this,e);if(!t)return this;t.stop(),nr(this).subs.delete(t.tag)}else{const{subs:t}=nr(this);for(const{tag:n,stop:s}of t.values())s(),t.delete(n)}return this}async addListener(e,t){return await this.on(e,t)}async removeListener(e,t){return await this.off(e,t)}static buildClass(e){class t extends Hc{constructor(s,i=null){super(s,e,i)}}return t}static from(e,t,n){return n==null&&(n=null),new this(e,t,n)}};let jd=Hc;function qS(){return jd}class Jo extends qS(){}function gf(r){return r.match(/^ipfs:\/\/ipfs\//i)?r=r.substring(12):r.match(/^ipfs:\/\//i)?r=r.substring(7):R(!1,"unsupported IPFS format","link",r),`https://gateway.ipfs.io/ipfs/${r}`}class VS{constructor(e){F(this,"name");ie(this,{name:e})}connect(e){return this}supportsCoinType(e){return!1}async encodeAddress(e,t){throw new Error("unsupported coin")}async decodeAddress(e,t){throw new Error("unsupported coin")}}const Pv=new RegExp("^(ipfs)://(.*)$","i"),c0=[new RegExp("^(https)://(.*)$","i"),new RegExp("^(data):(.*)$","i"),Pv,new RegExp("^eip155:[0-9]+/(erc[0-9]+):(.*)$","i")];var Ms,Vi,js,Ro,yh,Ov;const qo=class qo{constructor(e,t,n){M(this,js);F(this,"provider");F(this,"address");F(this,"name");M(this,Ms);M(this,Vi);ie(this,{provider:e,address:t,name:n}),O(this,Ms,null),O(this,Vi,new Jo(t,["function supportsInterface(bytes4) view returns (bool)","function resolve(bytes, bytes) view returns (bytes)","function addr(bytes32) view returns (address)","function addr(bytes32, uint) view returns (bytes)","function text(bytes32, string) view returns (string)","function contenthash(bytes32) view returns (bytes)"],e))}async supportsWildcard(){return y(this,Ms)==null&&O(this,Ms,(async()=>{try{return await y(this,Vi).supportsInterface("0x9061b923")}catch(e){if(ht(e,"CALL_EXCEPTION"))return!1;throw O(this,Ms,null),e}})()),await y(this,Ms)}async getAddress(e){if(e==null&&(e=60),e===60)try{const i=await K(this,js,Ro).call(this,"addr(bytes32)");return i==null||i===Vc?null:i}catch(i){if(ht(i,"CALL_EXCEPTION"))return null;throw i}if(e>=0&&e<2147483648){let i=e+2147483648;const o=await K(this,js,Ro).call(this,"addr(bytes32,uint)",[i]);if(_e(o,20))return Ie(o)}let t=null;for(const i of this.provider.plugins)if(i instanceof VS&&i.supportsCoinType(e)){t=i;break}if(t==null)return null;const n=await K(this,js,Ro).call(this,"addr(bytes32,uint)",[e]);if(n==null||n==="0x")return null;const s=await t.decodeAddress(e,n);if(s!=null)return s;q(!1,"invalid coin data","UNSUPPORTED_OPERATION",{operation:`getAddress(${e})`,info:{coinType:e,data:n}})}async getText(e){const t=await K(this,js,Ro).call(this,"text(bytes32,string)",[e]);return t==null||t==="0x"?null:t}async getContentHash(){const e=await K(this,js,Ro).call(this,"contenthash(bytes32)");if(e==null||e==="0x")return null;const t=e.match(/^0x(e3010170|e5010172)(([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f]*))$/);if(t){const s=t[1]==="e3010170"?"ipfs":"ipns",i=parseInt(t[4],16);if(t[5].length===i*2)return`${s}://${WA("0x"+t[2])}`}const n=e.match(/^0xe40101fa011b20([0-9a-f]*)$/);if(n&&n[1].length===64)return`bzz://${n[1]}`;q(!1,"invalid or unsupported content hash data","UNSUPPORTED_OPERATION",{operation:"getContentHash()",info:{data:e}})}async getAvatar(){return(await this._getAvatar()).url}async _getAvatar(){const e=[{type:"name",value:this.name}];try{const t=await this.getText("avatar");if(t==null)return e.push({type:"!avatar",value:""}),{url:null,linkage:e};e.push({type:"avatar",value:t});for(let n=0;n<c0.length;n++){const s=t.match(c0[n]);if(s==null)continue;const i=s[1].toLowerCase();switch(i){case"https":case"data":return e.push({type:"url",value:t}),{linkage:e,url:t};case"ipfs":{const o=gf(t);return e.push({type:"ipfs",value:t}),e.push({type:"url",value:o}),{linkage:e,url:o}}case"erc721":case"erc1155":{const o=i==="erc721"?"tokenURI(uint256)":"uri(uint256)";e.push({type:i,value:t});const a=await this.getAddress();if(a==null)return e.push({type:"!owner",value:""}),{url:null,linkage:e};const c=(s[2]||"").split("/");if(c.length!==2)return e.push({type:`!${i}caip`,value:s[2]||""}),{url:null,linkage:e};const l=c[1],u=new Jo(c[0],["function tokenURI(uint) view returns (string)","function ownerOf(uint) view returns (address)","function uri(uint) view returns (string)","function balanceOf(address, uint256) view returns (uint)"],this.provider);if(i==="erc721"){const g=await u.ownerOf(l);if(a!==g)return e.push({type:"!owner",value:g}),{url:null,linkage:e};e.push({type:"owner",value:g})}else if(i==="erc1155"){const g=await u.balanceOf(a,l);if(!g)return e.push({type:"!balance",value:"0"}),{url:null,linkage:e};e.push({type:"balance",value:g.toString()})}let h=await u[o](l);if(h==null||h==="0x")return e.push({type:"!metadata-url",value:""}),{url:null,linkage:e};e.push({type:"metadata-url-base",value:h}),i==="erc1155"&&(h=h.replace("{id}",Xs(l,32).substring(2)),e.push({type:"metadata-url-expanded",value:h})),h.match(/^ipfs:/i)&&(h=gf(h)),e.push({type:"metadata-url",value:h});let f={};const d=await new ei(h).send();d.assertOk();try{f=d.bodyJson}catch{try{e.push({type:"!metadata",value:d.bodyText})}catch{const b=d.body;return b&&e.push({type:"!metadata",value:X(b)}),{url:null,linkage:e}}return{url:null,linkage:e}}if(!f)return e.push({type:"!metadata",value:""}),{url:null,linkage:e};e.push({type:"metadata",value:JSON.stringify(f)});let p=f.image;if(typeof p!="string")return e.push({type:"!imageUrl",value:""}),{url:null,linkage:e};if(!p.match(/^(https:\/\/|data:)/i)){if(p.match(Pv)==null)return e.push({type:"!imageUrl-ipfs",value:p}),{url:null,linkage:e};e.push({type:"imageUrl-ipfs",value:p}),p=gf(p)}return e.push({type:"url",value:p}),{linkage:e,url:p}}}}}catch{}return{linkage:e,url:null}}static async getEnsAddress(e){const t=await e.getNetwork(),n=t.getPlugin("org.ethers.plugins.network.Ens");return q(n,"network does not support ENS","UNSUPPORTED_OPERATION",{operation:"getEnsAddress",info:{network:t}}),n.address}static async fromName(e,t){var s;let n=t;for(;;){if(n===""||n==="."||t!=="eth"&&n==="eth")return null;const i=await K(s=qo,yh,Ov).call(s,e,n);if(i!=null){const o=new qo(e,i,t);return n!==t&&!await o.supportsWildcard()?null:o}n=n.split(".").slice(1).join(".")}}};Ms=new WeakMap,Vi=new WeakMap,js=new WeakSet,Ro=async function(e,t){t=(t||[]).slice();const n=y(this,Vi).interface;t.unshift(kd(this.name));let s=null;await this.supportsWildcard()&&(s=n.getFunction(e),q(s,"missing fragment","UNKNOWN_ERROR",{info:{funcName:e}}),t=[oS(this.name,255),n.encodeFunctionData(s,t)],e="resolve(bytes,bytes)"),t.push({enableCcipRead:!0});try{const i=await y(this,Vi)[e](...t);return s?n.decodeFunctionResult(s,i)[0]:i}catch(i){if(!ht(i,"CALL_EXCEPTION"))throw i}return null},yh=new WeakSet,Ov=async function(e,t){const n=await qo.getEnsAddress(e);try{const i=await new Jo(n,["function resolver(bytes32) view returns (address)"],e).resolver(kd(t),{enableCcipRead:!0});return i===Vc?null:i}catch(s){throw s}return null},M(qo,yh);let Vu=qo;const l0=BigInt(0);function ge(r,e){return(function(t){return t==null?e:r(t)})}function el(r,e){return(t=>{if(e&&t==null)return null;if(!Array.isArray(t))throw new Error("not an array");return t.map(n=>r(n))})}function xl(r,e){return(t=>{const n={};for(const s in r){let i=s;if(e&&s in e&&!(i in t)){for(const o of e[s])if(o in t){i=o;break}}try{const o=r[s](t[i]);o!==void 0&&(n[s]=o)}catch(o){const a=o instanceof Error?o.message:"not-an-error";q(!1,`invalid value for value.${s} (${a})`,"BAD_DATA",{value:t})}}return n})}function KS(r){switch(r){case!0:case"true":return!0;case!1:case"false":return!1}R(!1,`invalid boolean; ${JSON.stringify(r)}`,"value",r)}function Qa(r){return R(_e(r,!0),"invalid data","value",r),r}function ut(r){return R(_e(r,32),"invalid hash","value",r),r}const GS=xl({address:Ie,blockHash:ut,blockNumber:oe,data:Qa,index:oe,removed:ge(KS,!1),topics:el(ut),transactionHash:ut,transactionIndex:oe},{index:["logIndex"]});function QS(r){return GS(r)}const WS=xl({hash:ge(ut),parentHash:ut,parentBeaconBlockRoot:ge(ut,null),number:oe,timestamp:oe,nonce:ge(Qa),difficulty:re,gasLimit:re,gasUsed:re,stateRoot:ge(ut,null),receiptsRoot:ge(ut,null),blobGasUsed:ge(re,null),excessBlobGas:ge(re,null),miner:ge(Ie),prevRandao:ge(ut,null),extraData:Qa,baseFeePerGas:ge(re)},{prevRandao:["mixHash"]});function JS(r){const e=WS(r);return e.transactions=r.transactions.map(t=>typeof t=="string"?t:Dv(t)),e}const YS=xl({transactionIndex:oe,blockNumber:oe,transactionHash:ut,address:Ie,topics:el(ut),data:Qa,index:oe,blockHash:ut},{index:["logIndex"]});function ZS(r){return YS(r)}const XS=xl({to:ge(Ie,null),from:ge(Ie,null),contractAddress:ge(Ie,null),index:oe,root:ge(X),gasUsed:re,blobGasUsed:ge(re,null),logsBloom:ge(Qa),blockHash:ut,hash:ut,logs:el(ZS),blockNumber:oe,cumulativeGasUsed:re,effectiveGasPrice:ge(re),blobGasPrice:ge(re,null),status:ge(oe),type:ge(oe,0)},{effectiveGasPrice:["gasPrice"],hash:["transactionHash"],index:["transactionIndex"]});function eP(r){return XS(r)}function Dv(r){r.to&&re(r.to)===l0&&(r.to="0x0000000000000000000000000000000000000000");const e=xl({hash:ut,index:ge(oe,void 0),type:t=>t==="0x"||t==null?0:oe(t),accessList:ge(ho,null),blobVersionedHashes:ge(el(ut,!0),null),authorizationList:ge(el(t=>{let n;if(t.signature)n=t.signature;else{let s=t.yParity;s==="0x1b"?s=0:s==="0x1c"&&(s=1),n=Object.assign({},t,{yParity:s})}return{address:Ie(t.address),chainId:re(t.chainId),nonce:re(t.nonce),signature:Wt.from(n)}},!1),null),blockHash:ge(ut,null),blockNumber:ge(oe,null),transactionIndex:ge(oe,null),from:Ie,gasPrice:ge(re),maxPriorityFeePerGas:ge(re),maxFeePerGas:ge(re),maxFeePerBlobGas:ge(re,null),gasLimit:re,to:ge(Ie,null),value:re,nonce:oe,data:Qa,creates:ge(Ie,null),chainId:ge(re,null)},{data:["input"],gasLimit:["gas"],index:["transactionIndex"]})(r);if(e.to==null&&e.creates==null&&(e.creates=zI(e)),(r.type===1||r.type===2)&&r.accessList==null&&(e.accessList=[]),r.signature?e.signature=Wt.from(r.signature):e.signature=Wt.from(r),e.chainId==null){const t=e.signature.legacyChainId;t!=null&&(e.chainId=t)}return e.blockHash&&re(e.blockHash)===l0&&(e.blockHash=null),e}const tP="0x00000000000C2E074eC69A0dFb2997BA6C7d2e1e";class Il{constructor(e){F(this,"name");ie(this,{name:e})}clone(){return new Il(this.name)}}class Th extends Il{constructor(t,n){t==null&&(t=0);super(`org.ethers.network.plugins.GasCost#${t||0}`);F(this,"effectiveBlock");F(this,"txBase");F(this,"txCreate");F(this,"txDataZero");F(this,"txDataNonzero");F(this,"txAccessListStorageKey");F(this,"txAccessListAddress");const s={effectiveBlock:t};function i(o,a){let c=(n||{})[o];c==null&&(c=a),R(typeof c=="number",`invalud value for ${o}`,"costs",n),s[o]=c}i("txBase",21e3),i("txCreate",32e3),i("txDataZero",4),i("txDataNonzero",16),i("txAccessListStorageKey",1900),i("txAccessListAddress",2400),ie(this,s)}clone(){return new Th(this.effectiveBlock,this)}}class Nh extends Il{constructor(t,n){super("org.ethers.plugins.network.Ens");F(this,"address");F(this,"targetNetwork");ie(this,{address:t||tP,targetNetwork:n??1})}clone(){return new Nh(this.address,this.targetNetwork)}}var gl,yl;class rP extends Il{constructor(t,n){super("org.ethers.plugins.network.FetchUrlFeeDataPlugin");M(this,gl);M(this,yl);O(this,gl,t),O(this,yl,n)}get url(){return y(this,gl)}get processFunc(){return y(this,yl)}clone(){return this}}gl=new WeakMap,yl=new WeakMap;const yf=new Map;var Oa,Da,zs;const Vo=class Vo{constructor(e,t){M(this,Oa);M(this,Da);M(this,zs);O(this,Oa,e),O(this,Da,re(t)),O(this,zs,new Map)}toJSON(){return{name:this.name,chainId:String(this.chainId)}}get name(){return y(this,Oa)}set name(e){O(this,Oa,e)}get chainId(){return y(this,Da)}set chainId(e){O(this,Da,re(e,"chainId"))}matches(e){if(e==null)return!1;if(typeof e=="string"){try{return this.chainId===re(e)}catch{}return this.name===e}if(typeof e=="number"||typeof e=="bigint"){try{return this.chainId===re(e)}catch{}return!1}if(typeof e=="object"){if(e.chainId!=null){try{return this.chainId===re(e.chainId)}catch{}return!1}return e.name!=null?this.name===e.name:!1}return!1}get plugins(){return Array.from(y(this,zs).values())}attachPlugin(e){if(y(this,zs).get(e.name))throw new Error(`cannot replace existing plugin: ${e.name} `);return y(this,zs).set(e.name,e.clone()),this}getPlugin(e){return y(this,zs).get(e)||null}getPlugins(e){return this.plugins.filter(t=>t.name.split("#")[0]===e)}clone(){const e=new Vo(this.name,this.chainId);return this.plugins.forEach(t=>{e.attachPlugin(t.clone())}),e}computeIntrinsicGas(e){const t=this.getPlugin("org.ethers.plugins.network.GasCost")||new Th;let n=t.txBase;if(e.to==null&&(n+=t.txCreate),e.data)for(let s=2;s<e.data.length;s+=2)e.data.substring(s,s+2)==="00"?n+=t.txDataZero:n+=t.txDataNonzero;if(e.accessList){const s=ho(e.accessList);for(const i in s)n+=t.txAccessListAddress+t.txAccessListStorageKey*s[i].storageKeys.length}return n}static from(e){if(nP(),e==null)return Vo.from("mainnet");if(typeof e=="number"&&(e=BigInt(e)),typeof e=="string"||typeof e=="bigint"){const t=yf.get(e);if(t)return t();if(typeof e=="bigint")return new Vo("unknown",e);R(!1,"unknown network","network",e)}if(typeof e.clone=="function")return e.clone();if(typeof e=="object"){R(typeof e.name=="string"&&typeof e.chainId=="number","invalid network object name or chainId","network",e);const t=new Vo(e.name,e.chainId);return(e.ensAddress||e.ensNetwork!=null)&&t.attachPlugin(new Nh(e.ensAddress,e.ensNetwork)),t}R(!1,"invalid network","network",e)}static register(e,t){typeof e=="number"&&(e=BigInt(e));const n=yf.get(e);n&&R(!1,`conflicting network for ${JSON.stringify(n.name)}`,"nameOrChainId",e),yf.set(e,t)}};Oa=new WeakMap,Da=new WeakMap,zs=new WeakMap;let En=Vo;function u0(r,e){const t=String(r);if(!t.match(/^[0-9.]+$/))throw new Error(`invalid gwei value: ${r}`);const n=t.split(".");if(n.length===1&&n.push(""),n.length!==2)throw new Error(`invalid gwei value: ${r}`);for(;n[1].length<e;)n[1]+="0";if(n[1].length>9){let s=BigInt(n[1].substring(0,9));n[1].substring(9).match(/^0+$/)||s++,n[1]=s.toString()}return BigInt(n[0]+n[1])}function h0(r){return new rP(r,async(e,t,n)=>{n.setHeader("User-Agent","ethers");let s;try{const[i,o]=await Promise.all([n.send(),e()]);s=i;const a=s.bodyJson.standard;return{gasPrice:o.gasPrice,maxFeePerGas:u0(a.maxFee,9),maxPriorityFeePerGas:u0(a.maxPriorityFee,9)}}catch(i){q(!1,`error encountered with polygon gas station (${JSON.stringify(n.url)})`,"SERVER_ERROR",{request:n,response:s,error:i})}})}let f0=!1;function nP(){if(f0)return;f0=!0;function r(e,t,n){const s=function(){const i=new En(e,t);return n.ensNetwork!=null&&i.attachPlugin(new Nh(null,n.ensNetwork)),i.attachPlugin(new Th),(n.plugins||[]).forEach(o=>{i.attachPlugin(o)}),i};En.register(e,s),En.register(t,s),n.altNames&&n.altNames.forEach(i=>{En.register(i,s)})}r("mainnet",1,{ensNetwork:1,altNames:["homestead"]}),r("ropsten",3,{ensNetwork:3}),r("rinkeby",4,{ensNetwork:4}),r("goerli",5,{ensNetwork:5}),r("kovan",42,{ensNetwork:42}),r("sepolia",11155111,{ensNetwork:11155111}),r("holesky",17e3,{ensNetwork:17e3}),r("classic",61,{}),r("classicKotti",6,{}),r("arbitrum",42161,{ensNetwork:1}),r("arbitrum-goerli",421613,{}),r("arbitrum-sepolia",421614,{}),r("base",8453,{ensNetwork:1}),r("base-goerli",84531,{}),r("base-sepolia",84532,{}),r("bnb",56,{ensNetwork:1}),r("bnbt",97,{}),r("linea",59144,{ensNetwork:1}),r("linea-goerli",59140,{}),r("linea-sepolia",59141,{}),r("matic",137,{ensNetwork:1,plugins:[h0("https://gasstation.polygon.technology/v2")]}),r("matic-amoy",80002,{}),r("matic-mumbai",80001,{altNames:["maticMumbai","maticmum"],plugins:[h0("https://gasstation-testnet.polygon.technology/v2")]}),r("optimism",10,{ensNetwork:1,plugins:[]}),r("optimism-goerli",420,{}),r("optimism-sepolia",11155420,{}),r("xdai",100,{ensNetwork:1})}function zd(r){return JSON.parse(JSON.stringify(r))}var Qn,br,Hs,pn,Ca,vu;class sP{constructor(e){M(this,Ca);M(this,Qn);M(this,br);M(this,Hs);M(this,pn);O(this,Qn,e),O(this,br,null),O(this,Hs,4e3),O(this,pn,-2)}get pollingInterval(){return y(this,Hs)}set pollingInterval(e){O(this,Hs,e)}start(){y(this,br)||(O(this,br,y(this,Qn)._setTimeout(K(this,Ca,vu).bind(this),y(this,Hs))),K(this,Ca,vu).call(this))}stop(){y(this,br)&&(y(this,Qn)._clearTimeout(y(this,br)),O(this,br,null))}pause(e){this.stop(),e&&O(this,pn,-2)}resume(){this.start()}}Qn=new WeakMap,br=new WeakMap,Hs=new WeakMap,pn=new WeakMap,Ca=new WeakSet,vu=async function(){try{const e=await y(this,Qn).getBlockNumber();if(y(this,pn)===-2){O(this,pn,e);return}if(e!==y(this,pn)){for(let t=y(this,pn)+1;t<=e;t++){if(y(this,br)==null)return;await y(this,Qn).emit("block",t)}O(this,pn,e)}}catch{}y(this,br)!=null&&O(this,br,y(this,Qn)._setTimeout(K(this,Ca,vu).bind(this),y(this,Hs)))};var Ki,Gi,qs;class ug{constructor(e){M(this,Ki);M(this,Gi);M(this,qs);O(this,Ki,e),O(this,qs,!1),O(this,Gi,t=>{this._poll(t,y(this,Ki))})}async _poll(e,t){throw new Error("sub-classes must override this")}start(){y(this,qs)||(O(this,qs,!0),y(this,Gi).call(this,-2),y(this,Ki).on("block",y(this,Gi)))}stop(){y(this,qs)&&(O(this,qs,!1),y(this,Ki).off("block",y(this,Gi)))}pause(e){this.stop()}resume(){this.start()}}Ki=new WeakMap,Gi=new WeakMap,qs=new WeakMap;var Ba,Wn;class iP extends ug{constructor(t,n){super(t);M(this,Ba);M(this,Wn);O(this,Ba,n),O(this,Wn,-2)}pause(t){t&&O(this,Wn,-2),super.pause(t)}async _poll(t,n){const s=await n.getBlock(y(this,Ba));s!=null&&(y(this,Wn)===-2?O(this,Wn,s.number):s.number>y(this,Wn)&&(n.emit(y(this,Ba),s.number),O(this,Wn,s.number)))}}Ba=new WeakMap,Wn=new WeakMap;var mh;class oP extends ug{constructor(t,n){super(t);M(this,mh);O(this,mh,zd(n))}async _poll(t,n){throw new Error("@TODO")}}mh=new WeakMap;var _a;class aP extends ug{constructor(t,n){super(t);M(this,_a);O(this,_a,n)}async _poll(t,n){const s=await n.getTransactionReceipt(y(this,_a));s&&n.emit(y(this,_a),s)}}_a=new WeakMap;var Jn,Ta,Na,Vs,vr,wh,Cv;class hg{constructor(e,t){M(this,wh);M(this,Jn);M(this,Ta);M(this,Na);M(this,Vs);M(this,vr);O(this,Jn,e),O(this,Ta,zd(t)),O(this,Na,K(this,wh,Cv).bind(this)),O(this,Vs,!1),O(this,vr,-2)}start(){y(this,Vs)||(O(this,Vs,!0),y(this,vr)===-2&&y(this,Jn).getBlockNumber().then(e=>{O(this,vr,e)}),y(this,Jn).on("block",y(this,Na)))}stop(){y(this,Vs)&&(O(this,Vs,!1),y(this,Jn).off("block",y(this,Na)))}pause(e){this.stop(),e&&O(this,vr,-2)}resume(){this.start()}}Jn=new WeakMap,Ta=new WeakMap,Na=new WeakMap,Vs=new WeakMap,vr=new WeakMap,wh=new WeakSet,Cv=async function(e){if(y(this,vr)===-2)return;const t=zd(y(this,Ta));t.fromBlock=y(this,vr)+1,t.toBlock=e;const n=await y(this,Jn).getLogs(t);if(n.length===0){y(this,vr)<e-60&&O(this,vr,e-60);return}for(const s of n)y(this,Jn).emit(y(this,Ta),s),O(this,vr,s.blockNumber)};const cP=BigInt(2),lP=10;function Gl(r){return r&&typeof r.then=="function"}function Eu(r,e){return r+":"+JSON.stringify(e,(t,n)=>{if(n==null)return"null";if(typeof n=="bigint")return`bigint:${n.toString()}`;if(typeof n=="string")return n.toLowerCase();if(typeof n=="object"&&!Array.isArray(n)){const s=Object.keys(n);return s.sort(),s.reduce((i,o)=>(i[o]=n[o],i),{})}return n})}class Bv{constructor(e){F(this,"name");ie(this,{name:e})}start(){}stop(){}pause(e){}resume(){}}function uP(r){return JSON.parse(JSON.stringify(r))}function Hd(r){return r=Array.from(new Set(r).values()),r.sort(),r}async function mf(r,e){if(r==null)throw new Error("invalid event");if(Array.isArray(r)&&(r={topics:r}),typeof r=="string")switch(r){case"block":case"debug":case"error":case"finalized":case"network":case"pending":case"safe":return{type:r,tag:r}}if(_e(r,32)){const t=r.toLowerCase();return{type:"transaction",tag:Eu("tx",{hash:t}),hash:t}}if(r.orphan){const t=r;return{type:"orphan",tag:Eu("orphan",t),filter:uP(t)}}if(r.address||r.topics){const t=r,n={topics:(t.topics||[]).map(s=>s==null?null:Array.isArray(s)?Hd(s.map(i=>i.toLowerCase())):s.toLowerCase())};if(t.address){const s=[],i=[],o=a=>{_e(a)?s.push(a):i.push((async()=>{s.push(await Nt(a,e))})())};Array.isArray(t.address)?t.address.forEach(o):o(t.address),i.length&&await Promise.all(i),n.address=Hd(s.map(a=>a.toLowerCase()))}return{filter:n,tag:Eu("event",n),type:"event"}}R(!1,"unknown ProviderEvent","event",r)}function wf(){return new Date().getTime()}const hP={cacheTimeout:250,pollingInterval:4e3};var It,Ks,St,Ra,ar,Qi,Gs,Yn,ml,Er,Ua,ka,he,tr,qd,Vd,Bc,Kd,_c,Au;class fP{constructor(e,t){M(this,he);M(this,It);M(this,Ks);M(this,St);M(this,Ra);M(this,ar);M(this,Qi);M(this,Gs);M(this,Yn);M(this,ml);M(this,Er);M(this,Ua);M(this,ka);if(O(this,ka,Object.assign({},hP,t||{})),e==="any")O(this,Qi,!0),O(this,ar,null);else if(e){const n=En.from(e);O(this,Qi,!1),O(this,ar,Promise.resolve(n)),setTimeout(()=>{this.emit("network",n,null)},0)}else O(this,Qi,!1),O(this,ar,null);O(this,Yn,-1),O(this,Gs,new Map),O(this,It,new Map),O(this,Ks,new Map),O(this,St,null),O(this,Ra,!1),O(this,ml,1),O(this,Er,new Map),O(this,Ua,!1)}get pollingInterval(){return y(this,ka).pollingInterval}get provider(){return this}get plugins(){return Array.from(y(this,Ks).values())}attachPlugin(e){if(y(this,Ks).get(e.name))throw new Error(`cannot replace existing plugin: ${e.name} `);return y(this,Ks).set(e.name,e.connect(this)),this}getPlugin(e){return y(this,Ks).get(e)||null}get disableCcipRead(){return y(this,Ua)}set disableCcipRead(e){O(this,Ua,!!e)}async ccipReadFetch(e,t,n){if(this.disableCcipRead||n.length===0||e.to==null)return null;const s=e.to.toLowerCase(),i=t.toLowerCase(),o=[];for(let a=0;a<n.length;a++){const c=n[a],l=c.replace("{sender}",s).replace("{data}",i),u=new ei(l);c.indexOf("{data}")===-1&&(u.body={data:i,sender:s}),this.emit("debug",{action:"sendCcipReadFetchRequest",request:u,index:a,urls:n});let h="unknown error",f;try{f=await u.send()}catch(d){o.push(d.message),this.emit("debug",{action:"receiveCcipReadFetchError",request:u,result:{error:d}});continue}try{const d=f.bodyJson;if(d.data)return this.emit("debug",{action:"receiveCcipReadFetchResult",request:u,result:d}),d.data;d.message&&(h=d.message),this.emit("debug",{action:"receiveCcipReadFetchError",request:u,result:d})}catch{}q(f.statusCode<400||f.statusCode>=500,`response not found during CCIP fetch: ${h}`,"OFFCHAIN_FAULT",{reason:"404_MISSING_RESOURCE",transaction:e,info:{url:c,errorMessage:h}}),o.push(h)}q(!1,`error encountered during CCIP fetch: ${o.map(a=>JSON.stringify(a)).join(", ")}`,"OFFCHAIN_FAULT",{reason:"500_SERVER_ERROR",transaction:e,info:{urls:n,errorMessages:o}})}_wrapBlock(e,t){return new _S(JS(e),this)}_wrapLog(e,t){return new Al(QS(e),this)}_wrapTransactionReceipt(e,t){return new gv(eP(e),this)}_wrapTransactionResponse(e,t){return new Xc(Dv(e),this)}_detectNetwork(){q(!1,"sub-classes must implement this","UNSUPPORTED_OPERATION",{operation:"_detectNetwork"})}async _perform(e){q(!1,`unsupported method: ${e.method}`,"UNSUPPORTED_OPERATION",{operation:e.method,info:e})}async getBlockNumber(){const e=oe(await K(this,he,tr).call(this,{method:"getBlockNumber"}),"%response");return y(this,Yn)>=0&&O(this,Yn,e),e}_getAddress(e){return Nt(e,this)}_getBlockTag(e){if(e==null)return"latest";switch(e){case"earliest":return"0x0";case"finalized":case"latest":case"pending":case"safe":return e}if(_e(e))return _e(e,32)?e:qr(e);if(typeof e=="bigint"&&(e=oe(e,"blockTag")),typeof e=="number")return e>=0?qr(e):y(this,Yn)>=0?qr(y(this,Yn)+e):this.getBlockNumber().then(t=>qr(t+e));R(!1,"invalid blockTag","blockTag",e)}_getFilter(e){const t=(e.topics||[]).map(c=>c==null?null:Array.isArray(c)?Hd(c.map(l=>l.toLowerCase())):c.toLowerCase()),n="blockHash"in e?e.blockHash:void 0,s=(c,l,u)=>{let h;switch(c.length){case 0:break;case 1:h=c[0];break;default:c.sort(),h=c}if(n&&(l!=null||u!=null))throw new Error("invalid filter");const f={};return h&&(f.address=h),t.length&&(f.topics=t),l&&(f.fromBlock=l),u&&(f.toBlock=u),n&&(f.blockHash=n),f};let i=[];if(e.address)if(Array.isArray(e.address))for(const c of e.address)i.push(this._getAddress(c));else i.push(this._getAddress(e.address));let o;"fromBlock"in e&&(o=this._getBlockTag(e.fromBlock));let a;return"toBlock"in e&&(a=this._getBlockTag(e.toBlock)),i.filter(c=>typeof c!="string").length||o!=null&&typeof o!="string"||a!=null&&typeof a!="string"?Promise.all([Promise.all(i),o,a]).then(c=>s(c[0],c[1],c[2])):s(i,o,a)}_getTransactionRequest(e){const t=Hu(e),n=[];if(["to","from"].forEach(s=>{if(t[s]==null)return;const i=Nt(t[s],this);Gl(i)?n.push((async function(){t[s]=await i})()):t[s]=i}),t.blockTag!=null){const s=this._getBlockTag(t.blockTag);Gl(s)?n.push((async function(){t.blockTag=await s})()):t.blockTag=s}return n.length?(async function(){return await Promise.all(n),t})():t}async getNetwork(){if(y(this,ar)==null){const s=(async()=>{try{const i=await this._detectNetwork();return this.emit("network",i,null),i}catch(i){throw y(this,ar)===s&&O(this,ar,null),i}})();return O(this,ar,s),(await s).clone()}const e=y(this,ar),[t,n]=await Promise.all([e,this._detectNetwork()]);return t.chainId!==n.chainId&&(y(this,Qi)?(this.emit("network",n,t),y(this,ar)===e&&O(this,ar,Promise.resolve(n))):q(!1,`network changed: ${t.chainId} => ${n.chainId} `,"NETWORK_ERROR",{event:"changed"})),t.clone()}async getFeeData(){const e=await this.getNetwork(),t=async()=>{const{_block:s,gasPrice:i,priorityFee:o}=await Bt({_block:K(this,he,Kd).call(this,"latest",!1),gasPrice:(async()=>{try{const u=await K(this,he,tr).call(this,{method:"getGasPrice"});return re(u,"%response")}catch{}return null})(),priorityFee:(async()=>{try{const u=await K(this,he,tr).call(this,{method:"getPriorityFee"});return re(u,"%response")}catch{}return null})()});let a=null,c=null;const l=this._wrapBlock(s,e);return l&&l.baseFeePerGas&&(c=o??BigInt("1000000000"),a=l.baseFeePerGas*cP+c),new i0(i,a,c)},n=e.getPlugin("org.ethers.plugins.network.FetchUrlFeeDataPlugin");if(n){const s=new ei(n.url),i=await n.processFunc(t,this,s);return new i0(i.gasPrice,i.maxFeePerGas,i.maxPriorityFeePerGas)}return await t()}async estimateGas(e){let t=this._getTransactionRequest(e);return Gl(t)&&(t=await t),re(await K(this,he,tr).call(this,{method:"estimateGas",transaction:t}),"%response")}async call(e){const{tx:t,blockTag:n}=await Bt({tx:this._getTransactionRequest(e),blockTag:this._getBlockTag(e.blockTag)});return await K(this,he,Vd).call(this,K(this,he,qd).call(this,t,n,e.enableCcipRead?0:-1))}async getBalance(e,t){return re(await K(this,he,Bc).call(this,{method:"getBalance"},e,t),"%response")}async getTransactionCount(e,t){return oe(await K(this,he,Bc).call(this,{method:"getTransactionCount"},e,t),"%response")}async getCode(e,t){return X(await K(this,he,Bc).call(this,{method:"getCode"},e,t))}async getStorage(e,t,n){const s=re(t,"position");return X(await K(this,he,Bc).call(this,{method:"getStorage",position:s},e,n))}async broadcastTransaction(e){const{blockNumber:t,hash:n,network:s}=await Bt({blockNumber:this.getBlockNumber(),hash:this._perform({method:"broadcastTransaction",signedTransaction:e}),network:this.getNetwork()}),i=ku.from(e);if(i.hash!==n)throw new Error("@TODO: the returned hash did not match");return this._wrapTransactionResponse(i,s).replaceableTransaction(t)}async getBlock(e,t){const{network:n,params:s}=await Bt({network:this.getNetwork(),params:K(this,he,Kd).call(this,e,!!t)});return s==null?null:this._wrapBlock(s,n)}async getTransaction(e){const{network:t,params:n}=await Bt({network:this.getNetwork(),params:K(this,he,tr).call(this,{method:"getTransaction",hash:e})});return n==null?null:this._wrapTransactionResponse(n,t)}async getTransactionReceipt(e){const{network:t,params:n}=await Bt({network:this.getNetwork(),params:K(this,he,tr).call(this,{method:"getTransactionReceipt",hash:e})});if(n==null)return null;if(n.gasPrice==null&&n.effectiveGasPrice==null){const s=await K(this,he,tr).call(this,{method:"getTransaction",hash:e});if(s==null)throw new Error("report this; could not find tx or effectiveGasPrice");n.effectiveGasPrice=s.gasPrice}return this._wrapTransactionReceipt(n,t)}async getTransactionResult(e){const{result:t}=await Bt({network:this.getNetwork(),result:K(this,he,tr).call(this,{method:"getTransactionResult",hash:e})});return t==null?null:X(t)}async getLogs(e){let t=this._getFilter(e);Gl(t)&&(t=await t);const{network:n,params:s}=await Bt({network:this.getNetwork(),params:K(this,he,tr).call(this,{method:"getLogs",filter:t})});return s.map(i=>this._wrapLog(i,n))}_getProvider(e){q(!1,"provider cannot connect to target network","UNSUPPORTED_OPERATION",{operation:"_getProvider()"})}async getResolver(e){return await Vu.fromName(this,e)}async getAvatar(e){const t=await this.getResolver(e);return t?await t.getAvatar():null}async resolveName(e){const t=await this.getResolver(e);return t?await t.getAddress():null}async lookupAddress(e){e=Ie(e);const t=kd(e.substring(2).toLowerCase()+".addr.reverse");try{const n=await Vu.getEnsAddress(this),i=await new Jo(n,["function resolver(bytes32) view returns (address)"],this).resolver(t);if(i==null||i===Vc)return null;const a=await new Jo(i,["function name(bytes32) view returns (string)"],this).name(t);return await this.resolveName(a)!==e?null:a}catch(n){if(ht(n,"BAD_DATA")&&n.value==="0x"||ht(n,"CALL_EXCEPTION"))return null;throw n}return null}async waitForTransaction(e,t,n){const s=t??1;return s===0?this.getTransactionReceipt(e):new Promise(async(i,o)=>{let a=null;const c=(async l=>{try{const u=await this.getTransactionReceipt(e);if(u!=null&&l-u.blockNumber+1>=s){i(u),a&&(clearTimeout(a),a=null);return}}catch(u){console.log("EEE",u)}this.once("block",c)});n!=null&&(a=setTimeout(()=>{a!=null&&(a=null,this.off("block",c),o(Re("timeout","TIMEOUT",{reason:"timeout"})))},n)),c(await this.getBlockNumber())})}async waitForBlock(e){q(!1,"not implemented yet","NOT_IMPLEMENTED",{operation:"waitForBlock"})}_clearTimeout(e){const t=y(this,Er).get(e);t&&(t.timer&&clearTimeout(t.timer),y(this,Er).delete(e))}_setTimeout(e,t){t==null&&(t=0);const n=ic(this,ml)._++,s=()=>{y(this,Er).delete(n),e()};if(this.paused)y(this,Er).set(n,{timer:null,func:s,time:t});else{const i=setTimeout(s,t);y(this,Er).set(n,{timer:i,func:s,time:wf()})}return n}_forEachSubscriber(e){for(const t of y(this,It).values())e(t.subscriber)}_getSubscriber(e){switch(e.type){case"debug":case"error":case"network":return new Bv(e.type);case"block":{const t=new sP(this);return t.pollingInterval=this.pollingInterval,t}case"safe":case"finalized":return new iP(this,e.type);case"event":return new hg(this,e.filter);case"transaction":return new aP(this,e.hash);case"orphan":return new oP(this,e.filter)}throw new Error(`unsupported event: ${e.type}`)}_recoverSubscriber(e,t){for(const n of y(this,It).values())if(n.subscriber===e){n.started&&n.subscriber.stop(),n.subscriber=t,n.started&&t.start(),y(this,St)!=null&&t.pause(y(this,St));break}}async on(e,t){const n=await K(this,he,Au).call(this,e);return n.listeners.push({listener:t,once:!1}),n.started||(n.subscriber.start(),n.started=!0,y(this,St)!=null&&n.subscriber.pause(y(this,St))),this}async once(e,t){const n=await K(this,he,Au).call(this,e);return n.listeners.push({listener:t,once:!0}),n.started||(n.subscriber.start(),n.started=!0,y(this,St)!=null&&n.subscriber.pause(y(this,St))),this}async emit(e,...t){const n=await K(this,he,_c).call(this,e,t);if(!n||n.listeners.length===0)return!1;const s=n.listeners.length;return n.listeners=n.listeners.filter(({listener:i,once:o})=>{const a=new zb(this,o?null:i,e);try{i.call(this,...t,a)}catch{}return!o}),n.listeners.length===0&&(n.started&&n.subscriber.stop(),y(this,It).delete(n.tag)),s>0}async listenerCount(e){if(e){const n=await K(this,he,_c).call(this,e);return n?n.listeners.length:0}let t=0;for(const{listeners:n}of y(this,It).values())t+=n.length;return t}async listeners(e){if(e){const n=await K(this,he,_c).call(this,e);return n?n.listeners.map(({listener:s})=>s):[]}let t=[];for(const{listeners:n}of y(this,It).values())t=t.concat(n.map(({listener:s})=>s));return t}async off(e,t){const n=await K(this,he,_c).call(this,e);if(!n)return this;if(t){const s=n.listeners.map(({listener:i})=>i).indexOf(t);s>=0&&n.listeners.splice(s,1)}return(!t||n.listeners.length===0)&&(n.started&&n.subscriber.stop(),y(this,It).delete(n.tag)),this}async removeAllListeners(e){if(e){const{tag:t,started:n,subscriber:s}=await K(this,he,Au).call(this,e);n&&s.stop(),y(this,It).delete(t)}else for(const[t,{started:n,subscriber:s}]of y(this,It))n&&s.stop(),y(this,It).delete(t);return this}async addListener(e,t){return await this.on(e,t)}async removeListener(e,t){return this.off(e,t)}get destroyed(){return y(this,Ra)}destroy(){this.removeAllListeners();for(const e of y(this,Er).keys())this._clearTimeout(e);O(this,Ra,!0)}get paused(){return y(this,St)!=null}set paused(e){!!e!==this.paused&&(this.paused?this.resume():this.pause(!1))}pause(e){if(O(this,Yn,-1),y(this,St)!=null){if(y(this,St)==!!e)return;q(!1,"cannot change pause type; resume first","UNSUPPORTED_OPERATION",{operation:"pause"})}this._forEachSubscriber(t=>t.pause(e)),O(this,St,!!e);for(const t of y(this,Er).values())t.timer&&clearTimeout(t.timer),t.time=wf()-t.time}resume(){if(y(this,St)!=null){this._forEachSubscriber(e=>e.resume()),O(this,St,null);for(const e of y(this,Er).values()){let t=e.time;t<0&&(t=0),e.time=wf(),setTimeout(e.func,t)}}}}It=new WeakMap,Ks=new WeakMap,St=new WeakMap,Ra=new WeakMap,ar=new WeakMap,Qi=new WeakMap,Gs=new WeakMap,Yn=new WeakMap,ml=new WeakMap,Er=new WeakMap,Ua=new WeakMap,ka=new WeakMap,he=new WeakSet,tr=async function(e){const t=y(this,ka).cacheTimeout;if(t<0)return await this._perform(e);const n=Eu(e.method,e);let s=y(this,Gs).get(n);return s||(s=this._perform(e),y(this,Gs).set(n,s),setTimeout(()=>{y(this,Gs).get(n)===s&&y(this,Gs).delete(n)},t)),await s},qd=async function(e,t,n){q(n<lP,"CCIP read exceeded maximum redirections","OFFCHAIN_FAULT",{reason:"TOO_MANY_REDIRECTS",transaction:Object.assign({},e,{blockTag:t,enableCcipRead:!0})});const s=Hu(e);try{return X(await this._perform({method:"call",transaction:s,blockTag:t}))}catch(i){if(!this.disableCcipRead&&Qp(i)&&i.data&&n>=0&&t==="latest"&&s.to!=null&&Le(i.data,0,4)==="0x556f1830"){const o=i.data,a=await Nt(s.to,this);let c;try{c=mP(Le(i.data,4))}catch(h){q(!1,h.message,"OFFCHAIN_FAULT",{reason:"BAD_DATA",transaction:s,info:{data:o}})}q(c.sender.toLowerCase()===a.toLowerCase(),"CCIP Read sender mismatch","CALL_EXCEPTION",{action:"call",data:o,reason:"OffchainLookup",transaction:s,invocation:null,revert:{signature:"OffchainLookup(address,string[],bytes,bytes4,bytes)",name:"OffchainLookup",args:c.errorArgs}});const l=await this.ccipReadFetch(s,c.calldata,c.urls);q(l!=null,"CCIP Read failed to fetch data","OFFCHAIN_FAULT",{reason:"FETCH_FAILED",transaction:s,info:{data:i.data,errorArgs:c.errorArgs}});const u={to:a,data:Fe([c.selector,yP([l,c.extraData])])};this.emit("debug",{action:"sendCcipReadCall",transaction:u});try{const h=await K(this,he,qd).call(this,u,t,n+1);return this.emit("debug",{action:"receiveCcipReadCallResult",transaction:Object.assign({},u),result:h}),h}catch(h){throw this.emit("debug",{action:"receiveCcipReadCallError",transaction:Object.assign({},u),error:h}),h}}throw i}},Vd=async function(e){const{value:t}=await Bt({network:this.getNetwork(),value:e});return t},Bc=async function(e,t,n){let s=this._getAddress(t),i=this._getBlockTag(n);return(typeof s!="string"||typeof i!="string")&&([s,i]=await Promise.all([s,i])),await K(this,he,Vd).call(this,K(this,he,tr).call(this,Object.assign(e,{address:s,blockTag:i})))},Kd=async function(e,t){if(_e(e,32))return await K(this,he,tr).call(this,{method:"getBlock",blockHash:e,includeTransactions:t});let n=this._getBlockTag(e);return typeof n!="string"&&(n=await n),await K(this,he,tr).call(this,{method:"getBlock",blockTag:n,includeTransactions:t})},_c=async function(e,t){let n=await mf(e,this);return n.type==="event"&&t&&t.length>0&&t[0].removed===!0&&(n=await mf({orphan:"drop-log",log:t[0]},this)),y(this,It).get(n.tag)||null},Au=async function(e){const t=await mf(e,this),n=t.tag;let s=y(this,It).get(n);return s||(s={subscriber:this._getSubscriber(t),tag:n,addressableMap:new WeakMap,nameMap:new Map,started:!1,listeners:[]},y(this,It).set(n,s)),s};function dP(r,e){try{const t=Gd(r,e);if(t)return Nu(t)}catch{}return null}function Gd(r,e){if(r==="0x")return null;try{const t=oe(Le(r,e,e+32)),n=oe(Le(r,t,t+32));return Le(r,t+32,t+32+n)}catch{}return null}function d0(r){const e=Ze(r);if(e.length>32)throw new Error("internal; should not happen");const t=new Uint8Array(32);return t.set(e,32-e.length),t}function pP(r){if(r.length%32===0)return r;const e=new Uint8Array(Math.ceil(r.length/32)*32);return e.set(r),e}const gP=new Uint8Array([]);function yP(r){const e=[];let t=0;for(let n=0;n<r.length;n++)e.push(gP),t+=32;for(let n=0;n<r.length;n++){const s=ue(r[n]);e[n]=d0(t),e.push(d0(s.length)),e.push(pP(s)),t+=32+Math.ceil(s.length/32)*32}return Fe(e)}const p0="0x0000000000000000000000000000000000000000000000000000000000000000";function mP(r){const e={sender:"",urls:[],calldata:"",selector:"",extraData:"",errorArgs:[]};q(Ko(r)>=160,"insufficient OffchainLookup data","OFFCHAIN_FAULT",{reason:"insufficient OffchainLookup data"});const t=Le(r,0,32);q(Le(t,0,12)===Le(p0,0,12),"corrupt OffchainLookup sender","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup sender"}),e.sender=Le(t,12);try{const n=[],s=oe(Le(r,32,64)),i=oe(Le(r,s,s+32)),o=Le(r,s+32);for(let a=0;a<i;a++){const c=dP(o,a*32);if(c==null)throw new Error("abort");n.push(c)}e.urls=n}catch{q(!1,"corrupt OffchainLookup urls","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup urls"})}try{const n=Gd(r,64);if(n==null)throw new Error("abort");e.calldata=n}catch{q(!1,"corrupt OffchainLookup calldata","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup calldata"})}q(Le(r,100,128)===Le(p0,0,28),"corrupt OffchainLookup callbaackSelector","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup callbaackSelector"}),e.selector=Le(r,96,100);try{const n=Gd(r,128);if(n==null)throw new Error("abort");e.extraData=n}catch{q(!1,"corrupt OffchainLookup extraData","OFFCHAIN_FAULT",{reason:"corrupt OffchainLookup extraData"})}return e.errorArgs="sender,urls,calldata,selector,extraData".split(/,/).map(n=>e[n]),e}function ci(r,e){if(r.provider)return r.provider;q(!1,"missing provider","UNSUPPORTED_OPERATION",{operation:e})}async function g0(r,e){let t=Hu(e);if(t.to!=null&&(t.to=Nt(t.to,r)),t.from!=null){const n=t.from;t.from=Promise.all([r.getAddress(),Nt(n,r)]).then(([s,i])=>(R(s.toLowerCase()===i.toLowerCase(),"transaction from mismatch","tx.from",i),s))}else t.from=r.getAddress();return await Bt(t)}class wP{constructor(e){F(this,"provider");ie(this,{provider:e||null})}async getNonce(e){return ci(this,"getTransactionCount").getTransactionCount(await this.getAddress(),e)}async populateCall(e){return await g0(this,e)}async populateTransaction(e){const t=ci(this,"populateTransaction"),n=await g0(this,e);n.nonce==null&&(n.nonce=await this.getNonce("pending")),n.gasLimit==null&&(n.gasLimit=await this.estimateGas(n));const s=await this.provider.getNetwork();if(n.chainId!=null){const o=re(n.chainId);R(o===s.chainId,"transaction chainId mismatch","tx.chainId",e.chainId)}else n.chainId=s.chainId;const i=n.maxFeePerGas!=null||n.maxPriorityFeePerGas!=null;if(n.gasPrice!=null&&(n.type===2||i)?R(!1,"eip-1559 transaction do not support gasPrice","tx",e):(n.type===0||n.type===1)&&i&&R(!1,"pre-eip-1559 transaction do not support maxFeePerGas/maxPriorityFeePerGas","tx",e),(n.type===2||n.type==null)&&n.maxFeePerGas!=null&&n.maxPriorityFeePerGas!=null)n.type=2;else if(n.type===0||n.type===1){const o=await t.getFeeData();q(o.gasPrice!=null,"network does not support gasPrice","UNSUPPORTED_OPERATION",{operation:"getGasPrice"}),n.gasPrice==null&&(n.gasPrice=o.gasPrice)}else{const o=await t.getFeeData();if(n.type==null)if(o.maxFeePerGas!=null&&o.maxPriorityFeePerGas!=null)if(n.authorizationList&&n.authorizationList.length?n.type=4:n.type=2,n.gasPrice!=null){const a=n.gasPrice;delete n.gasPrice,n.maxFeePerGas=a,n.maxPriorityFeePerGas=a}else n.maxFeePerGas==null&&(n.maxFeePerGas=o.maxFeePerGas),n.maxPriorityFeePerGas==null&&(n.maxPriorityFeePerGas=o.maxPriorityFeePerGas);else o.gasPrice!=null?(q(!i,"network does not support EIP-1559","UNSUPPORTED_OPERATION",{operation:"populateTransaction"}),n.gasPrice==null&&(n.gasPrice=o.gasPrice),n.type=0):q(!1,"failed to get consistent fee data","UNSUPPORTED_OPERATION",{operation:"signer.getFeeData"});else(n.type===2||n.type===3||n.type===4)&&(n.maxFeePerGas==null&&(n.maxFeePerGas=o.maxFeePerGas),n.maxPriorityFeePerGas==null&&(n.maxPriorityFeePerGas=o.maxPriorityFeePerGas))}return await Bt(n)}async populateAuthorization(e){const t=Object.assign({},e);return t.chainId==null&&(t.chainId=(await ci(this,"getNetwork").getNetwork()).chainId),t.nonce==null&&(t.nonce=await this.getNonce()),t}async estimateGas(e){return ci(this,"estimateGas").estimateGas(await this.populateCall(e))}async call(e){return ci(this,"call").call(await this.populateCall(e))}async resolveName(e){return await ci(this,"resolveName").resolveName(e)}async sendTransaction(e){const t=ci(this,"sendTransaction"),n=await this.populateTransaction(e);delete n.from;const s=ku.from(n);return await t.broadcastTransaction(await this.signTransaction(s))}authorize(e){q(!1,"authorization not implemented for this signer","UNSUPPORTED_OPERATION",{operation:"authorize"})}}function bP(r){return JSON.parse(JSON.stringify(r))}var Ct,gn,Wi,Qs,Ji,$a,ni,Qd,Wd;class _v{constructor(e){M(this,ni);M(this,Ct);M(this,gn);M(this,Wi);M(this,Qs);M(this,Ji);M(this,$a);O(this,Ct,e),O(this,gn,null),O(this,Wi,K(this,ni,Qd).bind(this)),O(this,Qs,!1),O(this,Ji,null),O(this,$a,!1)}_subscribe(e){throw new Error("subclasses must override this")}_emitResults(e,t){throw new Error("subclasses must override this")}_recover(e){throw new Error("subclasses must override this")}start(){y(this,Qs)||(O(this,Qs,!0),K(this,ni,Qd).call(this,-2))}stop(){y(this,Qs)&&(O(this,Qs,!1),O(this,$a,!0),K(this,ni,Wd).call(this),y(this,Ct).off("block",y(this,Wi)))}pause(e){e&&K(this,ni,Wd).call(this),y(this,Ct).off("block",y(this,Wi))}resume(){this.start()}}Ct=new WeakMap,gn=new WeakMap,Wi=new WeakMap,Qs=new WeakMap,Ji=new WeakMap,$a=new WeakMap,ni=new WeakSet,Qd=async function(e){try{y(this,gn)==null&&O(this,gn,this._subscribe(y(this,Ct)));let t=null;try{t=await y(this,gn)}catch(i){if(!ht(i,"UNSUPPORTED_OPERATION")||i.operation!=="eth_newFilter")throw i}if(t==null){O(this,gn,null),y(this,Ct)._recoverSubscriber(this,this._recover(y(this,Ct)));return}const n=await y(this,Ct).getNetwork();if(y(this,Ji)||O(this,Ji,n),y(this,Ji).chainId!==n.chainId)throw new Error("chaid changed");if(y(this,$a))return;const s=await y(this,Ct).send("eth_getFilterChanges",[t]);await this._emitResults(y(this,Ct),s)}catch(t){console.log("@TODO",t)}y(this,Ct).once("block",y(this,Wi))},Wd=function(){const e=y(this,gn);e&&(O(this,gn,null),e.then(t=>{y(this,Ct).destroyed||y(this,Ct).send("eth_uninstallFilter",[t])}))};var Yi;class vP extends _v{constructor(t,n){super(t);M(this,Yi);O(this,Yi,bP(n))}_recover(t){return new hg(t,y(this,Yi))}async _subscribe(t){return await t.send("eth_newFilter",[y(this,Yi)])}async _emitResults(t,n){for(const s of n)t.emit(y(this,Yi),t._wrapLog(s,t._network))}}Yi=new WeakMap;class EP extends _v{async _subscribe(e){return await e.send("eth_newPendingTransactionFilter",[])}async _emitResults(e,t){for(const n of t)e.emit("pending",n)}}const AP="bigint,boolean,function,number,string,symbol".split(/,/g);function xu(r){if(r==null||AP.indexOf(typeof r)>=0||typeof r.getAddress=="function")return r;if(Array.isArray(r))return r.map(xu);if(typeof r=="object")return Object.keys(r).reduce((e,t)=>(e[t]=r[t],e),{});throw new Error(`should not happen: ${r} (${typeof r})`)}function xP(r){return new Promise(e=>{setTimeout(e,r)})}function Ao(r){return r&&r.toLowerCase()}function y0(r){return r&&typeof r.pollingInterval=="number"}const Tv={polling:!1,staticNetwork:null,batchStallTime:10,batchMaxSize:1<<20,batchMaxCount:100,cacheTimeout:250,pollingInterval:4e3};class bf extends wP{constructor(t,n){super(t);F(this,"address");n=Ie(n),ie(this,{address:n})}connect(t){q(!1,"cannot reconnect JsonRpcSigner","UNSUPPORTED_OPERATION",{operation:"signer.connect"})}async getAddress(){return this.address}async populateTransaction(t){return await this.populateCall(t)}async sendUncheckedTransaction(t){const n=xu(t),s=[];if(n.from){const o=n.from;s.push((async()=>{const a=await Nt(o,this.provider);R(a!=null&&a.toLowerCase()===this.address.toLowerCase(),"from address mismatch","transaction",t),n.from=a})())}else n.from=this.address;if(n.gasLimit==null&&s.push((async()=>{n.gasLimit=await this.provider.estimateGas({...n,from:this.address})})()),n.to!=null){const o=n.to;s.push((async()=>{n.to=await Nt(o,this.provider)})())}s.length&&await Promise.all(s);const i=this.provider.getRpcTransaction(n);return this.provider.send("eth_sendTransaction",[i])}async sendTransaction(t){const n=await this.provider.getBlockNumber(),s=await this.sendUncheckedTransaction(t);return await new Promise((i,o)=>{const a=[1e3,100];let c=0;const l=async()=>{try{const u=await this.provider.getTransaction(s);if(u!=null){i(u.replaceableTransaction(n));return}}catch(u){if(ht(u,"CANCELLED")||ht(u,"BAD_DATA")||ht(u,"NETWORK_ERROR")||ht(u,"UNSUPPORTED_OPERATION")){u.info==null&&(u.info={}),u.info.sendTransactionHash=s,o(u);return}if(ht(u,"INVALID_ARGUMENT")&&(c++,u.info==null&&(u.info={}),u.info.sendTransactionHash=s,c>10)){o(u);return}this.provider.emit("error",Re("failed to fetch transation after sending (will try again)","UNKNOWN_ERROR",{error:u}))}this.provider._setTimeout(()=>{l()},a.pop()||4e3)};l()})}async signTransaction(t){const n=xu(t);if(n.from){const i=await Nt(n.from,this.provider);R(i!=null&&i.toLowerCase()===this.address.toLowerCase(),"from address mismatch","transaction",t),n.from=i}else n.from=this.address;const s=this.provider.getRpcTransaction(n);return await this.provider.send("eth_signTransaction",[s])}async signMessage(t){const n=typeof t=="string"?rs(t):t;return await this.provider.send("personal_sign",[X(n),this.address.toLowerCase()])}async signTypedData(t,n,s){const i=xu(s),o=await zu.resolveNames(t,n,i,async a=>{const c=await Nt(a);return R(c!=null,"TypedData does not support null address","value",a),c});return await this.provider.send("eth_signTypedData_v4",[this.address.toLowerCase(),JSON.stringify(zu.getPayload(o.domain,n,o.value))])}async unlock(t){return this.provider.send("personal_unlockAccount",[this.address.toLowerCase(),t,null])}async _legacySignMessage(t){const n=typeof t=="string"?rs(t):t;return await this.provider.send("eth_sign",[this.address.toLowerCase(),X(n)])}}var Zi,La,Zn,yn,Hr,Ar,Ht,wl,Jd;class IP extends fP{constructor(t,n){super(t,n);M(this,wl);M(this,Zi);M(this,La);M(this,Zn);M(this,yn);M(this,Hr);M(this,Ar);M(this,Ht);O(this,La,1),O(this,Zi,Object.assign({},Tv,n||{})),O(this,Zn,[]),O(this,yn,null),O(this,Ar,null),O(this,Ht,null);{let i=null;const o=new Promise(a=>{i=a});O(this,Hr,{promise:o,resolve:i})}const s=this._getOption("staticNetwork");typeof s=="boolean"?(R(!s||t!=="any","staticNetwork cannot be used on special network 'any'","options",n),s&&t!=null&&O(this,Ar,En.from(t))):s&&(R(t==null||s.matches(t),"staticNetwork MUST match network object","options",n),O(this,Ar,s))}_getOption(t){return y(this,Zi)[t]}get _network(){return q(y(this,Ar),"network is not available yet","NETWORK_ERROR"),y(this,Ar)}async _perform(t){if(t.method==="call"||t.method==="estimateGas"){let s=t.transaction;if(s&&s.type!=null&&re(s.type)&&s.maxFeePerGas==null&&s.maxPriorityFeePerGas==null){const i=await this.getFeeData();i.maxFeePerGas==null&&i.maxPriorityFeePerGas==null&&(t=Object.assign({},t,{transaction:Object.assign({},s,{type:void 0})}))}}const n=this.getRpcRequest(t);return n!=null?await this.send(n.method,n.args):super._perform(t)}async _detectNetwork(){const t=this._getOption("staticNetwork");if(t)if(t===!0){if(y(this,Ar))return y(this,Ar)}else return t;return y(this,Ht)?await y(this,Ht):this.ready?(O(this,Ht,(async()=>{try{const n=En.from(re(await this.send("eth_chainId",[])));return O(this,Ht,null),n}catch(n){throw O(this,Ht,null),n}})()),await y(this,Ht)):(O(this,Ht,(async()=>{const n={id:ic(this,La)._++,method:"eth_chainId",params:[],jsonrpc:"2.0"};this.emit("debug",{action:"sendRpcPayload",payload:n});let s;try{s=(await this._send(n))[0],O(this,Ht,null)}catch(i){throw O(this,Ht,null),this.emit("debug",{action:"receiveRpcError",error:i}),i}if(this.emit("debug",{action:"receiveRpcResult",result:s}),"result"in s)return En.from(re(s.result));throw this.getRpcError(n,s)})()),await y(this,Ht))}_start(){y(this,Hr)==null||y(this,Hr).resolve==null||(y(this,Hr).resolve(),O(this,Hr,null),(async()=>{for(;y(this,Ar)==null&&!this.destroyed;)try{O(this,Ar,await this._detectNetwork())}catch(t){if(this.destroyed)break;console.log("JsonRpcProvider failed to detect network and cannot start up; retry in 1s (perhaps the URL is wrong or the node is not started)"),this.emit("error",Re("failed to bootstrap network detection","NETWORK_ERROR",{event:"initial-network-discovery",info:{error:t}})),await xP(1e3)}K(this,wl,Jd).call(this)})())}async _waitUntilReady(){if(y(this,Hr)!=null)return await y(this,Hr).promise}_getSubscriber(t){return t.type==="pending"?new EP(this):t.type==="event"?this._getOption("polling")?new hg(this,t.filter):new vP(this,t.filter):t.type==="orphan"&&t.filter.orphan==="drop-log"?new Bv("orphan"):super._getSubscriber(t)}get ready(){return y(this,Hr)==null}getRpcTransaction(t){const n={};return["chainId","gasLimit","gasPrice","type","maxFeePerGas","maxPriorityFeePerGas","nonce","value"].forEach(s=>{if(t[s]==null)return;let i=s;s==="gasLimit"&&(i="gas"),n[i]=qr(re(t[s],`tx.${s}`))}),["from","to","data"].forEach(s=>{t[s]!=null&&(n[s]=X(t[s]))}),t.accessList&&(n.accessList=ho(t.accessList)),t.blobVersionedHashes&&(n.blobVersionedHashes=t.blobVersionedHashes.map(s=>s.toLowerCase())),t.authorizationList&&(n.authorizationList=t.authorizationList.map(s=>{const i=R1(s);return{address:i.address,nonce:qr(i.nonce),chainId:qr(i.chainId),yParity:qr(i.signature.yParity),r:qr(i.signature.r),s:qr(i.signature.s)}})),n}getRpcRequest(t){switch(t.method){case"chainId":return{method:"eth_chainId",args:[]};case"getBlockNumber":return{method:"eth_blockNumber",args:[]};case"getGasPrice":return{method:"eth_gasPrice",args:[]};case"getPriorityFee":return{method:"eth_maxPriorityFeePerGas",args:[]};case"getBalance":return{method:"eth_getBalance",args:[Ao(t.address),t.blockTag]};case"getTransactionCount":return{method:"eth_getTransactionCount",args:[Ao(t.address),t.blockTag]};case"getCode":return{method:"eth_getCode",args:[Ao(t.address),t.blockTag]};case"getStorage":return{method:"eth_getStorageAt",args:[Ao(t.address),"0x"+t.position.toString(16),t.blockTag]};case"broadcastTransaction":return{method:"eth_sendRawTransaction",args:[t.signedTransaction]};case"getBlock":if("blockTag"in t)return{method:"eth_getBlockByNumber",args:[t.blockTag,!!t.includeTransactions]};if("blockHash"in t)return{method:"eth_getBlockByHash",args:[t.blockHash,!!t.includeTransactions]};break;case"getTransaction":return{method:"eth_getTransactionByHash",args:[t.hash]};case"getTransactionReceipt":return{method:"eth_getTransactionReceipt",args:[t.hash]};case"call":return{method:"eth_call",args:[this.getRpcTransaction(t.transaction),t.blockTag]};case"estimateGas":return{method:"eth_estimateGas",args:[this.getRpcTransaction(t.transaction)]};case"getLogs":return t.filter&&t.filter.address!=null&&(Array.isArray(t.filter.address)?t.filter.address=t.filter.address.map(Ao):t.filter.address=Ao(t.filter.address)),{method:"eth_getLogs",args:[t.filter]}}return null}getRpcError(t,n){const{method:s}=t,{error:i}=n;if(s==="eth_estimateGas"&&i.message){const c=i.message;if(!c.match(/revert/i)&&c.match(/insufficient funds/i))return Re("insufficient funds","INSUFFICIENT_FUNDS",{transaction:t.params[0],info:{payload:t,error:i}});if(c.match(/nonce/i)&&c.match(/too low/i))return Re("nonce has already been used","NONCE_EXPIRED",{transaction:t.params[0],info:{payload:t,error:i}})}if(s==="eth_call"||s==="eth_estimateGas"){const c=Yd(i),l=Zc.getBuiltinCallException(s==="eth_call"?"call":"estimateGas",t.params[0],c?c.data:null);return l.info={error:i,payload:t},l}const o=JSON.stringify(PP(i));if(typeof i.message=="string"&&i.message.match(/user denied|ethers-user-denied/i))return Re("user rejected action","ACTION_REJECTED",{action:{eth_sign:"signMessage",personal_sign:"signMessage",eth_signTypedData_v4:"signTypedData",eth_signTransaction:"signTransaction",eth_sendTransaction:"sendTransaction",eth_requestAccounts:"requestAccess",wallet_requestAccounts:"requestAccess"}[s]||"unknown",reason:"rejected",info:{payload:t,error:i}});if(s==="eth_sendRawTransaction"||s==="eth_sendTransaction"){const c=t.params[0];if(o.match(/insufficient funds|base fee exceeds gas limit/i))return Re("insufficient funds for intrinsic transaction cost","INSUFFICIENT_FUNDS",{transaction:c,info:{error:i}});if(o.match(/nonce/i)&&o.match(/too low/i))return Re("nonce has already been used","NONCE_EXPIRED",{transaction:c,info:{error:i}});if(o.match(/replacement transaction/i)&&o.match(/underpriced/i))return Re("replacement fee too low","REPLACEMENT_UNDERPRICED",{transaction:c,info:{error:i}});if(o.match(/only replay-protected/i))return Re("legacy pre-eip-155 transactions not supported","UNSUPPORTED_OPERATION",{operation:s,info:{transaction:c,info:{error:i}}})}let a=!!o.match(/the method .* does not exist/i);return a||i&&i.details&&i.details.startsWith("Unauthorized method:")&&(a=!0),a?Re("unsupported operation","UNSUPPORTED_OPERATION",{operation:t.method,info:{error:i,payload:t}}):Re("could not coalesce error","UNKNOWN_ERROR",{error:i,payload:t})}send(t,n){if(this.destroyed)return Promise.reject(Re("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:t}));const s=ic(this,La)._++,i=new Promise((o,a)=>{y(this,Zn).push({resolve:o,reject:a,payload:{method:t,params:n,id:s,jsonrpc:"2.0"}})});return K(this,wl,Jd).call(this),i}async getSigner(t){t==null&&(t=0);const n=this.send("eth_accounts",[]);if(typeof t=="number"){const i=await n;if(t>=i.length)throw new Error("no such account");return new bf(this,i[t])}const{accounts:s}=await Bt({network:this.getNetwork(),accounts:n});t=Ie(t);for(const i of s)if(Ie(i)===t)return new bf(this,t);throw new Error("invalid account")}async listAccounts(){return(await this.send("eth_accounts",[])).map(n=>new bf(this,n))}destroy(){y(this,yn)&&(clearTimeout(y(this,yn)),O(this,yn,null));for(const{payload:t,reject:n}of y(this,Zn))n(Re("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:t.method}));O(this,Zn,[]),super.destroy()}}Zi=new WeakMap,La=new WeakMap,Zn=new WeakMap,yn=new WeakMap,Hr=new WeakMap,Ar=new WeakMap,Ht=new WeakMap,wl=new WeakSet,Jd=function(){if(y(this,yn))return;const t=this._getOption("batchMaxCount")===1?0:this._getOption("batchStallTime");O(this,yn,setTimeout(()=>{O(this,yn,null);const n=y(this,Zn);for(O(this,Zn,[]);n.length;){const s=[n.shift()];for(;n.length&&s.length!==y(this,Zi).batchMaxCount;)if(s.push(n.shift()),JSON.stringify(s.map(o=>o.payload)).length>y(this,Zi).batchMaxSize){n.unshift(s.pop());break}(async()=>{const i=s.length===1?s[0].payload:s.map(o=>o.payload);this.emit("debug",{action:"sendRpcPayload",payload:i});try{const o=await this._send(i);this.emit("debug",{action:"receiveRpcResult",result:o});for(const{resolve:a,reject:c,payload:l}of s){if(this.destroyed){c(Re("provider destroyed; cancelled request","UNSUPPORTED_OPERATION",{operation:l.method}));continue}const u=o.filter(h=>h.id===l.id)[0];if(u==null){const h=Re("missing response for request","BAD_DATA",{value:o,info:{payload:l}});this.emit("error",h),c(h);continue}if("error"in u){c(this.getRpcError(l,u));continue}a(u.result)}}catch(o){this.emit("debug",{action:"receiveRpcError",error:o});for(const{reject:a}of s)a(o)}})()}},t))};var Ws;class SP extends IP{constructor(t,n){super(t,n);M(this,Ws);let s=this._getOption("pollingInterval");s==null&&(s=Tv.pollingInterval),O(this,Ws,s)}_getSubscriber(t){const n=super._getSubscriber(t);return y0(n)&&(n.pollingInterval=y(this,Ws)),n}get pollingInterval(){return y(this,Ws)}set pollingInterval(t){if(!Number.isInteger(t)||t<0)throw new Error("invalid interval");O(this,Ws,t),this._forEachSubscriber(n=>{y0(n)&&(n.pollingInterval=y(this,Ws))})}}Ws=new WeakMap;function Yd(r){if(r==null)return null;if(typeof r.message=="string"&&r.message.match(/revert/i)&&_e(r.data))return{message:r.message,data:r.data};if(typeof r=="object"){for(const e in r){const t=Yd(r[e]);if(t)return t}return null}if(typeof r=="string")try{return Yd(JSON.parse(r))}catch{}return null}function Zd(r,e){if(r!=null){if(typeof r.message=="string"&&e.push(r.message),typeof r=="object")for(const t in r)Zd(r[t],e);if(typeof r=="string")try{return Zd(JSON.parse(r),e)}catch{}}}function PP(r){const e=[];return Zd(r,e),e}var Fa,Ma;const Ii=class Ii extends SP{constructor(t,n,s){const i=Object.assign({},s??{},{batchMaxCount:1});R(t&&t.request,"invalid EIP-1193 provider","ethereum",t);super(n,i);M(this,Fa);M(this,Ma);O(this,Ma,null),s&&s.providerInfo&&O(this,Ma,s.providerInfo),O(this,Fa,async(o,a)=>{const c={method:o,params:a};this.emit("debug",{action:"sendEip1193Request",payload:c});try{const l=await t.request(c);return this.emit("debug",{action:"receiveEip1193Result",result:l}),l}catch(l){const u=new Error(l.message);throw u.code=l.code,u.data=l.data,u.payload=c,this.emit("debug",{action:"receiveEip1193Error",error:u}),u}})}get providerInfo(){return y(this,Ma)}async send(t,n){return await this._start(),await super.send(t,n)}async _send(t){R(!Array.isArray(t),"EIP-1193 does not support batch request","payload",t);try{const n=await y(this,Fa).call(this,t.method,t.params||[]);return[{id:t.id,result:n}]}catch(n){return[{id:t.id,error:{code:n.code,data:n.data,message:n.message}}]}}getRpcError(t,n){switch(n=JSON.parse(JSON.stringify(n)),n.error.code||-1){case 4001:n.error.message=`ethers-user-denied: ${n.error.message}`;break;case 4200:n.error.message=`ethers-unsupported: ${n.error.message}`;break}return super.getRpcError(t,n)}async hasSigner(t){t==null&&(t=0);const n=await this.send("eth_accounts",[]);return typeof t=="number"?n.length>t:(t=t.toLowerCase(),n.filter(s=>s.toLowerCase()===t).length!==0)}async getSigner(t){if(t==null&&(t=0),!await this.hasSigner(t))try{await y(this,Fa).call(this,"eth_requestAccounts",[])}catch(n){const s=n.payload;throw this.getRpcError(s,{id:s.id,error:n})}return await super.getSigner(t)}static async discover(t){if(t==null&&(t={}),t.provider)return new Ii(t.provider);const n=t.window?t.window:typeof window<"u"?window:null;if(n==null)return null;const s=t.anyProvider;if(s&&n.ethereum)return new Ii(n.ethereum);if(!("addEventListener"in n&&"dispatchEvent"in n&&"removeEventListener"in n))return null;const i=t.timeout?t.timeout:300;return i===0?null:await new Promise((o,a)=>{let c=[];const l=f=>{c.push(f.detail),s&&u()},u=()=>{if(clearTimeout(h),c.length)if(t&&t.filter){const f=t.filter(c.map(d=>Object.assign({},d.info)));if(f==null)o(null);else if(f instanceof Ii)o(f);else{let d=null;if(f.uuid&&(d=c.filter(g=>f.uuid===g.info.uuid)[0]),d){const{provider:p,info:g}=d;o(new Ii(p,void 0,{providerInfo:g}))}else a(Re("filter returned unknown info","UNSUPPORTED_OPERATION",{value:f}))}}else{const{provider:f,info:d}=c[0];o(new Ii(f,void 0,{providerInfo:d}))}else o(null);n.removeEventListener("eip6963:announceProvider",l)},h=setTimeout(()=>{u()},i);n.addEventListener("eip6963:announceProvider",l),n.dispatchEvent(new Event("eip6963:requestProvider"))})}};Fa=new WeakMap,Ma=new WeakMap;let Ku=Ii;const OP="modulepreload",DP=function(r){return"/build/"+r},m0={},Nv=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){let o=function(l){return Promise.all(l.map(u=>Promise.resolve(u).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),c=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=o(t.map(l=>{if(l=DP(l),l in m0)return;m0[l]=!0;const u=l.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${h}`))return;const f=document.createElement("link");if(f.rel=u?"stylesheet":OP,u||(f.as="script"),f.crossOrigin="",f.href=l,c&&f.setAttribute("nonce",c),document.head.appendChild(f),u)return new Promise((d,p)=>{f.addEventListener("load",d),f.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${l}`)))})}))}function i(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return s.then(o=>{for(const a of o||[])a.status==="rejected"&&i(a.reason);return e().catch(i)})};var mn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function fg(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function CP(r){if(Object.prototype.hasOwnProperty.call(r,"__esModule"))return r;var e=r.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(n){var s=Object.getOwnPropertyDescriptor(r,n);Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:function(){return r[n]}})}),t}var Ql={exports:{}},w0;function BP(){if(w0)return Ql.exports;w0=1;var r=typeof Reflect=="object"?Reflect:null,e=r&&typeof r.apply=="function"?r.apply:function(S,E,P){return Function.prototype.apply.call(S,E,P)},t;r&&typeof r.ownKeys=="function"?t=r.ownKeys:Object.getOwnPropertySymbols?t=function(S){return Object.getOwnPropertyNames(S).concat(Object.getOwnPropertySymbols(S))}:t=function(S){return Object.getOwnPropertyNames(S)};function n(I){console&&console.warn&&console.warn(I)}var s=Number.isNaN||function(S){return S!==S};function i(){i.init.call(this)}Ql.exports=i,Ql.exports.once=b,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var o=10;function a(I){if(typeof I!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof I)}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return o},set:function(I){if(typeof I!="number"||I<0||s(I))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+I+".");o=I}}),i.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(S){if(typeof S!="number"||S<0||s(S))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+S+".");return this._maxListeners=S,this};function c(I){return I._maxListeners===void 0?i.defaultMaxListeners:I._maxListeners}i.prototype.getMaxListeners=function(){return c(this)},i.prototype.emit=function(S){for(var E=[],P=1;P<arguments.length;P++)E.push(arguments[P]);var D=S==="error",B=this._events;if(B!==void 0)D=D&&B.error===void 0;else if(!D)return!1;if(D){var L;if(E.length>0&&(L=E[0]),L instanceof Error)throw L;var j=new Error("Unhandled error."+(L?" ("+L.message+")":""));throw j.context=L,j}var $=B[S];if($===void 0)return!1;if(typeof $=="function")e($,this,E);else for(var U=$.length,T=p($,U),P=0;P<U;++P)e(T[P],this,E);return!0};function l(I,S,E,P){var D,B,L;if(a(E),B=I._events,B===void 0?(B=I._events=Object.create(null),I._eventsCount=0):(B.newListener!==void 0&&(I.emit("newListener",S,E.listener?E.listener:E),B=I._events),L=B[S]),L===void 0)L=B[S]=E,++I._eventsCount;else if(typeof L=="function"?L=B[S]=P?[E,L]:[L,E]:P?L.unshift(E):L.push(E),D=c(I),D>0&&L.length>D&&!L.warned){L.warned=!0;var j=new Error("Possible EventEmitter memory leak detected. "+L.length+" "+String(S)+" listeners added. Use emitter.setMaxListeners() to increase limit");j.name="MaxListenersExceededWarning",j.emitter=I,j.type=S,j.count=L.length,n(j)}return I}i.prototype.addListener=function(S,E){return l(this,S,E,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(S,E){return l(this,S,E,!0)};function u(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(I,S,E){var P={fired:!1,wrapFn:void 0,target:I,type:S,listener:E},D=u.bind(P);return D.listener=E,P.wrapFn=D,D}i.prototype.once=function(S,E){return a(E),this.on(S,h(this,S,E)),this},i.prototype.prependOnceListener=function(S,E){return a(E),this.prependListener(S,h(this,S,E)),this},i.prototype.removeListener=function(S,E){var P,D,B,L,j;if(a(E),D=this._events,D===void 0)return this;if(P=D[S],P===void 0)return this;if(P===E||P.listener===E)--this._eventsCount===0?this._events=Object.create(null):(delete D[S],D.removeListener&&this.emit("removeListener",S,P.listener||E));else if(typeof P!="function"){for(B=-1,L=P.length-1;L>=0;L--)if(P[L]===E||P[L].listener===E){j=P[L].listener,B=L;break}if(B<0)return this;B===0?P.shift():g(P,B),P.length===1&&(D[S]=P[0]),D.removeListener!==void 0&&this.emit("removeListener",S,j||E)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(S){var E,P,D;if(P=this._events,P===void 0)return this;if(P.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):P[S]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete P[S]),this;if(arguments.length===0){var B=Object.keys(P),L;for(D=0;D<B.length;++D)L=B[D],L!=="removeListener"&&this.removeAllListeners(L);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(E=P[S],typeof E=="function")this.removeListener(S,E);else if(E!==void 0)for(D=E.length-1;D>=0;D--)this.removeListener(S,E[D]);return this};function f(I,S,E){var P=I._events;if(P===void 0)return[];var D=P[S];return D===void 0?[]:typeof D=="function"?E?[D.listener||D]:[D]:E?m(D):p(D,D.length)}i.prototype.listeners=function(S){return f(this,S,!0)},i.prototype.rawListeners=function(S){return f(this,S,!1)},i.listenerCount=function(I,S){return typeof I.listenerCount=="function"?I.listenerCount(S):d.call(I,S)},i.prototype.listenerCount=d;function d(I){var S=this._events;if(S!==void 0){var E=S[I];if(typeof E=="function")return 1;if(E!==void 0)return E.length}return 0}i.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]};function p(I,S){for(var E=new Array(S),P=0;P<S;++P)E[P]=I[P];return E}function g(I,S){for(;S+1<I.length;S++)I[S]=I[S+1];I.pop()}function m(I){for(var S=new Array(I.length),E=0;E<S.length;++E)S[E]=I[E].listener||I[E];return S}function b(I,S){return new Promise(function(E,P){function D(L){I.removeListener(S,B),P(L)}function B(){typeof I.removeListener=="function"&&I.removeListener("error",D),E([].slice.call(arguments))}v(I,S,B,{once:!0}),S!=="error"&&x(I,D,{once:!0})})}function x(I,S,E){typeof I.on=="function"&&v(I,"error",S,E)}function v(I,S,E,P){if(typeof I.on=="function")P.once?I.once(S,E):I.on(S,E);else if(typeof I.addEventListener=="function")I.addEventListener(S,function D(B){P.once&&I.removeEventListener(S,D),E(B)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof I)}return Ql.exports}var hr=BP();const dg=fg(hr);var b0=function(r,e,t){if(t||arguments.length===2)for(var n=0,s=e.length,i;n<s;n++)(i||!(n in e))&&(i||(i=Array.prototype.slice.call(e,0,n)),i[n]=e[n]);return r.concat(i||Array.prototype.slice.call(e))},_P=(function(){function r(e,t,n){this.name=e,this.version=t,this.os=n,this.type="browser"}return r})(),TP=(function(){function r(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return r})(),NP=(function(){function r(e,t,n,s){this.name=e,this.version=t,this.os=n,this.bot=s,this.type="bot-device"}return r})(),RP=(function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r})(),UP=(function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r})(),kP=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,$P=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,v0=3,LP=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",kP]],E0=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function FP(r){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new UP:typeof navigator<"u"?jP(navigator.userAgent):HP()}function MP(r){return r!==""&&LP.reduce(function(e,t){var n=t[0],s=t[1];if(e)return e;var i=s.exec(r);return!!i&&[n,i]},!1)}function jP(r){var e=MP(r);if(!e)return null;var t=e[0],n=e[1];if(t==="searchbot")return new RP;var s=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);s?s.length<v0&&(s=b0(b0([],s,!0),qP(v0-s.length),!0)):s=[];var i=s.join("."),o=zP(r),a=$P.exec(r);return a&&a[1]?new NP(t,i,o,a[1]):new _P(t,i,o)}function zP(r){for(var e=0,t=E0.length;e<t;e++){var n=E0[e],s=n[0],i=n[1],o=i.exec(r);if(o)return s}return null}function HP(){var r=typeof process<"u"&&process.version;return r?new TP(process.version.slice(1)):null}function qP(r){for(var e=[],t=0;t<r;t++)e.push("0");return e}var vf={};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var Xd=function(r,e){return Xd=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var s in n)n.hasOwnProperty(s)&&(t[s]=n[s])},Xd(r,e)};function VP(r,e){Xd(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var ep=function(){return ep=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},ep.apply(this,arguments)};function KP(r,e){var t={};for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(r);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(r,n[s])&&(t[n[s]]=r[n[s]]);return t}function GP(r,e,t,n){var s=arguments.length,i=s<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(i=(s<3?o(i):s>3?o(e,t,i):o(e,t))||i);return s>3&&i&&Object.defineProperty(e,t,i),i}function QP(r,e){return function(t,n){e(t,n,r)}}function WP(r,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(r,e)}function JP(r,e,t,n){function s(i){return i instanceof t?i:new t(function(o){o(i)})}return new(t||(t=Promise))(function(i,o){function a(u){try{l(n.next(u))}catch(h){o(h)}}function c(u){try{l(n.throw(u))}catch(h){o(h)}}function l(u){u.done?i(u.value):s(u.value).then(a,c)}l((n=n.apply(r,e||[])).next())})}function YP(r,e){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,s,i,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,s&&(i=l[0]&2?s.return:l[0]?s.throw||((i=s.return)&&i.call(s),0):s.next)&&!(i=i.call(s,l[1])).done)return i;switch(s=0,i&&(l=[l[0]&2,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,s=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!i||l[1]>i[0]&&l[1]<i[3])){t.label=l[1];break}if(l[0]===6&&t.label<i[1]){t.label=i[1],i=l;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(l);break}i[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(u){l=[6,u],s=0}finally{n=i=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function ZP(r,e,t,n){n===void 0&&(n=t),r[n]=e[t]}function XP(r,e){for(var t in r)t!=="default"&&!e.hasOwnProperty(t)&&(e[t]=r[t])}function tp(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Rv(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),s,i=[],o;try{for(;(e===void 0||e-- >0)&&!(s=n.next()).done;)i.push(s.value)}catch(a){o={error:a}}finally{try{s&&!s.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return i}function eO(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(Rv(arguments[e]));return r}function tO(){for(var r=0,e=0,t=arguments.length;e<t;e++)r+=arguments[e].length;for(var n=Array(r),s=0,e=0;e<t;e++)for(var i=arguments[e],o=0,a=i.length;o<a;o++,s++)n[s]=i[o];return n}function tl(r){return this instanceof tl?(this.v=r,this):new tl(r)}function rO(r,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(r,e||[]),s,i=[];return s={},o("next"),o("throw"),o("return"),s[Symbol.asyncIterator]=function(){return this},s;function o(f){n[f]&&(s[f]=function(d){return new Promise(function(p,g){i.push([f,d,p,g])>1||a(f,d)})})}function a(f,d){try{c(n[f](d))}catch(p){h(i[0][3],p)}}function c(f){f.value instanceof tl?Promise.resolve(f.value.v).then(l,u):h(i[0][2],f)}function l(f){a("next",f)}function u(f){a("throw",f)}function h(f,d){f(d),i.shift(),i.length&&a(i[0][0],i[0][1])}}function nO(r){var e,t;return e={},n("next"),n("throw",function(s){throw s}),n("return"),e[Symbol.iterator]=function(){return this},e;function n(s,i){e[s]=r[s]?function(o){return(t=!t)?{value:tl(r[s](o)),done:s==="return"}:i?i(o):o}:i}}function sO(r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=r[Symbol.asyncIterator],t;return e?e.call(r):(r=typeof tp=="function"?tp(r):r[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(i){t[i]=r[i]&&function(o){return new Promise(function(a,c){o=r[i](o),s(a,c,o.done,o.value)})}}function s(i,o,a,c){Promise.resolve(c).then(function(l){i({value:l,done:a})},o)}}function iO(r,e){return Object.defineProperty?Object.defineProperty(r,"raw",{value:e}):r.raw=e,r}function oO(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t in r)Object.hasOwnProperty.call(r,t)&&(e[t]=r[t]);return e.default=r,e}function aO(r){return r&&r.__esModule?r:{default:r}}function cO(r,e){if(!e.has(r))throw new TypeError("attempted to get private field on non-instance");return e.get(r)}function lO(r,e,t){if(!e.has(r))throw new TypeError("attempted to set private field on non-instance");return e.set(r,t),t}const uO=Object.freeze(Object.defineProperty({__proto__:null,get __assign(){return ep},__asyncDelegator:nO,__asyncGenerator:rO,__asyncValues:sO,__await:tl,__awaiter:JP,__classPrivateFieldGet:cO,__classPrivateFieldSet:lO,__createBinding:ZP,__decorate:GP,__exportStar:XP,__extends:VP,__generator:YP,__importDefault:aO,__importStar:oO,__makeTemplateObject:iO,__metadata:WP,__param:QP,__read:Rv,__rest:KP,__spread:eO,__spreadArrays:tO,__values:tp},Symbol.toStringTag,{value:"Module"})),Sl=CP(uO);var Ef={},lc={},A0;function hO(){if(A0)return lc;A0=1,Object.defineProperty(lc,"__esModule",{value:!0}),lc.delay=void 0;function r(e){return new Promise(t=>{setTimeout(()=>{t(!0)},e)})}return lc.delay=r,lc}var li={},Af={},ui={},x0;function fO(){return x0||(x0=1,Object.defineProperty(ui,"__esModule",{value:!0}),ui.ONE_THOUSAND=ui.ONE_HUNDRED=void 0,ui.ONE_HUNDRED=100,ui.ONE_THOUSAND=1e3),ui}var xf={},I0;function dO(){return I0||(I0=1,(function(r){Object.defineProperty(r,"__esModule",{value:!0}),r.ONE_YEAR=r.FOUR_WEEKS=r.THREE_WEEKS=r.TWO_WEEKS=r.ONE_WEEK=r.THIRTY_DAYS=r.SEVEN_DAYS=r.FIVE_DAYS=r.THREE_DAYS=r.ONE_DAY=r.TWENTY_FOUR_HOURS=r.TWELVE_HOURS=r.SIX_HOURS=r.THREE_HOURS=r.ONE_HOUR=r.SIXTY_MINUTES=r.THIRTY_MINUTES=r.TEN_MINUTES=r.FIVE_MINUTES=r.ONE_MINUTE=r.SIXTY_SECONDS=r.THIRTY_SECONDS=r.TEN_SECONDS=r.FIVE_SECONDS=r.ONE_SECOND=void 0,r.ONE_SECOND=1,r.FIVE_SECONDS=5,r.TEN_SECONDS=10,r.THIRTY_SECONDS=30,r.SIXTY_SECONDS=60,r.ONE_MINUTE=r.SIXTY_SECONDS,r.FIVE_MINUTES=r.ONE_MINUTE*5,r.TEN_MINUTES=r.ONE_MINUTE*10,r.THIRTY_MINUTES=r.ONE_MINUTE*30,r.SIXTY_MINUTES=r.ONE_MINUTE*60,r.ONE_HOUR=r.SIXTY_MINUTES,r.THREE_HOURS=r.ONE_HOUR*3,r.SIX_HOURS=r.ONE_HOUR*6,r.TWELVE_HOURS=r.ONE_HOUR*12,r.TWENTY_FOUR_HOURS=r.ONE_HOUR*24,r.ONE_DAY=r.TWENTY_FOUR_HOURS,r.THREE_DAYS=r.ONE_DAY*3,r.FIVE_DAYS=r.ONE_DAY*5,r.SEVEN_DAYS=r.ONE_DAY*7,r.THIRTY_DAYS=r.ONE_DAY*30,r.ONE_WEEK=r.SEVEN_DAYS,r.TWO_WEEKS=r.ONE_WEEK*2,r.THREE_WEEKS=r.ONE_WEEK*3,r.FOUR_WEEKS=r.ONE_WEEK*4,r.ONE_YEAR=r.ONE_DAY*365})(xf)),xf}var S0;function Uv(){return S0||(S0=1,(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=Sl;e.__exportStar(fO(),r),e.__exportStar(dO(),r)})(Af)),Af}var P0;function pO(){if(P0)return li;P0=1,Object.defineProperty(li,"__esModule",{value:!0}),li.fromMiliseconds=li.toMiliseconds=void 0;const r=Uv();function e(n){return n*r.ONE_THOUSAND}li.toMiliseconds=e;function t(n){return Math.floor(n/r.ONE_THOUSAND)}return li.fromMiliseconds=t,li}var O0;function gO(){return O0||(O0=1,(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=Sl;e.__exportStar(hO(),r),e.__exportStar(pO(),r)})(Ef)),Ef}var xo={},D0;function yO(){if(D0)return xo;D0=1,Object.defineProperty(xo,"__esModule",{value:!0}),xo.Watch=void 0;class r{constructor(){this.timestamps=new Map}start(t){if(this.timestamps.has(t))throw new Error(`Watch already started for label: ${t}`);this.timestamps.set(t,{started:Date.now()})}stop(t){const n=this.get(t);if(typeof n.elapsed<"u")throw new Error(`Watch already stopped for label: ${t}`);const s=Date.now()-n.started;this.timestamps.set(t,{started:n.started,elapsed:s})}get(t){const n=this.timestamps.get(t);if(typeof n>"u")throw new Error(`No timestamp found for label: ${t}`);return n}elapsed(t){const n=this.get(t);return n.elapsed||Date.now()-n.started}}return xo.Watch=r,xo.default=r,xo}var If={},uc={},C0;function mO(){if(C0)return uc;C0=1,Object.defineProperty(uc,"__esModule",{value:!0}),uc.IWatch=void 0;class r{}return uc.IWatch=r,uc}var B0;function wO(){return B0||(B0=1,(function(r){Object.defineProperty(r,"__esModule",{value:!0}),Sl.__exportStar(mO(),r)})(If)),If}var _0;function bO(){return _0||(_0=1,(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=Sl;e.__exportStar(gO(),r),e.__exportStar(yO(),r),e.__exportStar(wO(),r),e.__exportStar(Uv(),r)})(vf)),vf}var J=bO(),De={},T0;function kv(){if(T0)return De;T0=1,Object.defineProperty(De,"__esModule",{value:!0}),De.getLocalStorage=De.getLocalStorageOrThrow=De.getCrypto=De.getCryptoOrThrow=De.getLocation=De.getLocationOrThrow=De.getNavigator=De.getNavigatorOrThrow=De.getDocument=De.getDocumentOrThrow=De.getFromWindowOrThrow=De.getFromWindow=void 0;function r(f){let d;return typeof window<"u"&&typeof window[f]<"u"&&(d=window[f]),d}De.getFromWindow=r;function e(f){const d=r(f);if(!d)throw new Error(`${f} is not defined in Window`);return d}De.getFromWindowOrThrow=e;function t(){return e("document")}De.getDocumentOrThrow=t;function n(){return r("document")}De.getDocument=n;function s(){return e("navigator")}De.getNavigatorOrThrow=s;function i(){return r("navigator")}De.getNavigator=i;function o(){return e("location")}De.getLocationOrThrow=o;function a(){return r("location")}De.getLocation=a;function c(){return e("crypto")}De.getCryptoOrThrow=c;function l(){return r("crypto")}De.getCrypto=l;function u(){return e("localStorage")}De.getLocalStorageOrThrow=u;function h(){return r("localStorage")}return De.getLocalStorage=h,De}var ls=kv(),hc={},N0;function vO(){if(N0)return hc;N0=1,Object.defineProperty(hc,"__esModule",{value:!0}),hc.getWindowMetadata=void 0;const r=kv();function e(){let t,n;try{t=r.getDocumentOrThrow(),n=r.getLocationOrThrow()}catch{return null}function s(){const d=t.getElementsByTagName("link"),p=[];for(let g=0;g<d.length;g++){const m=d[g],b=m.getAttribute("rel");if(b&&b.toLowerCase().indexOf("icon")>-1){const x=m.getAttribute("href");if(x)if(x.toLowerCase().indexOf("https:")===-1&&x.toLowerCase().indexOf("http:")===-1&&x.indexOf("//")!==0){let v=n.protocol+"//"+n.host;if(x.indexOf("/")===0)v+=x;else{const I=n.pathname.split("/");I.pop();const S=I.join("/");v+=S+"/"+x}p.push(v)}else if(x.indexOf("//")===0){const v=n.protocol+x;p.push(v)}else p.push(x)}}return p}function i(...d){const p=t.getElementsByTagName("meta");for(let g=0;g<p.length;g++){const m=p[g],b=["itemprop","property","name"].map(x=>m.getAttribute(x)).filter(x=>x?d.includes(x):!1);if(b.length&&b){const x=m.getAttribute("content");if(x)return x}}return""}function o(){let d=i("name","og:site_name","og:title","twitter:title");return d||(d=t.title),d}function a(){return i("description","og:description","twitter:description","keywords")}const c=o(),l=a(),u=n.origin,h=s();return{description:l,url:u,icons:h,name:c}}return hc.getWindowMetadata=e,hc}var EO=vO();function rl(r,{strict:e=!0}={}){return!r||typeof r!="string"?!1:e?/^0x[0-9a-fA-F]*$/.test(r):r.startsWith("0x")}function rp(r){return rl(r,{strict:!1})?Math.ceil((r.length-2)/2):r.length}const $v="2.36.0";let fc={getDocsUrl:({docsBaseUrl:r,docsPath:e="",docsSlug:t})=>e?`${r??"https://viem.sh"}${e}${t?`#${t}`:""}`:void 0,version:`viem@${$v}`};class io extends Error{constructor(e,t={}){var a;const n=(()=>{var c;return t.cause instanceof io?t.cause.details:(c=t.cause)!=null&&c.message?t.cause.message:t.details})(),s=t.cause instanceof io&&t.cause.docsPath||t.docsPath,i=(a=fc.getDocsUrl)==null?void 0:a.call(fc,{...t,docsPath:s}),o=[e||"An error occurred.","",...t.metaMessages?[...t.metaMessages,""]:[],...i?[`Docs: ${i}`]:[],...n?[`Details: ${n}`]:[],...fc.version?[`Version: ${fc.version}`]:[]].join(`
`);super(o,t.cause?{cause:t.cause}:void 0),Object.defineProperty(this,"details",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"docsPath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metaMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"shortMessage",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"version",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"BaseError"}),this.details=n,this.docsPath=s,this.metaMessages=t.metaMessages,this.name=t.name??this.name,this.shortMessage=e,this.version=$v}walk(e){return Lv(this,e)}}function Lv(r,e){return e!=null&&e(r)?r:r&&typeof r=="object"&&"cause"in r&&r.cause!==void 0?Lv(r.cause,e):e?null:r}class Fv extends io{constructor({size:e,targetSize:t,type:n}){super(`${n.charAt(0).toUpperCase()}${n.slice(1).toLowerCase()} size (${e}) exceeds padding size (${t}).`,{name:"SizeExceedsPaddingSizeError"})}}function ec(r,{dir:e,size:t=32}={}){return typeof r=="string"?AO(r,{dir:e,size:t}):xO(r,{dir:e,size:t})}function AO(r,{dir:e,size:t=32}={}){if(t===null)return r;const n=r.replace("0x","");if(n.length>t*2)throw new Fv({size:Math.ceil(n.length/2),targetSize:t,type:"hex"});return`0x${n[e==="right"?"padEnd":"padStart"](t*2,"0")}`}function xO(r,{dir:e,size:t=32}={}){if(t===null)return r;if(r.length>t)throw new Fv({size:r.length,targetSize:t,type:"bytes"});const n=new Uint8Array(t);for(let s=0;s<t;s++){const i=e==="right";n[i?s:t-s-1]=r[i?s:r.length-s-1]}return n}class IO extends io{constructor({max:e,min:t,signed:n,size:s,value:i}){super(`Number "${i}" is not in safe ${s?`${s*8}-bit ${n?"signed":"unsigned"} `:""}integer range ${e?`(${t} to ${e})`:`(above ${t})`}`,{name:"IntegerOutOfRangeError"})}}class SO extends io{constructor({givenSize:e,maxSize:t}){super(`Size cannot exceed ${t} bytes. Given size: ${e} bytes.`,{name:"SizeOverflowError"})}}function tc(r,{size:e}){if(rp(r)>e)throw new SO({givenSize:rp(r),maxSize:e})}function np(r,e={}){const{signed:t}=e;e.size&&tc(r,{size:e.size});const n=BigInt(r);if(!t)return n;const s=(r.length-2)/2,i=(1n<<BigInt(s)*8n-1n)-1n;return n<=i?n:n-BigInt(`0x${"f".padStart(s*2,"f")}`)-1n}function PO(r,e={}){return Number(np(r,e))}const OO=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function sp(r,e={}){return typeof r=="number"||typeof r=="bigint"?jv(r,e):typeof r=="string"?BO(r,e):typeof r=="boolean"?DO(r,e):Mv(r,e)}function DO(r,e={}){const t=`0x${Number(r)}`;return typeof e.size=="number"?(tc(t,{size:e.size}),ec(t,{size:e.size})):t}function Mv(r,e={}){let t="";for(let s=0;s<r.length;s++)t+=OO[r[s]];const n=`0x${t}`;return typeof e.size=="number"?(tc(n,{size:e.size}),ec(n,{dir:"right",size:e.size})):n}function jv(r,e={}){const{signed:t,size:n}=e,s=BigInt(r);let i;n?t?i=(1n<<BigInt(n)*8n-1n)-1n:i=2n**(BigInt(n)*8n)-1n:typeof r=="number"&&(i=BigInt(Number.MAX_SAFE_INTEGER));const o=typeof i=="bigint"&&t?-i-1n:0;if(i&&s>i||s<o){const c=typeof r=="bigint"?"n":"";throw new IO({max:i?`${i}${c}`:void 0,min:`${o}${c}`,signed:t,size:n,value:`${r}${c}`})}const a=`0x${(t&&s<0?(1n<<BigInt(n*8))+BigInt(s):s).toString(16)}`;return n?ec(a,{size:n}):a}const CO=new TextEncoder;function BO(r,e={}){const t=CO.encode(r);return Mv(t,e)}const _O=new TextEncoder;function TO(r,e={}){return typeof r=="number"||typeof r=="bigint"?RO(r,e):typeof r=="boolean"?NO(r,e):rl(r)?zv(r,e):Hv(r,e)}function NO(r,e={}){const t=new Uint8Array(1);return t[0]=Number(r),typeof e.size=="number"?(tc(t,{size:e.size}),ec(t,{size:e.size})):t}const Dn={zero:48,nine:57,A:65,F:70,a:97,f:102};function R0(r){if(r>=Dn.zero&&r<=Dn.nine)return r-Dn.zero;if(r>=Dn.A&&r<=Dn.F)return r-(Dn.A-10);if(r>=Dn.a&&r<=Dn.f)return r-(Dn.a-10)}function zv(r,e={}){let t=r;e.size&&(tc(t,{size:e.size}),t=ec(t,{dir:"right",size:e.size}));let n=t.slice(2);n.length%2&&(n=`0${n}`);const s=n.length/2,i=new Uint8Array(s);for(let o=0,a=0;o<s;o++){const c=R0(n.charCodeAt(a++)),l=R0(n.charCodeAt(a++));if(c===void 0||l===void 0)throw new io(`Invalid byte sequence ("${n[a-2]}${n[a-1]}" in "${n}").`);i[o]=c*16+l}return i}function RO(r,e){const t=jv(r,e);return zv(t)}function Hv(r,e={}){const t=_O.encode(r);return typeof e.size=="number"?(tc(t,{size:e.size}),ec(t,{dir:"right",size:e.size})):t}const Wl=BigInt(2**32-1),U0=BigInt(32);function UO(r,e=!1){return e?{h:Number(r&Wl),l:Number(r>>U0&Wl)}:{h:Number(r>>U0&Wl)|0,l:Number(r&Wl)|0}}function kO(r,e=!1){const t=r.length;let n=new Uint32Array(t),s=new Uint32Array(t);for(let i=0;i<t;i++){const{h:o,l:a}=UO(r[i],e);[n[i],s[i]]=[o,a]}return[n,s]}const $O=(r,e,t)=>r<<t|e>>>32-t,LO=(r,e,t)=>e<<t|r>>>32-t,FO=(r,e,t)=>e<<t-32|r>>>64-t,MO=(r,e,t)=>r<<t-32|e>>>64-t,Io=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function jO(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Gu(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function Wa(r,...e){if(!jO(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function TM(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Gu(r.outputLen),Gu(r.blockLen)}function k0(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function zO(r,e){Wa(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function HO(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}function qv(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function NM(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function RM(r,e){return r<<32-e|r>>>e}const qO=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function VO(r){return r<<24&4278190080|r<<8&16711680|r>>>8&65280|r>>>24&255}function KO(r){for(let e=0;e<r.length;e++)r[e]=VO(r[e]);return r}const $0=qO?r=>r:KO,Vv=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",GO=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function UM(r){if(Wa(r),Vv)return r.toHex();let e="";for(let t=0;t<r.length;t++)e+=GO[r[t]];return e}const Cn={_0:48,_9:57,A:65,F:70,a:97,f:102};function L0(r){if(r>=Cn._0&&r<=Cn._9)return r-Cn._0;if(r>=Cn.A&&r<=Cn.F)return r-(Cn.A-10);if(r>=Cn.a&&r<=Cn.f)return r-(Cn.a-10)}function kM(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);if(Vv)return Uint8Array.fromHex(r);const e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(t);for(let s=0,i=0;s<t;s++,i+=2){const o=L0(r.charCodeAt(i)),a=L0(r.charCodeAt(i+1));if(o===void 0||a===void 0){const c=r[i]+r[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[s]=o*16+a}return n}function QO(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function Kv(r){return typeof r=="string"&&(r=QO(r)),Wa(r),r}function $M(...r){let e=0;for(let n=0;n<r.length;n++){const s=r[n];Wa(s),e+=s.length}const t=new Uint8Array(e);for(let n=0,s=0;n<r.length;n++){const i=r[n];t.set(i,s),s+=i.length}return t}class WO{}function JO(r){const e=n=>r().update(Kv(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function LM(r=32){if(Io&&typeof Io.getRandomValues=="function")return Io.getRandomValues(new Uint8Array(r));if(Io&&typeof Io.randomBytes=="function")return Uint8Array.from(Io.randomBytes(r));throw new Error("crypto.getRandomValues must be defined")}const YO=BigInt(0),dc=BigInt(1),ZO=BigInt(2),XO=BigInt(7),e8=BigInt(256),t8=BigInt(113),Gv=[],Qv=[],Wv=[];for(let r=0,e=dc,t=1,n=0;r<24;r++){[t,n]=[n,(2*t+3*n)%5],Gv.push(2*(5*n+t)),Qv.push((r+1)*(r+2)/2%64);let s=YO;for(let i=0;i<7;i++)e=(e<<dc^(e>>XO)*t8)%e8,e&ZO&&(s^=dc<<(dc<<BigInt(i))-dc);Wv.push(s)}const Jv=kO(Wv,!0),r8=Jv[0],n8=Jv[1],F0=(r,e,t)=>t>32?FO(r,e,t):$O(r,e,t),M0=(r,e,t)=>t>32?MO(r,e,t):LO(r,e,t);function s8(r,e=24){const t=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)t[o]=r[o]^r[o+10]^r[o+20]^r[o+30]^r[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=t[c],u=t[c+1],h=F0(l,u,1)^t[a],f=M0(l,u,1)^t[a+1];for(let d=0;d<50;d+=10)r[o+d]^=h,r[o+d+1]^=f}let s=r[2],i=r[3];for(let o=0;o<24;o++){const a=Qv[o],c=F0(s,i,a),l=M0(s,i,a),u=Gv[o];s=r[u],i=r[u+1],r[u]=c,r[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)t[a]=r[o+a];for(let a=0;a<10;a++)r[o+a]^=~t[(a+2)%10]&t[(a+4)%10]}r[0]^=r8[n],r[1]^=n8[n]}qv(t)}class pg extends WO{constructor(e,t,n,s=!1,i=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=t,this.outputLen=n,this.enableXOF=s,this.rounds=i,Gu(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=HO(this.state)}clone(){return this._cloneInto()}keccak(){$0(this.state32),s8(this.state32,this.rounds),$0(this.state32),this.posOut=0,this.pos=0}update(e){k0(this),e=Kv(e),Wa(e);const{blockLen:t,state:n}=this,s=e.length;for(let i=0;i<s;){const o=Math.min(t-this.pos,s-i);for(let a=0;a<o;a++)n[this.pos++]^=e[i++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:n,blockLen:s}=this;e[n]^=t,(t&128)!==0&&n===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){k0(this,!1),Wa(e),this.finish();const t=this.state,{blockLen:n}=this;for(let s=0,i=e.length;s<i;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,i-s);e.set(t.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return Gu(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(zO(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,qv(this.state)}_cloneInto(e){const{blockLen:t,suffix:n,outputLen:s,rounds:i,enableXOF:o}=this;return e||(e=new pg(t,n,s,o,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=n,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}}const i8=(r,e,t)=>JO(()=>new pg(e,r,t)),o8=i8(1,136,256/8);function Yv(r,e){const t=e||"hex",n=o8(rl(r,{strict:!1})?TO(r):r);return t==="bytes"?n:sp(n)}class a8 extends Map{constructor(e){super(),Object.defineProperty(this,"maxSize",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxSize=e}get(e){const t=super.get(e);return super.has(e)&&t!==void 0&&(this.delete(e),super.set(e,t)),t}set(e,t){if(super.set(e,t),this.maxSize&&this.size>this.maxSize){const n=this.keys().next().value;n&&this.delete(n)}return this}}const Sf=new a8(8192);function c8(r,e){if(Sf.has(`${r}.${e}`))return Sf.get(`${r}.${e}`);const t=r.substring(2).toLowerCase(),n=Yv(Hv(t),"bytes"),s=t.split("");for(let o=0;o<40;o+=2)n[o>>1]>>4>=8&&s[o]&&(s[o]=s[o].toUpperCase()),(n[o>>1]&15)>=8&&s[o+1]&&(s[o+1]=s[o+1].toUpperCase());const i=`0x${s.join("")}`;return Sf.set(`${r}.${e}`,i),i}function l8(r){const e=Yv(`0x${r.substring(4)}`).substring(26);return c8(`0x${e}`)}async function u8({hash:r,signature:e}){const t=rl(r)?r:sp(r),{secp256k1:n}=await Nv(async()=>{const{secp256k1:o}=await import("./secp256k1-DfQHYOsn.js");return{secp256k1:o}},[]);return`0x${(()=>{if(typeof e=="object"&&"r"in e&&"s"in e){const{r:l,s:u,v:h,yParity:f}=e,d=Number(f??h),p=j0(d);return new n.Signature(np(l),np(u)).addRecoveryBit(p)}const o=rl(e)?e:sp(e);if(rp(o)!==65)throw new Error("invalid signature length");const a=PO(`0x${o.slice(130)}`),c=j0(a);return n.Signature.fromCompact(o.substring(2,130)).addRecoveryBit(c)})().recoverPublicKey(t.substring(2)).toHex(!1)}`}function j0(r){if(r===0||r===1)return r;if(r===27)return 0;if(r===28)return 1;throw new Error("Invalid yParityOrV value")}async function h8({hash:r,signature:e}){return l8(await u8({hash:r,signature:e}))}function f8(r){if(r.length>=255)throw new TypeError("Alphabet too long");const e=new Uint8Array(256);for(let l=0;l<e.length;l++)e[l]=255;for(let l=0;l<r.length;l++){const u=r.charAt(l),h=u.charCodeAt(0);if(e[h]!==255)throw new TypeError(u+" is ambiguous");e[h]=l}const t=r.length,n=r.charAt(0),s=Math.log(t)/Math.log(256),i=Math.log(256)/Math.log(t);function o(l){if(l instanceof Uint8Array||(ArrayBuffer.isView(l)?l=new Uint8Array(l.buffer,l.byteOffset,l.byteLength):Array.isArray(l)&&(l=Uint8Array.from(l))),!(l instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(l.length===0)return"";let u=0,h=0,f=0;const d=l.length;for(;f!==d&&l[f]===0;)f++,u++;const p=(d-f)*i+1>>>0,g=new Uint8Array(p);for(;f!==d;){let x=l[f],v=0;for(let I=p-1;(x!==0||v<h)&&I!==-1;I--,v++)x+=256*g[I]>>>0,g[I]=x%t>>>0,x=x/t>>>0;if(x!==0)throw new Error("Non-zero carry");h=v,f++}let m=p-h;for(;m!==p&&g[m]===0;)m++;let b=n.repeat(u);for(;m<p;++m)b+=r.charAt(g[m]);return b}function a(l){if(typeof l!="string")throw new TypeError("Expected String");if(l.length===0)return new Uint8Array;let u=0,h=0,f=0;for(;l[u]===n;)h++,u++;const d=(l.length-u)*s+1>>>0,p=new Uint8Array(d);for(;u<l.length;){const x=l.charCodeAt(u);if(x>255)return;let v=e[x];if(v===255)return;let I=0;for(let S=d-1;(v!==0||I<f)&&S!==-1;S--,I++)v+=t*p[S]>>>0,p[S]=v%256>>>0,v=v/256>>>0;if(v!==0)throw new Error("Non-zero carry");f=I,u++}let g=d-f;for(;g!==d&&p[g]===0;)g++;const m=new Uint8Array(h+(d-g));let b=h;for(;g!==d;)m[b++]=p[g++];return m}function c(l){const u=a(l);if(u)return u;throw new Error("Non-base"+t+" character")}return{encode:o,decodeUnsafe:a,decode:c}}var d8="123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz";const Pl=f8(d8);function p8(r){const e=r.length;let t=0,n=0;for(;n<e;){let s=r.charCodeAt(n++);if((s&4294967168)===0){t++;continue}else if((s&4294965248)===0)t+=2;else{if(s>=55296&&s<=56319&&n<e){const i=r.charCodeAt(n);(i&64512)===56320&&(++n,s=((s&1023)<<10)+(i&1023)+65536)}(s&4294901760)===0?t+=3:t+=4}}return t}function g8(r,e,t){const n=r.length;let s=t,i=0;for(;i<n;){let o=r.charCodeAt(i++);if((o&4294967168)===0){e[s++]=o;continue}else if((o&4294965248)===0)e[s++]=o>>6&31|192;else{if(o>=55296&&o<=56319&&i<n){const a=r.charCodeAt(i);(a&64512)===56320&&(++i,o=((o&1023)<<10)+(a&1023)+65536)}(o&4294901760)===0?(e[s++]=o>>12&15|224,e[s++]=o>>6&63|128):(e[s++]=o>>18&7|240,e[s++]=o>>12&63|128,e[s++]=o>>6&63|128)}e[s++]=o&63|128}}const y8=new TextEncoder,m8=50;function w8(r,e,t){y8.encodeInto(r,e.subarray(t))}function b8(r,e,t){r.length>m8?w8(r,e,t):g8(r,e,t)}const v8=4096;function Zv(r,e,t){let n=e;const s=n+t,i=[];let o="";for(;n<s;){const a=r[n++];if((a&128)===0)i.push(a);else if((a&224)===192){const c=r[n++]&63;i.push((a&31)<<6|c)}else if((a&240)===224){const c=r[n++]&63,l=r[n++]&63;i.push((a&31)<<12|c<<6|l)}else if((a&248)===240){const c=r[n++]&63,l=r[n++]&63,u=r[n++]&63;let h=(a&7)<<18|c<<12|l<<6|u;h>65535&&(h-=65536,i.push(h>>>10&1023|55296),h=56320|h&1023),i.push(h)}else i.push(a);i.length>=v8&&(o+=String.fromCharCode(...i),i.length=0)}return i.length>0&&(o+=String.fromCharCode(...i)),o}const E8=new TextDecoder,A8=200;function x8(r,e,t){const n=r.subarray(e,e+t);return E8.decode(n)}function I8(r,e,t){return t>A8?x8(r,e,t):Zv(r,e,t)}class Jl{constructor(e,t){this.type=e,this.data=t}}class cr extends Error{constructor(e){super(e);const t=Object.create(cr.prototype);Object.setPrototypeOf(this,t),Object.defineProperty(this,"name",{configurable:!0,enumerable:!1,value:cr.name})}}const pc=4294967295;function S8(r,e,t){const n=t/4294967296,s=t;r.setUint32(e,n),r.setUint32(e+4,s)}function Xv(r,e,t){const n=Math.floor(t/4294967296),s=t;r.setUint32(e,n),r.setUint32(e+4,s)}function eE(r,e){const t=r.getInt32(e),n=r.getUint32(e+4);return t*4294967296+n}function P8(r,e){const t=r.getUint32(e),n=r.getUint32(e+4);return t*4294967296+n}const O8=-1,D8=4294967296-1,C8=17179869184-1;function B8({sec:r,nsec:e}){if(r>=0&&e>=0&&r<=C8)if(e===0&&r<=D8){const t=new Uint8Array(4);return new DataView(t.buffer).setUint32(0,r),t}else{const t=r/4294967296,n=r&4294967295,s=new Uint8Array(8),i=new DataView(s.buffer);return i.setUint32(0,e<<2|t&3),i.setUint32(4,n),s}else{const t=new Uint8Array(12),n=new DataView(t.buffer);return n.setUint32(0,e),Xv(n,4,r),t}}function _8(r){const e=r.getTime(),t=Math.floor(e/1e3),n=(e-t*1e3)*1e6,s=Math.floor(n/1e9);return{sec:t+s,nsec:n-s*1e9}}function T8(r){if(r instanceof Date){const e=_8(r);return B8(e)}else return null}function N8(r){const e=new DataView(r.buffer,r.byteOffset,r.byteLength);switch(r.byteLength){case 4:return{sec:e.getUint32(0),nsec:0};case 8:{const t=e.getUint32(0),n=e.getUint32(4),s=(t&3)*4294967296+n,i=t>>>2;return{sec:s,nsec:i}}case 12:{const t=eE(e,4),n=e.getUint32(0);return{sec:t,nsec:n}}default:throw new cr(`Unrecognized data size for timestamp (expected 4, 8, or 12): ${r.length}`)}}function R8(r){const e=N8(r);return new Date(e.sec*1e3+e.nsec/1e6)}const U8={type:O8,encode:T8,decode:R8};class Qu{constructor(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(U8)}register({type:e,encode:t,decode:n}){if(e>=0)this.encoders[e]=t,this.decoders[e]=n;else{const s=-1-e;this.builtInEncoders[s]=t,this.builtInDecoders[s]=n}}tryToEncode(e,t){for(let n=0;n<this.builtInEncoders.length;n++){const s=this.builtInEncoders[n];if(s!=null){const i=s(e,t);if(i!=null){const o=-1-n;return new Jl(o,i)}}}for(let n=0;n<this.encoders.length;n++){const s=this.encoders[n];if(s!=null){const i=s(e,t);if(i!=null){const o=n;return new Jl(o,i)}}}return e instanceof Jl?e:null}decode(e,t,n){const s=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return s?s(e,t,n):new Jl(t,e)}}Qu.defaultCodec=new Qu;function k8(r){return r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer}function ip(r){return r instanceof Uint8Array?r:ArrayBuffer.isView(r)?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):k8(r)?new Uint8Array(r):Uint8Array.from(r)}const $8=100,L8=2048;let F8=class tE{constructor(e){this.entered=!1,this.extensionCodec=(e==null?void 0:e.extensionCodec)??Qu.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.maxDepth=(e==null?void 0:e.maxDepth)??$8,this.initialBufferSize=(e==null?void 0:e.initialBufferSize)??L8,this.sortKeys=(e==null?void 0:e.sortKeys)??!1,this.forceFloat32=(e==null?void 0:e.forceFloat32)??!1,this.ignoreUndefined=(e==null?void 0:e.ignoreUndefined)??!1,this.forceIntegerToFloat=(e==null?void 0:e.forceIntegerToFloat)??!1,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}clone(){return new tE({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,maxDepth:this.maxDepth,initialBufferSize:this.initialBufferSize,sortKeys:this.sortKeys,forceFloat32:this.forceFloat32,ignoreUndefined:this.ignoreUndefined,forceIntegerToFloat:this.forceIntegerToFloat})}reinitializeState(){this.pos=0}encodeSharedRef(e){if(this.entered)return this.clone().encodeSharedRef(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)}finally{this.entered=!1}}encode(e){if(this.entered)return this.clone().encode(e);try{return this.entered=!0,this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)}finally{this.entered=!1}}doEncode(e,t){if(t>this.maxDepth)throw new Error(`Too deep objects in depth ${t}`);e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.forceIntegerToFloat?this.encodeNumberAsFloat(e):this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.useBigInt64&&typeof e=="bigint"?this.encodeBigInt64(e):this.encodeObject(e,t)}ensureBufferSizeToWrite(e){const t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(t*2)}resizeBuffer(e){const t=new ArrayBuffer(e),n=new Uint8Array(t),s=new DataView(t);n.set(this.bytes),this.view=s,this.bytes=n}encodeNil(){this.writeU8(192)}encodeBoolean(e){e===!1?this.writeU8(194):this.writeU8(195)}encodeNumber(e){!this.forceIntegerToFloat&&Number.isSafeInteger(e)?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):this.useBigInt64?this.encodeNumberAsFloat(e):(this.writeU8(211),this.writeI64(e)):this.encodeNumberAsFloat(e)}encodeNumberAsFloat(e){this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))}encodeBigInt64(e){e>=BigInt(0)?(this.writeU8(207),this.writeBigUint64(e)):(this.writeU8(211),this.writeBigInt64(e))}writeStringHeader(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error(`Too long string: ${e} bytes in UTF-8`)}encodeString(e){const n=p8(e);this.ensureBufferSizeToWrite(5+n),this.writeStringHeader(n),b8(e,this.bytes,this.pos),this.pos+=n}encodeObject(e,t){const n=this.extensionCodec.tryToEncode(e,this.context);if(n!=null)this.encodeExtension(n);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,t);else throw new Error(`Unrecognized object: ${Object.prototype.toString.apply(e)}`)}encodeBinary(e){const t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else if(t<4294967296)this.writeU8(198),this.writeU32(t);else throw new Error(`Too large binary: ${t}`);const n=ip(e);this.writeU8a(n)}encodeArray(e,t){const n=e.length;if(n<16)this.writeU8(144+n);else if(n<65536)this.writeU8(220),this.writeU16(n);else if(n<4294967296)this.writeU8(221),this.writeU32(n);else throw new Error(`Too large array: ${n}`);for(const s of e)this.doEncode(s,t+1)}countWithoutUndefined(e,t){let n=0;for(const s of t)e[s]!==void 0&&n++;return n}encodeMap(e,t){const n=Object.keys(e);this.sortKeys&&n.sort();const s=this.ignoreUndefined?this.countWithoutUndefined(e,n):n.length;if(s<16)this.writeU8(128+s);else if(s<65536)this.writeU8(222),this.writeU16(s);else if(s<4294967296)this.writeU8(223),this.writeU32(s);else throw new Error(`Too large map object: ${s}`);for(const i of n){const o=e[i];this.ignoreUndefined&&o===void 0||(this.encodeString(i),this.doEncode(o,t+1))}}encodeExtension(e){if(typeof e.data=="function"){const n=e.data(this.pos+6),s=n.length;if(s>=4294967296)throw new Error(`Too large extension object: ${s}`);this.writeU8(201),this.writeU32(s),this.writeI8(e.type),this.writeU8a(n);return}const t=e.data.length;if(t===1)this.writeU8(212);else if(t===2)this.writeU8(213);else if(t===4)this.writeU8(214);else if(t===8)this.writeU8(215);else if(t===16)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else if(t<4294967296)this.writeU8(201),this.writeU32(t);else throw new Error(`Too large extension object: ${t}`);this.writeI8(e.type),this.writeU8a(e.data)}writeU8(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++}writeU8a(e){const t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t}writeI8(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++}writeU16(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2}writeI16(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2}writeU32(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4}writeI32(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4}writeF32(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4}writeF64(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8}writeU64(e){this.ensureBufferSizeToWrite(8),S8(this.view,this.pos,e),this.pos+=8}writeI64(e){this.ensureBufferSizeToWrite(8),Xv(this.view,this.pos,e),this.pos+=8}writeBigUint64(e){this.ensureBufferSizeToWrite(8),this.view.setBigUint64(this.pos,e),this.pos+=8}writeBigInt64(e){this.ensureBufferSizeToWrite(8),this.view.setBigInt64(this.pos,e),this.pos+=8}};function M8(r,e){return new F8(e).encodeSharedRef(r)}function Pf(r){return`${r<0?"-":""}0x${Math.abs(r).toString(16).padStart(2,"0")}`}const j8=16,z8=16;class H8{constructor(e=j8,t=z8){this.hit=0,this.miss=0,this.maxKeyLength=e,this.maxLengthPerKey=t,this.caches=[];for(let n=0;n<this.maxKeyLength;n++)this.caches.push([])}canBeCached(e){return e>0&&e<=this.maxKeyLength}find(e,t,n){const s=this.caches[n-1];e:for(const i of s){const o=i.bytes;for(let a=0;a<n;a++)if(o[a]!==e[t+a])continue e;return i.str}return null}store(e,t){const n=this.caches[e.length-1],s={bytes:e,str:t};n.length>=this.maxLengthPerKey?n[Math.random()*n.length|0]=s:n.push(s)}decode(e,t,n){const s=this.find(e,t,n);if(s!=null)return this.hit++,s;this.miss++;const i=Zv(e,t,n),o=Uint8Array.prototype.slice.call(e,t,t+n);return this.store(o,i),i}}const op="array",kc="map_key",rE="map_value",q8=r=>{if(typeof r=="string"||typeof r=="number")return r;throw new cr("The type of key must be string or number but "+typeof r)};class V8{constructor(){this.stack=[],this.stackHeadPosition=-1}get length(){return this.stackHeadPosition+1}top(){return this.stack[this.stackHeadPosition]}pushArrayState(e){const t=this.getUninitializedStateFromPool();t.type=op,t.position=0,t.size=e,t.array=new Array(e)}pushMapState(e){const t=this.getUninitializedStateFromPool();t.type=kc,t.readCount=0,t.size=e,t.map={}}getUninitializedStateFromPool(){if(this.stackHeadPosition++,this.stackHeadPosition===this.stack.length){const e={type:void 0,size:0,array:void 0,position:0,readCount:0,map:void 0,key:null};this.stack.push(e)}return this.stack[this.stackHeadPosition]}release(e){if(this.stack[this.stackHeadPosition]!==e)throw new Error("Invalid stack state. Released state is not on top of the stack.");if(e.type===op){const n=e;n.size=0,n.array=void 0,n.position=0,n.type=void 0}if(e.type===kc||e.type===rE){const n=e;n.size=0,n.map=void 0,n.readCount=0,n.type=void 0}this.stackHeadPosition--}reset(){this.stack.length=0,this.stackHeadPosition=-1}}const gc=-1,gg=new DataView(new ArrayBuffer(0)),K8=new Uint8Array(gg.buffer);try{gg.getInt8(0)}catch(r){if(!(r instanceof RangeError))throw new Error("This module is not supported in the current JavaScript engine because DataView does not throw RangeError on out-of-bounds access")}const z0=new RangeError("Insufficient data"),G8=new H8;let Q8=class nE{constructor(e){this.totalPos=0,this.pos=0,this.view=gg,this.bytes=K8,this.headByte=gc,this.stack=new V8,this.entered=!1,this.extensionCodec=(e==null?void 0:e.extensionCodec)??Qu.defaultCodec,this.context=e==null?void 0:e.context,this.useBigInt64=(e==null?void 0:e.useBigInt64)??!1,this.rawStrings=(e==null?void 0:e.rawStrings)??!1,this.maxStrLength=(e==null?void 0:e.maxStrLength)??pc,this.maxBinLength=(e==null?void 0:e.maxBinLength)??pc,this.maxArrayLength=(e==null?void 0:e.maxArrayLength)??pc,this.maxMapLength=(e==null?void 0:e.maxMapLength)??pc,this.maxExtLength=(e==null?void 0:e.maxExtLength)??pc,this.keyDecoder=(e==null?void 0:e.keyDecoder)!==void 0?e.keyDecoder:G8,this.mapKeyConverter=(e==null?void 0:e.mapKeyConverter)??q8}clone(){return new nE({extensionCodec:this.extensionCodec,context:this.context,useBigInt64:this.useBigInt64,rawStrings:this.rawStrings,maxStrLength:this.maxStrLength,maxBinLength:this.maxBinLength,maxArrayLength:this.maxArrayLength,maxMapLength:this.maxMapLength,maxExtLength:this.maxExtLength,keyDecoder:this.keyDecoder})}reinitializeState(){this.totalPos=0,this.headByte=gc,this.stack.reset()}setBuffer(e){const t=ip(e);this.bytes=t,this.view=new DataView(t.buffer,t.byteOffset,t.byteLength),this.pos=0}appendBuffer(e){if(this.headByte===gc&&!this.hasRemaining(1))this.setBuffer(e);else{const t=this.bytes.subarray(this.pos),n=ip(e),s=new Uint8Array(t.length+n.length);s.set(t),s.set(n,t.length),this.setBuffer(s)}}hasRemaining(e){return this.view.byteLength-this.pos>=e}createExtraByteError(e){const{view:t,pos:n}=this;return new RangeError(`Extra ${t.byteLength-n} of ${t.byteLength} byte(s) found at buffer[${e}]`)}decode(e){if(this.entered)return this.clone().decode(e);try{this.entered=!0,this.reinitializeState(),this.setBuffer(e);const t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t}finally{this.entered=!1}}*decodeMulti(e){if(this.entered){yield*this.clone().decodeMulti(e);return}try{for(this.entered=!0,this.reinitializeState(),this.setBuffer(e);this.hasRemaining(1);)yield this.doDecodeSync()}finally{this.entered=!1}}async decodeAsync(e){if(this.entered)return this.clone().decodeAsync(e);try{this.entered=!0;let t=!1,n;for await(const a of e){if(t)throw this.entered=!1,this.createExtraByteError(this.totalPos);this.appendBuffer(a);try{n=this.doDecodeSync(),t=!0}catch(c){if(!(c instanceof RangeError))throw c}this.totalPos+=this.pos}if(t){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return n}const{headByte:s,pos:i,totalPos:o}=this;throw new RangeError(`Insufficient data in parsing ${Pf(s)} at ${o} (${i} in the current buffer)`)}finally{this.entered=!1}}decodeArrayStream(e){return this.decodeMultiAsync(e,!0)}decodeStream(e){return this.decodeMultiAsync(e,!1)}async*decodeMultiAsync(e,t){if(this.entered){yield*this.clone().decodeMultiAsync(e,t);return}try{this.entered=!0;let n=t,s=-1;for await(const i of e){if(t&&s===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(i),n&&(s=this.readArraySize(),n=!1,this.complete());try{for(;yield this.doDecodeSync(),--s!==0;);}catch(o){if(!(o instanceof RangeError))throw o}this.totalPos+=this.pos}}finally{this.entered=!1}}doDecodeSync(){e:for(;;){const e=this.readHeadByte();let t;if(e>=224)t=e-256;else if(e<192)if(e<128)t=e;else if(e<144){const s=e-128;if(s!==0){this.pushMapState(s),this.complete();continue e}else t={}}else if(e<160){const s=e-144;if(s!==0){this.pushArrayState(s),this.complete();continue e}else t=[]}else{const s=e-160;t=this.decodeString(s,0)}else if(e===192)t=null;else if(e===194)t=!1;else if(e===195)t=!0;else if(e===202)t=this.readF32();else if(e===203)t=this.readF64();else if(e===204)t=this.readU8();else if(e===205)t=this.readU16();else if(e===206)t=this.readU32();else if(e===207)this.useBigInt64?t=this.readU64AsBigInt():t=this.readU64();else if(e===208)t=this.readI8();else if(e===209)t=this.readI16();else if(e===210)t=this.readI32();else if(e===211)this.useBigInt64?t=this.readI64AsBigInt():t=this.readI64();else if(e===217){const s=this.lookU8();t=this.decodeString(s,1)}else if(e===218){const s=this.lookU16();t=this.decodeString(s,2)}else if(e===219){const s=this.lookU32();t=this.decodeString(s,4)}else if(e===220){const s=this.readU16();if(s!==0){this.pushArrayState(s),this.complete();continue e}else t=[]}else if(e===221){const s=this.readU32();if(s!==0){this.pushArrayState(s),this.complete();continue e}else t=[]}else if(e===222){const s=this.readU16();if(s!==0){this.pushMapState(s),this.complete();continue e}else t={}}else if(e===223){const s=this.readU32();if(s!==0){this.pushMapState(s),this.complete();continue e}else t={}}else if(e===196){const s=this.lookU8();t=this.decodeBinary(s,1)}else if(e===197){const s=this.lookU16();t=this.decodeBinary(s,2)}else if(e===198){const s=this.lookU32();t=this.decodeBinary(s,4)}else if(e===212)t=this.decodeExtension(1,0);else if(e===213)t=this.decodeExtension(2,0);else if(e===214)t=this.decodeExtension(4,0);else if(e===215)t=this.decodeExtension(8,0);else if(e===216)t=this.decodeExtension(16,0);else if(e===199){const s=this.lookU8();t=this.decodeExtension(s,1)}else if(e===200){const s=this.lookU16();t=this.decodeExtension(s,2)}else if(e===201){const s=this.lookU32();t=this.decodeExtension(s,4)}else throw new cr(`Unrecognized type byte: ${Pf(e)}`);this.complete();const n=this.stack;for(;n.length>0;){const s=n.top();if(s.type===op)if(s.array[s.position]=t,s.position++,s.position===s.size)t=s.array,n.release(s);else continue e;else if(s.type===kc){if(t==="__proto__")throw new cr("The key __proto__ is not allowed");s.key=this.mapKeyConverter(t),s.type=rE;continue e}else if(s.map[s.key]=t,s.readCount++,s.readCount===s.size)t=s.map,n.release(s);else{s.key=null,s.type=kc;continue e}}return t}}readHeadByte(){return this.headByte===gc&&(this.headByte=this.readU8()),this.headByte}complete(){this.headByte=gc}readArraySize(){const e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new cr(`Unrecognized array type byte: ${Pf(e)}`)}}}pushMapState(e){if(e>this.maxMapLength)throw new cr(`Max length exceeded: map length (${e}) > maxMapLengthLength (${this.maxMapLength})`);this.stack.pushMapState(e)}pushArrayState(e){if(e>this.maxArrayLength)throw new cr(`Max length exceeded: array length (${e}) > maxArrayLength (${this.maxArrayLength})`);this.stack.pushArrayState(e)}decodeString(e,t){return!this.rawStrings||this.stateIsMapKey()?this.decodeUtf8String(e,t):this.decodeBinary(e,t)}decodeUtf8String(e,t){var i;if(e>this.maxStrLength)throw new cr(`Max length exceeded: UTF-8 byte length (${e}) > maxStrLength (${this.maxStrLength})`);if(this.bytes.byteLength<this.pos+t+e)throw z0;const n=this.pos+t;let s;return this.stateIsMapKey()&&((i=this.keyDecoder)!=null&&i.canBeCached(e))?s=this.keyDecoder.decode(this.bytes,n,e):s=I8(this.bytes,n,e),this.pos+=t+e,s}stateIsMapKey(){return this.stack.length>0?this.stack.top().type===kc:!1}decodeBinary(e,t){if(e>this.maxBinLength)throw new cr(`Max length exceeded: bin length (${e}) > maxBinLength (${this.maxBinLength})`);if(!this.hasRemaining(e+t))throw z0;const n=this.pos+t,s=this.bytes.subarray(n,n+e);return this.pos+=t+e,s}decodeExtension(e,t){if(e>this.maxExtLength)throw new cr(`Max length exceeded: ext length (${e}) > maxExtLength (${this.maxExtLength})`);const n=this.view.getInt8(this.pos+t),s=this.decodeBinary(e,t+1);return this.extensionCodec.decode(s,n,this.context)}lookU8(){return this.view.getUint8(this.pos)}lookU16(){return this.view.getUint16(this.pos)}lookU32(){return this.view.getUint32(this.pos)}readU8(){const e=this.view.getUint8(this.pos);return this.pos++,e}readI8(){const e=this.view.getInt8(this.pos);return this.pos++,e}readU16(){const e=this.view.getUint16(this.pos);return this.pos+=2,e}readI16(){const e=this.view.getInt16(this.pos);return this.pos+=2,e}readU32(){const e=this.view.getUint32(this.pos);return this.pos+=4,e}readI32(){const e=this.view.getInt32(this.pos);return this.pos+=4,e}readU64(){const e=P8(this.view,this.pos);return this.pos+=8,e}readI64(){const e=eE(this.view,this.pos);return this.pos+=8,e}readU64AsBigInt(){const e=this.view.getBigUint64(this.pos);return this.pos+=8,e}readI64AsBigInt(){const e=this.view.getBigInt64(this.pos);return this.pos+=8,e}readF32(){const e=this.view.getFloat32(this.pos);return this.pos+=4,e}readF64(){const e=this.view.getFloat64(this.pos);return this.pos+=8,e}};function W8(r,e){return new Q8(e).decode(r)}/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function J8(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function sE(r,e){return Array.isArray(e)?e.length===0?!0:r?e.every(t=>typeof t=="string"):e.every(t=>Number.isSafeInteger(t)):!1}function Wu(r,e){if(typeof e!="string")throw new Error(`${r}: string expected`);return!0}function yg(r){if(!Number.isSafeInteger(r))throw new Error(`invalid integer: ${r}`)}function ap(r){if(!Array.isArray(r))throw new Error("array expected")}function Ju(r,e){if(!sE(!0,e))throw new Error(`${r}: array of strings expected`)}function Y8(r,e){if(!sE(!1,e))throw new Error(`${r}: array of numbers expected`)}function Z8(...r){const e=i=>i,t=(i,o)=>a=>i(o(a)),n=r.map(i=>i.encode).reduceRight(t,e),s=r.map(i=>i.decode).reduce(t,e);return{encode:n,decode:s}}function X8(r){const e=typeof r=="string"?r.split(""):r,t=e.length;Ju("alphabet",e);const n=new Map(e.map((s,i)=>[s,i]));return{encode:s=>(ap(s),s.map(i=>{if(!Number.isSafeInteger(i)||i<0||i>=t)throw new Error(`alphabet.encode: digit index outside alphabet "${i}". Allowed: ${r}`);return e[i]})),decode:s=>(ap(s),s.map(i=>{Wu("alphabet.decode",i);const o=n.get(i);if(o===void 0)throw new Error(`Unknown letter: "${i}". Allowed: ${r}`);return o}))}}function eD(r=""){return Wu("join",r),{encode:e=>(Ju("join.decode",e),e.join(r)),decode:e=>(Wu("join.decode",e),e.split(r))}}function tD(r,e="="){return yg(r),Wu("padding",e),{encode(t){for(Ju("padding.encode",t);t.length*r%8;)t.push(e);return t},decode(t){Ju("padding.decode",t);let n=t.length;if(n*r%8)throw new Error("padding: invalid, string should have whole number of bytes");for(;n>0&&t[n-1]===e;n--)if((n-1)*r%8===0)throw new Error("padding: invalid, string has too much padding");return t.slice(0,n)}}}const iE=(r,e)=>e===0?r:iE(e,r%e),Yu=(r,e)=>r+(e-iE(r,e)),Of=(()=>{let r=[];for(let e=0;e<40;e++)r.push(2**e);return r})();function H0(r,e,t,n){if(ap(r),e<=0||e>32)throw new Error(`convertRadix2: wrong from=${e}`);if(t<=0||t>32)throw new Error(`convertRadix2: wrong to=${t}`);if(Yu(e,t)>32)throw new Error(`convertRadix2: carry overflow from=${e} to=${t} carryBits=${Yu(e,t)}`);let s=0,i=0;const o=Of[e],a=Of[t]-1,c=[];for(const l of r){if(yg(l),l>=o)throw new Error(`convertRadix2: invalid data word=${l} from=${e}`);if(s=s<<e|l,i+e>32)throw new Error(`convertRadix2: carry overflow pos=${i} from=${e}`);for(i+=e;i>=t;i-=t)c.push((s>>i-t&a)>>>0);const u=Of[i];if(u===void 0)throw new Error("invalid carry");s&=u-1}if(s=s<<t-i&a,!n&&i>=e)throw new Error("Excess padding");if(!n&&s>0)throw new Error(`Non-zero padding: ${s}`);return n&&i>0&&c.push(s>>>0),c}function rD(r,e=!1){if(yg(r),r<=0||r>32)throw new Error("radix2: bits should be in (0..32]");if(Yu(8,r)>32||Yu(r,8)>32)throw new Error("radix2: carry overflow");return{encode:t=>{if(!J8(t))throw new Error("radix2.encode input should be Uint8Array");return H0(Array.from(t),8,r,!e)},decode:t=>(Y8("radix2.decode",t),Uint8Array.from(H0(t,r,8,e)))}}const nD=Z8(rD(5),X8("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),tD(5),eD("")),sD=r=>JSON.stringify(r,(e,t)=>typeof t=="bigint"?t.toString()+"n":t),iD=r=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,t=r.replace(e,'$1"$2n"$3');return JSON.parse(t,(n,s)=>typeof s=="string"&&s.match(/^\d+n$/)?BigInt(s.substring(0,s.length-1)):s)};function oo(r){if(typeof r!="string")throw new Error(`Cannot safe json parse value of type ${typeof r}`);try{return iD(r)}catch{return r}}function us(r){return typeof r=="string"?r:sD(r)||""}function oD(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function oE(r,...e){if(!oD(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function q0(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function aD(r,e){oE(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}const So=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Df=r=>new DataView(r.buffer,r.byteOffset,r.byteLength);function cD(r){if(typeof r!="string")throw new Error("utf8ToBytes expected string, got "+typeof r);return new Uint8Array(new TextEncoder().encode(r))}function aE(r){return typeof r=="string"&&(r=cD(r)),oE(r),r}let lD=class{clone(){return this._cloneInto()}};function uD(r){const e=n=>r().update(aE(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function cE(r=32){if(So&&typeof So.getRandomValues=="function")return So.getRandomValues(new Uint8Array(r));if(So&&typeof So.randomBytes=="function")return So.randomBytes(r);throw new Error("crypto.getRandomValues must be defined")}function hD(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(t>>s&i),a=Number(t&i),c=n?4:0,l=n?0:4;r.setUint32(e+c,o,n),r.setUint32(e+l,a,n)}let fD=class extends lD{constructor(e,t,n,s){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=s,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=Df(this.buffer)}update(e){q0(this);const{view:t,buffer:n,blockLen:s}=this;e=aE(e);const i=e.length;for(let o=0;o<i;){const a=Math.min(s-this.pos,i-o);if(a===s){const c=Df(e);for(;s<=i-o;o+=s)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){q0(this),aD(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:s,isLE:i}=this;let{pos:o}=this;t[o++]=128,this.buffer.subarray(o).fill(0),this.padOffset>s-o&&(this.process(n,0),o=0);for(let h=o;h<s;h++)t[h]=0;hD(n,s-8,BigInt(this.length*8),i),this.process(n,0);const a=Df(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return e.length=s,e.pos=a,e.finished=i,e.destroyed=o,s%t&&e.buffer.set(n),e}};const Yl=BigInt(2**32-1),cp=BigInt(32);function lE(r,e=!1){return e?{h:Number(r&Yl),l:Number(r>>cp&Yl)}:{h:Number(r>>cp&Yl)|0,l:Number(r&Yl)|0}}function dD(r,e=!1){let t=new Uint32Array(r.length),n=new Uint32Array(r.length);for(let s=0;s<r.length;s++){const{h:i,l:o}=lE(r[s],e);[t[s],n[s]]=[i,o]}return[t,n]}const pD=(r,e)=>BigInt(r>>>0)<<cp|BigInt(e>>>0),gD=(r,e,t)=>r>>>t,yD=(r,e,t)=>r<<32-t|e>>>t,mD=(r,e,t)=>r>>>t|e<<32-t,wD=(r,e,t)=>r<<32-t|e>>>t,bD=(r,e,t)=>r<<64-t|e>>>t-32,vD=(r,e,t)=>r>>>t-32|e<<64-t,ED=(r,e)=>e,AD=(r,e)=>r,xD=(r,e,t)=>r<<t|e>>>32-t,ID=(r,e,t)=>e<<t|r>>>32-t,SD=(r,e,t)=>e<<t-32|r>>>64-t,PD=(r,e,t)=>r<<t-32|e>>>64-t;function OD(r,e,t,n){const s=(e>>>0)+(n>>>0);return{h:r+t+(s/2**32|0)|0,l:s|0}}const DD=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),CD=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,BD=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),_D=(r,e,t,n,s)=>e+t+n+s+(r/2**32|0)|0,TD=(r,e,t,n,s)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(s>>>0),ND=(r,e,t,n,s,i)=>e+t+n+s+i+(r/2**32|0)|0,ce={fromBig:lE,split:dD,toBig:pD,shrSH:gD,shrSL:yD,rotrSH:mD,rotrSL:wD,rotrBH:bD,rotrBL:vD,rotr32H:ED,rotr32L:AD,rotlSH:xD,rotlSL:ID,rotlBH:SD,rotlBL:PD,add:OD,add3L:DD,add3H:CD,add4L:BD,add4H:_D,add5H:ND,add5L:TD},[RD,UD]=ce.split(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),ms=new Uint32Array(80),ws=new Uint32Array(80);let kD=class extends fD{constructor(){super(128,64,16,!1),this.Ah=1779033703,this.Al=-205731576,this.Bh=-1150833019,this.Bl=-2067093701,this.Ch=1013904242,this.Cl=-23791573,this.Dh=-1521486534,this.Dl=1595750129,this.Eh=1359893119,this.El=-1377402159,this.Fh=-1694144372,this.Fl=725511199,this.Gh=528734635,this.Gl=-79577749,this.Hh=1541459225,this.Hl=327033209}get(){const{Ah:e,Al:t,Bh:n,Bl:s,Ch:i,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:f,Gh:d,Gl:p,Hh:g,Hl:m}=this;return[e,t,n,s,i,o,a,c,l,u,h,f,d,p,g,m]}set(e,t,n,s,i,o,a,c,l,u,h,f,d,p,g,m){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=f|0,this.Gh=d|0,this.Gl=p|0,this.Hh=g|0,this.Hl=m|0}process(e,t){for(let v=0;v<16;v++,t+=4)ms[v]=e.getUint32(t),ws[v]=e.getUint32(t+=4);for(let v=16;v<80;v++){const I=ms[v-15]|0,S=ws[v-15]|0,E=ce.rotrSH(I,S,1)^ce.rotrSH(I,S,8)^ce.shrSH(I,S,7),P=ce.rotrSL(I,S,1)^ce.rotrSL(I,S,8)^ce.shrSL(I,S,7),D=ms[v-2]|0,B=ws[v-2]|0,L=ce.rotrSH(D,B,19)^ce.rotrBH(D,B,61)^ce.shrSH(D,B,6),j=ce.rotrSL(D,B,19)^ce.rotrBL(D,B,61)^ce.shrSL(D,B,6),$=ce.add4L(P,j,ws[v-7],ws[v-16]),U=ce.add4H($,E,L,ms[v-7],ms[v-16]);ms[v]=U|0,ws[v]=$|0}let{Ah:n,Al:s,Bh:i,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:f,Fh:d,Fl:p,Gh:g,Gl:m,Hh:b,Hl:x}=this;for(let v=0;v<80;v++){const I=ce.rotrSH(h,f,14)^ce.rotrSH(h,f,18)^ce.rotrBH(h,f,41),S=ce.rotrSL(h,f,14)^ce.rotrSL(h,f,18)^ce.rotrBL(h,f,41),E=h&d^~h&g,P=f&p^~f&m,D=ce.add5L(x,S,P,UD[v],ws[v]),B=ce.add5H(D,b,I,E,RD[v],ms[v]),L=D|0,j=ce.rotrSH(n,s,28)^ce.rotrBH(n,s,34)^ce.rotrBH(n,s,39),$=ce.rotrSL(n,s,28)^ce.rotrBL(n,s,34)^ce.rotrBL(n,s,39),U=n&i^n&a^i&a,T=s&o^s&c^o&c;b=g|0,x=m|0,g=d|0,m=p|0,d=h|0,p=f|0,{h,l:f}=ce.add(l|0,u|0,B|0,L|0),l=a|0,u=c|0,a=i|0,c=o|0,i=n|0,o=s|0;const w=ce.add3L(L,$,T);n=ce.add3H(w,B,j,U),s=w|0}({h:n,l:s}=ce.add(this.Ah|0,this.Al|0,n|0,s|0)),{h:i,l:o}=ce.add(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=ce.add(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=ce.add(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:f}=ce.add(this.Eh|0,this.El|0,h|0,f|0),{h:d,l:p}=ce.add(this.Fh|0,this.Fl|0,d|0,p|0),{h:g,l:m}=ce.add(this.Gh|0,this.Gl|0,g|0,m|0),{h:b,l:x}=ce.add(this.Hh|0,this.Hl|0,b|0,x|0),this.set(n,s,i,o,a,c,l,u,h,f,d,p,g,m,b,x)}roundClean(){ms.fill(0),ws.fill(0)}destroy(){this.buffer.fill(0),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};const $D=uD(()=>new kD);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const mg=BigInt(0),uE=BigInt(1),LD=BigInt(2);function wg(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function bg(r){if(!wg(r))throw new Error("Uint8Array expected")}function Cf(r,e){if(typeof e!="boolean")throw new Error(r+" boolean expected, got "+e)}const FD=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function vg(r){bg(r);let e="";for(let t=0;t<r.length;t++)e+=FD[r[t]];return e}function hE(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?mg:BigInt("0x"+r)}const Bn={_0:48,_9:57,A:65,F:70,a:97,f:102};function V0(r){if(r>=Bn._0&&r<=Bn._9)return r-Bn._0;if(r>=Bn.A&&r<=Bn.F)return r-(Bn.A-10);if(r>=Bn.a&&r<=Bn.f)return r-(Bn.a-10)}function fE(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);const e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(t);for(let s=0,i=0;s<t;s++,i+=2){const o=V0(r.charCodeAt(i)),a=V0(r.charCodeAt(i+1));if(o===void 0||a===void 0){const c=r[i]+r[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[s]=o*16+a}return n}function MD(r){return hE(vg(r))}function Iu(r){return bg(r),hE(vg(Uint8Array.from(r).reverse()))}function dE(r,e){return fE(r.toString(16).padStart(e*2,"0"))}function lp(r,e){return dE(r,e).reverse()}function _n(r,e,t){let n;if(typeof e=="string")try{n=fE(e)}catch(i){throw new Error(r+" must be hex string or Uint8Array, cause: "+i)}else if(wg(e))n=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");const s=n.length;if(typeof t=="number"&&s!==t)throw new Error(r+" of length "+t+" expected, got "+s);return n}function K0(...r){let e=0;for(let n=0;n<r.length;n++){const s=r[n];bg(s),e+=s.length}const t=new Uint8Array(e);for(let n=0,s=0;n<r.length;n++){const i=r[n];t.set(i,s),s+=i.length}return t}const Bf=r=>typeof r=="bigint"&&mg<=r;function jD(r,e,t){return Bf(r)&&Bf(e)&&Bf(t)&&e<=r&&r<t}function yc(r,e,t,n){if(!jD(e,t,n))throw new Error("expected valid "+r+": "+t+" <= n < "+n+", got "+e)}function zD(r){let e;for(e=0;r>mg;r>>=uE,e+=1);return e}const HD=r=>(LD<<BigInt(r-1))-uE,qD={bigint:r=>typeof r=="bigint",function:r=>typeof r=="function",boolean:r=>typeof r=="boolean",string:r=>typeof r=="string",stringOrUint8Array:r=>typeof r=="string"||wg(r),isSafeInteger:r=>Number.isSafeInteger(r),array:r=>Array.isArray(r),field:(r,e)=>e.Fp.isValid(r),hash:r=>typeof r=="function"&&Number.isSafeInteger(r.outputLen)};function Eg(r,e,t={}){const n=(s,i,o)=>{const a=qD[i];if(typeof a!="function")throw new Error("invalid validator function");const c=r[s];if(!(o&&c===void 0)&&!a(c,r))throw new Error("param "+String(s)+" is invalid. Expected "+i+", got "+c)};for(const[s,i]of Object.entries(e))n(s,i,!1);for(const[s,i]of Object.entries(t))n(s,i,!0);return r}function G0(r){const e=new WeakMap;return(t,...n)=>{const s=e.get(t);if(s!==void 0)return s;const i=r(t,...n);return e.set(t,i),i}}const st=BigInt(0),He=BigInt(1),bi=BigInt(2),VD=BigInt(3),up=BigInt(4),Q0=BigInt(5),W0=BigInt(8);function Je(r,e){const t=r%e;return t>=st?t:e+t}function KD(r,e,t){if(e<st)throw new Error("invalid exponent, negatives unsupported");if(t<=st)throw new Error("invalid modulus");if(t===He)return st;let n=He;for(;e>st;)e&He&&(n=n*r%t),r=r*r%t,e>>=He;return n}function Xr(r,e,t){let n=r;for(;e-- >st;)n*=n,n%=t;return n}function J0(r,e){if(r===st)throw new Error("invert: expected non-zero number");if(e<=st)throw new Error("invert: expected positive modulus, got "+e);let t=Je(r,e),n=e,s=st,i=He;for(;t!==st;){const o=n/t,a=n%t,c=s-i*o;n=t,t=a,s=i,i=c}if(n!==He)throw new Error("invert: does not exist");return Je(s,e)}function GD(r){const e=(r-He)/bi;let t,n,s;for(t=r-He,n=0;t%bi===st;t/=bi,n++);for(s=bi;s<r&&KD(s,e,r)!==r-He;s++)if(s>1e3)throw new Error("Cannot find square root: likely non-prime P");if(n===1){const o=(r+He)/up;return function(a,c){const l=a.pow(c,o);if(!a.eql(a.sqr(l),c))throw new Error("Cannot find square root");return l}}const i=(t+He)/bi;return function(o,a){if(o.pow(a,e)===o.neg(o.ONE))throw new Error("Cannot find square root");let c=n,l=o.pow(o.mul(o.ONE,s),t),u=o.pow(a,i),h=o.pow(a,t);for(;!o.eql(h,o.ONE);){if(o.eql(h,o.ZERO))return o.ZERO;let f=1;for(let p=o.sqr(h);f<c&&!o.eql(p,o.ONE);f++)p=o.sqr(p);const d=o.pow(l,He<<BigInt(c-f-1));l=o.sqr(d),u=o.mul(u,d),h=o.mul(h,l),c=f}return u}}function QD(r){if(r%up===VD){const e=(r+He)/up;return function(t,n){const s=t.pow(n,e);if(!t.eql(t.sqr(s),n))throw new Error("Cannot find square root");return s}}if(r%W0===Q0){const e=(r-Q0)/W0;return function(t,n){const s=t.mul(n,bi),i=t.pow(s,e),o=t.mul(n,i),a=t.mul(t.mul(o,bi),i),c=t.mul(o,t.sub(a,t.ONE));if(!t.eql(t.sqr(c),n))throw new Error("Cannot find square root");return c}}return GD(r)}const WD=(r,e)=>(Je(r,e)&He)===He,JD=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function YD(r){const e={ORDER:"bigint",MASK:"bigint",BYTES:"isSafeInteger",BITS:"isSafeInteger"},t=JD.reduce((n,s)=>(n[s]="function",n),e);return Eg(r,t)}function ZD(r,e,t){if(t<st)throw new Error("invalid exponent, negatives unsupported");if(t===st)return r.ONE;if(t===He)return e;let n=r.ONE,s=e;for(;t>st;)t&He&&(n=r.mul(n,s)),s=r.sqr(s),t>>=He;return n}function XD(r,e){const t=new Array(e.length),n=e.reduce((i,o,a)=>r.is0(o)?i:(t[a]=i,r.mul(i,o)),r.ONE),s=r.inv(n);return e.reduceRight((i,o,a)=>r.is0(o)?i:(t[a]=r.mul(i,t[a]),r.mul(i,o)),s),t}function pE(r,e){const t=e!==void 0?e:r.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}function gE(r,e,t=!1,n={}){if(r<=st)throw new Error("invalid field: expected ORDER > 0, got "+r);const{nBitLength:s,nByteLength:i}=pE(r,e);if(i>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let o;const a=Object.freeze({ORDER:r,isLE:t,BITS:s,BYTES:i,MASK:HD(s),ZERO:st,ONE:He,create:c=>Je(c,r),isValid:c=>{if(typeof c!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof c);return st<=c&&c<r},is0:c=>c===st,isOdd:c=>(c&He)===He,neg:c=>Je(-c,r),eql:(c,l)=>c===l,sqr:c=>Je(c*c,r),add:(c,l)=>Je(c+l,r),sub:(c,l)=>Je(c-l,r),mul:(c,l)=>Je(c*l,r),pow:(c,l)=>ZD(a,c,l),div:(c,l)=>Je(c*J0(l,r),r),sqrN:c=>c*c,addN:(c,l)=>c+l,subN:(c,l)=>c-l,mulN:(c,l)=>c*l,inv:c=>J0(c,r),sqrt:n.sqrt||(c=>(o||(o=QD(r)),o(a,c))),invertBatch:c=>XD(a,c),cmov:(c,l,u)=>u?l:c,toBytes:c=>t?lp(c,i):dE(c,i),fromBytes:c=>{if(c.length!==i)throw new Error("Field.fromBytes: expected "+i+" bytes, got "+c.length);return t?Iu(c):MD(c)}});return Object.freeze(a)}const Y0=BigInt(0),Zl=BigInt(1);function _f(r,e){const t=e.negate();return r?t:e}function yE(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function Tf(r,e){yE(r,e);const t=Math.ceil(e/r)+1,n=2**(r-1);return{windows:t,windowSize:n}}function eC(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,n)=>{if(!(t instanceof e))throw new Error("invalid point at index "+n)})}function tC(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,n)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+n)})}const Nf=new WeakMap,mE=new WeakMap;function Rf(r){return mE.get(r)||1}function rC(r,e){return{constTimeNegate:_f,hasPrecomputes(t){return Rf(t)!==1},unsafeLadder(t,n,s=r.ZERO){let i=t;for(;n>Y0;)n&Zl&&(s=s.add(i)),i=i.double(),n>>=Zl;return s},precomputeWindow(t,n){const{windows:s,windowSize:i}=Tf(n,e),o=[];let a=t,c=a;for(let l=0;l<s;l++){c=a,o.push(c);for(let u=1;u<i;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(t,n,s){const{windows:i,windowSize:o}=Tf(t,e);let a=r.ZERO,c=r.BASE;const l=BigInt(2**t-1),u=2**t,h=BigInt(t);for(let f=0;f<i;f++){const d=f*o;let p=Number(s&l);s>>=h,p>o&&(p-=u,s+=Zl);const g=d,m=d+Math.abs(p)-1,b=f%2!==0,x=p<0;p===0?c=c.add(_f(b,n[g])):a=a.add(_f(x,n[m]))}return{p:a,f:c}},wNAFUnsafe(t,n,s,i=r.ZERO){const{windows:o,windowSize:a}=Tf(t,e),c=BigInt(2**t-1),l=2**t,u=BigInt(t);for(let h=0;h<o;h++){const f=h*a;if(s===Y0)break;let d=Number(s&c);if(s>>=u,d>a&&(d-=l,s+=Zl),d===0)continue;let p=n[f+Math.abs(d)-1];d<0&&(p=p.negate()),i=i.add(p)}return i},getPrecomputes(t,n,s){let i=Nf.get(n);return i||(i=this.precomputeWindow(n,t),t!==1&&Nf.set(n,s(i))),i},wNAFCached(t,n,s){const i=Rf(t);return this.wNAF(i,this.getPrecomputes(i,t,s),n)},wNAFCachedUnsafe(t,n,s,i){const o=Rf(t);return o===1?this.unsafeLadder(t,n,i):this.wNAFUnsafe(o,this.getPrecomputes(o,t,s),n,i)},setWindowSize(t,n){yE(n,e),mE.set(t,n),Nf.delete(t)}}}function nC(r,e,t,n){if(eC(t,r),tC(n,e),t.length!==n.length)throw new Error("arrays of points and scalars must have equal length");const s=r.ZERO,i=zD(BigInt(t.length)),o=i>12?i-3:i>4?i-2:i?2:1,a=(1<<o)-1,c=new Array(a+1).fill(s),l=Math.floor((e.BITS-1)/o)*o;let u=s;for(let h=l;h>=0;h-=o){c.fill(s);for(let d=0;d<n.length;d++){const p=n[d],g=Number(p>>BigInt(h)&BigInt(a));c[g]=c[g].add(t[d])}let f=s;for(let d=c.length-1,p=s;d>0;d--)p=p.add(c[d]),f=f.add(p);if(u=u.add(f),h!==0)for(let d=0;d<o;d++)u=u.double()}return u}function sC(r){return YD(r.Fp),Eg(r,{n:"bigint",h:"bigint",Gx:"field",Gy:"field"},{nBitLength:"isSafeInteger",nByteLength:"isSafeInteger"}),Object.freeze({...pE(r.n,r.nBitLength),...r,p:r.Fp.ORDER})}const Br=BigInt(0),Lt=BigInt(1),Xl=BigInt(2),iC=BigInt(8),oC={zip215:!0};function aC(r){const e=sC(r);return Eg(r,{hash:"function",a:"bigint",d:"bigint",randomBytes:"function"},{adjustScalarBytes:"function",domain:"function",uvRatio:"function",mapToCurve:"function"}),Object.freeze({...e})}function cC(r){const e=aC(r),{Fp:t,n,prehash:s,hash:i,randomBytes:o,nByteLength:a,h:c}=e,l=Xl<<BigInt(a*8)-Lt,u=t.create,h=gE(e.n,e.nBitLength),f=e.uvRatio||((w,A)=>{try{return{isValid:!0,value:t.sqrt(w*t.inv(A))}}catch{return{isValid:!1,value:Br}}}),d=e.adjustScalarBytes||(w=>w),p=e.domain||((w,A,C)=>{if(Cf("phflag",C),A.length||C)throw new Error("Contexts/pre-hash are not supported");return w});function g(w,A){yc("coordinate "+w,A,Br,l)}function m(w){if(!(w instanceof v))throw new Error("ExtendedPoint expected")}const b=G0((w,A)=>{const{ex:C,ey:k,ez:_}=w,N=w.is0();A==null&&(A=N?iC:t.inv(_));const z=u(C*A),H=u(k*A),Y=u(_*A);if(N)return{x:Br,y:Lt};if(Y!==Lt)throw new Error("invZ was invalid");return{x:z,y:H}}),x=G0(w=>{const{a:A,d:C}=e;if(w.is0())throw new Error("bad point: ZERO");const{ex:k,ey:_,ez:N,et:z}=w,H=u(k*k),Y=u(_*_),G=u(N*N),Q=u(G*G),ee=u(H*A),se=u(G*u(ee+Y)),le=u(Q+u(C*u(H*Y)));if(se!==le)throw new Error("bad point: equation left != right (1)");const ne=u(k*_),fe=u(N*z);if(ne!==fe)throw new Error("bad point: equation left != right (2)");return!0});class v{constructor(A,C,k,_){this.ex=A,this.ey=C,this.ez=k,this.et=_,g("x",A),g("y",C),g("z",k),g("t",_),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(A){if(A instanceof v)throw new Error("extended point not allowed");const{x:C,y:k}=A||{};return g("x",C),g("y",k),new v(C,k,Lt,u(C*k))}static normalizeZ(A){const C=t.invertBatch(A.map(k=>k.ez));return A.map((k,_)=>k.toAffine(C[_])).map(v.fromAffine)}static msm(A,C){return nC(v,h,A,C)}_setWindowSize(A){E.setWindowSize(this,A)}assertValidity(){x(this)}equals(A){m(A);const{ex:C,ey:k,ez:_}=this,{ex:N,ey:z,ez:H}=A,Y=u(C*H),G=u(N*_),Q=u(k*H),ee=u(z*_);return Y===G&&Q===ee}is0(){return this.equals(v.ZERO)}negate(){return new v(u(-this.ex),this.ey,this.ez,u(-this.et))}double(){const{a:A}=e,{ex:C,ey:k,ez:_}=this,N=u(C*C),z=u(k*k),H=u(Xl*u(_*_)),Y=u(A*N),G=C+k,Q=u(u(G*G)-N-z),ee=Y+z,se=ee-H,le=Y-z,ne=u(Q*se),fe=u(ee*le),ke=u(Q*le),qe=u(se*ee);return new v(ne,fe,qe,ke)}add(A){m(A);const{a:C,d:k}=e,{ex:_,ey:N,ez:z,et:H}=this,{ex:Y,ey:G,ez:Q,et:ee}=A;if(C===BigInt(-1)){const Jg=u((N-_)*(G+Y)),Yg=u((N+_)*(G-Y)),Zh=u(Yg-Jg);if(Zh===Br)return this.double();const Zg=u(z*Xl*ee),Xg=u(H*Xl*Q),ey=Xg+Zg,ty=Yg+Jg,ry=Xg-Zg,FA=u(ey*Zh),MA=u(ty*ry),jA=u(ey*ry),zA=u(Zh*ty);return new v(FA,MA,zA,jA)}const se=u(_*Y),le=u(N*G),ne=u(H*k*ee),fe=u(z*Q),ke=u((_+N)*(Y+G)-se-le),qe=fe-ne,$e=fe+ne,mt=u(le-C*se),bo=u(ke*qe),Ll=u($e*mt),$A=u(ke*mt),LA=u(qe*$e);return new v(bo,Ll,LA,$A)}subtract(A){return this.add(A.negate())}wNAF(A){return E.wNAFCached(this,A,v.normalizeZ)}multiply(A){const C=A;yc("scalar",C,Lt,n);const{p:k,f:_}=this.wNAF(C);return v.normalizeZ([k,_])[0]}multiplyUnsafe(A,C=v.ZERO){const k=A;return yc("scalar",k,Br,n),k===Br?S:this.is0()||k===Lt?this:E.wNAFCachedUnsafe(this,k,v.normalizeZ,C)}isSmallOrder(){return this.multiplyUnsafe(c).is0()}isTorsionFree(){return E.unsafeLadder(this,n).is0()}toAffine(A){return b(this,A)}clearCofactor(){const{h:A}=e;return A===Lt?this:this.multiplyUnsafe(A)}static fromHex(A,C=!1){const{d:k,a:_}=e,N=t.BYTES;A=_n("pointHex",A,N),Cf("zip215",C);const z=A.slice(),H=A[N-1];z[N-1]=H&-129;const Y=Iu(z),G=C?l:t.ORDER;yc("pointHex.y",Y,Br,G);const Q=u(Y*Y),ee=u(Q-Lt),se=u(k*Q-_);let{isValid:le,value:ne}=f(ee,se);if(!le)throw new Error("Point.fromHex: invalid y coordinate");const fe=(ne&Lt)===Lt,ke=(H&128)!==0;if(!C&&ne===Br&&ke)throw new Error("Point.fromHex: x=0 and x_0=1");return ke!==fe&&(ne=u(-ne)),v.fromAffine({x:ne,y:Y})}static fromPrivateKey(A){return B(A).point}toRawBytes(){const{x:A,y:C}=this.toAffine(),k=lp(C,t.BYTES);return k[k.length-1]|=A&Lt?128:0,k}toHex(){return vg(this.toRawBytes())}}v.BASE=new v(e.Gx,e.Gy,Lt,u(e.Gx*e.Gy)),v.ZERO=new v(Br,Lt,Lt,Br);const{BASE:I,ZERO:S}=v,E=rC(v,a*8);function P(w){return Je(w,n)}function D(w){return P(Iu(w))}function B(w){const A=t.BYTES;w=_n("private key",w,A);const C=_n("hashed private key",i(w),2*A),k=d(C.slice(0,A)),_=C.slice(A,2*A),N=D(k),z=I.multiply(N),H=z.toRawBytes();return{head:k,prefix:_,scalar:N,point:z,pointBytes:H}}function L(w){return B(w).pointBytes}function j(w=new Uint8Array,...A){const C=K0(...A);return D(i(p(C,_n("context",w),!!s)))}function $(w,A,C={}){w=_n("message",w),s&&(w=s(w));const{prefix:k,scalar:_,pointBytes:N}=B(A),z=j(C.context,k,w),H=I.multiply(z).toRawBytes(),Y=j(C.context,H,N,w),G=P(z+Y*_);yc("signature.s",G,Br,n);const Q=K0(H,lp(G,t.BYTES));return _n("result",Q,t.BYTES*2)}const U=oC;function T(w,A,C,k=U){const{context:_,zip215:N}=k,z=t.BYTES;w=_n("signature",w,2*z),A=_n("message",A),C=_n("publicKey",C,z),N!==void 0&&Cf("zip215",N),s&&(A=s(A));const H=Iu(w.slice(z,2*z));let Y,G,Q;try{Y=v.fromHex(C,N),G=v.fromHex(w.slice(0,z),N),Q=I.multiplyUnsafe(H)}catch{return!1}if(!N&&Y.isSmallOrder())return!1;const ee=j(_,G.toRawBytes(),Y.toRawBytes(),A);return G.add(Y.multiplyUnsafe(ee)).subtract(Q).clearCofactor().equals(v.ZERO)}return I._setWindowSize(8),{CURVE:e,getPublicKey:L,sign:$,verify:T,ExtendedPoint:v,utils:{getExtendedPublicKey:B,randomPrivateKey:()=>o(t.BYTES),precompute(w=8,A=v.BASE){return A._setWindowSize(w),A.multiply(BigInt(3)),A}}}}BigInt(0),BigInt(1);const Ag=BigInt("57896044618658097711785492504343953926634992332820282019728792003956564819949"),Z0=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");BigInt(0);const lC=BigInt(1),X0=BigInt(2);BigInt(3);const uC=BigInt(5),hC=BigInt(8);function fC(r){const e=BigInt(10),t=BigInt(20),n=BigInt(40),s=BigInt(80),i=Ag,o=r*r%i*r%i,a=Xr(o,X0,i)*o%i,c=Xr(a,lC,i)*r%i,l=Xr(c,uC,i)*c%i,u=Xr(l,e,i)*l%i,h=Xr(u,t,i)*u%i,f=Xr(h,n,i)*h%i,d=Xr(f,s,i)*f%i,p=Xr(d,s,i)*f%i,g=Xr(p,e,i)*l%i;return{pow_p_5_8:Xr(g,X0,i)*r%i,b2:o}}function dC(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}function pC(r,e){const t=Ag,n=Je(e*e*e,t),s=Je(n*n*e,t),i=fC(r*s).pow_p_5_8;let o=Je(r*n*i,t);const a=Je(e*o*o,t),c=o,l=Je(o*Z0,t),u=a===r,h=a===Je(-r,t),f=a===Je(-r*Z0,t);return u&&(o=c),(h||f)&&(o=l),WD(o,t)&&(o=Je(-o,t)),{isValid:u||h,value:o}}const gC=gE(Ag,void 0,!0),yC={a:BigInt(-1),d:BigInt("37095705934669439343138083508754565189542113879843219016388785533085940283555"),Fp:gC,n:BigInt("7237005577332262213973186563042994240857116359379907606001950938285454250989"),h:hC,Gx:BigInt("15112221349535400772501151409588531511454012693041857206046113283949847762202"),Gy:BigInt("46316835694926478169428394003475163141307993866256225615783033603165251855960"),hash:$D,randomBytes:cE,adjustScalarBytes:dC,uvRatio:pC},wE=cC(yC),mC="EdDSA",wC="JWT",Zu=".",Rh="base64url",bE="utf8",vE="utf8",bC=":",vC="did",EC="key",em="base58btc",AC="z",xC="K36",IC=32;function xg(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function EE(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?xg(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function AE(r,e){e||(e=r.reduce((s,i)=>s+i.length,0));const t=EE(e);let n=0;for(const s of r)t.set(s,n),n+=s.length;return xg(t)}function SC(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,m=0,b=0,x=p.length;b!==x&&p[b]===0;)b++,g++;for(var v=(x-b)*u+1>>>0,I=new Uint8Array(v);b!==x;){for(var S=p[b],E=0,P=v-1;(S!==0||E<m)&&P!==-1;P--,E++)S+=256*I[P]>>>0,I[P]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");m=E,b++}for(var D=v-m;D!==v&&I[D]===0;)D++;for(var B=c.repeat(g);D<v;++D)B+=r.charAt(I[D]);return B}function f(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var m=0,b=0;p[g]===c;)m++,g++;for(var x=(p.length-g)*l+1>>>0,v=new Uint8Array(x);p[g];){var I=t[p.charCodeAt(g)];if(I===255)return;for(var S=0,E=x-1;(I!==0||S<b)&&E!==-1;E--,S++)I+=a*v[E]>>>0,v[E]=I%256>>>0,I=I/256>>>0;if(I!==0)throw new Error("Non-zero carry");b=S,g++}if(p[g]!==" "){for(var P=x-b;P!==x&&v[P]===0;)P++;for(var D=new Uint8Array(m+(x-P)),B=m;P!==x;)D[B++]=v[P++];return D}}}function d(p){var g=f(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:d}}var PC=SC,OC=PC;const xE=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},DC=r=>new TextEncoder().encode(r),CC=r=>new TextDecoder().decode(r);let BC=class{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}},_C=class{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return IE(this,e)}},TC=class{constructor(e){this.decoders=e}or(e){return IE(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}};const IE=(r,e)=>new TC({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});let NC=class{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new BC(e,t,n),this.decoder=new _C(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}};const Uh=({name:r,prefix:e,encode:t,decode:n})=>new NC(r,e,t,n),Ol=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=OC(t,e);return Uh({prefix:r,name:e,encode:n,decode:i=>xE(s(i))})},RC=(r,e,t,n)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const h=s[r[u]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},UC=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},pt=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>Uh({prefix:e,name:r,encode(s){return UC(s,n,t)},decode(s){return RC(s,n,t,r)}}),kC=Uh({prefix:"\0",name:"identity",encode:r=>CC(r),decode:r=>DC(r)});var $C=Object.freeze({__proto__:null,identity:kC});const LC=pt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var FC=Object.freeze({__proto__:null,base2:LC});const MC=pt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var jC=Object.freeze({__proto__:null,base8:MC});const zC=Ol({prefix:"9",name:"base10",alphabet:"0123456789"});var HC=Object.freeze({__proto__:null,base10:zC});const qC=pt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),VC=pt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var KC=Object.freeze({__proto__:null,base16:qC,base16upper:VC});const GC=pt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),QC=pt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),WC=pt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),JC=pt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),YC=pt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ZC=pt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),XC=pt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),eB=pt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),tB=pt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var rB=Object.freeze({__proto__:null,base32:GC,base32upper:QC,base32pad:WC,base32padupper:JC,base32hex:YC,base32hexupper:ZC,base32hexpad:XC,base32hexpadupper:eB,base32z:tB});const nB=Ol({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),sB=Ol({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var iB=Object.freeze({__proto__:null,base36:nB,base36upper:sB});const oB=Ol({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),aB=Ol({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var cB=Object.freeze({__proto__:null,base58btc:oB,base58flickr:aB});const lB=pt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),uB=pt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),hB=pt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),fB=pt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var dB=Object.freeze({__proto__:null,base64:lB,base64pad:uB,base64url:hB,base64urlpad:fB});const SE=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),pB=SE.reduce((r,e,t)=>(r[t]=e,r),[]),gB=SE.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function yB(r){return r.reduce((e,t)=>(e+=pB[t],e),"")}function mB(r){const e=[];for(const t of r){const n=gB[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const wB=Uh({prefix:"🚀",name:"base256emoji",encode:yB,decode:mB});var bB=Object.freeze({__proto__:null,base256emoji:wB}),vB=PE,tm=128,EB=-128,AB=Math.pow(2,31);function PE(r,e,t){e=e||[],t=t||0;for(var n=t;r>=AB;)e[t++]=r&255|tm,r/=128;for(;r&EB;)e[t++]=r&255|tm,r>>>=7;return e[t]=r|0,PE.bytes=t-n+1,e}var xB=hp,IB=128,rm=127;function hp(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw hp.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&rm)<<s:(o&rm)*Math.pow(2,s),s+=7}while(o>=IB);return hp.bytes=i-n,t}var SB=Math.pow(2,7),PB=Math.pow(2,14),OB=Math.pow(2,21),DB=Math.pow(2,28),CB=Math.pow(2,35),BB=Math.pow(2,42),_B=Math.pow(2,49),TB=Math.pow(2,56),NB=Math.pow(2,63),RB=function(r){return r<SB?1:r<PB?2:r<OB?3:r<DB?4:r<CB?5:r<BB?6:r<_B?7:r<TB?8:r<NB?9:10},UB={encode:vB,decode:xB,encodingLength:RB},OE=UB;const nm=(r,e,t=0)=>(OE.encode(r,e,t),e),sm=r=>OE.encodingLength(r),fp=(r,e)=>{const t=e.byteLength,n=sm(r),s=n+sm(t),i=new Uint8Array(s+t);return nm(r,i,0),nm(t,i,n),i.set(e,s),new kB(r,t,e,i)};let kB=class{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}};const DE=({name:r,code:e,encode:t})=>new $B(r,e,t);let $B=class{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?fp(this.code,t):t.then(n=>fp(this.code,n))}else throw Error("Unknown type, must be binary type")}};const CE=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),LB=DE({name:"sha2-256",code:18,encode:CE("SHA-256")}),FB=DE({name:"sha2-512",code:19,encode:CE("SHA-512")});var MB=Object.freeze({__proto__:null,sha256:LB,sha512:FB});const BE=0,jB="identity",_E=xE,zB=r=>fp(BE,_E(r)),HB={code:BE,name:jB,encode:_E,digest:zB};var qB=Object.freeze({__proto__:null,identity:HB});new TextEncoder,new TextDecoder;const im={...$C,...FC,...jC,...HC,...KC,...rB,...iB,...cB,...dB,...bB};({...MB,...qB});function TE(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}const om=TE("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),Uf=TE("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=EE(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),NE={utf8:om,"utf-8":om,hex:im.base16,latin1:Uf,ascii:Uf,binary:Uf,...im};function kh(r,e="utf8"){const t=NE[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}function rc(r,e="utf8"){const t=NE[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?xg(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}function am(r){return oo(kh(rc(r,Rh),bE))}function Xu(r){return kh(rc(us(r),bE),Rh)}function RE(r){const e=rc(xC,em),t=AC+kh(AE([e,r]),em);return[vC,EC,t].join(bC)}function VB(r){return kh(r,Rh)}function KB(r){return rc(r,Rh)}function GB(r){return rc([Xu(r.header),Xu(r.payload)].join(Zu),vE)}function QB(r){return[Xu(r.header),Xu(r.payload),VB(r.signature)].join(Zu)}function dp(r){const e=r.split(Zu),t=am(e[0]),n=am(e[1]),s=KB(e[2]),i=rc(e.slice(0,2).join(Zu),vE);return{header:t,payload:n,signature:s,data:i}}function cm(r=cE(IC)){const e=wE.getPublicKey(r);return{secretKey:AE([r,e]),publicKey:e}}async function WB(r,e,t,n,s=J.fromMiliseconds(Date.now())){const i={alg:mC,typ:wC},o=RE(n.publicKey),a=s+t,c={iss:o,sub:r,aud:e,iat:s,exp:a},l=GB({header:i,payload:c}),u=wE.sign(l,n.secretKey.slice(0,32));return QB({header:i,payload:c,signature:u})}function Ig(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function UE(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Ig(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function $c(r,e){e||(e=r.reduce((s,i)=>s+i.length,0));const t=UE(e);let n=0;for(const s of r)t.set(s,n),n+=s.length;return Ig(t)}function JB(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,m=0,b=0,x=p.length;b!==x&&p[b]===0;)b++,g++;for(var v=(x-b)*u+1>>>0,I=new Uint8Array(v);b!==x;){for(var S=p[b],E=0,P=v-1;(S!==0||E<m)&&P!==-1;P--,E++)S+=256*I[P]>>>0,I[P]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");m=E,b++}for(var D=v-m;D!==v&&I[D]===0;)D++;for(var B=c.repeat(g);D<v;++D)B+=r.charAt(I[D]);return B}function f(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var m=0,b=0;p[g]===c;)m++,g++;for(var x=(p.length-g)*l+1>>>0,v=new Uint8Array(x);p[g];){var I=t[p.charCodeAt(g)];if(I===255)return;for(var S=0,E=x-1;(I!==0||S<b)&&E!==-1;E--,S++)I+=a*v[E]>>>0,v[E]=I%256>>>0,I=I/256>>>0;if(I!==0)throw new Error("Non-zero carry");b=S,g++}if(p[g]!==" "){for(var P=x-b;P!==x&&v[P]===0;)P++;for(var D=new Uint8Array(m+(x-P)),B=m;P!==x;)D[B++]=v[P++];return D}}}function d(p){var g=f(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:d}}var YB=JB,ZB=YB;const XB=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},e_=r=>new TextEncoder().encode(r),t_=r=>new TextDecoder().decode(r);class r_{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class n_{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return kE(this,e)}}class s_{constructor(e){this.decoders=e}or(e){return kE(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const kE=(r,e)=>new s_({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class i_{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new r_(e,t,n),this.decoder=new n_(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const $h=({name:r,prefix:e,encode:t,decode:n})=>new i_(r,e,t,n),Dl=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=ZB(t,e);return $h({prefix:r,name:e,encode:n,decode:i=>XB(s(i))})},o_=(r,e,t,n)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const h=s[r[u]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},a_=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},gt=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>$h({prefix:e,name:r,encode(s){return a_(s,n,t)},decode(s){return o_(s,n,t,r)}}),c_=$h({prefix:"\0",name:"identity",encode:r=>t_(r),decode:r=>e_(r)}),l_=Object.freeze(Object.defineProperty({__proto__:null,identity:c_},Symbol.toStringTag,{value:"Module"})),u_=gt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),h_=Object.freeze(Object.defineProperty({__proto__:null,base2:u_},Symbol.toStringTag,{value:"Module"})),f_=gt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),d_=Object.freeze(Object.defineProperty({__proto__:null,base8:f_},Symbol.toStringTag,{value:"Module"})),p_=Dl({prefix:"9",name:"base10",alphabet:"0123456789"}),g_=Object.freeze(Object.defineProperty({__proto__:null,base10:p_},Symbol.toStringTag,{value:"Module"})),y_=gt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),m_=gt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),w_=Object.freeze(Object.defineProperty({__proto__:null,base16:y_,base16upper:m_},Symbol.toStringTag,{value:"Module"})),b_=gt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),v_=gt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),E_=gt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),A_=gt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),x_=gt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),I_=gt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),S_=gt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),P_=gt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),O_=gt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),D_=Object.freeze(Object.defineProperty({__proto__:null,base32:b_,base32hex:x_,base32hexpad:S_,base32hexpadupper:P_,base32hexupper:I_,base32pad:E_,base32padupper:A_,base32upper:v_,base32z:O_},Symbol.toStringTag,{value:"Module"})),C_=Dl({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),B_=Dl({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),__=Object.freeze(Object.defineProperty({__proto__:null,base36:C_,base36upper:B_},Symbol.toStringTag,{value:"Module"})),T_=Dl({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),N_=Dl({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),R_=Object.freeze(Object.defineProperty({__proto__:null,base58btc:T_,base58flickr:N_},Symbol.toStringTag,{value:"Module"})),U_=gt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),k_=gt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),$_=gt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),L_=gt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),F_=Object.freeze(Object.defineProperty({__proto__:null,base64:U_,base64pad:k_,base64url:$_,base64urlpad:L_},Symbol.toStringTag,{value:"Module"})),$E=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),M_=$E.reduce((r,e,t)=>(r[t]=e,r),[]),j_=$E.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function z_(r){return r.reduce((e,t)=>(e+=M_[t],e),"")}function H_(r){const e=[];for(const t of r){const n=j_[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const q_=$h({prefix:"🚀",name:"base256emoji",encode:z_,decode:H_}),V_=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:q_},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const lm={...l_,...h_,...d_,...g_,...w_,...D_,...__,...R_,...F_,...V_};function LE(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}const um=LE("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),kf=LE("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=UE(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),FE={utf8:um,"utf-8":um,hex:lm.base16,latin1:kf,ascii:kf,binary:kf,...lm};function Or(r,e="utf8"){const t=FE[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Ig(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}function Jt(r,e="utf8"){const t=FE[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(r.buffer,r.byteOffset,r.byteLength).toString("utf8"):t.encoder.encode(r).substring(1)}const K_={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe",batchFetchMessages:"waku_batchFetchMessages"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe",batchFetchMessages:"irn_batchFetchMessages"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe",batchFetchMessages:"iridium_batchFetchMessages"}};var $f,hm;function ME(){if(hm)return $f;hm=1;const r="Input must be an string, Buffer or Uint8Array";function e(o){let a;if(o instanceof Uint8Array)a=o;else if(typeof o=="string")a=new TextEncoder().encode(o);else throw new Error(r);return a}function t(o){return Array.prototype.map.call(o,function(a){return(a<16?"0":"")+a.toString(16)}).join("")}function n(o){return(4294967296+o).toString(16).substring(1)}function s(o,a,c){let l=`
`+o+" = ";for(let u=0;u<a.length;u+=2){if(c===32)l+=n(a[u]).toUpperCase(),l+=" ",l+=n(a[u+1]).toUpperCase();else if(c===64)l+=n(a[u+1]).toUpperCase(),l+=n(a[u]).toUpperCase();else throw new Error("Invalid size "+c);u%6===4?l+=`
`+new Array(o.length+4).join(" "):u<a.length-2&&(l+=" ")}console.log(l)}function i(o,a,c){let l=new Date().getTime();const u=new Uint8Array(a);for(let f=0;f<a;f++)u[f]=f%256;const h=new Date().getTime();console.log("Generated random input in "+(h-l)+"ms"),l=h;for(let f=0;f<c;f++){const d=o(u),p=new Date().getTime(),g=p-l;l=p,console.log("Hashed in "+g+"ms: "+d.substring(0,20)+"..."),console.log(Math.round(a/(1<<20)/(g/1e3)*100)/100+" MB PER SECOND")}}return $f={normalizeInput:e,toHex:t,debugPrint:s,testSpeed:i},$f}var Lf,fm;function G_(){if(fm)return Lf;fm=1;const r=ME();function e(b,x,v){const I=b[x]+b[v];let S=b[x+1]+b[v+1];I>=4294967296&&S++,b[x]=I,b[x+1]=S}function t(b,x,v,I){let S=b[x]+v;v<0&&(S+=4294967296);let E=b[x+1]+I;S>=4294967296&&E++,b[x]=S,b[x+1]=E}function n(b,x){return b[x]^b[x+1]<<8^b[x+2]<<16^b[x+3]<<24}function s(b,x,v,I,S,E){const P=l[S],D=l[S+1],B=l[E],L=l[E+1];e(c,b,x),t(c,b,P,D);let j=c[I]^c[b],$=c[I+1]^c[b+1];c[I]=$,c[I+1]=j,e(c,v,I),j=c[x]^c[v],$=c[x+1]^c[v+1],c[x]=j>>>24^$<<8,c[x+1]=$>>>24^j<<8,e(c,b,x),t(c,b,B,L),j=c[I]^c[b],$=c[I+1]^c[b+1],c[I]=j>>>16^$<<16,c[I+1]=$>>>16^j<<16,e(c,v,I),j=c[x]^c[v],$=c[x+1]^c[v+1],c[x]=$>>>31^j<<1,c[x+1]=j>>>31^$<<1}const i=new Uint32Array([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),o=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3],a=new Uint8Array(o.map(function(b){return b*2})),c=new Uint32Array(32),l=new Uint32Array(32);function u(b,x){let v=0;for(v=0;v<16;v++)c[v]=b.h[v],c[v+16]=i[v];for(c[24]=c[24]^b.t,c[25]=c[25]^b.t/4294967296,x&&(c[28]=~c[28],c[29]=~c[29]),v=0;v<32;v++)l[v]=n(b.b,4*v);for(v=0;v<12;v++)s(0,8,16,24,a[v*16+0],a[v*16+1]),s(2,10,18,26,a[v*16+2],a[v*16+3]),s(4,12,20,28,a[v*16+4],a[v*16+5]),s(6,14,22,30,a[v*16+6],a[v*16+7]),s(0,10,20,30,a[v*16+8],a[v*16+9]),s(2,12,22,24,a[v*16+10],a[v*16+11]),s(4,14,16,26,a[v*16+12],a[v*16+13]),s(6,8,18,28,a[v*16+14],a[v*16+15]);for(v=0;v<16;v++)b.h[v]=b.h[v]^c[v]^c[v+16]}const h=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function f(b,x,v,I){if(b===0||b>64)throw new Error("Illegal output length, expected 0 < length <= 64");if(x&&x.length>64)throw new Error("Illegal key, expected Uint8Array with 0 < length <= 64");if(v&&v.length!==16)throw new Error("Illegal salt, expected Uint8Array with length is 16");if(I&&I.length!==16)throw new Error("Illegal personal, expected Uint8Array with length is 16");const S={b:new Uint8Array(128),h:new Uint32Array(16),t:0,c:0,outlen:b};h.fill(0),h[0]=b,x&&(h[1]=x.length),h[2]=1,h[3]=1,v&&h.set(v,32),I&&h.set(I,48);for(let E=0;E<16;E++)S.h[E]=i[E]^n(h,E*4);return x&&(d(S,x),S.c=128),S}function d(b,x){for(let v=0;v<x.length;v++)b.c===128&&(b.t+=b.c,u(b,!1),b.c=0),b.b[b.c++]=x[v]}function p(b){for(b.t+=b.c;b.c<128;)b.b[b.c++]=0;u(b,!0);const x=new Uint8Array(b.outlen);for(let v=0;v<b.outlen;v++)x[v]=b.h[v>>2]>>8*(v&3);return x}function g(b,x,v,I,S){v=v||64,b=r.normalizeInput(b),I&&(I=r.normalizeInput(I)),S&&(S=r.normalizeInput(S));const E=f(v,x,I,S);return d(E,b),p(E)}function m(b,x,v,I,S){const E=g(b,x,v,I,S);return r.toHex(E)}return Lf={blake2b:g,blake2bHex:m,blake2bInit:f,blake2bUpdate:d,blake2bFinal:p},Lf}var Ff,dm;function Q_(){if(dm)return Ff;dm=1;const r=ME();function e(p,g){return p[g]^p[g+1]<<8^p[g+2]<<16^p[g+3]<<24}function t(p,g,m,b,x,v){o[p]=o[p]+o[g]+x,o[b]=n(o[b]^o[p],16),o[m]=o[m]+o[b],o[g]=n(o[g]^o[m],12),o[p]=o[p]+o[g]+v,o[b]=n(o[b]^o[p],8),o[m]=o[m]+o[b],o[g]=n(o[g]^o[m],7)}function n(p,g){return p>>>g^p<<32-g}const s=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),i=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0]),o=new Uint32Array(16),a=new Uint32Array(16);function c(p,g){let m=0;for(m=0;m<8;m++)o[m]=p.h[m],o[m+8]=s[m];for(o[12]^=p.t,o[13]^=p.t/4294967296,g&&(o[14]=~o[14]),m=0;m<16;m++)a[m]=e(p.b,4*m);for(m=0;m<10;m++)t(0,4,8,12,a[i[m*16+0]],a[i[m*16+1]]),t(1,5,9,13,a[i[m*16+2]],a[i[m*16+3]]),t(2,6,10,14,a[i[m*16+4]],a[i[m*16+5]]),t(3,7,11,15,a[i[m*16+6]],a[i[m*16+7]]),t(0,5,10,15,a[i[m*16+8]],a[i[m*16+9]]),t(1,6,11,12,a[i[m*16+10]],a[i[m*16+11]]),t(2,7,8,13,a[i[m*16+12]],a[i[m*16+13]]),t(3,4,9,14,a[i[m*16+14]],a[i[m*16+15]]);for(m=0;m<8;m++)p.h[m]^=o[m]^o[m+8]}function l(p,g){if(!(p>0&&p<=32))throw new Error("Incorrect output length, should be in [1, 32]");const m=g?g.length:0;if(g&&!(m>0&&m<=32))throw new Error("Incorrect key length, should be in [1, 32]");const b={h:new Uint32Array(s),b:new Uint8Array(64),c:0,t:0,outlen:p};return b.h[0]^=16842752^m<<8^p,m>0&&(u(b,g),b.c=64),b}function u(p,g){for(let m=0;m<g.length;m++)p.c===64&&(p.t+=p.c,c(p,!1),p.c=0),p.b[p.c++]=g[m]}function h(p){for(p.t+=p.c;p.c<64;)p.b[p.c++]=0;c(p,!0);const g=new Uint8Array(p.outlen);for(let m=0;m<p.outlen;m++)g[m]=p.h[m>>2]>>8*(m&3)&255;return g}function f(p,g,m){m=m||32,p=r.normalizeInput(p);const b=l(m,g);return u(b,p),h(b)}function d(p,g,m){const b=f(p,g,m);return r.toHex(b)}return Ff={blake2s:f,blake2sHex:d,blake2sInit:l,blake2sUpdate:u,blake2sFinal:h},Ff}var Mf,pm;function W_(){if(pm)return Mf;pm=1;const r=G_(),e=Q_();return Mf={blake2b:r.blake2b,blake2bHex:r.blake2bHex,blake2bInit:r.blake2bInit,blake2bUpdate:r.blake2bUpdate,blake2bFinal:r.blake2bFinal,blake2s:e.blake2s,blake2sHex:e.blake2sHex,blake2sInit:e.blake2sInit,blake2sUpdate:e.blake2sUpdate,blake2sFinal:e.blake2sFinal},Mf}var J_=W_(),Y_={};const Z_=":";function ss(r){const[e,t]=r.split(Z_);return{namespace:e,reference:t}}function gm(r,e=[]){const t=[];return Object.keys(r).forEach(n=>{if(e.length&&!e.includes(n))return;const s=r[n];t.push(...s.accounts)}),t}function jE(r,e){return r.includes(":")?[r]:e.chains||[]}var X_=Object.defineProperty,eT=Object.defineProperties,tT=Object.getOwnPropertyDescriptors,ym=Object.getOwnPropertySymbols,rT=Object.prototype.hasOwnProperty,nT=Object.prototype.propertyIsEnumerable,pp=(r,e,t)=>e in r?X_(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,mm=(r,e)=>{for(var t in e||(e={}))rT.call(e,t)&&pp(r,t,e[t]);if(ym)for(var t of ym(e))nT.call(e,t)&&pp(r,t,e[t]);return r},sT=(r,e)=>eT(r,tT(e)),wm=(r,e,t)=>pp(r,typeof e!="symbol"?e+"":e,t);const iT="ReactNative",ur={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},oT="js";function eh(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function ii(){return!ls.getDocument()&&!!ls.getNavigator()&&navigator.product===iT}function aT(){return ii()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="android"}function cT(){return ii()&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"&&(global==null?void 0:global.Platform.OS)==="ios"}function nc(){return!eh()&&!!ls.getNavigator()&&!!ls.getDocument()}function Cl(){return ii()?ur.reactNative:eh()?ur.node:nc()?ur.browser:ur.unknown}function bm(){var r;try{return ii()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(r=global.Application)==null?void 0:r.applicationId:void 0}catch{return}}function lT(r,e){const t=new URLSearchParams(r);return Object.entries(e).sort(([n],[s])=>n.localeCompare(s)).forEach(([n,s])=>{s!=null&&t.set(n,String(s))}),t.toString()}function uT(r){var e,t;const n=zE();try{return r!=null&&r.url&&n.url&&new URL(r.url).host!==new URL(n.url).host&&(console.warn(`The configured WalletConnect 'metadata.url':${r.url} differs from the actual page url:${n.url}. This is probably unintended and can lead to issues.`),r.url=n.url),(e=r==null?void 0:r.icons)!=null&&e.length&&r.icons.length>0&&(r.icons=r.icons.filter(s=>s!=="")),sT(mm(mm({},n),r),{url:(r==null?void 0:r.url)||n.url,name:(r==null?void 0:r.name)||n.name,description:(r==null?void 0:r.description)||n.description,icons:(t=r==null?void 0:r.icons)!=null&&t.length&&r.icons.length>0?r.icons:n.icons})}catch(s){return console.warn("Error populating app metadata",s),r||n}}function zE(){return EO.getWindowMetadata()||{name:"",description:"",url:"",icons:[""]}}function hT(){if(Cl()===ur.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:t,Version:n}=global.Platform;return[t,n].join("-")}const r=FP();if(r===null)return"unknown";const e=r.os?r.os.replace(" ","").toLowerCase():"unknown";return r.type==="browser"?[e,r.name,r.version].join("-"):[e,r.version].join("-")}function fT(){var r;const e=Cl();return e===ur.browser?[e,((r=ls.getLocation())==null?void 0:r.host)||"unknown"].join(":"):e}function HE(r,e,t){const n=hT(),s=fT();return[[r,e].join("-"),[oT,t].join("-"),n,s].join("/")}function dT({protocol:r,version:e,relayUrl:t,sdkVersion:n,auth:s,projectId:i,useOnCloseEvent:o,bundleId:a,packageName:c}){const l=t.split("?"),u=HE(r,e,n),h={auth:s,ua:u,projectId:i,useOnCloseEvent:o,packageName:c||void 0,bundleId:a||void 0},f=lT(l[1]||"",h);return l[0]+"?"+f}function Ci(r,e){return r.filter(t=>e.includes(t)).length===r.length}function gp(r){return Object.fromEntries(r.entries())}function yp(r){return new Map(Object.entries(r))}function gi(r=J.FIVE_MINUTES,e){const t=J.toMiliseconds(r||J.FIVE_MINUTES);let n,s,i,o;return{resolve:a=>{i&&n&&(clearTimeout(i),n(a),o=Promise.resolve(a))},reject:a=>{i&&s&&(clearTimeout(i),s(a))},done:()=>new Promise((a,c)=>{if(o)return a(o);i=setTimeout(()=>{const l=new Error(e);o=Promise.reject(l),c(l)},t),n=a,s=c})}}function An(r,e,t){return new Promise(async(n,s)=>{const i=setTimeout(()=>s(new Error(t)),e);try{const o=await r;n(o)}catch(o){s(o)}clearTimeout(i)})}function qE(r,e){if(typeof e=="string"&&e.startsWith(`${r}:`))return e;if(r.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(r.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${r}`)}function pT(r){return qE("topic",r)}function gT(r){return qE("id",r)}function VE(r){const[e,t]=r.split(":"),n={id:void 0,topic:void 0};if(e==="topic"&&typeof t=="string")n.topic=t;else if(e==="id"&&Number.isInteger(Number(t)))n.id=Number(t);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${t}`);return n}function Ke(r,e){return J.fromMiliseconds(Date.now()+J.toMiliseconds(r))}function wn(r){return Date.now()>=J.toMiliseconds(r)}function Ee(r,e){return`${r}${e?`:${e}`:""}`}function In(r=[],e=[]){return[...new Set([...r,...e])]}async function yT({id:r,topic:e,wcDeepLink:t}){var n;try{if(!t)return;const s=typeof t=="string"?JSON.parse(t):t,i=s==null?void 0:s.href;if(typeof i!="string")return;const o=mT(i,r,e),a=Cl();if(a===ur.browser){if(!((n=ls.getDocument())!=null&&n.hasFocus())){console.warn("Document does not have focus, skipping deeplink.");return}wT(o)}else a===ur.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(o)}catch(s){console.error(s)}}function mT(r,e,t){const n=`requestId=${e}&sessionTopic=${t}`;r.endsWith("/")&&(r=r.slice(0,-1));let s=`${r}`;if(r.startsWith("https://t.me")){const i=r.includes("?")?"&startapp=":"?startapp=";s=`${s}${i}${AT(n,!0)}`}else s=`${s}/wc?${n}`;return s}function wT(r){let e="_self";ET()?e="_top":(vT()||r.startsWith("https://")||r.startsWith("http://"))&&(e="_blank"),window.open(r,e,"noreferrer noopener")}async function bT(r,e){let t="";try{if(nc()&&(t=localStorage.getItem(e),t))return t;t=await r.getItem(e)}catch(n){console.error(n)}return t}function vm(r,e){if(!r.includes(e))return null;const t=r.split(/([&,?,=])/),n=t.indexOf(e);return t[n+2]}function Em(){return typeof crypto<"u"&&crypto!=null&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/gu,r=>{const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)})}function Sg(){return typeof process<"u"&&Y_.IS_VITEST==="true"}function vT(){return typeof window<"u"&&(!!window.TelegramWebviewProxy||!!window.Telegram||!!window.TelegramWebviewProxyProto)}function ET(){try{return window.self!==window.top}catch{return!1}}function AT(r,e=!1){const t=Buffer.from(r).toString("base64");return e?t.replace(/[=]/g,""):t}function KE(r){return Buffer.from(r,"base64").toString("utf-8")}function xT(r){return new Promise(e=>setTimeout(e,r))}let IT=class{constructor({limit:e}){wm(this,"limit"),wm(this,"set"),this.limit=e,this.set=new Set}add(e){if(!this.set.has(e)){if(this.set.size>=this.limit){const t=this.set.values().next().value;t&&this.set.delete(t)}this.set.add(e)}}has(e){return this.set.has(e)}};const eu=BigInt(2**32-1),Am=BigInt(32);function GE(r,e=!1){return e?{h:Number(r&eu),l:Number(r>>Am&eu)}:{h:Number(r>>Am&eu)|0,l:Number(r&eu)|0}}function QE(r,e=!1){const t=r.length;let n=new Uint32Array(t),s=new Uint32Array(t);for(let i=0;i<t;i++){const{h:o,l:a}=GE(r[i],e);[n[i],s[i]]=[o,a]}return[n,s]}const xm=(r,e,t)=>r>>>t,Im=(r,e,t)=>r<<32-t|e>>>t,Os=(r,e,t)=>r>>>t|e<<32-t,Ds=(r,e,t)=>r<<32-t|e>>>t,Tc=(r,e,t)=>r<<64-t|e>>>t-32,Nc=(r,e,t)=>r>>>t-32|e<<64-t,ST=(r,e)=>e,PT=(r,e)=>r,OT=(r,e,t)=>r<<t|e>>>32-t,DT=(r,e,t)=>e<<t|r>>>32-t,CT=(r,e,t)=>e<<t-32|r>>>64-t,BT=(r,e,t)=>r<<t-32|e>>>64-t;function Ur(r,e,t,n){const s=(e>>>0)+(n>>>0);return{h:r+t+(s/2**32|0)|0,l:s|0}}const Pg=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),Og=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,_T=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),TT=(r,e,t,n,s)=>e+t+n+s+(r/2**32|0)|0,NT=(r,e,t,n,s)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(s>>>0),RT=(r,e,t,n,s,i)=>e+t+n+s+i+(r/2**32|0)|0,Po=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;function Lh(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function hs(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function Jr(r,...e){if(!Lh(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function Fh(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");hs(r.outputLen),hs(r.blockLen)}function ri(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function Dg(r,e){Jr(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function nl(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}function Cr(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function jf(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function en(r,e){return r<<32-e|r>>>e}const WE=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function JE(r){return r<<24&4278190080|r<<8&16711680|r>>>8&65280|r>>>24&255}const kn=WE?r=>r:r=>JE(r);function UT(r){for(let e=0;e<r.length;e++)r[e]=JE(r[e]);return r}const Cs=WE?r=>r:UT,YE=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",kT=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function Yo(r){if(Jr(r),YE)return r.toHex();let e="";for(let t=0;t<r.length;t++)e+=kT[r[t]];return e}const Tn={_0:48,_9:57,A:65,F:70,a:97,f:102};function Sm(r){if(r>=Tn._0&&r<=Tn._9)return r-Tn._0;if(r>=Tn.A&&r<=Tn.F)return r-(Tn.A-10);if(r>=Tn.a&&r<=Tn.f)return r-(Tn.a-10)}function th(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);if(YE)return Uint8Array.fromHex(r);const e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(t);for(let s=0,i=0;s<t;s++,i+=2){const o=Sm(r.charCodeAt(i)),a=Sm(r.charCodeAt(i+1));if(o===void 0||a===void 0){const c=r[i]+r[i+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+i)}n[s]=o*16+a}return n}function ZE(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function Qr(r){return typeof r=="string"&&(r=ZE(r)),Jr(r),r}function _s(...r){let e=0;for(let n=0;n<r.length;n++){const s=r[n];Jr(s),e+=s.length}const t=new Uint8Array(e);for(let n=0,s=0;n<r.length;n++){const i=r[n];t.set(i,s),s+=i.length}return t}class Mh{}function Bl(r){const e=n=>r().update(Qr(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function $T(r){const e=(n,s)=>r(s).update(Qr(n)).digest(),t=r({});return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=n=>r(n),e}function po(r=32){if(Po&&typeof Po.getRandomValues=="function")return Po.getRandomValues(new Uint8Array(r));if(Po&&typeof Po.randomBytes=="function")return Uint8Array.from(Po.randomBytes(r));throw new Error("crypto.getRandomValues must be defined")}const LT=BigInt(0),mc=BigInt(1),FT=BigInt(2),MT=BigInt(7),jT=BigInt(256),zT=BigInt(113),XE=[],e2=[],t2=[];for(let r=0,e=mc,t=1,n=0;r<24;r++){[t,n]=[n,(2*t+3*n)%5],XE.push(2*(5*n+t)),e2.push((r+1)*(r+2)/2%64);let s=LT;for(let i=0;i<7;i++)e=(e<<mc^(e>>MT)*zT)%jT,e&FT&&(s^=mc<<(mc<<BigInt(i))-mc);t2.push(s)}const r2=QE(t2,!0),HT=r2[0],qT=r2[1],Pm=(r,e,t)=>t>32?CT(r,e,t):OT(r,e,t),Om=(r,e,t)=>t>32?BT(r,e,t):DT(r,e,t);function VT(r,e=24){const t=new Uint32Array(10);for(let n=24-e;n<24;n++){for(let o=0;o<10;o++)t[o]=r[o]^r[o+10]^r[o+20]^r[o+30]^r[o+40];for(let o=0;o<10;o+=2){const a=(o+8)%10,c=(o+2)%10,l=t[c],u=t[c+1],h=Pm(l,u,1)^t[a],f=Om(l,u,1)^t[a+1];for(let d=0;d<50;d+=10)r[o+d]^=h,r[o+d+1]^=f}let s=r[2],i=r[3];for(let o=0;o<24;o++){const a=e2[o],c=Pm(s,i,a),l=Om(s,i,a),u=XE[o];s=r[u],i=r[u+1],r[u]=c,r[u+1]=l}for(let o=0;o<50;o+=10){for(let a=0;a<10;a++)t[a]=r[o+a];for(let a=0;a<10;a++)r[o+a]^=~t[(a+2)%10]&t[(a+4)%10]}r[0]^=HT[n],r[1]^=qT[n]}Cr(t)}let KT=class n2 extends Mh{constructor(e,t,n,s=!1,i=24){if(super(),this.pos=0,this.posOut=0,this.finished=!1,this.destroyed=!1,this.enableXOF=!1,this.blockLen=e,this.suffix=t,this.outputLen=n,this.enableXOF=s,this.rounds=i,hs(n),!(0<e&&e<200))throw new Error("only keccak-f1600 function is supported");this.state=new Uint8Array(200),this.state32=nl(this.state)}clone(){return this._cloneInto()}keccak(){Cs(this.state32),VT(this.state32,this.rounds),Cs(this.state32),this.posOut=0,this.pos=0}update(e){ri(this),e=Qr(e),Jr(e);const{blockLen:t,state:n}=this,s=e.length;for(let i=0;i<s;){const o=Math.min(t-this.pos,s-i);for(let a=0;a<o;a++)n[this.pos++]^=e[i++];this.pos===t&&this.keccak()}return this}finish(){if(this.finished)return;this.finished=!0;const{state:e,suffix:t,pos:n,blockLen:s}=this;e[n]^=t,(t&128)!==0&&n===s-1&&this.keccak(),e[s-1]^=128,this.keccak()}writeInto(e){ri(this,!1),Jr(e),this.finish();const t=this.state,{blockLen:n}=this;for(let s=0,i=e.length;s<i;){this.posOut>=n&&this.keccak();const o=Math.min(n-this.posOut,i-s);e.set(t.subarray(this.posOut,this.posOut+o),s),this.posOut+=o,s+=o}return e}xofInto(e){if(!this.enableXOF)throw new Error("XOF is not possible for this instance");return this.writeInto(e)}xof(e){return hs(e),this.xofInto(new Uint8Array(e))}digestInto(e){if(Dg(e,this),this.finished)throw new Error("digest() was already called");return this.writeInto(e),this.destroy(),e}digest(){return this.digestInto(new Uint8Array(this.outputLen))}destroy(){this.destroyed=!0,Cr(this.state)}_cloneInto(e){const{blockLen:t,suffix:n,outputLen:s,rounds:i,enableXOF:o}=this;return e||(e=new n2(t,n,s,o,i)),e.state32.set(this.state32),e.pos=this.pos,e.posOut=this.posOut,e.finished=this.finished,e.rounds=i,e.suffix=n,e.outputLen=s,e.enableXOF=o,e.destroyed=this.destroyed,e}};const GT=(r,e,t)=>Bl(()=>new KT(e,r,t)),QT=GT(1,136,256/8);function WT(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(t>>s&i),a=Number(t&i),c=n?4:0,l=n?0:4;r.setUint32(e+c,o,n),r.setUint32(e+l,a,n)}function JT(r,e,t){return r&e^~r&t}function YT(r,e,t){return r&e^r&t^e&t}let s2=class extends Mh{constructor(e,t,n,s){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=s,this.buffer=new Uint8Array(e),this.view=jf(this.buffer)}update(e){ri(this),e=Qr(e),Jr(e);const{view:t,buffer:n,blockLen:s}=this,i=e.length;for(let o=0;o<i;){const a=Math.min(s-this.pos,i-o);if(a===s){const c=jf(e);for(;s<=i-o;o+=s)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===s&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ri(this),Dg(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:s,isLE:i}=this;let{pos:o}=this;t[o++]=128,Cr(this.buffer.subarray(o)),this.padOffset>s-o&&(this.process(n,0),o=0);for(let h=o;h<s;h++)t[h]=0;WT(n,s-8,BigInt(this.length*8),i),this.process(n,0);const a=jf(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let h=0;h<l;h++)a.setUint32(4*h,u[h],i)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:s,finished:i,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=i,e.length=s,e.pos=a,s%t&&e.buffer.set(n),e}clone(){return this._cloneInto()}};const bs=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),wt=Uint32Array.from([3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]),bt=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),ZT=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),vs=new Uint32Array(64);class XT extends s2{constructor(e=32){super(64,e,8,!1),this.A=bs[0]|0,this.B=bs[1]|0,this.C=bs[2]|0,this.D=bs[3]|0,this.E=bs[4]|0,this.F=bs[5]|0,this.G=bs[6]|0,this.H=bs[7]|0}get(){const{A:e,B:t,C:n,D:s,E:i,F:o,G:a,H:c}=this;return[e,t,n,s,i,o,a,c]}set(e,t,n,s,i,o,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=s|0,this.E=i|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let h=0;h<16;h++,t+=4)vs[h]=e.getUint32(t,!1);for(let h=16;h<64;h++){const f=vs[h-15],d=vs[h-2],p=en(f,7)^en(f,18)^f>>>3,g=en(d,17)^en(d,19)^d>>>10;vs[h]=g+vs[h-7]+p+vs[h-16]|0}let{A:n,B:s,C:i,D:o,E:a,F:c,G:l,H:u}=this;for(let h=0;h<64;h++){const f=en(a,6)^en(a,11)^en(a,25),d=u+f+JT(a,c,l)+ZT[h]+vs[h]|0,p=(en(n,2)^en(n,13)^en(n,22))+YT(n,s,i)|0;u=l,l=c,c=a,a=o+d|0,o=i,i=s,s=n,n=d+p|0}n=n+this.A|0,s=s+this.B|0,i=i+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(n,s,i,o,a,c,l,u)}roundClean(){Cr(vs)}destroy(){this.set(0,0,0,0,0,0,0,0),Cr(this.buffer)}}const i2=QE(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),eN=i2[0],tN=i2[1],Es=new Uint32Array(80),As=new Uint32Array(80);let Cg=class extends s2{constructor(e=64){super(128,e,16,!1),this.Ah=bt[0]|0,this.Al=bt[1]|0,this.Bh=bt[2]|0,this.Bl=bt[3]|0,this.Ch=bt[4]|0,this.Cl=bt[5]|0,this.Dh=bt[6]|0,this.Dl=bt[7]|0,this.Eh=bt[8]|0,this.El=bt[9]|0,this.Fh=bt[10]|0,this.Fl=bt[11]|0,this.Gh=bt[12]|0,this.Gl=bt[13]|0,this.Hh=bt[14]|0,this.Hl=bt[15]|0}get(){const{Ah:e,Al:t,Bh:n,Bl:s,Ch:i,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:h,Fl:f,Gh:d,Gl:p,Hh:g,Hl:m}=this;return[e,t,n,s,i,o,a,c,l,u,h,f,d,p,g,m]}set(e,t,n,s,i,o,a,c,l,u,h,f,d,p,g,m){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=s|0,this.Ch=i|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=h|0,this.Fl=f|0,this.Gh=d|0,this.Gl=p|0,this.Hh=g|0,this.Hl=m|0}process(e,t){for(let v=0;v<16;v++,t+=4)Es[v]=e.getUint32(t),As[v]=e.getUint32(t+=4);for(let v=16;v<80;v++){const I=Es[v-15]|0,S=As[v-15]|0,E=Os(I,S,1)^Os(I,S,8)^xm(I,S,7),P=Ds(I,S,1)^Ds(I,S,8)^Im(I,S,7),D=Es[v-2]|0,B=As[v-2]|0,L=Os(D,B,19)^Tc(D,B,61)^xm(D,B,6),j=Ds(D,B,19)^Nc(D,B,61)^Im(D,B,6),$=_T(P,j,As[v-7],As[v-16]),U=TT($,E,L,Es[v-7],Es[v-16]);Es[v]=U|0,As[v]=$|0}let{Ah:n,Al:s,Bh:i,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:h,El:f,Fh:d,Fl:p,Gh:g,Gl:m,Hh:b,Hl:x}=this;for(let v=0;v<80;v++){const I=Os(h,f,14)^Os(h,f,18)^Tc(h,f,41),S=Ds(h,f,14)^Ds(h,f,18)^Nc(h,f,41),E=h&d^~h&g,P=f&p^~f&m,D=NT(x,S,P,tN[v],As[v]),B=RT(D,b,I,E,eN[v],Es[v]),L=D|0,j=Os(n,s,28)^Tc(n,s,34)^Tc(n,s,39),$=Ds(n,s,28)^Nc(n,s,34)^Nc(n,s,39),U=n&i^n&a^i&a,T=s&o^s&c^o&c;b=g|0,x=m|0,g=d|0,m=p|0,d=h|0,p=f|0,{h,l:f}=Ur(l|0,u|0,B|0,L|0),l=a|0,u=c|0,a=i|0,c=o|0,i=n|0,o=s|0;const w=Pg(L,$,T);n=Og(w,B,j,U),s=w|0}({h:n,l:s}=Ur(this.Ah|0,this.Al|0,n|0,s|0)),{h:i,l:o}=Ur(this.Bh|0,this.Bl|0,i|0,o|0),{h:a,l:c}=Ur(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=Ur(this.Dh|0,this.Dl|0,l|0,u|0),{h,l:f}=Ur(this.Eh|0,this.El|0,h|0,f|0),{h:d,l:p}=Ur(this.Fh|0,this.Fl|0,d|0,p|0),{h:g,l:m}=Ur(this.Gh|0,this.Gl|0,g|0,m|0),{h:b,l:x}=Ur(this.Hh|0,this.Hl|0,b|0,x|0),this.set(n,s,i,o,a,c,l,u,h,f,d,p,g,m,b,x)}roundClean(){Cr(Es,As)}destroy(){Cr(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}};class rN extends Cg{constructor(){super(48),this.Ah=wt[0]|0,this.Al=wt[1]|0,this.Bh=wt[2]|0,this.Bl=wt[3]|0,this.Ch=wt[4]|0,this.Cl=wt[5]|0,this.Dh=wt[6]|0,this.Dl=wt[7]|0,this.Eh=wt[8]|0,this.El=wt[9]|0,this.Fh=wt[10]|0,this.Fl=wt[11]|0,this.Gh=wt[12]|0,this.Gl=wt[13]|0,this.Hh=wt[14]|0,this.Hl=wt[15]|0}}const vt=Uint32Array.from([573645204,4230739756,2673172387,3360449730,596883563,1867755857,2520282905,1497426621,2519219938,2827943907,3193839141,1401305490,721525244,746961066,246885852,2177182882]);class nN extends Cg{constructor(){super(32),this.Ah=vt[0]|0,this.Al=vt[1]|0,this.Bh=vt[2]|0,this.Bl=vt[3]|0,this.Ch=vt[4]|0,this.Cl=vt[5]|0,this.Dh=vt[6]|0,this.Dl=vt[7]|0,this.Eh=vt[8]|0,this.El=vt[9]|0,this.Fh=vt[10]|0,this.Fl=vt[11]|0,this.Gh=vt[12]|0,this.Gl=vt[13]|0,this.Hh=vt[14]|0,this.Hl=vt[15]|0}}const jh=Bl(()=>new XT),sN=Bl(()=>new Cg),iN=Bl(()=>new rN),oN=Bl(()=>new nN),aN=Uint8Array.from([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9,12,5,1,15,14,13,4,10,0,7,6,3,9,2,8,11,13,11,7,14,12,1,3,9,5,0,15,4,8,6,2,10,6,15,14,9,11,3,0,8,12,2,13,7,1,4,10,5,10,2,8,4,7,6,1,5,15,11,9,14,3,12,13,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,14,10,4,8,9,15,13,6,1,12,0,2,11,7,5,3,11,8,12,0,5,2,15,13,10,14,3,6,7,1,9,4,7,9,3,1,13,12,11,14,2,6,5,10,4,0,15,8,9,0,5,7,2,4,10,15,14,1,11,12,6,8,3,13,2,12,6,10,0,11,8,3,4,13,7,5,15,14,1,9]),We=Uint32Array.from([4089235720,1779033703,2227873595,3144134277,4271175723,1013904242,1595750129,2773480762,2917565137,1359893119,725511199,2600822924,4215389547,528734635,327033209,1541459225]),Z=new Uint32Array(32);function xs(r,e,t,n,s,i){const o=s[i],a=s[i+1];let c=Z[2*r],l=Z[2*r+1],u=Z[2*e],h=Z[2*e+1],f=Z[2*t],d=Z[2*t+1],p=Z[2*n],g=Z[2*n+1],m=Pg(c,u,o);l=Og(m,l,h,a),c=m|0,{Dh:g,Dl:p}={Dh:g^l,Dl:p^c},{Dh:g,Dl:p}={Dh:ST(g,p),Dl:PT(g)},{h:d,l:f}=Ur(d,f,g,p),{Bh:h,Bl:u}={Bh:h^d,Bl:u^f},{Bh:h,Bl:u}={Bh:Os(h,u,24),Bl:Ds(h,u,24)},Z[2*r]=c,Z[2*r+1]=l,Z[2*e]=u,Z[2*e+1]=h,Z[2*t]=f,Z[2*t+1]=d,Z[2*n]=p,Z[2*n+1]=g}function Is(r,e,t,n,s,i){const o=s[i],a=s[i+1];let c=Z[2*r],l=Z[2*r+1],u=Z[2*e],h=Z[2*e+1],f=Z[2*t],d=Z[2*t+1],p=Z[2*n],g=Z[2*n+1],m=Pg(c,u,o);l=Og(m,l,h,a),c=m|0,{Dh:g,Dl:p}={Dh:g^l,Dl:p^c},{Dh:g,Dl:p}={Dh:Os(g,p,16),Dl:Ds(g,p,16)},{h:d,l:f}=Ur(d,f,g,p),{Bh:h,Bl:u}={Bh:h^d,Bl:u^f},{Bh:h,Bl:u}={Bh:Tc(h,u,63),Bl:Nc(h,u,63)},Z[2*r]=c,Z[2*r+1]=l,Z[2*e]=u,Z[2*e+1]=h,Z[2*t]=f,Z[2*t+1]=d,Z[2*n]=p,Z[2*n+1]=g}function cN(r,e={},t,n,s){if(hs(t),r<0||r>t)throw new Error("outputLen bigger than keyLen");const{key:i,salt:o,personalization:a}=e;if(i!==void 0&&(i.length<1||i.length>t))throw new Error("key length must be undefined or 1.."+t);if(o!==void 0&&o.length!==n)throw new Error("salt must be undefined or "+n);if(a!==void 0&&a.length!==s)throw new Error("personalization must be undefined or "+s)}class lN extends Mh{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,this.length=0,this.pos=0,hs(e),hs(t),this.blockLen=e,this.outputLen=t,this.buffer=new Uint8Array(e),this.buffer32=nl(this.buffer)}update(e){ri(this),e=Qr(e),Jr(e);const{blockLen:t,buffer:n,buffer32:s}=this,i=e.length,o=e.byteOffset,a=e.buffer;for(let c=0;c<i;){this.pos===t&&(Cs(s),this.compress(s,0,!1),Cs(s),this.pos=0);const l=Math.min(t-this.pos,i-c),u=o+c;if(l===t&&!(u%4)&&c+l<i){const h=new Uint32Array(a,u,Math.floor((i-c)/4));Cs(h);for(let f=0;c+t<i;f+=s.length,c+=t)this.length+=t,this.compress(h,f,!1);Cs(h);continue}n.set(e.subarray(c,c+l),this.pos),this.pos+=l,this.length+=l,c+=l}return this}digestInto(e){ri(this),Dg(e,this);const{pos:t,buffer32:n}=this;this.finished=!0,Cr(this.buffer.subarray(t)),Cs(n),this.compress(n,0,!0),Cs(n);const s=nl(e);this.get().forEach((i,o)=>s[o]=kn(i))}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){const{buffer:t,length:n,finished:s,destroyed:i,outputLen:o,pos:a}=this;return e||(e=new this.constructor({dkLen:o})),e.set(...this.get()),e.buffer.set(t),e.destroyed=i,e.finished=s,e.length=n,e.pos=a,e.outputLen=o,e}clone(){return this._cloneInto()}}class uN extends lN{constructor(e={}){const t=e.dkLen===void 0?64:e.dkLen;super(128,t),this.v0l=We[0]|0,this.v0h=We[1]|0,this.v1l=We[2]|0,this.v1h=We[3]|0,this.v2l=We[4]|0,this.v2h=We[5]|0,this.v3l=We[6]|0,this.v3h=We[7]|0,this.v4l=We[8]|0,this.v4h=We[9]|0,this.v5l=We[10]|0,this.v5h=We[11]|0,this.v6l=We[12]|0,this.v6h=We[13]|0,this.v7l=We[14]|0,this.v7h=We[15]|0,cN(t,e,64,16,16);let{key:n,personalization:s,salt:i}=e,o=0;if(n!==void 0&&(n=Qr(n),o=n.length),this.v0l^=this.outputLen|o<<8|65536|1<<24,i!==void 0){i=Qr(i);const a=nl(i);this.v4l^=kn(a[0]),this.v4h^=kn(a[1]),this.v5l^=kn(a[2]),this.v5h^=kn(a[3])}if(s!==void 0){s=Qr(s);const a=nl(s);this.v6l^=kn(a[0]),this.v6h^=kn(a[1]),this.v7l^=kn(a[2]),this.v7h^=kn(a[3])}if(n!==void 0){const a=new Uint8Array(this.blockLen);a.set(n),this.update(a)}}get(){let{v0l:e,v0h:t,v1l:n,v1h:s,v2l:i,v2h:o,v3l:a,v3h:c,v4l:l,v4h:u,v5l:h,v5h:f,v6l:d,v6h:p,v7l:g,v7h:m}=this;return[e,t,n,s,i,o,a,c,l,u,h,f,d,p,g,m]}set(e,t,n,s,i,o,a,c,l,u,h,f,d,p,g,m){this.v0l=e|0,this.v0h=t|0,this.v1l=n|0,this.v1h=s|0,this.v2l=i|0,this.v2h=o|0,this.v3l=a|0,this.v3h=c|0,this.v4l=l|0,this.v4h=u|0,this.v5l=h|0,this.v5h=f|0,this.v6l=d|0,this.v6h=p|0,this.v7l=g|0,this.v7h=m|0}compress(e,t,n){this.get().forEach((c,l)=>Z[l]=c),Z.set(We,16);let{h:s,l:i}=GE(BigInt(this.length));Z[24]=We[8]^i,Z[25]=We[9]^s,n&&(Z[28]=~Z[28],Z[29]=~Z[29]);let o=0;const a=aN;for(let c=0;c<12;c++)xs(0,4,8,12,e,t+2*a[o++]),Is(0,4,8,12,e,t+2*a[o++]),xs(1,5,9,13,e,t+2*a[o++]),Is(1,5,9,13,e,t+2*a[o++]),xs(2,6,10,14,e,t+2*a[o++]),Is(2,6,10,14,e,t+2*a[o++]),xs(3,7,11,15,e,t+2*a[o++]),Is(3,7,11,15,e,t+2*a[o++]),xs(0,5,10,15,e,t+2*a[o++]),Is(0,5,10,15,e,t+2*a[o++]),xs(1,6,11,12,e,t+2*a[o++]),Is(1,6,11,12,e,t+2*a[o++]),xs(2,7,8,13,e,t+2*a[o++]),Is(2,7,8,13,e,t+2*a[o++]),xs(3,4,9,14,e,t+2*a[o++]),Is(3,4,9,14,e,t+2*a[o++]);this.v0l^=Z[0]^Z[16],this.v0h^=Z[1]^Z[17],this.v1l^=Z[2]^Z[18],this.v1h^=Z[3]^Z[19],this.v2l^=Z[4]^Z[20],this.v2h^=Z[5]^Z[21],this.v3l^=Z[6]^Z[22],this.v3h^=Z[7]^Z[23],this.v4l^=Z[8]^Z[24],this.v4h^=Z[9]^Z[25],this.v5l^=Z[10]^Z[26],this.v5h^=Z[11]^Z[27],this.v6l^=Z[12]^Z[28],this.v6h^=Z[13]^Z[29],this.v7l^=Z[14]^Z[30],this.v7h^=Z[15]^Z[31],Cr(Z)}destroy(){this.destroyed=!0,Cr(this.buffer32),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const hN=$T(r=>new uN(r)),fN="https://rpc.walletconnect.org/v1";function o2(r){const e=`Ethereum Signed Message:
${r.length}`,t=new TextEncoder().encode(e+r);return"0x"+Buffer.from(QT(t)).toString("hex")}async function dN(r,e,t,n,s,i){switch(t.t){case"eip191":return await pN(r,e,t.s);case"eip1271":return await gN(r,e,t.s,n,s,i);default:throw new Error(`verifySignature failed: Attempted to verify CacaoSignature with unknown type: ${t.t}`)}}async function pN(r,e,t){return(await h8({hash:o2(e),signature:t})).toLowerCase()===r.toLowerCase()}async function gN(r,e,t,n,s,i){const o=ss(n);if(!o.namespace||!o.reference)throw new Error(`isValidEip1271Signature failed: chainId must be in CAIP-2 format, received: ${n}`);try{const a="0x1626ba7e",c="0000000000000000000000000000000000000000000000000000000000000040",l=t.substring(2),u=(l.length/2).toString(16).padStart(64,"0"),h=(e.startsWith("0x")?e:o2(e)).substring(2),f=a+h+c+u+l,d=await fetch(`${i||fN}/?chainId=${n}&projectId=${s}`,{headers:{"Content-Type":"application/json"},method:"POST",body:JSON.stringify({id:yN(),jsonrpc:"2.0",method:"eth_call",params:[{to:r,data:f},"latest"]})}),{result:p}=await d.json();return p?p.slice(0,a.length).toLowerCase()===a.toLowerCase():!1}catch(a){return console.error("isValidEip1271Signature: ",a),!1}}function yN(){return Date.now()+Math.floor(Math.random()*1e3)}function mN(r){const e=atob(r),t=new Uint8Array(e.length);for(let o=0;o<e.length;o++)t[o]=e.charCodeAt(o);const n=t[0];if(n===0)throw new Error("No signatures found");const s=1+n*64;if(t.length<s)throw new Error("Transaction data too short for claimed signature count");if(t.length<100)throw new Error("Transaction too short");const i=Buffer.from(r,"base64").slice(1,65);return Pl.encode(i)}function wN(r){const e=new Uint8Array(Buffer.from(r,"base64")),t=Array.from("TransactionData::").map(i=>i.charCodeAt(0)),n=new Uint8Array(t.length+e.length);n.set(t),n.set(e,t.length);const s=hN(n,{dkLen:32});return Pl.encode(s)}function Dm(r){const e=new Uint8Array(jh(bN(r)));return Pl.encode(e)}function bN(r){if(r instanceof Uint8Array)return r;if(Array.isArray(r))return new Uint8Array(r);if(typeof r=="object"&&r!=null&&r.data)return new Uint8Array(Object.values(r.data));if(typeof r=="object"&&r)return new Uint8Array(Object.values(r));throw new Error("getNearUint8ArrayFromBytes: Unexpected result type from bytes array")}function Cm(r){const e=Buffer.from(r,"base64"),t=W8(e).txn;if(!t)throw new Error("Invalid signed transaction: missing 'txn' field");const n=M8(t),s=Buffer.from("TX"),i=Buffer.concat([s,Buffer.from(n)]),o=oN(i);return nD.encode(o).replace(/=+$/,"")}function zf(r){const e=[];let t=BigInt(r);for(;t>=BigInt(128);)e.push(Number(t&BigInt(127)|BigInt(128))),t>>=BigInt(7);return e.push(Number(t)),Buffer.from(e)}function vN(r){const e=Buffer.from(r.signed.bodyBytes,"base64"),t=Buffer.from(r.signed.authInfoBytes,"base64"),n=Buffer.from(r.signature.signature,"base64"),s=[];s.push(Buffer.from([10])),s.push(zf(e.length)),s.push(e),s.push(Buffer.from([18])),s.push(zf(t.length)),s.push(t),s.push(Buffer.from([26])),s.push(zf(n.length)),s.push(n);const i=Buffer.concat(s),o=jh(i);return Buffer.from(o).toString("hex").toUpperCase()}function EN(r){var e,t;const n=[];try{if(typeof r=="string")return n.push(r),n;if(typeof r!="object")return n;r!=null&&r.id&&n.push(r.id);const s=(t=(e=r==null?void 0:r.capabilities)==null?void 0:e.caip345)==null?void 0:t.transactionHashes;s&&n.push(...s)}catch(s){console.warn("getWalletSendCallsHashes failed: ",s)}return n}var AN=Object.defineProperty,xN=Object.defineProperties,IN=Object.getOwnPropertyDescriptors,Bm=Object.getOwnPropertySymbols,SN=Object.prototype.hasOwnProperty,PN=Object.prototype.propertyIsEnumerable,_m=(r,e,t)=>e in r?AN(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ON=(r,e)=>{for(var t in e||(e={}))SN.call(e,t)&&_m(r,t,e[t]);if(Bm)for(var t of Bm(e))PN.call(e,t)&&_m(r,t,e[t]);return r},DN=(r,e)=>xN(r,IN(e));const CN="did:pkh:",Bg=r=>r==null?void 0:r.split(":"),BN=r=>{const e=r&&Bg(r);if(e)return r.includes(CN)?e[3]:e[1]},mp=r=>{const e=r&&Bg(r);if(e)return e[2]+":"+e[3]},rh=r=>{const e=r&&Bg(r);if(e)return e.pop()};async function Tm(r){const{cacao:e,projectId:t}=r,{s:n,p:s}=e,i=a2(s,s.iss),o=rh(s.iss);return await dN(o,i,n,mp(s.iss),t)}const a2=(r,e)=>{const t=`${r.domain} wants you to sign in with your Ethereum account:`,n=rh(e);if(!r.aud&&!r.uri)throw new Error("Either `aud` or `uri` is required to construct the message");let s=r.statement||void 0;const i=`URI: ${r.aud||r.uri}`,o=`Version: ${r.version}`,a=`Chain ID: ${BN(e)}`,c=`Nonce: ${r.nonce}`,l=`Issued At: ${r.iat}`,u=r.exp?`Expiration Time: ${r.exp}`:void 0,h=r.nbf?`Not Before: ${r.nbf}`:void 0,f=r.requestId?`Request ID: ${r.requestId}`:void 0,d=r.resources?`Resources:${r.resources.map(g=>`
- ${g}`).join("")}`:void 0,p=Su(r.resources);if(p){const g=sl(p);s=FN(s,g)}return[t,n,"",s,"",i,o,a,c,l,u,h,f,d].filter(g=>g!=null).join(`
`)};function _N(r){return Buffer.from(JSON.stringify(r)).toString("base64")}function TN(r){return JSON.parse(Buffer.from(r,"base64").toString("utf-8"))}function ao(r){if(!r)throw new Error("No recap provided, value is undefined");if(!r.att)throw new Error("No `att` property found");const e=Object.keys(r.att);if(!(e!=null&&e.length))throw new Error("No resources found in `att` property");e.forEach(t=>{const n=r.att[t];if(Array.isArray(n))throw new Error(`Resource must be an object: ${t}`);if(typeof n!="object")throw new Error(`Resource must be an object: ${t}`);if(!Object.keys(n).length)throw new Error(`Resource object is empty: ${t}`);Object.keys(n).forEach(s=>{const i=n[s];if(!Array.isArray(i))throw new Error(`Ability limits ${s} must be an array of objects, found: ${i}`);if(!i.length)throw new Error(`Value of ${s} is empty array, must be an array with objects`);i.forEach(o=>{if(typeof o!="object")throw new Error(`Ability limits (${s}) must be an array of objects, found: ${o}`)})})})}function NN(r,e,t,n={}){return t==null||t.sort((s,i)=>s.localeCompare(i)),{att:{[r]:RN(e,t,n)}}}function RN(r,e,t={}){e=e==null?void 0:e.sort((s,i)=>s.localeCompare(i));const n=e.map(s=>({[`${r}/${s}`]:[t]}));return Object.assign({},...n)}function c2(r){return ao(r),`urn:recap:${_N(r).replace(/=/g,"")}`}function sl(r){const e=TN(r.replace("urn:recap:",""));return ao(e),e}function UN(r,e,t){const n=NN(r,e,t);return c2(n)}function kN(r){return r&&r.includes("urn:recap:")}function $N(r,e){const t=sl(r),n=sl(e),s=LN(t,n);return c2(s)}function LN(r,e){ao(r),ao(e);const t=Object.keys(r.att).concat(Object.keys(e.att)).sort((s,i)=>s.localeCompare(i)),n={att:{}};return t.forEach(s=>{var i,o;Object.keys(((i=r.att)==null?void 0:i[s])||{}).concat(Object.keys(((o=e.att)==null?void 0:o[s])||{})).sort((a,c)=>a.localeCompare(c)).forEach(a=>{var c,l;n.att[s]=DN(ON({},n.att[s]),{[a]:((c=r.att[s])==null?void 0:c[a])||((l=e.att[s])==null?void 0:l[a])})})}),n}function FN(r="",e){ao(e);const t="I further authorize the stated URI to perform the following actions on my behalf: ";if(r.includes(t))return r;const n=[];let s=0;Object.keys(e.att).forEach(a=>{const c=Object.keys(e.att[a]).map(h=>({ability:h.split("/")[0],action:h.split("/")[1]}));c.sort((h,f)=>h.action.localeCompare(f.action));const l={};c.forEach(h=>{l[h.ability]||(l[h.ability]=[]),l[h.ability].push(h.action)});const u=Object.keys(l).map(h=>(s++,`(${s}) '${h}': '${l[h].join("', '")}' for '${a}'.`));n.push(u.join(", ").replace(".,","."))});const i=n.join(" "),o=`${t}${i}`;return`${r?r+" ":""}${o}`}function Nm(r){var e;const t=sl(r);ao(t);const n=(e=t.att)==null?void 0:e.eip155;return n?Object.keys(n).map(s=>s.split("/")[1]):[]}function Rm(r){const e=sl(r);ao(e);const t=[];return Object.values(e.att).forEach(n=>{Object.values(n).forEach(s=>{var i;(i=s==null?void 0:s[0])!=null&&i.chains&&t.push(s[0].chains)})}),[...new Set(t.flat())]}function Su(r){if(!r)return;const e=r==null?void 0:r[r.length-1];return kN(e)?e:void 0}/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function l2(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function wp(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}function Hf(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function Vt(r,...e){if(!l2(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function Um(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function MN(r,e){Vt(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function Zs(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}function Ja(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function jN(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}const zN=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function HN(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function bp(r){if(typeof r=="string")r=HN(r);else if(l2(r))r=vp(r);else throw new Error("Uint8Array expected, got "+typeof r);return r}function qN(r,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(r,e)}function VN(r,e){if(r.length!==e.length)return!1;let t=0;for(let n=0;n<r.length;n++)t|=r[n]^e[n];return t===0}const KN=(r,e)=>{function t(n,...s){if(Vt(n),!zN)throw new Error("Non little-endian hardware is not yet supported");if(r.nonceLength!==void 0){const l=s[0];if(!l)throw new Error("nonce / iv required");r.varSizeNonce?Vt(l):Vt(l,r.nonceLength)}const i=r.tagLength;i&&s[1]!==void 0&&Vt(s[1]);const o=e(n,...s),a=(l,u)=>{if(u!==void 0){if(l!==2)throw new Error("cipher output not supported");Vt(u)}};let c=!1;return{encrypt(l,u){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Vt(l),a(o.encrypt.length,u),o.encrypt(l,u)},decrypt(l,u){if(Vt(l),i&&l.length<i)throw new Error("invalid ciphertext length: smaller than tagLength="+i);return a(o.decrypt.length,u),o.decrypt(l,u)}}}return Object.assign(t,r),t};function km(r,e,t=!0){if(e===void 0)return new Uint8Array(r);if(e.length!==r)throw new Error("invalid output length, expected "+r+", got: "+e.length);if(t&&!QN(e))throw new Error("invalid output, must be aligned");return e}function $m(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const s=BigInt(32),i=BigInt(4294967295),o=Number(t>>s&i),a=Number(t&i);r.setUint32(e+4,o,n),r.setUint32(e+0,a,n)}function GN(r,e,t){wp(t);const n=new Uint8Array(16),s=jN(n);return $m(s,0,BigInt(e),t),$m(s,8,BigInt(r),t),n}function QN(r){return r.byteOffset%4===0}function vp(r){return Uint8Array.from(r)}const u2=r=>Uint8Array.from(r.split("").map(e=>e.charCodeAt(0))),WN=u2("expand 16-byte k"),JN=u2("expand 32-byte k"),YN=Zs(WN),ZN=Zs(JN);function we(r,e){return r<<e|r>>>32-e}function Ep(r){return r.byteOffset%4===0}const tu=64,XN=16,h2=2**32-1,Lm=new Uint32Array;function eR(r,e,t,n,s,i,o,a){const c=s.length,l=new Uint8Array(tu),u=Zs(l),h=Ep(s)&&Ep(i),f=h?Zs(s):Lm,d=h?Zs(i):Lm;for(let p=0;p<c;o++){if(r(e,t,n,u,o,a),o>=h2)throw new Error("arx: counter overflow");const g=Math.min(tu,c-p);if(h&&g===tu){const m=p/4;if(p%4!==0)throw new Error("arx: invalid block position");for(let b=0,x;b<XN;b++)x=m+b,d[x]=f[x]^u[b];p+=tu;continue}for(let m=0,b;m<g;m++)b=p+m,i[b]=s[b]^l[m];p+=g}}function tR(r,e){const{allowShortKeys:t,extendNonceFn:n,counterLength:s,counterRight:i,rounds:o}=qN({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof r!="function")throw new Error("core must be a function");return Hf(s),Hf(o),wp(i),wp(t),(a,c,l,u,h=0)=>{Vt(a),Vt(c),Vt(l);const f=l.length;if(u===void 0&&(u=new Uint8Array(f)),Vt(u),Hf(h),h<0||h>=h2)throw new Error("arx: counter overflow");if(u.length<f)throw new Error(`arx: output (${u.length}) is shorter than data (${f})`);const d=[];let p=a.length,g,m;if(p===32)d.push(g=vp(a)),m=ZN;else if(p===16&&t)g=new Uint8Array(32),g.set(a),g.set(a,16),m=YN,d.push(g);else throw new Error(`arx: invalid 32-byte key, got length=${p}`);Ep(c)||d.push(c=vp(c));const b=Zs(g);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(m,b,Zs(c.subarray(0,16)),b),c=c.subarray(16)}const x=16-s;if(x!==c.length)throw new Error(`arx: nonce must be ${x} or 16 bytes`);if(x!==12){const I=new Uint8Array(12);I.set(c,i?0:12-c.length),c=I,d.push(c)}const v=Zs(c);return eR(r,m,b,v,l,u,h,o),Ja(...d),u}}const it=(r,e)=>r[e++]&255|(r[e++]&255)<<8;class rR{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=bp(e),Vt(e,32);const t=it(e,0),n=it(e,2),s=it(e,4),i=it(e,6),o=it(e,8),a=it(e,10),c=it(e,12),l=it(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|n<<3)&8191,this.r[2]=(n>>>10|s<<6)&7939,this.r[3]=(s>>>7|i<<9)&8191,this.r[4]=(i>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=it(e,16+2*u)}process(e,t,n=!1){const s=n?0:2048,{h:i,r:o}=this,a=o[0],c=o[1],l=o[2],u=o[3],h=o[4],f=o[5],d=o[6],p=o[7],g=o[8],m=o[9],b=it(e,t+0),x=it(e,t+2),v=it(e,t+4),I=it(e,t+6),S=it(e,t+8),E=it(e,t+10),P=it(e,t+12),D=it(e,t+14);let B=i[0]+(b&8191),L=i[1]+((b>>>13|x<<3)&8191),j=i[2]+((x>>>10|v<<6)&8191),$=i[3]+((v>>>7|I<<9)&8191),U=i[4]+((I>>>4|S<<12)&8191),T=i[5]+(S>>>1&8191),w=i[6]+((S>>>14|E<<2)&8191),A=i[7]+((E>>>11|P<<5)&8191),C=i[8]+((P>>>8|D<<8)&8191),k=i[9]+(D>>>5|s),_=0,N=_+B*a+L*(5*m)+j*(5*g)+$*(5*p)+U*(5*d);_=N>>>13,N&=8191,N+=T*(5*f)+w*(5*h)+A*(5*u)+C*(5*l)+k*(5*c),_+=N>>>13,N&=8191;let z=_+B*c+L*a+j*(5*m)+$*(5*g)+U*(5*p);_=z>>>13,z&=8191,z+=T*(5*d)+w*(5*f)+A*(5*h)+C*(5*u)+k*(5*l),_+=z>>>13,z&=8191;let H=_+B*l+L*c+j*a+$*(5*m)+U*(5*g);_=H>>>13,H&=8191,H+=T*(5*p)+w*(5*d)+A*(5*f)+C*(5*h)+k*(5*u),_+=H>>>13,H&=8191;let Y=_+B*u+L*l+j*c+$*a+U*(5*m);_=Y>>>13,Y&=8191,Y+=T*(5*g)+w*(5*p)+A*(5*d)+C*(5*f)+k*(5*h),_+=Y>>>13,Y&=8191;let G=_+B*h+L*u+j*l+$*c+U*a;_=G>>>13,G&=8191,G+=T*(5*m)+w*(5*g)+A*(5*p)+C*(5*d)+k*(5*f),_+=G>>>13,G&=8191;let Q=_+B*f+L*h+j*u+$*l+U*c;_=Q>>>13,Q&=8191,Q+=T*a+w*(5*m)+A*(5*g)+C*(5*p)+k*(5*d),_+=Q>>>13,Q&=8191;let ee=_+B*d+L*f+j*h+$*u+U*l;_=ee>>>13,ee&=8191,ee+=T*c+w*a+A*(5*m)+C*(5*g)+k*(5*p),_+=ee>>>13,ee&=8191;let se=_+B*p+L*d+j*f+$*h+U*u;_=se>>>13,se&=8191,se+=T*l+w*c+A*a+C*(5*m)+k*(5*g),_+=se>>>13,se&=8191;let le=_+B*g+L*p+j*d+$*f+U*h;_=le>>>13,le&=8191,le+=T*u+w*l+A*c+C*a+k*(5*m),_+=le>>>13,le&=8191;let ne=_+B*m+L*g+j*p+$*d+U*f;_=ne>>>13,ne&=8191,ne+=T*h+w*u+A*l+C*c+k*a,_+=ne>>>13,ne&=8191,_=(_<<2)+_|0,_=_+N|0,N=_&8191,_=_>>>13,z+=_,i[0]=N,i[1]=z,i[2]=H,i[3]=Y,i[4]=G,i[5]=Q,i[6]=ee,i[7]=se,i[8]=le,i[9]=ne}finalize(){const{h:e,pad:t}=this,n=new Uint16Array(10);let s=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=s,s=e[a]>>>13,e[a]&=8191;e[0]+=s*5,s=e[0]>>>13,e[0]&=8191,e[1]+=s,s=e[1]>>>13,e[1]&=8191,e[2]+=s,n[0]=e[0]+5,s=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+s,s=n[a]>>>13,n[a]&=8191;n[9]-=8192;let i=(s^1)-1;for(let a=0;a<10;a++)n[a]&=i;i=~i;for(let a=0;a<10;a++)e[a]=e[a]&i|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+t[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+t[a]|0)+(o>>>16)|0,e[a]=o&65535;Ja(n)}update(e){Um(this),e=bp(e),Vt(e);const{buffer:t,blockLen:n}=this,s=e.length;for(let i=0;i<s;){const o=Math.min(n-this.pos,s-i);if(o===n){for(;n<=s-i;i+=n)this.process(e,i);continue}t.set(e.subarray(i,i+o),this.pos),this.pos+=o,i+=o,this.pos===n&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){Ja(this.h,this.r,this.buffer,this.pad)}digestInto(e){Um(this),MN(e,this),this.finished=!0;const{buffer:t,h:n}=this;let{pos:s}=this;if(s){for(t[s++]=1;s<16;s++)t[s]=0;this.process(t,0,!0)}this.finalize();let i=0;for(let o=0;o<8;o++)e[i++]=n[o]>>>0,e[i++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}}function nR(r){const e=(n,s)=>r(s).update(bp(n)).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=n=>r(n),e}const sR=nR(r=>new rR(r));function iR(r,e,t,n,s,i=20){let o=r[0],a=r[1],c=r[2],l=r[3],u=e[0],h=e[1],f=e[2],d=e[3],p=e[4],g=e[5],m=e[6],b=e[7],x=s,v=t[0],I=t[1],S=t[2],E=o,P=a,D=c,B=l,L=u,j=h,$=f,U=d,T=p,w=g,A=m,C=b,k=x,_=v,N=I,z=S;for(let Y=0;Y<i;Y+=2)E=E+L|0,k=we(k^E,16),T=T+k|0,L=we(L^T,12),E=E+L|0,k=we(k^E,8),T=T+k|0,L=we(L^T,7),P=P+j|0,_=we(_^P,16),w=w+_|0,j=we(j^w,12),P=P+j|0,_=we(_^P,8),w=w+_|0,j=we(j^w,7),D=D+$|0,N=we(N^D,16),A=A+N|0,$=we($^A,12),D=D+$|0,N=we(N^D,8),A=A+N|0,$=we($^A,7),B=B+U|0,z=we(z^B,16),C=C+z|0,U=we(U^C,12),B=B+U|0,z=we(z^B,8),C=C+z|0,U=we(U^C,7),E=E+j|0,z=we(z^E,16),A=A+z|0,j=we(j^A,12),E=E+j|0,z=we(z^E,8),A=A+z|0,j=we(j^A,7),P=P+$|0,k=we(k^P,16),C=C+k|0,$=we($^C,12),P=P+$|0,k=we(k^P,8),C=C+k|0,$=we($^C,7),D=D+U|0,_=we(_^D,16),T=T+_|0,U=we(U^T,12),D=D+U|0,_=we(_^D,8),T=T+_|0,U=we(U^T,7),B=B+L|0,N=we(N^B,16),w=w+N|0,L=we(L^w,12),B=B+L|0,N=we(N^B,8),w=w+N|0,L=we(L^w,7);let H=0;n[H++]=o+E|0,n[H++]=a+P|0,n[H++]=c+D|0,n[H++]=l+B|0,n[H++]=u+L|0,n[H++]=h+j|0,n[H++]=f+$|0,n[H++]=d+U|0,n[H++]=p+T|0,n[H++]=g+w|0,n[H++]=m+A|0,n[H++]=b+C|0,n[H++]=x+k|0,n[H++]=v+_|0,n[H++]=I+N|0,n[H++]=S+z|0}const oR=tR(iR,{counterRight:!1,counterLength:4,allowShortKeys:!1}),aR=new Uint8Array(16),Fm=(r,e)=>{r.update(e);const t=e.length%16;t&&r.update(aR.subarray(t))},cR=new Uint8Array(32);function Mm(r,e,t,n,s){const i=r(e,t,cR),o=sR.create(i);s&&Fm(o,s),Fm(o,n);const a=GN(n.length,s?s.length:0,!0);o.update(a);const c=o.digest();return Ja(i,a),c}const lR=r=>(e,t,n)=>({encrypt(s,i){const o=s.length;i=km(o+16,i,!1),i.set(s);const a=i.subarray(0,-16);r(e,t,a,a,1);const c=Mm(r,e,t,a,n);return i.set(c,o),Ja(c),i},decrypt(s,i){i=km(s.length-16,i,!1);const o=s.subarray(0,-16),a=s.subarray(-16),c=Mm(r,e,t,o,n);if(!VN(a,c))throw new Error("invalid tag");return i.set(s.subarray(0,-16)),r(e,t,i,i,1),Ja(c),i}}),f2=KN({blockSize:64,nonceLength:12,tagLength:16},lR(oR));let d2=class extends Mh{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,Fh(e);const n=Qr(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const s=this.blockLen,i=new Uint8Array(s);i.set(n.length>s?e.create().update(n).digest():n);for(let o=0;o<i.length;o++)i[o]^=54;this.iHash.update(i),this.oHash=e.create();for(let o=0;o<i.length;o++)i[o]^=106;this.oHash.update(i),Cr(i)}update(e){return ri(this),this.iHash.update(e),this}digestInto(e){ri(this),Jr(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:s,destroyed:i,blockLen:o,outputLen:a}=this;return e=e,e.finished=s,e.destroyed=i,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}};const zh=(r,e,t)=>new d2(r,e).update(t).digest();zh.create=(r,e)=>new d2(r,e);function uR(r,e,t){return Fh(r),t===void 0&&(t=new Uint8Array(r.outputLen)),zh(r,Qr(t),Qr(e))}const qf=Uint8Array.from([0]),jm=Uint8Array.of();function hR(r,e,t,n=32){Fh(r),hs(n);const s=r.outputLen;if(n>255*s)throw new Error("Length should be <= 255*HashLen");const i=Math.ceil(n/s);t===void 0&&(t=jm);const o=new Uint8Array(i*s),a=zh.create(r,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let u=0;u<i;u++)qf[0]=u+1,c.update(u===0?jm:l).update(t).update(qf).digestInto(l),o.set(l,s*u),a._cloneInto(c);return a.destroy(),c.destroy(),Cr(l,qf),o.slice(0,n)}const fR=(r,e,t,n,s)=>hR(r,uR(r,e,t),n,s),Hh=jh,_g=BigInt(0),Ap=BigInt(1);function nh(r,e=""){if(typeof r!="boolean"){const t=e&&`"${e}"`;throw new Error(t+"expected boolean, got type="+typeof r)}return r}function Bi(r,e,t=""){const n=Lh(r),s=r==null?void 0:r.length,i=e!==void 0;if(!n||i&&s!==e){const o=t&&`"${t}" `,a=i?` of length ${e}`:"",c=n?`length=${s}`:`type=${typeof r}`;throw new Error(o+"expected Uint8Array"+a+", got "+c)}return r}function ru(r){const e=r.toString(16);return e.length&1?"0"+e:e}function p2(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?_g:BigInt("0x"+r)}function qh(r){return p2(Yo(r))}function sh(r){return Jr(r),p2(Yo(Uint8Array.from(r).reverse()))}function Tg(r,e){return th(r.toString(16).padStart(e*2,"0"))}function Ng(r,e){return Tg(r,e).reverse()}function Pt(r,e,t){let n;if(typeof e=="string")try{n=th(e)}catch(i){throw new Error(r+" must be hex string or Uint8Array, cause: "+i)}else if(Lh(e))n=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");const s=n.length;if(typeof t=="number"&&s!==t)throw new Error(r+" of length "+t+" expected, got "+s);return n}const Vf=r=>typeof r=="bigint"&&_g<=r;function dR(r,e,t){return Vf(r)&&Vf(e)&&Vf(t)&&e<=r&&r<t}function xp(r,e,t,n){if(!dR(e,t,n))throw new Error("expected valid "+r+": "+t+" <= n < "+n+", got "+e)}function g2(r){let e;for(e=0;r>_g;r>>=Ap,e+=1);return e}const _l=r=>(Ap<<BigInt(r))-Ap;function pR(r,e,t){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");const n=f=>new Uint8Array(f),s=f=>Uint8Array.of(f);let i=n(r),o=n(r),a=0;const c=()=>{i.fill(1),o.fill(0),a=0},l=(...f)=>t(o,i,...f),u=(f=n(0))=>{o=l(s(0),f),i=l(),f.length!==0&&(o=l(s(1),f),i=l())},h=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let f=0;const d=[];for(;f<e;){i=l();const p=i.slice();d.push(p),f+=i.length}return _s(...d)};return(f,d)=>{c(),u(f);let p;for(;!(p=d(h()));)u();return c(),p}}function Vh(r,e,t={}){if(!r||typeof r!="object")throw new Error("expected valid options object");function n(s,i,o){const a=r[s];if(o&&a===void 0)return;const c=typeof a;if(c!==i||a===null)throw new Error(`param "${s}" is invalid: expected ${i}, got ${c}`)}Object.entries(e).forEach(([s,i])=>n(s,i,!1)),Object.entries(t).forEach(([s,i])=>n(s,i,!0))}function zm(r){const e=new WeakMap;return(t,...n)=>{const s=e.get(t);if(s!==void 0)return s;const i=r(t,...n);return e.set(t,i),i}}const Qt=BigInt(0),Ut=BigInt(1),_i=BigInt(2),y2=BigInt(3),m2=BigInt(4),w2=BigInt(5),gR=BigInt(7),b2=BigInt(8),yR=BigInt(9),v2=BigInt(16);function lr(r,e){const t=r%e;return t>=Qt?t:e+t}function Tr(r,e,t){let n=r;for(;e-- >Qt;)n*=n,n%=t;return n}function Hm(r,e){if(r===Qt)throw new Error("invert: expected non-zero number");if(e<=Qt)throw new Error("invert: expected positive modulus, got "+e);let t=lr(r,e),n=e,s=Qt,i=Ut;for(;t!==Qt;){const o=n/t,a=n%t,c=s-i*o;n=t,t=a,s=i,i=c}if(n!==Ut)throw new Error("invert: does not exist");return lr(s,e)}function Rg(r,e,t){if(!r.eql(r.sqr(e),t))throw new Error("Cannot find square root")}function E2(r,e){const t=(r.ORDER+Ut)/m2,n=r.pow(e,t);return Rg(r,n,e),n}function mR(r,e){const t=(r.ORDER-w2)/b2,n=r.mul(e,_i),s=r.pow(n,t),i=r.mul(e,s),o=r.mul(r.mul(i,_i),s),a=r.mul(i,r.sub(o,r.ONE));return Rg(r,a,e),a}function wR(r){const e=oi(r),t=A2(r),n=t(e,e.neg(e.ONE)),s=t(e,n),i=t(e,e.neg(n)),o=(r+gR)/v2;return(a,c)=>{let l=a.pow(c,o),u=a.mul(l,n);const h=a.mul(l,s),f=a.mul(l,i),d=a.eql(a.sqr(u),c),p=a.eql(a.sqr(h),c);l=a.cmov(l,u,d),u=a.cmov(f,h,p);const g=a.eql(a.sqr(u),c),m=a.cmov(l,u,g);return Rg(a,m,c),m}}function A2(r){if(r<y2)throw new Error("sqrt is not defined for small field");let e=r-Ut,t=0;for(;e%_i===Qt;)e/=_i,t++;let n=_i;const s=oi(r);for(;qm(s,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(t===1)return E2;let i=s.pow(n,e);const o=(e+Ut)/_i;return function(a,c){if(a.is0(c))return c;if(qm(a,c)!==1)throw new Error("Cannot find square root");let l=t,u=a.mul(a.ONE,i),h=a.pow(c,e),f=a.pow(c,o);for(;!a.eql(h,a.ONE);){if(a.is0(h))return a.ZERO;let d=1,p=a.sqr(h);for(;!a.eql(p,a.ONE);)if(d++,p=a.sqr(p),d===l)throw new Error("Cannot find square root");const g=Ut<<BigInt(l-d-1),m=a.pow(u,g);l=d,u=a.sqr(m),h=a.mul(h,u),f=a.mul(f,m)}return f}}function bR(r){return r%m2===y2?E2:r%b2===w2?mR:r%v2===yR?wR(r):A2(r)}const vR=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function ER(r){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},t=vR.reduce((n,s)=>(n[s]="function",n),e);return Vh(r,t),r}function AR(r,e,t){if(t<Qt)throw new Error("invalid exponent, negatives unsupported");if(t===Qt)return r.ONE;if(t===Ut)return e;let n=r.ONE,s=e;for(;t>Qt;)t&Ut&&(n=r.mul(n,s)),s=r.sqr(s),t>>=Ut;return n}function x2(r,e,t=!1){const n=new Array(e.length).fill(t?r.ZERO:void 0),s=e.reduce((o,a,c)=>r.is0(a)?o:(n[c]=o,r.mul(o,a)),r.ONE),i=r.inv(s);return e.reduceRight((o,a,c)=>r.is0(a)?o:(n[c]=r.mul(o,n[c]),r.mul(o,a)),i),n}function qm(r,e){const t=(r.ORDER-Ut)/_i,n=r.pow(e,t),s=r.eql(n,r.ONE),i=r.eql(n,r.ZERO),o=r.eql(n,r.neg(r.ONE));if(!s&&!i&&!o)throw new Error("invalid Legendre symbol result");return s?1:i?0:-1}function I2(r,e){e!==void 0&&hs(e);const t=e!==void 0?e:r.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}function oi(r,e,t=!1,n={}){if(r<=Qt)throw new Error("invalid field: expected ORDER > 0, got "+r);let s,i,o=!1,a;if(typeof e=="object"&&e!=null){if(n.sqrt||t)throw new Error("cannot specify opts in two arguments");const f=e;f.BITS&&(s=f.BITS),f.sqrt&&(i=f.sqrt),typeof f.isLE=="boolean"&&(t=f.isLE),typeof f.modFromBytes=="boolean"&&(o=f.modFromBytes),a=f.allowedLengths}else typeof e=="number"&&(s=e),n.sqrt&&(i=n.sqrt);const{nBitLength:c,nByteLength:l}=I2(r,s);if(l>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let u;const h=Object.freeze({ORDER:r,isLE:t,BITS:c,BYTES:l,MASK:_l(c),ZERO:Qt,ONE:Ut,allowedLengths:a,create:f=>lr(f,r),isValid:f=>{if(typeof f!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof f);return Qt<=f&&f<r},is0:f=>f===Qt,isValidNot0:f=>!h.is0(f)&&h.isValid(f),isOdd:f=>(f&Ut)===Ut,neg:f=>lr(-f,r),eql:(f,d)=>f===d,sqr:f=>lr(f*f,r),add:(f,d)=>lr(f+d,r),sub:(f,d)=>lr(f-d,r),mul:(f,d)=>lr(f*d,r),pow:(f,d)=>AR(h,f,d),div:(f,d)=>lr(f*Hm(d,r),r),sqrN:f=>f*f,addN:(f,d)=>f+d,subN:(f,d)=>f-d,mulN:(f,d)=>f*d,inv:f=>Hm(f,r),sqrt:i||(f=>(u||(u=bR(r)),u(h,f))),toBytes:f=>t?Ng(f,l):Tg(f,l),fromBytes:(f,d=!0)=>{if(a){if(!a.includes(f.length)||f.length>l)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+f.length);const g=new Uint8Array(l);g.set(f,t?0:g.length-f.length),f=g}if(f.length!==l)throw new Error("Field.fromBytes: expected "+l+" bytes, got "+f.length);let p=t?sh(f):qh(f);if(o&&(p=lr(p,r)),!d&&!h.isValid(p))throw new Error("invalid field element: outside of range 0..ORDER");return p},invertBatch:f=>x2(h,f),cmov:(f,d,p)=>p?d:f});return Object.freeze(h)}function S2(r){if(typeof r!="bigint")throw new Error("field order must be bigint");const e=r.toString(2).length;return Math.ceil(e/8)}function P2(r){const e=S2(r);return e+Math.ceil(e/2)}function xR(r,e,t=!1){const n=r.length,s=S2(e),i=P2(e);if(n<16||n<i||n>1024)throw new Error("expected "+i+"-1024 bytes of input, got "+n);const o=t?sh(r):qh(r),a=lr(o,e-Ut)+Ut;return t?Ng(a,s):Tg(a,s)}const Ya=BigInt(0),Ti=BigInt(1);function ih(r,e){const t=e.negate();return r?t:e}function Kf(r,e){const t=x2(r.Fp,e.map(n=>n.Z));return e.map((n,s)=>r.fromAffine(n.toAffine(t[s])))}function O2(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function Gf(r,e){O2(r,e);const t=Math.ceil(e/r)+1,n=2**(r-1),s=2**r,i=_l(r),o=BigInt(r);return{windows:t,windowSize:n,mask:i,maxNumber:s,shiftBy:o}}function Vm(r,e,t){const{windowSize:n,mask:s,maxNumber:i,shiftBy:o}=t;let a=Number(r&s),c=r>>o;a>n&&(a-=i,c+=Ti);const l=e*n,u=l+Math.abs(a)-1,h=a===0,f=a<0,d=e%2!==0;return{nextN:c,offset:u,isZero:h,isNeg:f,isNegF:d,offsetF:l}}function IR(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,n)=>{if(!(t instanceof e))throw new Error("invalid point at index "+n)})}function SR(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,n)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+n)})}const Qf=new WeakMap,D2=new WeakMap;function Wf(r){return D2.get(r)||1}function Km(r){if(r!==Ya)throw new Error("invalid wNAF")}class PR{constructor(e,t){this.BASE=e.BASE,this.ZERO=e.ZERO,this.Fn=e.Fn,this.bits=t}_unsafeLadder(e,t,n=this.ZERO){let s=e;for(;t>Ya;)t&Ti&&(n=n.add(s)),s=s.double(),t>>=Ti;return n}precomputeWindow(e,t){const{windows:n,windowSize:s}=Gf(t,this.bits),i=[];let o=e,a=o;for(let c=0;c<n;c++){a=o,i.push(a);for(let l=1;l<s;l++)a=a.add(o),i.push(a);o=a.double()}return i}wNAF(e,t,n){if(!this.Fn.isValid(n))throw new Error("invalid scalar");let s=this.ZERO,i=this.BASE;const o=Gf(e,this.bits);for(let a=0;a<o.windows;a++){const{nextN:c,offset:l,isZero:u,isNeg:h,isNegF:f,offsetF:d}=Vm(n,a,o);n=c,u?i=i.add(ih(f,t[d])):s=s.add(ih(h,t[l]))}return Km(n),{p:s,f:i}}wNAFUnsafe(e,t,n,s=this.ZERO){const i=Gf(e,this.bits);for(let o=0;o<i.windows&&n!==Ya;o++){const{nextN:a,offset:c,isZero:l,isNeg:u}=Vm(n,o,i);if(n=a,!l){const h=t[c];s=s.add(u?h.negate():h)}}return Km(n),s}getPrecomputes(e,t,n){let s=Qf.get(t);return s||(s=this.precomputeWindow(t,e),e!==1&&(typeof n=="function"&&(s=n(s)),Qf.set(t,s))),s}cached(e,t,n){const s=Wf(e);return this.wNAF(s,this.getPrecomputes(s,e,n),t)}unsafe(e,t,n,s){const i=Wf(e);return i===1?this._unsafeLadder(e,t,s):this.wNAFUnsafe(i,this.getPrecomputes(i,e,n),t,s)}createCache(e,t){O2(t,this.bits),D2.set(e,t),Qf.delete(e)}hasCache(e){return Wf(e)!==1}}function OR(r,e,t,n){let s=e,i=r.ZERO,o=r.ZERO;for(;t>Ya||n>Ya;)t&Ti&&(i=i.add(s)),n&Ti&&(o=o.add(s)),s=s.double(),t>>=Ti,n>>=Ti;return{p1:i,p2:o}}function DR(r,e,t,n){IR(t,r),SR(n,e);const s=t.length,i=n.length;if(s!==i)throw new Error("arrays of points and scalars must have equal length");const o=r.ZERO,a=g2(BigInt(s));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=_l(c),u=new Array(Number(l)+1).fill(o),h=Math.floor((e.BITS-1)/c)*c;let f=o;for(let d=h;d>=0;d-=c){u.fill(o);for(let g=0;g<i;g++){const m=n[g],b=Number(m>>BigInt(d)&l);u[b]=u[b].add(t[g])}let p=o;for(let g=u.length-1,m=o;g>0;g--)m=m.add(u[g]),p=p.add(m);if(f=f.add(p),d!==0)for(let g=0;g<c;g++)f=f.double()}return f}function Gm(r,e,t){if(e){if(e.ORDER!==r)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return ER(e),e}else return oi(r,{isLE:t})}function CR(r,e,t={},n){if(n===void 0&&(n=r==="edwards"),!e||typeof e!="object")throw new Error(`expected valid ${r} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!(typeof c=="bigint"&&c>Ya))throw new Error(`CURVE.${a} must be positive bigint`)}const s=Gm(e.p,t.Fp,n),i=Gm(e.n,t.Fn,n),o=["Gx","Gy","a","b"];for(const a of o)if(!s.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return e=Object.freeze(Object.assign({},e)),{CURVE:e,Fp:s,Fn:i}}BigInt(0),BigInt(1),BigInt(2),BigInt(8),ZE("HashToScalar-");const wc=BigInt(0),Oo=BigInt(1),nu=BigInt(2);function BR(r){return Vh(r,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...r})}function _R(r){const e=BR(r),{P:t,type:n,adjustScalarBytes:s,powPminus2:i,randomBytes:o}=e,a=n==="x25519";if(!a&&n!=="x448")throw new Error("invalid type");const c=o||po,l=a?255:448,u=a?32:56,h=BigInt(a?9:5),f=BigInt(a?121665:39081),d=a?nu**BigInt(254):nu**BigInt(447),p=a?BigInt(8)*nu**BigInt(251)-Oo:BigInt(4)*nu**BigInt(445)-Oo,g=d+p+Oo,m=$=>lr($,t),b=x(h);function x($){return Ng(m($),u)}function v($){const U=Pt("u coordinate",$,u);return a&&(U[31]&=127),m(sh(U))}function I($){return sh(s(Pt("scalar",$,u)))}function S($,U){const T=D(v(U),I($));if(T===wc)throw new Error("invalid private or public key received");return x(T)}function E($){return S($,b)}function P($,U,T){const w=m($*(U-T));return U=m(U-w),T=m(T+w),{x_2:U,x_3:T}}function D($,U){xp("u",$,wc,t),xp("scalar",U,d,g);const T=U,w=$;let A=Oo,C=wc,k=$,_=Oo,N=wc;for(let H=BigInt(l-1);H>=wc;H--){const Y=T>>H&Oo;N^=Y,{x_2:A,x_3:k}=P(N,A,k),{x_2:C,x_3:_}=P(N,C,_),N=Y;const G=A+C,Q=m(G*G),ee=A-C,se=m(ee*ee),le=Q-se,ne=k+_,fe=k-_,ke=m(fe*G),qe=m(ne*ee),$e=ke+qe,mt=ke-qe;k=m($e*$e),_=m(w*m(mt*mt)),A=m(Q*se),C=m(le*(Q+m(f*le)))}({x_2:A,x_3:k}=P(N,A,k)),{x_2:C,x_3:_}=P(N,C,_);const z=i(C);return m(A*z)}const B={secretKey:u,publicKey:u,seed:u},L=($=c(u))=>(Jr($,B.seed),$);function j($){const U=L($);return{secretKey:U,publicKey:E(U)}}return{keygen:j,getSharedSecret:($,U)=>S($,U),getPublicKey:$=>E($),scalarMult:S,scalarMultBase:E,utils:{randomSecretKey:L,randomPrivateKey:L},GuBytes:b.slice(),lengths:B}}const TR=BigInt(1),Qm=BigInt(2),NR=BigInt(3),RR=BigInt(5);BigInt(8);const C2=BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),UR={p:C2,n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function kR(r){const e=BigInt(10),t=BigInt(20),n=BigInt(40),s=BigInt(80),i=C2,o=r*r%i*r%i,a=Tr(o,Qm,i)*o%i,c=Tr(a,TR,i)*r%i,l=Tr(c,RR,i)*c%i,u=Tr(l,e,i)*l%i,h=Tr(u,t,i)*u%i,f=Tr(h,n,i)*h%i,d=Tr(f,s,i)*f%i,p=Tr(d,s,i)*f%i,g=Tr(p,e,i)*l%i;return{pow_p_5_8:Tr(g,Qm,i)*r%i,b2:o}}function $R(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}const LR=oi(UR.p,{isLE:!0}),Ip=(()=>{const r=LR.ORDER;return _R({P:r,type:"x25519",powPminus2:e=>{const{pow_p_5_8:t,b2:n}=kR(e);return lr(Tr(t,NR,r)*n,r)},adjustScalarBytes:$R})})(),Wm=(r,e)=>(r+(r>=0?e:-e)/B2)/e;function FR(r,e,t){const[[n,s],[i,o]]=e,a=Wm(o*r,t),c=Wm(-s*r,t);let l=r-a*n-c*i,u=-a*s-c*o;const h=l<ts,f=u<ts;h&&(l=-l),f&&(u=-u);const d=_l(Math.ceil(g2(t)/2))+Zo;if(l<ts||l>=d||u<ts||u>=d)throw new Error("splitScalar (endomorphism): failed, k="+r);return{k1neg:h,k1:l,k2neg:f,k2:u}}function Sp(r){if(!["compact","recovered","der"].includes(r))throw new Error('Signature format must be "compact", "recovered", or "der"');return r}function Jf(r,e){const t={};for(let n of Object.keys(e))t[n]=r[n]===void 0?e[n]:r[n];return nh(t.lowS,"lowS"),nh(t.prehash,"prehash"),t.format!==void 0&&Sp(t.format),t}class MR extends Error{constructor(e=""){super(e)}}const jn={Err:MR,_tlv:{encode:(r,e)=>{const{Err:t}=jn;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const n=e.length/2,s=ru(n);if(s.length/2&128)throw new t("tlv.encode: long form length too big");const i=n>127?ru(s.length/2|128):"";return ru(r)+i+s+e},decode(r,e){const{Err:t}=jn;let n=0;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[n++]!==r)throw new t("tlv.decode: wrong tlv");const s=e[n++],i=!!(s&128);let o=0;if(!i)o=s;else{const c=s&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");const l=e.subarray(n,n+c);if(l.length!==c)throw new t("tlv.decode: length bytes not complete");if(l[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(n+=c,o<128)throw new t("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(r){const{Err:e}=jn;if(r<ts)throw new e("integer: negative integers are not allowed");let t=ru(r);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(r){const{Err:e}=jn;if(r[0]&128)throw new e("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return qh(r)}},toSig(r){const{Err:e,_int:t,_tlv:n}=jn,s=Pt("signature",r),{v:i,l:o}=n.decode(48,s);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,i),{v:l,l:u}=n.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(l)}},hexFromSig(r){const{_tlv:e,_int:t}=jn,n=e.encode(2,t.encode(r.r)),s=e.encode(2,t.encode(r.s)),i=n+s;return e.encode(48,i)}},ts=BigInt(0),Zo=BigInt(1),B2=BigInt(2),su=BigInt(3),jR=BigInt(4);function Fo(r,e){const{BYTES:t}=r;let n;if(typeof e=="bigint")n=e;else{let s=Pt("private key",e);try{n=r.fromBytes(s)}catch{throw new Error(`invalid private key: expected ui8a of size ${t}, got ${typeof e}`)}}if(!r.isValidNot0(n))throw new Error("invalid private key: out of range [1..N-1]");return n}function zR(r,e={}){const t=CR("weierstrass",r,e),{Fp:n,Fn:s}=t;let i=t.CURVE;const{h:o,n:a}=i;Vh(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:c}=e;if(c&&(!n.is0(i.a)||typeof c.beta!="bigint"||!Array.isArray(c.basises)))throw new Error('invalid endo: expected "beta": bigint and "basises": array');const l=T2(n,s);function u(){if(!n.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function h($,U,T){const{x:w,y:A}=U.toAffine(),C=n.toBytes(w);if(nh(T,"isCompressed"),T){u();const k=!n.isOdd(A);return _s(_2(k),C)}else return _s(Uint8Array.of(4),C,n.toBytes(A))}function f($){Bi($,void 0,"Point");const{publicKey:U,publicKeyUncompressed:T}=l,w=$.length,A=$[0],C=$.subarray(1);if(w===U&&(A===2||A===3)){const k=n.fromBytes(C);if(!n.isValid(k))throw new Error("bad point: is not on curve, wrong x");const _=g(k);let N;try{N=n.sqrt(_)}catch(H){const Y=H instanceof Error?": "+H.message:"";throw new Error("bad point: is not on curve, sqrt error"+Y)}u();const z=n.isOdd(N);return(A&1)===1!==z&&(N=n.neg(N)),{x:k,y:N}}else if(w===T&&A===4){const k=n.BYTES,_=n.fromBytes(C.subarray(0,k)),N=n.fromBytes(C.subarray(k,k*2));if(!m(_,N))throw new Error("bad point: is not on curve");return{x:_,y:N}}else throw new Error(`bad point: got length ${w}, expected compressed=${U} or uncompressed=${T}`)}const d=e.toBytes||h,p=e.fromBytes||f;function g($){const U=n.sqr($),T=n.mul(U,$);return n.add(n.add(T,n.mul($,i.a)),i.b)}function m($,U){const T=n.sqr(U),w=g($);return n.eql(T,w)}if(!m(i.Gx,i.Gy))throw new Error("bad curve params: generator point");const b=n.mul(n.pow(i.a,su),jR),x=n.mul(n.sqr(i.b),BigInt(27));if(n.is0(n.add(b,x)))throw new Error("bad curve params: a or b");function v($,U,T=!1){if(!n.isValid(U)||T&&n.is0(U))throw new Error(`bad point coordinate ${$}`);return U}function I($){if(!($ instanceof B))throw new Error("ProjectivePoint expected")}function S($){if(!c||!c.basises)throw new Error("no endo");return FR($,c.basises,s.ORDER)}const E=zm(($,U)=>{const{X:T,Y:w,Z:A}=$;if(n.eql(A,n.ONE))return{x:T,y:w};const C=$.is0();U==null&&(U=C?n.ONE:n.inv(A));const k=n.mul(T,U),_=n.mul(w,U),N=n.mul(A,U);if(C)return{x:n.ZERO,y:n.ZERO};if(!n.eql(N,n.ONE))throw new Error("invZ was invalid");return{x:k,y:_}}),P=zm($=>{if($.is0()){if(e.allowInfinityPoint&&!n.is0($.Y))return;throw new Error("bad point: ZERO")}const{x:U,y:T}=$.toAffine();if(!n.isValid(U)||!n.isValid(T))throw new Error("bad point: x or y not field elements");if(!m(U,T))throw new Error("bad point: equation left != right");if(!$.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function D($,U,T,w,A){return T=new B(n.mul(T.X,$),T.Y,T.Z),U=ih(w,U),T=ih(A,T),U.add(T)}class B{constructor(U,T,w){this.X=v("x",U),this.Y=v("y",T,!0),this.Z=v("z",w),Object.freeze(this)}static CURVE(){return i}static fromAffine(U){const{x:T,y:w}=U||{};if(!U||!n.isValid(T)||!n.isValid(w))throw new Error("invalid affine point");if(U instanceof B)throw new Error("projective point not allowed");return n.is0(T)&&n.is0(w)?B.ZERO:new B(T,w,n.ONE)}static fromBytes(U){const T=B.fromAffine(p(Bi(U,void 0,"point")));return T.assertValidity(),T}static fromHex(U){return B.fromBytes(Pt("pointHex",U))}get x(){return this.toAffine().x}get y(){return this.toAffine().y}precompute(U=8,T=!0){return j.createCache(this,U),T||this.multiply(su),this}assertValidity(){P(this)}hasEvenY(){const{y:U}=this.toAffine();if(!n.isOdd)throw new Error("Field doesn't support isOdd");return!n.isOdd(U)}equals(U){I(U);const{X:T,Y:w,Z:A}=this,{X:C,Y:k,Z:_}=U,N=n.eql(n.mul(T,_),n.mul(C,A)),z=n.eql(n.mul(w,_),n.mul(k,A));return N&&z}negate(){return new B(this.X,n.neg(this.Y),this.Z)}double(){const{a:U,b:T}=i,w=n.mul(T,su),{X:A,Y:C,Z:k}=this;let _=n.ZERO,N=n.ZERO,z=n.ZERO,H=n.mul(A,A),Y=n.mul(C,C),G=n.mul(k,k),Q=n.mul(A,C);return Q=n.add(Q,Q),z=n.mul(A,k),z=n.add(z,z),_=n.mul(U,z),N=n.mul(w,G),N=n.add(_,N),_=n.sub(Y,N),N=n.add(Y,N),N=n.mul(_,N),_=n.mul(Q,_),z=n.mul(w,z),G=n.mul(U,G),Q=n.sub(H,G),Q=n.mul(U,Q),Q=n.add(Q,z),z=n.add(H,H),H=n.add(z,H),H=n.add(H,G),H=n.mul(H,Q),N=n.add(N,H),G=n.mul(C,k),G=n.add(G,G),H=n.mul(G,Q),_=n.sub(_,H),z=n.mul(G,Y),z=n.add(z,z),z=n.add(z,z),new B(_,N,z)}add(U){I(U);const{X:T,Y:w,Z:A}=this,{X:C,Y:k,Z:_}=U;let N=n.ZERO,z=n.ZERO,H=n.ZERO;const Y=i.a,G=n.mul(i.b,su);let Q=n.mul(T,C),ee=n.mul(w,k),se=n.mul(A,_),le=n.add(T,w),ne=n.add(C,k);le=n.mul(le,ne),ne=n.add(Q,ee),le=n.sub(le,ne),ne=n.add(T,A);let fe=n.add(C,_);return ne=n.mul(ne,fe),fe=n.add(Q,se),ne=n.sub(ne,fe),fe=n.add(w,A),N=n.add(k,_),fe=n.mul(fe,N),N=n.add(ee,se),fe=n.sub(fe,N),H=n.mul(Y,ne),N=n.mul(G,se),H=n.add(N,H),N=n.sub(ee,H),H=n.add(ee,H),z=n.mul(N,H),ee=n.add(Q,Q),ee=n.add(ee,Q),se=n.mul(Y,se),ne=n.mul(G,ne),ee=n.add(ee,se),se=n.sub(Q,se),se=n.mul(Y,se),ne=n.add(ne,se),Q=n.mul(ee,ne),z=n.add(z,Q),Q=n.mul(fe,ne),N=n.mul(le,N),N=n.sub(N,Q),Q=n.mul(le,ee),H=n.mul(fe,H),H=n.add(H,Q),new B(N,z,H)}subtract(U){return this.add(U.negate())}is0(){return this.equals(B.ZERO)}multiply(U){const{endo:T}=e;if(!s.isValidNot0(U))throw new Error("invalid scalar: out of range");let w,A;const C=k=>j.cached(this,k,_=>Kf(B,_));if(T){const{k1neg:k,k1:_,k2neg:N,k2:z}=S(U),{p:H,f:Y}=C(_),{p:G,f:Q}=C(z);A=Y.add(Q),w=D(T.beta,H,G,k,N)}else{const{p:k,f:_}=C(U);w=k,A=_}return Kf(B,[w,A])[0]}multiplyUnsafe(U){const{endo:T}=e,w=this;if(!s.isValid(U))throw new Error("invalid scalar: out of range");if(U===ts||w.is0())return B.ZERO;if(U===Zo)return w;if(j.hasCache(this))return this.multiply(U);if(T){const{k1neg:A,k1:C,k2neg:k,k2:_}=S(U),{p1:N,p2:z}=OR(B,w,C,_);return D(T.beta,N,z,A,k)}else return j.unsafe(w,U)}multiplyAndAddUnsafe(U,T,w){const A=this.multiplyUnsafe(T).add(U.multiplyUnsafe(w));return A.is0()?void 0:A}toAffine(U){return E(this,U)}isTorsionFree(){const{isTorsionFree:U}=e;return o===Zo?!0:U?U(B,this):j.unsafe(this,a).is0()}clearCofactor(){const{clearCofactor:U}=e;return o===Zo?this:U?U(B,this):this.multiplyUnsafe(o)}isSmallOrder(){return this.multiplyUnsafe(o).is0()}toBytes(U=!0){return nh(U,"isCompressed"),this.assertValidity(),d(B,this,U)}toHex(U=!0){return Yo(this.toBytes(U))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}get px(){return this.X}get py(){return this.X}get pz(){return this.Z}toRawBytes(U=!0){return this.toBytes(U)}_setWindowSize(U){this.precompute(U)}static normalizeZ(U){return Kf(B,U)}static msm(U,T){return DR(B,s,U,T)}static fromPrivateKey(U){return B.BASE.multiply(Fo(s,U))}}B.BASE=new B(i.Gx,i.Gy,n.ONE),B.ZERO=new B(n.ZERO,n.ONE,n.ZERO),B.Fp=n,B.Fn=s;const L=s.BITS,j=new PR(B,e.endo?Math.ceil(L/2):L);return B.BASE.precompute(8),B}function _2(r){return Uint8Array.of(r?2:3)}function T2(r,e){return{secretKey:e.BYTES,publicKey:1+r.BYTES,publicKeyUncompressed:1+2*r.BYTES,publicKeyHasPrefix:!0,signature:2*e.BYTES}}function HR(r,e={}){const{Fn:t}=r,n=e.randomBytes||po,s=Object.assign(T2(r.Fp,t),{seed:P2(t.ORDER)});function i(f){try{return!!Fo(t,f)}catch{return!1}}function o(f,d){const{publicKey:p,publicKeyUncompressed:g}=s;try{const m=f.length;return d===!0&&m!==p||d===!1&&m!==g?!1:!!r.fromBytes(f)}catch{return!1}}function a(f=n(s.seed)){return xR(Bi(f,s.seed,"seed"),t.ORDER)}function c(f,d=!0){return r.BASE.multiply(Fo(t,f)).toBytes(d)}function l(f){const d=a(f);return{secretKey:d,publicKey:c(d)}}function u(f){if(typeof f=="bigint")return!1;if(f instanceof r)return!0;const{secretKey:d,publicKey:p,publicKeyUncompressed:g}=s;if(t.allowedLengths||d===p)return;const m=Pt("key",f).length;return m===p||m===g}function h(f,d,p=!0){if(u(f)===!0)throw new Error("first arg must be private key");if(u(d)===!1)throw new Error("second arg must be public key");const g=Fo(t,f);return r.fromHex(d).multiply(g).toBytes(p)}return Object.freeze({getPublicKey:c,getSharedSecret:h,keygen:l,Point:r,utils:{isValidSecretKey:i,isValidPublicKey:o,randomSecretKey:a,isValidPrivateKey:i,randomPrivateKey:a,normPrivateKeyToScalar:f=>Fo(t,f),precompute(f=8,d=r.BASE){return d.precompute(f,!1)}},lengths:s})}function qR(r,e,t={}){Fh(e),Vh(t,{},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const n=t.randomBytes||po,s=t.hmac||((T,...w)=>zh(e,T,_s(...w))),{Fp:i,Fn:o}=r,{ORDER:a,BITS:c}=o,{keygen:l,getPublicKey:u,getSharedSecret:h,utils:f,lengths:d}=HR(r,t),p={prehash:!1,lowS:typeof t.lowS=="boolean"?t.lowS:!1,format:void 0,extraEntropy:!1},g="compact";function m(T){const w=a>>Zo;return T>w}function b(T,w){if(!o.isValidNot0(w))throw new Error(`invalid signature ${T}: out of range 1..Point.Fn.ORDER`);return w}function x(T,w){Sp(w);const A=d.signature,C=w==="compact"?A:w==="recovered"?A+1:void 0;return Bi(T,C,`${w} signature`)}class v{constructor(w,A,C){this.r=b("r",w),this.s=b("s",A),C!=null&&(this.recovery=C),Object.freeze(this)}static fromBytes(w,A=g){x(w,A);let C;if(A==="der"){const{r:z,s:H}=jn.toSig(Bi(w));return new v(z,H)}A==="recovered"&&(C=w[0],A="compact",w=w.subarray(1));const k=o.BYTES,_=w.subarray(0,k),N=w.subarray(k,k*2);return new v(o.fromBytes(_),o.fromBytes(N),C)}static fromHex(w,A){return this.fromBytes(th(w),A)}addRecoveryBit(w){return new v(this.r,this.s,w)}recoverPublicKey(w){const A=i.ORDER,{r:C,s:k,recovery:_}=this;if(_==null||![0,1,2,3].includes(_))throw new Error("recovery id invalid");if(a*B2<A&&_>1)throw new Error("recovery id is ambiguous for h>1 curve");const N=_===2||_===3?C+a:C;if(!i.isValid(N))throw new Error("recovery id 2 or 3 invalid");const z=i.toBytes(N),H=r.fromBytes(_s(_2((_&1)===0),z)),Y=o.inv(N),G=S(Pt("msgHash",w)),Q=o.create(-G*Y),ee=o.create(k*Y),se=r.BASE.multiplyUnsafe(Q).add(H.multiplyUnsafe(ee));if(se.is0())throw new Error("point at infinify");return se.assertValidity(),se}hasHighS(){return m(this.s)}toBytes(w=g){if(Sp(w),w==="der")return th(jn.hexFromSig(this));const A=o.toBytes(this.r),C=o.toBytes(this.s);if(w==="recovered"){if(this.recovery==null)throw new Error("recovery bit must be present");return _s(Uint8Array.of(this.recovery),A,C)}return _s(A,C)}toHex(w){return Yo(this.toBytes(w))}assertValidity(){}static fromCompact(w){return v.fromBytes(Pt("sig",w),"compact")}static fromDER(w){return v.fromBytes(Pt("sig",w),"der")}normalizeS(){return this.hasHighS()?new v(this.r,o.neg(this.s),this.recovery):this}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Yo(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Yo(this.toBytes("compact"))}}const I=t.bits2int||function(T){if(T.length>8192)throw new Error("input is too large");const w=qh(T),A=T.length*8-c;return A>0?w>>BigInt(A):w},S=t.bits2int_modN||function(T){return o.create(I(T))},E=_l(c);function P(T){return xp("num < 2^"+c,T,ts,E),o.toBytes(T)}function D(T,w){return Bi(T,void 0,"message"),w?Bi(e(T),void 0,"prehashed message"):T}function B(T,w,A){if(["recovered","canonical"].some(ee=>ee in A))throw new Error("sign() legacy options not supported");const{lowS:C,prehash:k,extraEntropy:_}=Jf(A,p);T=D(T,k);const N=S(T),z=Fo(o,w),H=[P(z),P(N)];if(_!=null&&_!==!1){const ee=_===!0?n(d.secretKey):_;H.push(Pt("extraEntropy",ee))}const Y=_s(...H),G=N;function Q(ee){const se=I(ee);if(!o.isValidNot0(se))return;const le=o.inv(se),ne=r.BASE.multiply(se).toAffine(),fe=o.create(ne.x);if(fe===ts)return;const ke=o.create(le*o.create(G+fe*z));if(ke===ts)return;let qe=(ne.x===fe?0:2)|Number(ne.y&Zo),$e=ke;return C&&m(ke)&&($e=o.neg(ke),qe^=1),new v(fe,$e,qe)}return{seed:Y,k2sig:Q}}function L(T,w,A={}){T=Pt("message",T);const{seed:C,k2sig:k}=B(T,w,A);return pR(e.outputLen,o.BYTES,s)(C,k)}function j(T){let w;const A=typeof T=="string"||Lh(T),C=!A&&T!==null&&typeof T=="object"&&typeof T.r=="bigint"&&typeof T.s=="bigint";if(!A&&!C)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");if(C)w=new v(T.r,T.s);else if(A){try{w=v.fromBytes(Pt("sig",T),"der")}catch(k){if(!(k instanceof jn.Err))throw k}if(!w)try{w=v.fromBytes(Pt("sig",T),"compact")}catch{return!1}}return w||!1}function $(T,w,A,C={}){const{lowS:k,prehash:_,format:N}=Jf(C,p);if(A=Pt("publicKey",A),w=D(Pt("message",w),_),"strict"in C)throw new Error("options.strict was renamed to lowS");const z=N===void 0?j(T):v.fromBytes(Pt("sig",T),N);if(z===!1)return!1;try{const H=r.fromBytes(A);if(k&&z.hasHighS())return!1;const{r:Y,s:G}=z,Q=S(w),ee=o.inv(G),se=o.create(Q*ee),le=o.create(Y*ee),ne=r.BASE.multiplyUnsafe(se).add(H.multiplyUnsafe(le));return ne.is0()?!1:o.create(ne.x)===Y}catch{return!1}}function U(T,w,A={}){const{prehash:C}=Jf(A,p);return w=D(w,C),v.fromBytes(T,"recovered").recoverPublicKey(w).toBytes()}return Object.freeze({keygen:l,getPublicKey:u,getSharedSecret:h,utils:f,lengths:d,Point:r,sign:L,verify:$,recoverPublicKey:U,Signature:v,hash:e})}function VR(r){const e={a:r.a,b:r.b,p:r.Fp.ORDER,n:r.n,h:r.h,Gx:r.Gx,Gy:r.Gy},t=r.Fp;let n=r.allowedPrivateKeyLengths?Array.from(new Set(r.allowedPrivateKeyLengths.map(o=>Math.ceil(o/2)))):void 0;const s=oi(e.n,{BITS:r.nBitLength,allowedLengths:n,modFromBytes:r.wrapPrivateKey}),i={Fp:t,Fn:s,allowInfinityPoint:r.allowInfinityPoint,endo:r.endo,isTorsionFree:r.isTorsionFree,clearCofactor:r.clearCofactor,fromBytes:r.fromBytes,toBytes:r.toBytes};return{CURVE:e,curveOpts:i}}function KR(r){const{CURVE:e,curveOpts:t}=VR(r),n={hmac:r.hmac,randomBytes:r.randomBytes,lowS:r.lowS,bits2int:r.bits2int,bits2int_modN:r.bits2int_modN};return{CURVE:e,curveOpts:t,hash:r.hash,ecdsaOpts:n}}function GR(r,e){const t=e.Point;return Object.assign({},e,{ProjectivePoint:t,CURVE:Object.assign({},r,I2(t.Fn.ORDER,t.Fn.BITS))})}function QR(r){const{CURVE:e,curveOpts:t,hash:n,ecdsaOpts:s}=KR(r),i=zR(e,t),o=qR(i,n,s);return GR(r,o)}function Pp(r,e){const t=n=>QR({...r,hash:n});return{...t(e),create:t}}const N2={p:BigInt("0xffffffff00000001000000000000000000000000ffffffffffffffffffffffff"),n:BigInt("0xffffffff00000000ffffffffffffffffbce6faada7179e84f3b9cac2fc632551"),h:BigInt(1),a:BigInt("0xffffffff00000001000000000000000000000000fffffffffffffffffffffffc"),b:BigInt("0x5ac635d8aa3a93e7b3ebbd55769886bc651d06b0cc53b0f63bce3c3e27d2604b"),Gx:BigInt("0x6b17d1f2e12c4247f8bce6e563a440f277037d812deb33a0f4a13945d898c296"),Gy:BigInt("0x4fe342e2fe1a7f9b8ee7eb4a7c0f9e162bce33576b315ececbb6406837bf51f5")},R2={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000ffffffff"),n:BigInt("0xffffffffffffffffffffffffffffffffffffffffffffffffc7634d81f4372ddf581a0db248b0a77aecec196accc52973"),h:BigInt(1),a:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffeffffffff0000000000000000fffffffc"),b:BigInt("0xb3312fa7e23ee7e4988e056be3f82d19181d9c6efe8141120314088f5013875ac656398d8a2ed19d2a85c8edd3ec2aef"),Gx:BigInt("0xaa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a385502f25dbf55296c3a545e3872760ab7"),Gy:BigInt("0x3617de4a96262c6f5d9e98bf9292dc29f8f41dbd289a147ce9da3113b5f0b8c00a60b1ce1d7e819d7a431d7c90ea0e5f")},U2={p:BigInt("0x1ffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff"),n:BigInt("0x01fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffa51868783bf2f966b7fcc0148f709a5d03bb5c9b8899c47aebb6fb71e91386409"),h:BigInt(1),a:BigInt("0x1fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffc"),b:BigInt("0x0051953eb9618e1c9a1f929a21a0b68540eea2da725b99b315f3b8b489918ef109e156193951ec7e937b1652c0bd3bb1bf073573df883d2c34f1ef451fd46b503f00"),Gx:BigInt("0x00c6858e06b70404e9cd9e3ecb662395b4429c648139053fb521f828af606b4d3dbaa14b5e77efe75928fe1dc127a2ffa8de3348b3c1856a429bf97e7e31c2e5bd66"),Gy:BigInt("0x011839296a789a3bc0045c8a5fb42c7d1bd998f54449579b446817afbd17273e662c97ee72995ef42640c550b9013fad0761353c7086a272c24088be94769fd16650")},WR=oi(N2.p),JR=oi(R2.p),YR=oi(U2.p),ZR=Pp({...N2,Fp:WR,lowS:!1},jh);Pp({...R2,Fp:JR,lowS:!1},iN),Pp({...U2,Fp:YR,lowS:!1,allowedPrivateKeyLengths:[130,131,132]},sN);const XR=ZR,k2="base10",kt="base16",Kt="base64pad",Ts="base64url",Tl="utf8",$2=0,is=1,Nl=2,e6=0,Jm=1,Lc=12,Ug=32;function t6(){const r=Ip.utils.randomPrivateKey(),e=Ip.getPublicKey(r);return{privateKey:Jt(r,kt),publicKey:Jt(e,kt)}}function Op(){const r=po(Ug);return Jt(r,kt)}function r6(r,e){const t=Ip.getSharedSecret(Or(r,kt),Or(e,kt)),n=fR(Hh,t,void 0,void 0,Ug);return Jt(n,kt)}function Pu(r){const e=Hh(Or(r,kt));return Jt(e,kt)}function Ir(r){const e=Hh(Or(r,Tl));return Jt(e,kt)}function L2(r){return Or(`${r}`,k2)}function co(r){return Number(Jt(r,k2))}function F2(r){return r.replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}function M2(r){const e=r.replace(/-/g,"+").replace(/_/g,"/"),t=(4-e.length%4)%4;return e+"=".repeat(t)}function n6(r){const e=L2(typeof r.type<"u"?r.type:$2);if(co(e)===is&&typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const t=typeof r.senderPublicKey<"u"?Or(r.senderPublicKey,kt):void 0,n=typeof r.iv<"u"?Or(r.iv,kt):po(Lc),s=Or(r.symKey,kt),i=f2(s,n).encrypt(Or(r.message,Tl)),o=j2({type:e,sealed:i,iv:n,senderPublicKey:t});return r.encoding===Ts?F2(o):o}function s6(r){const e=Or(r.symKey,kt),{sealed:t,iv:n}=il({encoded:r.encoded,encoding:r.encoding}),s=f2(e,n).decrypt(t);if(s===null)throw new Error("Failed to decrypt");return Jt(s,Tl)}function i6(r,e){const t=L2(Nl),n=po(Lc),s=Or(r,Tl),i=j2({type:t,sealed:s,iv:n});return e===Ts?F2(i):i}function o6(r,e){const{sealed:t}=il({encoded:r,encoding:e});return Jt(t,Tl)}function j2(r){if(co(r.type)===Nl)return Jt($c([r.type,r.sealed]),Kt);if(co(r.type)===is){if(typeof r.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return Jt($c([r.type,r.senderPublicKey,r.iv,r.sealed]),Kt)}return Jt($c([r.type,r.iv,r.sealed]),Kt)}function il(r){const e=(r.encoding||Kt)===Ts?M2(r.encoded):r.encoded,t=Or(e,Kt),n=t.slice(e6,Jm),s=Jm;if(co(n)===is){const c=s+Ug,l=c+Lc,u=t.slice(s,c),h=t.slice(c,l),f=t.slice(l);return{type:n,sealed:f,iv:h,senderPublicKey:u}}if(co(n)===Nl){const c=t.slice(s),l=po(Lc);return{type:n,sealed:c,iv:l}}const i=s+Lc,o=t.slice(s,i),a=t.slice(i);return{type:n,sealed:a,iv:o}}function a6(r,e){const t=il({encoded:r,encoding:e==null?void 0:e.encoding});return z2({type:co(t.type),senderPublicKey:typeof t.senderPublicKey<"u"?Jt(t.senderPublicKey,kt):void 0,receiverPublicKey:e==null?void 0:e.receiverPublicKey})}function z2(r){const e=(r==null?void 0:r.type)||$2;if(e===is){if(typeof(r==null?void 0:r.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(r==null?void 0:r.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:r==null?void 0:r.senderPublicKey,receiverPublicKey:r==null?void 0:r.receiverPublicKey}}function Ym(r){return r.type===is&&typeof r.senderPublicKey=="string"&&typeof r.receiverPublicKey=="string"}function Zm(r){return r.type===Nl}function c6(r){const e=Buffer.from(r.x,"base64"),t=Buffer.from(r.y,"base64");return $c([new Uint8Array([4]),e,t])}function l6(r,e){const[t,n,s]=r.split("."),i=Buffer.from(M2(s),"base64");if(i.length!==64)throw new Error("Invalid signature length");const o=i.slice(0,32),a=i.slice(32,64),c=`${t}.${n}`,l=Hh(c),u=c6(e);if(!XR.verify($c([o,a]),l,u))throw new Error("Invalid signature");return dp(r).payload}const u6="irn";function oh(r){return(r==null?void 0:r.relay)||{protocol:u6}}function Mo(r){const e=K_[r];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${r}`);return e}var h6=Object.defineProperty,f6=Object.defineProperties,d6=Object.getOwnPropertyDescriptors,Xm=Object.getOwnPropertySymbols,p6=Object.prototype.hasOwnProperty,g6=Object.prototype.propertyIsEnumerable,ew=(r,e,t)=>e in r?h6(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Yf=(r,e)=>{for(var t in e||(e={}))p6.call(e,t)&&ew(r,t,e[t]);if(Xm)for(var t of Xm(e))g6.call(e,t)&&ew(r,t,e[t]);return r},y6=(r,e)=>f6(r,d6(e));function m6(r,e="-"){const t={},n="relay"+e;return Object.keys(r).forEach(s=>{if(s.startsWith(n)){const i=s.replace(n,""),o=r[s];t[i]=o}}),t}function tw(r){if(!r.includes("wc:")){const l=KE(r);l!=null&&l.includes("wc:")&&(r=l)}r=r.includes("wc://")?r.replace("wc://",""):r,r=r.includes("wc:")?r.replace("wc:",""):r;const e=r.indexOf(":"),t=r.indexOf("?")!==-1?r.indexOf("?"):void 0,n=r.substring(0,e),s=r.substring(e+1,t).split("@"),i=typeof t<"u"?r.substring(t):"",o=new URLSearchParams(i),a=Object.fromEntries(o.entries()),c=typeof a.methods=="string"?a.methods.split(","):void 0;return{protocol:n,topic:w6(s[0]),version:parseInt(s[1],10),symKey:a.symKey,relay:m6(a),methods:c,expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function w6(r){return r.startsWith("//")?r.substring(2):r}function b6(r,e="-"){const t="relay",n={};return Object.keys(r).forEach(s=>{const i=s,o=t+e+i;r[i]&&(n[o]=r[i])}),n}function rw(r){const e=new URLSearchParams,t=Yf(Yf(y6(Yf({},b6(r.relay)),{symKey:r.symKey}),r.expiryTimestamp&&{expiryTimestamp:r.expiryTimestamp.toString()}),r.methods&&{methods:r.methods.join(",")});return Object.entries(t).sort(([n],[s])=>n.localeCompare(s)).forEach(([n,s])=>{s!==void 0&&e.append(n,String(s))}),`${r.protocol}:${r.topic}@${r.version}?${e}`}function iu(r,e,t){return`${r}?wc_ev=${t}&topic=${e}`}var v6=Object.defineProperty,E6=Object.defineProperties,A6=Object.getOwnPropertyDescriptors,nw=Object.getOwnPropertySymbols,x6=Object.prototype.hasOwnProperty,I6=Object.prototype.propertyIsEnumerable,sw=(r,e,t)=>e in r?v6(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,S6=(r,e)=>{for(var t in e||(e={}))x6.call(e,t)&&sw(r,t,e[t]);if(nw)for(var t of nw(e))I6.call(e,t)&&sw(r,t,e[t]);return r},P6=(r,e)=>E6(r,A6(e));function sc(r){const e=[];return r.forEach(t=>{const[n,s]=t.split(":");e.push(`${n}:${s}`)}),e}function O6(r){const e=[];return Object.values(r).forEach(t=>{e.push(...sc(t.accounts))}),e}function D6(r,e){const t=[];return Object.values(r).forEach(n=>{sc(n.accounts).includes(e)&&t.push(...n.methods)}),t}function C6(r,e){const t=[];return Object.values(r).forEach(n=>{sc(n.accounts).includes(e)&&t.push(...n.events)}),t}function Kh(r){return r.includes(":")}function jo(r){return Kh(r)?r.split(":")[0]:r}function iw(r){var e,t,n;const s={};if(!Sn(r))return s;for(const[i,o]of Object.entries(r)){const a=Kh(i)?[i]:o.chains,c=o.methods||[],l=o.events||[],u=jo(i);s[u]=P6(S6({},s[u]),{chains:In(a,(e=s[u])==null?void 0:e.chains),methods:In(c,(t=s[u])==null?void 0:t.methods),events:In(l,(n=s[u])==null?void 0:n.events)})}return s}function B6(r){const e={};return r==null||r.forEach(t=>{var n;const[s,i]=t.split(":");e[s]||(e[s]={accounts:[],chains:[],events:[],methods:[]}),e[s].accounts.push(t),(n=e[s].chains)==null||n.push(`${s}:${i}`)}),e}function ow(r,e){e=e.map(n=>n.replace("did:pkh:",""));const t=B6(e);for(const[n,s]of Object.entries(t))s.methods?s.methods=In(s.methods,r):s.methods=r,s.events=["chainChanged","accountsChanged"];return t}function _6(r,e){var t,n,s,i,o,a;const c=iw(r),l=iw(e),u={},h=Object.keys(c).concat(Object.keys(l));for(const f of h)u[f]={chains:In((t=c[f])==null?void 0:t.chains,(n=l[f])==null?void 0:n.chains),methods:In((s=c[f])==null?void 0:s.methods,(i=l[f])==null?void 0:i.methods),events:In((o=c[f])==null?void 0:o.events,(a=l[f])==null?void 0:a.events)};return u}const T6={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},N6={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function W(r,e){const{message:t,code:n}=N6[r];return{message:e?`${t} ${e}`:t,code:n}}function Ne(r,e){const{message:t,code:n}=T6[r];return{message:e?`${t} ${e}`:t,code:n}}function Dr(r,e){return!!Array.isArray(r)}function Sn(r){return Object.getPrototypeOf(r)===Object.prototype&&Object.keys(r).length}function Ye(r){return typeof r>"u"}function Ge(r,e){return e&&Ye(r)?!0:typeof r=="string"&&!!r.trim().length}function kg(r,e){return e&&Ye(r)?!0:typeof r=="number"&&!isNaN(r)}function R6(r,e){const{requiredNamespaces:t}=e,n=Object.keys(r.namespaces),s=Object.keys(t);let i=!0;return Ci(s,n)?(n.forEach(o=>{const{accounts:a,methods:c,events:l}=r.namespaces[o],u=sc(a),h=t[o];(!Ci(jE(o,h),u)||!Ci(h.methods,c)||!Ci(h.events,l))&&(i=!1)}),i):!1}function ah(r){return Ge(r,!1)&&r.includes(":")?r.split(":").length===2:!1}function U6(r){if(Ge(r,!1)&&r.includes(":")){const e=r.split(":");if(e.length===3){const t=e[0]+":"+e[1];return!!e[2]&&ah(t)}}return!1}function k6(r){function e(t){try{return typeof new URL(t)<"u"}catch{return!1}}try{if(Ge(r,!1)){if(e(r))return!0;const t=KE(r);return e(t)}}catch{}return!1}function $6(r){var e;return(e=r==null?void 0:r.proposer)==null?void 0:e.publicKey}function L6(r){return r==null?void 0:r.topic}function F6(r,e){let t=null;return Ge(r==null?void 0:r.publicKey,!1)||(t=W("MISSING_OR_INVALID",`${e} controller public key should be a string`)),t}function aw(r){let e=!0;return Dr(r)?r.length&&(e=r.every(t=>Ge(t,!1))):e=!1,e}function M6(r,e,t){let n=null;return Dr(e)&&e.length?e.forEach(s=>{n||ah(s)||(n=Ne("UNSUPPORTED_CHAINS",`${t}, chain ${s} should be a string and conform to "namespace:chainId" format`))}):ah(r)||(n=Ne("UNSUPPORTED_CHAINS",`${t}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),n}function j6(r,e,t){let n=null;return Object.entries(r).forEach(([s,i])=>{if(n)return;const o=M6(s,jE(s,i),`${e} ${t}`);o&&(n=o)}),n}function z6(r,e){let t=null;return Dr(r)?r.forEach(n=>{t||U6(n)||(t=Ne("UNSUPPORTED_ACCOUNTS",`${e}, account ${n} should be a string and conform to "namespace:chainId:address" format`))}):t=Ne("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),t}function H6(r,e){let t=null;return Object.values(r).forEach(n=>{if(t)return;const s=z6(n==null?void 0:n.accounts,`${e} namespace`);s&&(t=s)}),t}function q6(r,e){let t=null;return aw(r==null?void 0:r.methods)?aw(r==null?void 0:r.events)||(t=Ne("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):t=Ne("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),t}function H2(r,e){let t=null;return Object.values(r).forEach(n=>{if(t)return;const s=q6(n,`${e}, namespace`);s&&(t=s)}),t}function V6(r,e,t){let n=null;if(r&&Sn(r)){const s=H2(r,e);s&&(n=s);const i=j6(r,e,t);i&&(n=i)}else n=W("MISSING_OR_INVALID",`${e}, ${t} should be an object with data`);return n}function Zf(r,e){let t=null;if(r&&Sn(r)){const n=H2(r,e);n&&(t=n);const s=H6(r,e);s&&(t=s)}else t=W("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return t}function q2(r){return Ge(r.protocol,!0)}function K6(r,e){let t=!1;return r?r&&Dr(r)&&r.length&&r.forEach(n=>{t=q2(n)}):t=!0,t}function G6(r){return typeof r=="number"}function jt(r){return typeof r<"u"&&typeof r!==null}function Q6(r){return!(!r||typeof r!="object"||!r.code||!kg(r.code,!1)||!r.message||!Ge(r.message,!1))}function W6(r){return!(Ye(r)||!Ge(r.method,!1))}function J6(r){return!(Ye(r)||Ye(r.result)&&Ye(r.error)||!kg(r.id,!1)||!Ge(r.jsonrpc,!1))}function Y6(r){return!(Ye(r)||!Ge(r.name,!1))}function cw(r,e){return!(!ah(e)||!O6(r).includes(e))}function Z6(r,e,t){return Ge(t,!1)?D6(r,e).includes(t):!1}function X6(r,e,t){return Ge(t,!1)?C6(r,e).includes(t):!1}function lw(r,e,t){let n=null;const s=e4(r),i=t4(e),o=Object.keys(s),a=Object.keys(i),c=uw(Object.keys(r)),l=uw(Object.keys(e)),u=c.filter(h=>!l.includes(h));return u.length&&(n=W("NON_CONFORMING_NAMESPACES",`${t} namespaces keys don't satisfy requiredNamespaces.
      Required: ${u.toString()}
      Received: ${Object.keys(e).toString()}`)),Ci(o,a)||(n=W("NON_CONFORMING_NAMESPACES",`${t} namespaces chains don't satisfy required namespaces.
      Required: ${o.toString()}
      Approved: ${a.toString()}`)),Object.keys(e).forEach(h=>{if(!h.includes(":")||n)return;const f=sc(e[h].accounts);f.includes(h)||(n=W("NON_CONFORMING_NAMESPACES",`${t} namespaces accounts don't satisfy namespace accounts for ${h}
        Required: ${h}
        Approved: ${f.toString()}`))}),o.forEach(h=>{n||(Ci(s[h].methods,i[h].methods)?Ci(s[h].events,i[h].events)||(n=W("NON_CONFORMING_NAMESPACES",`${t} namespaces events don't satisfy namespace events for ${h}`)):n=W("NON_CONFORMING_NAMESPACES",`${t} namespaces methods don't satisfy namespace methods for ${h}`))}),n}function e4(r){const e={};return Object.keys(r).forEach(t=>{var n;t.includes(":")?e[t]=r[t]:(n=r[t].chains)==null||n.forEach(s=>{e[s]={methods:r[t].methods,events:r[t].events}})}),e}function uw(r){return[...new Set(r.map(e=>e.includes(":")?e.split(":")[0]:e))]}function t4(r){const e={};return Object.keys(r).forEach(t=>{if(t.includes(":"))e[t]=r[t];else{const n=sc(r[t].accounts);n==null||n.forEach(s=>{e[s]={accounts:r[t].accounts.filter(i=>i.includes(`${s}:`)),methods:r[t].methods,events:r[t].events}})}}),e}function r4(r,e){return kg(r,!1)&&r<=e.max&&r>=e.min}function hw(){const r=Cl();return new Promise(e=>{switch(r){case ur.browser:e(n4());break;case ur.reactNative:e(s4());break;case ur.node:e(i4());break;default:e(!0)}})}function n4(){return nc()&&(navigator==null?void 0:navigator.onLine)}async function s4(){if(ii()&&typeof global<"u"&&global!=null&&global.NetInfo){const r=await(global==null?void 0:global.NetInfo.fetch());return r==null?void 0:r.isConnected}return!0}function i4(){return!0}function o4(r){switch(Cl()){case ur.browser:a4(r);break;case ur.reactNative:c4(r);break}}function a4(r){!ii()&&nc()&&(window.addEventListener("online",()=>r(!0)),window.addEventListener("offline",()=>r(!1)))}function c4(r){ii()&&typeof global<"u"&&global!=null&&global.NetInfo&&(global==null||global.NetInfo.addEventListener(e=>r(e==null?void 0:e.isConnected)))}function l4(){var r;return nc()&&ls.getDocument()?((r=ls.getDocument())==null?void 0:r.visibilityState)==="visible":!0}const Xf={};class bc{static get(e){return Xf[e]}static set(e,t){Xf[e]=t}static delete(e){delete Xf[e]}}function u4(r){const e=Pl.decode(r);if(e.length<33)throw new Error("Too short to contain a public key");return e.slice(1,33)}function h4({publicKey:r,signature:e,payload:t}){var n;const s=Dp(t.method),i=128|parseInt(((n=t.version)==null?void 0:n.toString())||"4"),o=p4(t.address),a=t.era==="00"?new Uint8Array([0]):Dp(t.era);if(a.length!==1&&a.length!==2)throw new Error("Invalid era length");const c=parseInt(t.nonce,16),l=new Uint8Array([c&255,c>>8&255]),u=BigInt(`0x${d4(t.tip)}`),h=y4(u),f=new Uint8Array([0,...r,o,...e,...a,...l,...h,...s]),d=g4(f.length+1);return new Uint8Array([...d,i,...f])}function f4(r){const e=Dp(r),t=J_.blake2b(e,void 0,32);return"0x"+Buffer.from(t).toString("hex")}function Dp(r){return new Uint8Array(r.replace(/^0x/,"").match(/.{1,2}/g).map(e=>parseInt(e,16)))}function d4(r){return r.startsWith("0x")?r.slice(2):r}function p4(r){const e=Pl.decode(r)[0];return e===42?0:e===60?2:1}function g4(r){if(r<64)return new Uint8Array([r<<2]);if(r<16384){const e=r<<2|1;return new Uint8Array([e&255,e>>8&255])}else if(r<1<<30){const e=r<<2|2;return new Uint8Array([e&255,e>>8&255,e>>16&255,e>>24&255])}else throw new Error("Compact encoding > 2^30 not supported")}function y4(r){if(r<BigInt(1)<<BigInt(6))return new Uint8Array([Number(r<<BigInt(2))]);if(r<BigInt(1)<<BigInt(14)){const e=r<<BigInt(2)|BigInt(1);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255))])}else if(r<BigInt(1)<<BigInt(30)){const e=r<<BigInt(2)|BigInt(2);return new Uint8Array([Number(e&BigInt(255)),Number(e>>BigInt(8)&BigInt(255)),Number(e>>BigInt(16)&BigInt(255)),Number(e>>BigInt(24)&BigInt(255))])}else throw new Error("BigInt compact encoding not supported > 2^30")}function m4(r){const e=Uint8Array.from(Buffer.from(r.signature,"hex")),t=u4(r.transaction.address),n=h4({publicKey:t,signature:e,payload:r.transaction}),s=Buffer.from(n).toString("hex");return f4(s)}class go{}let w4=class extends go{constructor(e){super()}};const fw=J.FIVE_SECONDS,yo={pulse:"heartbeat_pulse"};let b4=class V2 extends w4{constructor(e){super(e),this.events=new hr.EventEmitter,this.interval=fw,this.interval=(e==null?void 0:e.interval)||fw}static async init(e){const t=new V2(e);return await t.init(),t}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),J.toMiliseconds(this.interval))}pulse(){this.events.emit(yo.pulse)}};const v4=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,E4=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,A4=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function x4(r,e){if(r==="__proto__"||r==="constructor"&&e&&typeof e=="object"&&"prototype"in e){I4(r);return}return e}function I4(r){console.warn(`[destr] Dropping "${r}" key to prevent prototype pollution.`)}function ou(r,e={}){if(typeof r!="string")return r;if(r[0]==='"'&&r[r.length-1]==='"'&&r.indexOf("\\")===-1)return r.slice(1,-1);const t=r.trim();if(t.length<=9)switch(t.toLowerCase()){case"true":return!0;case"false":return!1;case"undefined":return;case"null":return null;case"nan":return Number.NaN;case"infinity":return Number.POSITIVE_INFINITY;case"-infinity":return Number.NEGATIVE_INFINITY}if(!A4.test(r)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return r}try{if(v4.test(r)||E4.test(r)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(r,x4)}return JSON.parse(r)}catch(n){if(e.strict)throw n;return r}}function S4(r){return!r||typeof r.then!="function"?Promise.resolve(r):r}function et(r,...e){try{return S4(r(...e))}catch(t){return Promise.reject(t)}}function P4(r){const e=typeof r;return r===null||e!=="object"&&e!=="function"}function O4(r){const e=Object.getPrototypeOf(r);return!e||e.isPrototypeOf(Object)}function Ou(r){if(P4(r))return String(r);if(O4(r)||Array.isArray(r))return JSON.stringify(r);if(typeof r.toJSON=="function")return Ou(r.toJSON());throw new Error("[unstorage] Cannot stringify value!")}const Cp="base64:";function D4(r){return typeof r=="string"?r:Cp+_4(r)}function C4(r){return typeof r!="string"||!r.startsWith(Cp)?r:B4(r.slice(Cp.length))}function B4(r){return globalThis.Buffer?Buffer.from(r,"base64"):Uint8Array.from(globalThis.atob(r),e=>e.codePointAt(0))}function _4(r){return globalThis.Buffer?Buffer.from(r).toString("base64"):globalThis.btoa(String.fromCodePoint(...r))}function Mt(r){var e;return r&&((e=r.split("?")[0])==null?void 0:e.replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""))||""}function T4(...r){return Mt(r.join(":"))}function au(r){return r=Mt(r),r?r+":":""}function N4(r,e){if(e===void 0)return!0;let t=0,n=r.indexOf(":");for(;n>-1;)t++,n=r.indexOf(":",n+1);return t<=e}function R4(r,e){return e?r.startsWith(e)&&r[r.length-1]!=="$":r[r.length-1]!=="$"}const U4="memory",k4=()=>{const r=new Map;return{name:U4,getInstance:()=>r,hasItem(e){return r.has(e)},getItem(e){return r.get(e)??null},getItemRaw(e){return r.get(e)??null},setItem(e,t){r.set(e,t)},setItemRaw(e,t){r.set(e,t)},removeItem(e){r.delete(e)},getKeys(){return[...r.keys()]},clear(){r.clear()},dispose(){r.clear()}}};function $4(r={}){const e={mounts:{"":r.driver||k4()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},t=l=>{for(const u of e.mountpoints)if(l.startsWith(u))return{base:u,relativeKey:l.slice(u.length),driver:e.mounts[u]};return{base:"",relativeKey:l,driver:e.mounts[""]}},n=(l,u)=>e.mountpoints.filter(h=>h.startsWith(l)||u&&l.startsWith(h)).map(h=>({relativeBase:l.length>h.length?l.slice(h.length):void 0,mountpoint:h,driver:e.mounts[h]})),s=(l,u)=>{if(e.watching){u=Mt(u);for(const h of e.watchListeners)h(l,u)}},i=async()=>{if(!e.watching){e.watching=!0;for(const l in e.mounts)e.unwatch[l]=await dw(e.mounts[l],s,l)}},o=async()=>{if(e.watching){for(const l in e.unwatch)await e.unwatch[l]();e.unwatch={},e.watching=!1}},a=(l,u,h)=>{const f=new Map,d=p=>{let g=f.get(p.base);return g||(g={driver:p.driver,base:p.base,items:[]},f.set(p.base,g)),g};for(const p of l){const g=typeof p=="string",m=Mt(g?p:p.key),b=g?void 0:p.value,x=g||!p.options?u:{...u,...p.options},v=t(m);d(v).items.push({key:m,value:b,relativeKey:v.relativeKey,options:x})}return Promise.all([...f.values()].map(p=>h(p))).then(p=>p.flat())},c={hasItem(l,u={}){l=Mt(l);const{relativeKey:h,driver:f}=t(l);return et(f.hasItem,h,u)},getItem(l,u={}){l=Mt(l);const{relativeKey:h,driver:f}=t(l);return et(f.getItem,h,u).then(d=>ou(d))},getItems(l,u={}){return a(l,u,h=>h.driver.getItems?et(h.driver.getItems,h.items.map(f=>({key:f.relativeKey,options:f.options})),u).then(f=>f.map(d=>({key:T4(h.base,d.key),value:ou(d.value)}))):Promise.all(h.items.map(f=>et(h.driver.getItem,f.relativeKey,f.options).then(d=>({key:f.key,value:ou(d)})))))},getItemRaw(l,u={}){l=Mt(l);const{relativeKey:h,driver:f}=t(l);return f.getItemRaw?et(f.getItemRaw,h,u):et(f.getItem,h,u).then(d=>C4(d))},async setItem(l,u,h={}){if(u===void 0)return c.removeItem(l);l=Mt(l);const{relativeKey:f,driver:d}=t(l);d.setItem&&(await et(d.setItem,f,Ou(u),h),d.watch||s("update",l))},async setItems(l,u){await a(l,u,async h=>{if(h.driver.setItems)return et(h.driver.setItems,h.items.map(f=>({key:f.relativeKey,value:Ou(f.value),options:f.options})),u);h.driver.setItem&&await Promise.all(h.items.map(f=>et(h.driver.setItem,f.relativeKey,Ou(f.value),f.options)))})},async setItemRaw(l,u,h={}){if(u===void 0)return c.removeItem(l,h);l=Mt(l);const{relativeKey:f,driver:d}=t(l);if(d.setItemRaw)await et(d.setItemRaw,f,u,h);else if(d.setItem)await et(d.setItem,f,D4(u),h);else return;d.watch||s("update",l)},async removeItem(l,u={}){typeof u=="boolean"&&(u={removeMeta:u}),l=Mt(l);const{relativeKey:h,driver:f}=t(l);f.removeItem&&(await et(f.removeItem,h,u),(u.removeMeta||u.removeMata)&&await et(f.removeItem,h+"$",u),f.watch||s("remove",l))},async getMeta(l,u={}){typeof u=="boolean"&&(u={nativeOnly:u}),l=Mt(l);const{relativeKey:h,driver:f}=t(l),d=Object.create(null);if(f.getMeta&&Object.assign(d,await et(f.getMeta,h,u)),!u.nativeOnly){const p=await et(f.getItem,h+"$",u).then(g=>ou(g));p&&typeof p=="object"&&(typeof p.atime=="string"&&(p.atime=new Date(p.atime)),typeof p.mtime=="string"&&(p.mtime=new Date(p.mtime)),Object.assign(d,p))}return d},setMeta(l,u,h={}){return this.setItem(l+"$",u,h)},removeMeta(l,u={}){return this.removeItem(l+"$",u)},async getKeys(l,u={}){var m;l=au(l);const h=n(l,!0);let f=[];const d=[];let p=!0;for(const b of h){(m=b.driver.flags)!=null&&m.maxDepth||(p=!1);const x=await et(b.driver.getKeys,b.relativeBase,u);for(const v of x){const I=b.mountpoint+Mt(v);f.some(S=>I.startsWith(S))||d.push(I)}f=[b.mountpoint,...f.filter(v=>!v.startsWith(b.mountpoint))]}const g=u.maxDepth!==void 0&&!p;return d.filter(b=>(!g||N4(b,u.maxDepth))&&R4(b,l))},async clear(l,u={}){l=au(l),await Promise.all(n(l,!1).map(async h=>{if(h.driver.clear)return et(h.driver.clear,h.relativeBase,u);if(h.driver.removeItem){const f=await h.driver.getKeys(h.relativeBase||"",u);return Promise.all(f.map(d=>h.driver.removeItem(d,u)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(l=>pw(l)))},async watch(l){return await i(),e.watchListeners.push(l),async()=>{e.watchListeners=e.watchListeners.filter(u=>u!==l),e.watchListeners.length===0&&await o()}},async unwatch(){e.watchListeners=[],await o()},mount(l,u){if(l=au(l),l&&e.mounts[l])throw new Error(`already mounted at ${l}`);return l&&(e.mountpoints.push(l),e.mountpoints.sort((h,f)=>f.length-h.length)),e.mounts[l]=u,e.watching&&Promise.resolve(dw(u,s,l)).then(h=>{e.unwatch[l]=h}).catch(console.error),c},async unmount(l,u=!0){var h,f;l=au(l),!(!l||!e.mounts[l])&&(e.watching&&l in e.unwatch&&((f=(h=e.unwatch)[l])==null||f.call(h),delete e.unwatch[l]),u&&await pw(e.mounts[l]),e.mountpoints=e.mountpoints.filter(d=>d!==l),delete e.mounts[l])},getMount(l=""){l=Mt(l)+":";const u=t(l);return{driver:u.driver,base:u.base}},getMounts(l="",u={}){return l=Mt(l),n(l,u.parents).map(f=>({driver:f.driver,base:f.mountpoint}))},keys:(l,u={})=>c.getKeys(l,u),get:(l,u={})=>c.getItem(l,u),set:(l,u,h={})=>c.setItem(l,u,h),has:(l,u={})=>c.hasItem(l,u),del:(l,u={})=>c.removeItem(l,u),remove:(l,u={})=>c.removeItem(l,u)};return c}function dw(r,e,t){return r.watch?r.watch((n,s)=>e(n,t+s)):()=>{}}async function pw(r){typeof r.dispose=="function"&&await et(r.dispose)}function mo(r){return new Promise((e,t)=>{r.oncomplete=r.onsuccess=()=>e(r.result),r.onabort=r.onerror=()=>t(r.error)})}function K2(r,e){let t;const n=()=>{if(t)return t;const s=indexedDB.open(r);return s.onupgradeneeded=()=>s.result.createObjectStore(e),t=mo(s),t.then(i=>{i.onclose=()=>t=void 0},()=>{}),t};return(s,i)=>n().then(o=>i(o.transaction(e,s).objectStore(e)))}let ed;function Rl(){return ed||(ed=K2("keyval-store","keyval")),ed}function gw(r,e=Rl()){return e("readonly",t=>mo(t.get(r)))}function L4(r,e,t=Rl()){return t("readwrite",n=>(n.put(e,r),mo(n.transaction)))}function F4(r,e=Rl()){return e("readwrite",t=>(t.delete(r),mo(t.transaction)))}function M4(r=Rl()){return r("readwrite",e=>(e.clear(),mo(e.transaction)))}function j4(r,e){return r.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},mo(r.transaction)}function z4(r=Rl()){return r("readonly",e=>{if(e.getAllKeys)return mo(e.getAllKeys());const t=[];return j4(e,n=>t.push(n.key)).then(()=>t)})}const H4="idb-keyval";var q4=(r={})=>{const e=r.base&&r.base.length>0?`${r.base}:`:"",t=s=>e+s;let n;return r.dbName&&r.storeName&&(n=K2(r.dbName,r.storeName)),{name:H4,options:r,async hasItem(s){return!(typeof await gw(t(s),n)>"u")},async getItem(s){return await gw(t(s),n)??null},setItem(s,i){return L4(t(s),i,n)},removeItem(s){return F4(t(s),n)},getKeys(){return z4(n)},clear(){return M4(n)}}};const V4="WALLET_CONNECT_V2_INDEXED_DB",K4="keyvaluestorage";let G4=class{constructor(){this.indexedDb=$4({driver:q4({dbName:V4,storeName:K4})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const t=await this.indexedDb.getItem(e);if(t!==null)return t}async setItem(e,t){await this.indexedDb.setItem(e,us(t))}async removeItem(e){await this.indexedDb.removeItem(e)}};var td=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Du={exports:{}};(function(){let r;function e(){}r=e,r.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},r.prototype.setItem=function(t,n){this[t]=String(n)},r.prototype.removeItem=function(t){delete this[t]},r.prototype.clear=function(){const t=this;Object.keys(t).forEach(function(n){t[n]=void 0,delete t[n]})},r.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},r.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof td<"u"&&td.localStorage?Du.exports=td.localStorage:typeof window<"u"&&window.localStorage?Du.exports=window.localStorage:Du.exports=new e})();function Q4(r){var e;return[r[0],oo((e=r[1])!=null?e:"")]}let W4=class{constructor(){this.localStorage=Du.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Q4)}async getItem(e){const t=this.localStorage.getItem(e);if(t!==null)return oo(t)}async setItem(e,t){this.localStorage.setItem(e,us(t))}async removeItem(e){this.localStorage.removeItem(e)}};const J4="wc_storage_version",yw=1,Y4=async(r,e,t)=>{const n=J4,s=await e.getItem(n);if(s&&s>=yw){t(e);return}const i=await r.getKeys();if(!i.length){t(e);return}const o=[];for(;i.length;){const a=i.shift();if(!a)continue;const c=a.toLowerCase();if(c.includes("wc@")||c.includes("walletconnect")||c.includes("wc_")||c.includes("wallet_connect")){const l=await r.getItem(a);await e.setItem(a,l),o.push(a)}}await e.setItem(n,yw),t(e),Z4(r,o)},Z4=async(r,e)=>{e.length&&e.forEach(async t=>{await r.removeItem(t)})};let X4=class{constructor(){this.initialized=!1,this.setInitialized=t=>{this.storage=t,this.initialized=!0};const e=new W4;this.storage=e;try{const t=new G4;Y4(e,t,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,t){return await this.initialize(),this.storage.setItem(e,t)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const t=setInterval(()=>{this.initialized&&(clearInterval(t),e())},20)})}};var rd,mw;function eU(){if(mw)return rd;mw=1;function r(t){try{return JSON.stringify(t)}catch{return'"[Circular]"'}}rd=e;function e(t,n,s){var i=s&&s.stringify||r,o=1;if(typeof t=="object"&&t!==null){var a=n.length+o;if(a===1)return t;var c=new Array(a);c[0]=i(t);for(var l=1;l<a;l++)c[l]=i(n[l]);return c.join(" ")}if(typeof t!="string")return t;var u=n.length;if(u===0)return t;for(var h="",f=1-o,d=-1,p=t&&t.length||0,g=0;g<p;){if(t.charCodeAt(g)===37&&g+1<p){switch(d=d>-1?d:0,t.charCodeAt(g+1)){case 100:case 102:if(f>=u||n[f]==null)break;d<g&&(h+=t.slice(d,g)),h+=Number(n[f]),d=g+2,g++;break;case 105:if(f>=u||n[f]==null)break;d<g&&(h+=t.slice(d,g)),h+=Math.floor(Number(n[f])),d=g+2,g++;break;case 79:case 111:case 106:if(f>=u||n[f]===void 0)break;d<g&&(h+=t.slice(d,g));var m=typeof n[f];if(m==="string"){h+="'"+n[f]+"'",d=g+2,g++;break}if(m==="function"){h+=n[f].name||"<anonymous>",d=g+2,g++;break}h+=i(n[f]),d=g+2,g++;break;case 115:if(f>=u)break;d<g&&(h+=t.slice(d,g)),h+=String(n[f]),d=g+2,g++;break;case 37:d<g&&(h+=t.slice(d,g)),h+="%",d=g+2,g++,f--;break}++f}++g}return d===-1?t:(d<p&&(h+=t.slice(d)),h)}return rd}var nd,ww;function tU(){if(ww)return nd;ww=1;const r=eU();nd=s;const e=S().console||{},t={mapHttpRequest:p,mapHttpResponse:p,wrapRequestSerializer:g,wrapResponseSerializer:g,wrapErrorSerializer:g,req:p,res:p,err:f};function n(E,P){return Array.isArray(E)?E.filter(function(B){return B!=="!stdSerializers.err"}):E===!0?Object.keys(P):!1}function s(E){E=E||{},E.browser=E.browser||{};const P=E.browser.transmit;if(P&&typeof P.send!="function")throw Error("pino: transmit option must have a send function");const D=E.browser.write||e;E.browser.write&&(E.browser.asObject=!0);const B=E.serializers||{},L=n(E.browser.serialize,B);let j=E.browser.serialize;Array.isArray(E.browser.serialize)&&E.browser.serialize.indexOf("!stdSerializers.err")>-1&&(j=!1);const $=["error","fatal","warn","info","debug","trace"];typeof D=="function"&&(D.error=D.fatal=D.warn=D.info=D.debug=D.trace=D),E.enabled===!1&&(E.level="silent");const U=E.level||"info",T=Object.create(D);T.log||(T.log=m),Object.defineProperty(T,"levelVal",{get:A}),Object.defineProperty(T,"level",{get:C,set:k});const w={transmit:P,serialize:L,asObject:E.browser.asObject,levels:$,timestamp:d(E)};T.levels=s.levels,T.level=U,T.setMaxListeners=T.getMaxListeners=T.emit=T.addListener=T.on=T.prependListener=T.once=T.prependOnceListener=T.removeListener=T.removeAllListeners=T.listeners=T.listenerCount=T.eventNames=T.write=T.flush=m,T.serializers=B,T._serialize=L,T._stdErrSerialize=j,T.child=_,P&&(T._logEvent=h());function A(){return this.level==="silent"?1/0:this.levels.values[this.level]}function C(){return this._level}function k(N){if(N!=="silent"&&!this.levels.values[N])throw Error("unknown level "+N);this._level=N,i(w,T,"error","log"),i(w,T,"fatal","error"),i(w,T,"warn","error"),i(w,T,"info","log"),i(w,T,"debug","log"),i(w,T,"trace","log")}function _(N,z){if(!N)throw new Error("missing bindings for child Pino");z=z||{},L&&N.serializers&&(z.serializers=N.serializers);const H=z.serializers;if(L&&H){var Y=Object.assign({},B,H),G=E.browser.serialize===!0?Object.keys(Y):L;delete N.serializers,c([N],G,Y,this._stdErrSerialize)}function Q(ee){this._childLevel=(ee._childLevel|0)+1,this.error=l(ee,N,"error"),this.fatal=l(ee,N,"fatal"),this.warn=l(ee,N,"warn"),this.info=l(ee,N,"info"),this.debug=l(ee,N,"debug"),this.trace=l(ee,N,"trace"),Y&&(this.serializers=Y,this._serialize=G),P&&(this._logEvent=h([].concat(ee._logEvent.bindings,N)))}return Q.prototype=this,new Q(this)}return T}s.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},s.stdSerializers=t,s.stdTimeFunctions=Object.assign({},{nullTime:b,epochTime:x,unixTime:v,isoTime:I});function i(E,P,D,B){const L=Object.getPrototypeOf(P);P[D]=P.levelVal>P.levels.values[D]?m:L[D]?L[D]:e[D]||e[B]||m,o(E,P,D)}function o(E,P,D){!E.transmit&&P[D]===m||(P[D]=(function(B){return function(){const j=E.timestamp(),$=new Array(arguments.length),U=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var T=0;T<$.length;T++)$[T]=arguments[T];if(E.serialize&&!E.asObject&&c($,this._serialize,this.serializers,this._stdErrSerialize),E.asObject?B.call(U,a(this,D,$,j)):B.apply(U,$),E.transmit){const w=E.transmit.level||P.level,A=s.levels.values[w],C=s.levels.values[D];if(C<A)return;u(this,{ts:j,methodLevel:D,methodValue:C,transmitValue:s.levels.values[E.transmit.level||P.level],send:E.transmit.send,val:P.levelVal},$)}}})(P[D]))}function a(E,P,D,B){E._serialize&&c(D,E._serialize,E.serializers,E._stdErrSerialize);const L=D.slice();let j=L[0];const $={};B&&($.time=B),$.level=s.levels.values[P];let U=(E._childLevel|0)+1;if(U<1&&(U=1),j!==null&&typeof j=="object"){for(;U--&&typeof L[0]=="object";)Object.assign($,L.shift());j=L.length?r(L.shift(),L):void 0}else typeof j=="string"&&(j=r(L.shift(),L));return j!==void 0&&($.msg=j),$}function c(E,P,D,B){for(const L in E)if(B&&E[L]instanceof Error)E[L]=s.stdSerializers.err(E[L]);else if(typeof E[L]=="object"&&!Array.isArray(E[L]))for(const j in E[L])P&&P.indexOf(j)>-1&&j in D&&(E[L][j]=D[j](E[L][j]))}function l(E,P,D){return function(){const B=new Array(1+arguments.length);B[0]=P;for(var L=1;L<B.length;L++)B[L]=arguments[L-1];return E[D].apply(this,B)}}function u(E,P,D){const B=P.send,L=P.ts,j=P.methodLevel,$=P.methodValue,U=P.val,T=E._logEvent.bindings;c(D,E._serialize||Object.keys(E.serializers),E.serializers,E._stdErrSerialize===void 0?!0:E._stdErrSerialize),E._logEvent.ts=L,E._logEvent.messages=D.filter(function(w){return T.indexOf(w)===-1}),E._logEvent.level.label=j,E._logEvent.level.value=$,B(j,E._logEvent,U),E._logEvent=h(T)}function h(E){return{ts:0,messages:[],bindings:E||[],level:{label:"",value:0}}}function f(E){const P={type:E.constructor.name,msg:E.message,stack:E.stack};for(const D in E)P[D]===void 0&&(P[D]=E[D]);return P}function d(E){return typeof E.timestamp=="function"?E.timestamp:E.timestamp===!1?b:x}function p(){return{}}function g(E){return E}function m(){}function b(){return!1}function x(){return Date.now()}function v(){return Math.round(Date.now()/1e3)}function I(){return new Date(Date.now()).toISOString()}function S(){function E(P){return typeof P<"u"&&P}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return E(self)||E(window)||E(this)||{}}}return nd}var Uo=tU();const Ul=fg(Uo),rU={level:"info"},kl="custom_context",$g=1e3*1024;let nU=class{constructor(e){this.nodeValue=e,this.sizeInBytes=new TextEncoder().encode(this.nodeValue).length,this.next=null}get value(){return this.nodeValue}get size(){return this.sizeInBytes}},bw=class{constructor(e){this.head=null,this.tail=null,this.lengthInNodes=0,this.maxSizeInBytes=e,this.sizeInBytes=0}append(e){const t=new nU(e);if(t.size>this.maxSizeInBytes)throw new Error(`[LinkedList] Value too big to insert into list: ${e} with size ${t.size}`);for(;this.size+t.size>this.maxSizeInBytes;)this.shift();this.head?(this.tail&&(this.tail.next=t),this.tail=t):(this.head=t,this.tail=t),this.lengthInNodes++,this.sizeInBytes+=t.size}shift(){if(!this.head)return;const e=this.head;this.head=this.head.next,this.head||(this.tail=null),this.lengthInNodes--,this.sizeInBytes-=e.size}toArray(){const e=[];let t=this.head;for(;t!==null;)e.push(t.value),t=t.next;return e}get length(){return this.lengthInNodes}get size(){return this.sizeInBytes}toOrderedArray(){return Array.from(this)}[Symbol.iterator](){let e=this.head;return{next:()=>{if(!e)return{done:!0,value:null};const t=e.value;return e=e.next,{done:!1,value:t}}}}},G2=class{constructor(e,t=$g){this.level=e??"error",this.levelValue=Uo.levels.values[this.level],this.MAX_LOG_SIZE_IN_BYTES=t,this.logs=new bw(this.MAX_LOG_SIZE_IN_BYTES)}forwardToConsole(e,t){t===Uo.levels.values.error?console.error(e):t===Uo.levels.values.warn?console.warn(e):t===Uo.levels.values.debug?console.debug(e):t===Uo.levels.values.trace?console.trace(e):console.log(e)}appendToLogs(e){this.logs.append(us({timestamp:new Date().toISOString(),log:e}));const t=typeof e=="string"?JSON.parse(e).level:e.level;t>=this.levelValue&&this.forwardToConsole(e,t)}getLogs(){return this.logs}clearLogs(){this.logs=new bw(this.MAX_LOG_SIZE_IN_BYTES)}getLogArray(){return Array.from(this.logs)}logsToBlob(e){const t=this.getLogArray();return t.push(us({extraMetadata:e})),new Blob(t,{type:"application/json"})}},sU=class{constructor(e,t=$g){this.baseChunkLogger=new G2(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}downloadLogsBlobInBrowser(e){const t=URL.createObjectURL(this.logsToBlob(e)),n=document.createElement("a");n.href=t,n.download=`walletconnect-logs-${new Date().toISOString()}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(t)}},iU=class{constructor(e,t=$g){this.baseChunkLogger=new G2(e,t)}write(e){this.baseChunkLogger.appendToLogs(e)}getLogs(){return this.baseChunkLogger.getLogs()}clearLogs(){this.baseChunkLogger.clearLogs()}getLogArray(){return this.baseChunkLogger.getLogArray()}logsToBlob(e){return this.baseChunkLogger.logsToBlob(e)}};var oU=Object.defineProperty,aU=Object.defineProperties,cU=Object.getOwnPropertyDescriptors,vw=Object.getOwnPropertySymbols,lU=Object.prototype.hasOwnProperty,uU=Object.prototype.propertyIsEnumerable,Ew=(r,e,t)=>e in r?oU(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ch=(r,e)=>{for(var t in e||(e={}))lU.call(e,t)&&Ew(r,t,e[t]);if(vw)for(var t of vw(e))uU.call(e,t)&&Ew(r,t,e[t]);return r},lh=(r,e)=>aU(r,cU(e));function Gh(r){return lh(ch({},r),{level:(r==null?void 0:r.level)||rU.level})}function hU(r,e=kl){return r[e]||""}function fU(r,e,t=kl){return r[t]=e,r}function Zt(r,e=kl){let t="";return typeof r.bindings>"u"?t=hU(r,e):t=r.bindings().context||"",t}function dU(r,e,t=kl){const n=Zt(r,t);return n.trim()?`${n}/${e}`:e}function $t(r,e,t=kl){const n=dU(r,e,t),s=r.child({context:n});return fU(s,n,t)}function pU(r){var e,t;const n=new sU((e=r.opts)==null?void 0:e.level,r.maxSizeInBytes);return{logger:Ul(lh(ch({},r.opts),{level:"trace",browser:lh(ch({},(t=r.opts)==null?void 0:t.browser),{write:s=>n.write(s)})})),chunkLoggerController:n}}function gU(r){var e;const t=new iU((e=r.opts)==null?void 0:e.level,r.maxSizeInBytes);return{logger:Ul(lh(ch({},r.opts),{level:"trace"}),t),chunkLoggerController:t}}function yU(r){return typeof r.loggerOverride<"u"&&typeof r.loggerOverride!="string"?{logger:r.loggerOverride,chunkLoggerController:null}:typeof window<"u"?pU(r):gU(r)}var mU=Object.defineProperty,wU=(r,e,t)=>e in r?mU(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Aw=(r,e,t)=>wU(r,typeof e!="symbol"?e+"":e,t);let bU=class extends go{constructor(e){super(),this.opts=e,Aw(this,"protocol","wc"),Aw(this,"version",2)}};var vU=Object.defineProperty,EU=(r,e,t)=>e in r?vU(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,AU=(r,e,t)=>EU(r,e+"",t);let xU=class extends go{constructor(e,t){super(),this.core=e,this.logger=t,AU(this,"records",new Map)}},IU=class{constructor(e,t){this.logger=e,this.core=t}},SU=class extends go{constructor(e,t){super(),this.relayer=e,this.logger=t}},PU=class extends go{constructor(e){super()}},OU=class{constructor(e,t,n,s){this.core=e,this.logger=t,this.name=n}},DU=class extends go{constructor(e,t){super(),this.relayer=e,this.logger=t}},CU=class extends go{constructor(e,t){super(),this.core=e,this.logger=t}},BU=class{constructor(e,t,n){this.core=e,this.logger=t,this.store=n}},_U=class{constructor(e,t){this.projectId=e,this.logger=t}},TU=class{constructor(e,t,n){this.core=e,this.logger=t,this.telemetryEnabled=n}};var NU=Object.defineProperty,RU=(r,e,t)=>e in r?NU(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,xw=(r,e,t)=>RU(r,typeof e!="symbol"?e+"":e,t);let UU=class{constructor(e){this.opts=e,xw(this,"protocol","wc"),xw(this,"version",2)}},kU=class{constructor(e){this.client=e}};const $U="PARSE_ERROR",LU="INVALID_REQUEST",FU="METHOD_NOT_FOUND",MU="INVALID_PARAMS",Q2="INTERNAL_ERROR",Lg="SERVER_ERROR",jU=[-32700,-32600,-32601,-32602,-32603],Fc={[$U]:{code:-32700,message:"Parse error"},[LU]:{code:-32600,message:"Invalid Request"},[FU]:{code:-32601,message:"Method not found"},[MU]:{code:-32602,message:"Invalid params"},[Q2]:{code:-32603,message:"Internal error"},[Lg]:{code:-32e3,message:"Server error"}},W2=Lg;function zU(r){return jU.includes(r)}function Iw(r){return Object.keys(Fc).includes(r)?Fc[r]:Fc[W2]}function HU(r){const e=Object.values(Fc).find(t=>t.code===r);return e||Fc[W2]}function J2(r,e,t){return r.message.includes("getaddrinfo ENOTFOUND")||r.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${t} RPC url at ${e}`):r}var sd={},Nn={},Sw;function qU(){if(Sw)return Nn;Sw=1,Object.defineProperty(Nn,"__esModule",{value:!0}),Nn.isBrowserCryptoAvailable=Nn.getSubtleCrypto=Nn.getBrowerCrypto=void 0;function r(){return(mn==null?void 0:mn.crypto)||(mn==null?void 0:mn.msCrypto)||{}}Nn.getBrowerCrypto=r;function e(){const n=r();return n.subtle||n.webkitSubtle}Nn.getSubtleCrypto=e;function t(){return!!r()&&!!e()}return Nn.isBrowserCryptoAvailable=t,Nn}var Rn={},Pw;function VU(){if(Pw)return Rn;Pw=1,Object.defineProperty(Rn,"__esModule",{value:!0}),Rn.isBrowser=Rn.isNode=Rn.isReactNative=void 0;function r(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Rn.isReactNative=r;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}Rn.isNode=e;function t(){return!r()&&!e()}return Rn.isBrowser=t,Rn}var Ow;function KU(){return Ow||(Ow=1,(function(r){Object.defineProperty(r,"__esModule",{value:!0});const e=Sl;e.__exportStar(qU(),r),e.__exportStar(VU(),r)})(sd)),sd}var GU=KU();function sn(r=3){const e=Date.now()*Math.pow(10,r),t=Math.floor(Math.random()*Math.pow(10,r));return e+t}function Js(r=6){return BigInt(sn(r))}function Vr(r,e,t){return{id:t||sn(),jsonrpc:"2.0",method:r,params:e}}function ol(r,e){return{id:r,jsonrpc:"2.0",result:e}}function Qh(r,e,t){return{id:r,jsonrpc:"2.0",error:QU(e)}}function QU(r,e){return typeof r>"u"?Iw(Q2):(typeof r=="string"&&(r=Object.assign(Object.assign({},Iw(Lg)),{message:r})),zU(r.code)&&(r=HU(r.code)),r)}class WU{}class JU extends WU{constructor(){super()}}class YU extends JU{constructor(e){super()}}const ZU="^https?:",XU="^wss?:";function e5(r){const e=r.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function Y2(r,e){const t=e5(r);return typeof t>"u"?!1:new RegExp(e).test(t)}function Dw(r){return Y2(r,ZU)}function Cw(r){return Y2(r,XU)}function t5(r){return new RegExp("wss?://localhost(:d{2,5})?").test(r)}function Z2(r){return typeof r=="object"&&"id"in r&&"jsonrpc"in r&&r.jsonrpc==="2.0"}function Fg(r){return Z2(r)&&"method"in r}function Wh(r){return Z2(r)&&(on(r)||Sr(r))}function on(r){return"result"in r}function Sr(r){return"error"in r}let Mg=class extends YU{constructor(e){super(e),this.events=new hr.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async request(e,t){return this.requestStrict(Vr(e.method,e.params||[],e.id||Js().toString()),t)}async requestStrict(e,t){return new Promise(async(n,s)=>{if(!this.connection.connected)try{await this.open()}catch(i){s(i)}this.events.on(`${e.id}`,i=>{Sr(i)?s(i.error):n(i.result)});try{await this.connection.send(e,t)}catch(i){s(i)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Wh(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}};const r5=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),n5=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Bw=r=>r.split("?")[0],_w=10,s5=r5();let i5=class{constructor(e){if(this.url=e,this.events=new hr.EventEmitter,this.registering=!1,!Cw(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,t)=>{if(typeof this.socket>"u"){t(new Error("Connection already closed"));return}this.socket.onclose=n=>{this.onClose(n),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(us(e))}catch(t){this.onError(e.id,t)}}register(e=this.url){if(!Cw(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((n,s)=>{this.events.once("register_error",i=>{this.resetMaxListeners(),s(i)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));n(this.socket)})})}return this.url=e,this.registering=!0,new Promise((t,n)=>{const s=GU.isReactNative()?void 0:{rejectUnauthorized:!t5(e)},i=new s5(e,[],s);n5()?i.onerror=o=>{const a=o;n(this.emitError(a.error))}:i.on("error",o=>{n(this.emitError(o))}),i.onopen=()=>{this.onOpen(i),t(i)}})}onOpen(e){e.onmessage=t=>this.onPayload(t),e.onclose=t=>this.onClose(t),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const t=typeof e.data=="string"?oo(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const n=this.parseError(t),s=n.message||n.toString(),i=Qh(e,s);this.events.emit("payload",i)}parseError(e,t=this.url){return J2(e,Bw(t),"WS")}resetMaxListeners(){this.events.getMaxListeners()>_w&&this.events.setMaxListeners(_w)}emitError(e){const t=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${Bw(this.url)}`));return this.events.emit("register_error",t),t}};var o5={};const X2="wc",eA=2,Bp="core",On=`${X2}@2:${Bp}:`,a5={logger:"error"},c5={database:":memory:"},l5="crypto",Tw="client_ed25519_seed",u5=J.ONE_DAY,h5="keychain",f5="0.3",d5="messages",p5="0.3",g5=J.SIX_HOURS,y5="publisher",tA="irn",m5="error",rA="wss://relay.walletconnect.org",w5="relayer",Me={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},b5="_subscription",dr={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},v5=.1,_p="2.21.9",Te={link_mode:"link_mode",relay:"relay"},Cu={inbound:"inbound",outbound:"outbound"},E5="0.3",A5="WALLETCONNECT_CLIENT_ID",Nw="WALLETCONNECT_LINK_MODE_APPS",rr={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},x5="subscription",I5="0.3",S5="pairing",P5="0.3",vc={wc_pairingDelete:{req:{ttl:J.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:J.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:J.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:J.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:J.ONE_DAY,prompt:!1,tag:0},res:{ttl:J.ONE_DAY,prompt:!1,tag:0}}},vi={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},_r={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},O5="history",D5="0.3",C5="expirer",yr={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},B5="0.3",_5="verify-api",T5="https://verify.walletconnect.com",nA="https://verify.walletconnect.org",Mc=nA,N5=`${Mc}/v3`,R5=[T5,nA],U5="echo",k5="https://echo.walletconnect.com",nn={pairing_started:"pairing_started",pairing_uri_validation_success:"pairing_uri_validation_success",pairing_uri_not_expired:"pairing_uri_not_expired",store_new_pairing:"store_new_pairing",subscribing_pairing_topic:"subscribing_pairing_topic",subscribe_pairing_topic_success:"subscribe_pairing_topic_success",existing_pairing:"existing_pairing",pairing_not_expired:"pairing_not_expired",emit_inactive_pairing:"emit_inactive_pairing",emit_session_proposal:"emit_session_proposal",subscribing_to_pairing_topic:"subscribing_to_pairing_topic"},$n={no_wss_connection:"no_wss_connection",no_internet_connection:"no_internet_connection",malformed_pairing_uri:"malformed_pairing_uri",active_pairing_already_exists:"active_pairing_already_exists",subscribe_pairing_topic_failure:"subscribe_pairing_topic_failure",pairing_expired:"pairing_expired",proposal_expired:"proposal_expired",proposal_listener_not_found:"proposal_listener_not_found"},Ss={session_approve_started:"session_approve_started",proposal_not_expired:"proposal_not_expired",session_namespaces_validation_success:"session_namespaces_validation_success",create_session_topic:"create_session_topic",subscribing_session_topic:"subscribing_session_topic",subscribe_session_topic_success:"subscribe_session_topic_success",publishing_session_approve:"publishing_session_approve",session_approve_publish_success:"session_approve_publish_success",store_session:"store_session",publishing_session_settle:"publishing_session_settle",session_settle_publish_success:"session_settle_publish_success"},Ec={no_internet_connection:"no_internet_connection",no_wss_connection:"no_wss_connection",proposal_expired:"proposal_expired",subscribe_session_topic_failure:"subscribe_session_topic_failure",session_approve_publish_failure:"session_approve_publish_failure",session_settle_publish_failure:"session_settle_publish_failure",session_approve_namespace_validation_failure:"session_approve_namespace_validation_failure",proposal_not_found:"proposal_not_found"},hi={authenticated_session_approve_started:"authenticated_session_approve_started",create_authenticated_session_topic:"create_authenticated_session_topic",cacaos_verified:"cacaos_verified",store_authenticated_session:"store_authenticated_session",subscribing_authenticated_session_topic:"subscribing_authenticated_session_topic",subscribe_authenticated_session_topic_success:"subscribe_authenticated_session_topic_success",publishing_authenticated_session_approve:"publishing_authenticated_session_approve"},Ac={no_internet_connection:"no_internet_connection",invalid_cacao:"invalid_cacao",subscribe_authenticated_session_topic_failure:"subscribe_authenticated_session_topic_failure",authenticated_session_approve_publish_failure:"authenticated_session_approve_publish_failure",authenticated_session_pending_request_not_found:"authenticated_session_pending_request_not_found"},$5=.1,L5="event-client",F5=86400,M5="https://pulse.walletconnect.org/batch";function j5(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var s=0;s<r.length;s++){var i=r.charAt(s),o=i.charCodeAt(0);if(t[o]!==255)throw new TypeError(i+" is ambiguous");t[o]=s}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function h(p){if(p instanceof Uint8Array||(ArrayBuffer.isView(p)?p=new Uint8Array(p.buffer,p.byteOffset,p.byteLength):Array.isArray(p)&&(p=Uint8Array.from(p))),!(p instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(p.length===0)return"";for(var g=0,m=0,b=0,x=p.length;b!==x&&p[b]===0;)b++,g++;for(var v=(x-b)*u+1>>>0,I=new Uint8Array(v);b!==x;){for(var S=p[b],E=0,P=v-1;(S!==0||E<m)&&P!==-1;P--,E++)S+=256*I[P]>>>0,I[P]=S%a>>>0,S=S/a>>>0;if(S!==0)throw new Error("Non-zero carry");m=E,b++}for(var D=v-m;D!==v&&I[D]===0;)D++;for(var B=c.repeat(g);D<v;++D)B+=r.charAt(I[D]);return B}function f(p){if(typeof p!="string")throw new TypeError("Expected String");if(p.length===0)return new Uint8Array;var g=0;if(p[g]!==" "){for(var m=0,b=0;p[g]===c;)m++,g++;for(var x=(p.length-g)*l+1>>>0,v=new Uint8Array(x);p[g];){var I=t[p.charCodeAt(g)];if(I===255)return;for(var S=0,E=x-1;(I!==0||S<b)&&E!==-1;E--,S++)I+=a*v[E]>>>0,v[E]=I%256>>>0,I=I/256>>>0;if(I!==0)throw new Error("Non-zero carry");b=S,g++}if(p[g]!==" "){for(var P=x-b;P!==x&&v[P]===0;)P++;for(var D=new Uint8Array(m+(x-P)),B=m;P!==x;)D[B++]=v[P++];return D}}}function d(p){var g=f(p);if(g)return g;throw new Error(`Non-${e} character`)}return{encode:h,decodeUnsafe:f,decode:d}}var z5=j5,H5=z5;const sA=r=>{if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")},q5=r=>new TextEncoder().encode(r),V5=r=>new TextDecoder().decode(r);class K5{constructor(e,t,n){this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class G5{constructor(e,t,n){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return iA(this,e)}}class Q5{constructor(e){this.decoders=e}or(e){return iA(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const iA=(r,e)=>new Q5({...r.decoders||{[r.prefix]:r},...e.decoders||{[e.prefix]:e}});class W5{constructor(e,t,n,s){this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=s,this.encoder=new K5(e,t,n),this.decoder=new G5(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const Jh=({name:r,prefix:e,encode:t,decode:n})=>new W5(r,e,t,n),$l=({prefix:r,name:e,alphabet:t})=>{const{encode:n,decode:s}=H5(t,e);return Jh({prefix:r,name:e,encode:n,decode:i=>sA(s(i))})},J5=(r,e,t,n)=>{const s={};for(let u=0;u<e.length;++u)s[e[u]]=u;let i=r.length;for(;r[i-1]==="=";)--i;const o=new Uint8Array(i*t/8|0);let a=0,c=0,l=0;for(let u=0;u<i;++u){const h=s[r[u]];if(h===void 0)throw new SyntaxError(`Non-${n} character`);c=c<<t|h,a+=t,a>=8&&(a-=8,o[l++]=255&c>>a)}if(a>=t||255&c<<8-a)throw new SyntaxError("Unexpected end of data");return o},Y5=(r,e,t)=>{const n=e[e.length-1]==="=",s=(1<<t)-1;let i="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,i+=e[s&a>>o];if(o&&(i+=e[s&a<<t-o]),n)for(;i.length*t&7;)i+="=";return i},yt=({name:r,prefix:e,bitsPerChar:t,alphabet:n})=>Jh({prefix:e,name:r,encode(s){return Y5(s,n,t)},decode(s){return J5(s,n,t,r)}}),Z5=Jh({prefix:"\0",name:"identity",encode:r=>V5(r),decode:r=>q5(r)});var X5=Object.freeze({__proto__:null,identity:Z5});const ek=yt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var tk=Object.freeze({__proto__:null,base2:ek});const rk=yt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var nk=Object.freeze({__proto__:null,base8:rk});const sk=$l({prefix:"9",name:"base10",alphabet:"0123456789"});var ik=Object.freeze({__proto__:null,base10:sk});const ok=yt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),ak=yt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var ck=Object.freeze({__proto__:null,base16:ok,base16upper:ak});const lk=yt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),uk=yt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),hk=yt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),fk=yt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),dk=yt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),pk=yt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),gk=yt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),yk=yt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),mk=yt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var wk=Object.freeze({__proto__:null,base32:lk,base32upper:uk,base32pad:hk,base32padupper:fk,base32hex:dk,base32hexupper:pk,base32hexpad:gk,base32hexpadupper:yk,base32z:mk});const bk=$l({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),vk=$l({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Ek=Object.freeze({__proto__:null,base36:bk,base36upper:vk});const Ak=$l({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),xk=$l({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Ik=Object.freeze({__proto__:null,base58btc:Ak,base58flickr:xk});const Sk=yt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Pk=yt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ok=yt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Dk=yt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Ck=Object.freeze({__proto__:null,base64:Sk,base64pad:Pk,base64url:Ok,base64urlpad:Dk});const oA=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),Bk=oA.reduce((r,e,t)=>(r[t]=e,r),[]),_k=oA.reduce((r,e,t)=>(r[e.codePointAt(0)]=t,r),[]);function Tk(r){return r.reduce((e,t)=>(e+=Bk[t],e),"")}function Nk(r){const e=[];for(const t of r){const n=_k[t.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(n)}return new Uint8Array(e)}const Rk=Jh({prefix:"🚀",name:"base256emoji",encode:Tk,decode:Nk});var Uk=Object.freeze({__proto__:null,base256emoji:Rk}),kk=aA,Rw=128,$k=-128,Lk=Math.pow(2,31);function aA(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Lk;)e[t++]=r&255|Rw,r/=128;for(;r&$k;)e[t++]=r&255|Rw,r>>>=7;return e[t]=r|0,aA.bytes=t-n+1,e}var Fk=Tp,Mk=128,Uw=127;function Tp(r,n){var t=0,n=n||0,s=0,i=n,o,a=r.length;do{if(i>=a)throw Tp.bytes=0,new RangeError("Could not decode varint");o=r[i++],t+=s<28?(o&Uw)<<s:(o&Uw)*Math.pow(2,s),s+=7}while(o>=Mk);return Tp.bytes=i-n,t}var jk=Math.pow(2,7),zk=Math.pow(2,14),Hk=Math.pow(2,21),qk=Math.pow(2,28),Vk=Math.pow(2,35),Kk=Math.pow(2,42),Gk=Math.pow(2,49),Qk=Math.pow(2,56),Wk=Math.pow(2,63),Jk=function(r){return r<jk?1:r<zk?2:r<Hk?3:r<qk?4:r<Vk?5:r<Kk?6:r<Gk?7:r<Qk?8:r<Wk?9:10},Yk={encode:kk,decode:Fk,encodingLength:Jk},cA=Yk;const kw=(r,e,t=0)=>(cA.encode(r,e,t),e),$w=r=>cA.encodingLength(r),Np=(r,e)=>{const t=e.byteLength,n=$w(r),s=n+$w(t),i=new Uint8Array(s+t);return kw(r,i,0),kw(t,i,n),i.set(e,s),new Zk(r,t,e,i)};class Zk{constructor(e,t,n,s){this.code=e,this.size=t,this.digest=n,this.bytes=s}}const lA=({name:r,code:e,encode:t})=>new Xk(r,e,t);class Xk{constructor(e,t,n){this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?Np(this.code,t):t.then(n=>Np(this.code,n))}else throw Error("Unknown type, must be binary type")}}const uA=r=>async e=>new Uint8Array(await crypto.subtle.digest(r,e)),e$=lA({name:"sha2-256",code:18,encode:uA("SHA-256")}),t$=lA({name:"sha2-512",code:19,encode:uA("SHA-512")});var r$=Object.freeze({__proto__:null,sha256:e$,sha512:t$});const hA=0,n$="identity",fA=sA,s$=r=>Np(hA,fA(r)),i$={code:hA,name:n$,encode:fA,digest:s$};var o$=Object.freeze({__proto__:null,identity:i$});new TextEncoder,new TextDecoder;const Lw={...X5,...tk,...nk,...ik,...ck,...wk,...Ek,...Ik,...Ck,...Uk};({...r$,...o$});function dA(r){return globalThis.Buffer!=null?new Uint8Array(r.buffer,r.byteOffset,r.byteLength):r}function a$(r=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?dA(globalThis.Buffer.allocUnsafe(r)):new Uint8Array(r)}function pA(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}const Fw=pA("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),id=pA("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=a$(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),c$={utf8:Fw,"utf-8":Fw,hex:Lw.base16,latin1:id,ascii:id,binary:id,...Lw};function l$(r,e="utf8"){const t=c$[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?dA(globalThis.Buffer.from(r,"utf-8")):t.decoder.decode(`${t.prefix}${r}`)}var u$=Object.defineProperty,h$=(r,e,t)=>e in r?u$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,tn=(r,e,t)=>h$(r,typeof e!="symbol"?e+"":e,t);class f${constructor(e,t){this.core=e,this.logger=t,tn(this,"keychain",new Map),tn(this,"name",h5),tn(this,"version",f5),tn(this,"initialized",!1),tn(this,"storagePrefix",On),tn(this,"init",async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}}),tn(this,"has",n=>(this.isInitialized(),this.keychain.has(n))),tn(this,"set",async(n,s)=>{this.isInitialized(),this.keychain.set(n,s),await this.persist()}),tn(this,"get",n=>{this.isInitialized();const s=this.keychain.get(n);if(typeof s>"u"){const{message:i}=W("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(i)}return s}),tn(this,"del",async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()}),this.core=e,this.logger=$t(t,this.name)}get context(){return Zt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,gp(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?yp(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}}var d$=Object.defineProperty,p$=(r,e,t)=>e in r?d$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ot=(r,e,t)=>p$(r,typeof e!="symbol"?e+"":e,t);class g${constructor(e,t,n){this.core=e,this.logger=t,ot(this,"name",l5),ot(this,"keychain"),ot(this,"randomSessionIdentifier",Op()),ot(this,"initialized",!1),ot(this,"init",async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)}),ot(this,"hasKeys",s=>(this.isInitialized(),this.keychain.has(s))),ot(this,"getClientId",async()=>{this.isInitialized();const s=await this.getClientSeed(),i=cm(s);return RE(i.publicKey)}),ot(this,"generateKeyPair",()=>{this.isInitialized();const s=t6();return this.setPrivateKey(s.publicKey,s.privateKey)}),ot(this,"signJWT",async s=>{this.isInitialized();const i=await this.getClientSeed(),o=cm(i),a=this.randomSessionIdentifier;return await WB(a,s,u5,o)}),ot(this,"generateSharedKey",(s,i,o)=>{this.isInitialized();const a=this.getPrivateKey(s),c=r6(a,i);return this.setSymKey(c,o)}),ot(this,"setSymKey",async(s,i)=>{this.isInitialized();const o=i||Pu(s);return await this.keychain.set(o,s),o}),ot(this,"deleteKeyPair",async s=>{this.isInitialized(),await this.keychain.del(s)}),ot(this,"deleteSymKey",async s=>{this.isInitialized(),await this.keychain.del(s)}),ot(this,"encode",async(s,i,o)=>{this.isInitialized();const a=z2(o),c=us(i);if(Zm(a))return i6(c,o==null?void 0:o.encoding);if(Ym(a)){const f=a.senderPublicKey,d=a.receiverPublicKey;s=await this.generateSharedKey(f,d)}const l=this.getSymKey(s),{type:u,senderPublicKey:h}=a;return n6({type:u,symKey:l,message:c,senderPublicKey:h,encoding:o==null?void 0:o.encoding})}),ot(this,"decode",async(s,i,o)=>{this.isInitialized();const a=a6(i,o);if(Zm(a)){const c=o6(i,o==null?void 0:o.encoding);return oo(c)}if(Ym(a)){const c=a.receiverPublicKey,l=a.senderPublicKey;s=await this.generateSharedKey(c,l)}try{const c=this.getSymKey(s),l=s6({symKey:c,encoded:i,encoding:o==null?void 0:o.encoding});return oo(l)}catch(c){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(c)}}),ot(this,"getPayloadType",(s,i=Kt)=>{const o=il({encoded:s,encoding:i});return co(o.type)}),ot(this,"getPayloadSenderPublicKey",(s,i=Kt)=>{const o=il({encoded:s,encoding:i});return o.senderPublicKey?Jt(o.senderPublicKey,kt):void 0}),this.core=e,this.logger=$t(t,this.name),this.keychain=n||new f$(this.core,this.logger)}get context(){return Zt(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Tw)}catch{e=Op(),await this.keychain.set(Tw,e)}return l$(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}}var y$=Object.defineProperty,m$=Object.defineProperties,w$=Object.getOwnPropertyDescriptors,Mw=Object.getOwnPropertySymbols,b$=Object.prototype.hasOwnProperty,v$=Object.prototype.propertyIsEnumerable,Rp=(r,e,t)=>e in r?y$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,E$=(r,e)=>{for(var t in e||(e={}))b$.call(e,t)&&Rp(r,t,e[t]);if(Mw)for(var t of Mw(e))v$.call(e,t)&&Rp(r,t,e[t]);return r},A$=(r,e)=>m$(r,w$(e)),Xt=(r,e,t)=>Rp(r,typeof e!="symbol"?e+"":e,t);class x$ extends IU{constructor(e,t){super(e,t),this.logger=e,this.core=t,Xt(this,"messages",new Map),Xt(this,"messagesWithoutClientAck",new Map),Xt(this,"name",d5),Xt(this,"version",p5),Xt(this,"initialized",!1),Xt(this,"storagePrefix",On),Xt(this,"init",async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n);const s=await this.getRelayerMessagesWithoutClientAck();typeof s<"u"&&(this.messagesWithoutClientAck=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}}),Xt(this,"set",async(n,s,i)=>{this.isInitialized();const o=Ir(s);let a=this.messages.get(n);if(typeof a>"u"&&(a={}),typeof a[o]<"u")return o;if(a[o]=s,this.messages.set(n,a),i===Cu.inbound){const c=this.messagesWithoutClientAck.get(n)||{};this.messagesWithoutClientAck.set(n,A$(E$({},c),{[o]:s}))}return await this.persist(),o}),Xt(this,"get",n=>{this.isInitialized();let s=this.messages.get(n);return typeof s>"u"&&(s={}),s}),Xt(this,"getWithoutAck",n=>{this.isInitialized();const s={};for(const i of n){const o=this.messagesWithoutClientAck.get(i)||{};s[i]=Object.values(o)}return s}),Xt(this,"has",(n,s)=>{this.isInitialized();const i=this.get(n),o=Ir(s);return typeof i[o]<"u"}),Xt(this,"ack",async(n,s)=>{this.isInitialized();const i=this.messagesWithoutClientAck.get(n);if(typeof i>"u")return;const o=Ir(s);delete i[o],Object.keys(i).length===0?this.messagesWithoutClientAck.delete(n):this.messagesWithoutClientAck.set(n,i),await this.persist()}),Xt(this,"del",async n=>{this.isInitialized(),this.messages.delete(n),this.messagesWithoutClientAck.delete(n),await this.persist()}),this.logger=$t(e,this.name),this.core=t}get context(){return Zt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get storageKeyWithoutClientAck(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name+"_withoutClientAck"}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,gp(e))}async setRelayerMessagesWithoutClientAck(e){await this.core.storage.setItem(this.storageKeyWithoutClientAck,gp(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?yp(e):void 0}async getRelayerMessagesWithoutClientAck(){const e=await this.core.storage.getItem(this.storageKeyWithoutClientAck);return typeof e<"u"?yp(e):void 0}async persist(){await this.setRelayerMessages(this.messages),await this.setRelayerMessagesWithoutClientAck(this.messagesWithoutClientAck)}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}}var I$=Object.defineProperty,S$=Object.defineProperties,P$=Object.getOwnPropertyDescriptors,jw=Object.getOwnPropertySymbols,O$=Object.prototype.hasOwnProperty,D$=Object.prototype.propertyIsEnumerable,Up=(r,e,t)=>e in r?I$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Do=(r,e)=>{for(var t in e||(e={}))O$.call(e,t)&&Up(r,t,e[t]);if(jw)for(var t of jw(e))D$.call(e,t)&&Up(r,t,e[t]);return r},zw=(r,e)=>S$(r,P$(e)),pr=(r,e,t)=>Up(r,typeof e!="symbol"?e+"":e,t);class C$ extends SU{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,pr(this,"events",new hr.EventEmitter),pr(this,"name",y5),pr(this,"queue",new Map),pr(this,"publishTimeout",J.toMiliseconds(J.ONE_MINUTE)),pr(this,"initialPublishTimeout",J.toMiliseconds(J.ONE_SECOND*15)),pr(this,"needsTransportRestart",!1),pr(this,"publish",async(n,s,i)=>{var o,a,c,l,u;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:s,opts:i}});const h=(i==null?void 0:i.ttl)||g5,f=(i==null?void 0:i.prompt)||!1,d=(i==null?void 0:i.tag)||0,p=(i==null?void 0:i.id)||Js().toString(),g=Mo(oh().protocol),m={id:p,method:(i==null?void 0:i.publishMethod)||g.publish,params:Do({topic:n,message:s,ttl:h,prompt:f,tag:d,attestation:i==null?void 0:i.attestation},i==null?void 0:i.tvf)},b=`Failed to publish payload, please try again. id:${p} tag:${d}`;try{Ye((o=m.params)==null?void 0:o.prompt)&&((a=m.params)==null||delete a.prompt),Ye((c=m.params)==null?void 0:c.tag)&&((l=m.params)==null||delete l.tag);const x=new Promise(async v=>{const I=({id:E})=>{var P;((P=m.id)==null?void 0:P.toString())===E.toString()&&(this.removeRequestFromQueue(E),this.relayer.events.removeListener(Me.publish,I),v())};this.relayer.events.on(Me.publish,I);const S=An(new Promise((E,P)=>{this.rpcPublish(m,i).then(E).catch(D=>{this.logger.warn(D,D==null?void 0:D.message),P(D)})}),this.initialPublishTimeout,`Failed initial publish, retrying.... id:${p} tag:${d}`);try{await S,this.events.removeListener(Me.publish,I)}catch(E){this.queue.set(p,{request:m,opts:i,attempt:1}),this.logger.warn(E,E==null?void 0:E.message)}});this.logger.trace({type:"method",method:"publish",params:{id:p,topic:n,message:s,opts:i}}),await An(x,this.publishTimeout,b)}catch(x){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(x),(u=i==null?void 0:i.internal)!=null&&u.throwOnFailedPublish)throw x}finally{this.queue.delete(p)}}),pr(this,"publishCustom",async n=>{var s,i,o,a,c;this.logger.debug("Publishing custom payload"),this.logger.trace({type:"method",method:"publishCustom",params:n});const{payload:l,opts:u={}}=n,{attestation:h,tvf:f,publishMethod:d,prompt:p,tag:g,ttl:m=J.FIVE_MINUTES}=u,b=u.id||Js().toString(),x=Mo(oh().protocol),v=d||x.publish,I={id:b,method:v,params:Do(zw(Do({},l),{ttl:m,prompt:p,tag:g,attestation:h}),f)},S=`Failed to publish custom payload, please try again. id:${b} tag:${g}`;try{Ye((s=I.params)==null?void 0:s.prompt)&&((i=I.params)==null||delete i.prompt),Ye((o=I.params)==null?void 0:o.tag)&&((a=I.params)==null||delete a.tag);const E=new Promise(async P=>{const D=({id:L})=>{var j;((j=I.id)==null?void 0:j.toString())===L.toString()&&(this.removeRequestFromQueue(L),this.relayer.events.removeListener(Me.publish,D),P())};this.relayer.events.on(Me.publish,D);const B=An(new Promise((L,j)=>{this.rpcPublish(I,u).then(L).catch($=>{this.logger.warn($,$==null?void 0:$.message),j($)})}),this.initialPublishTimeout,`Failed initial custom payload publish, retrying.... method:${v} id:${b} tag:${g}`);try{await B,this.events.removeListener(Me.publish,D)}catch(L){this.queue.set(b,{request:I,opts:u,attempt:1}),this.logger.warn(L,L==null?void 0:L.message)}});this.logger.trace({type:"method",method:"publish",params:{id:b,payload:l,opts:u}}),await An(E,this.publishTimeout,S)}catch(E){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(E),(c=u==null?void 0:u.internal)!=null&&c.throwOnFailedPublish)throw E}finally{this.queue.delete(b)}}),pr(this,"on",(n,s)=>{this.events.on(n,s)}),pr(this,"once",(n,s)=>{this.events.once(n,s)}),pr(this,"off",(n,s)=>{this.events.off(n,s)}),pr(this,"removeListener",(n,s)=>{this.events.removeListener(n,s)}),this.relayer=e,this.logger=$t(t,this.name),this.registerEventListeners()}get context(){return Zt(this.logger)}async rpcPublish(e,t){this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:e});const n=await this.relayer.request(e);return this.relayer.events.emit(Me.publish,Do(Do({},e),t)),this.logger.debug("Successfully Published Payload"),n}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async(e,t)=>{var n;const s=e.attempt+1;this.queue.set(t,zw(Do({},e),{attempt:s})),this.logger.warn({},`Publisher: queue->publishing: ${e.request.id}, tag: ${(n=e.request.params)==null?void 0:n.tag}, attempt: ${s}`),await this.rpcPublish(e.request,e.opts),this.logger.warn({},`Publisher: queue->published: ${e.request.id}`)})}registerEventListeners(){this.relayer.core.heartbeat.on(yo.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Me.connection_stalled);return}this.checkQueue()}),this.relayer.on(Me.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}var B$=Object.defineProperty,_$=(r,e,t)=>e in r?B$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Co=(r,e,t)=>_$(r,typeof e!="symbol"?e+"":e,t);class T${constructor(){Co(this,"map",new Map),Co(this,"set",(e,t)=>{const n=this.get(e);this.exists(e,t)||this.map.set(e,[...n,t])}),Co(this,"get",e=>this.map.get(e)||[]),Co(this,"exists",(e,t)=>this.get(e).includes(t)),Co(this,"delete",(e,t)=>{if(typeof t>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const n=this.get(e);if(!this.exists(e,t))return;const s=n.filter(i=>i!==t);if(!s.length){this.map.delete(e);return}this.map.set(e,s)}),Co(this,"clear",()=>{this.map.clear()})}get topics(){return Array.from(this.map.keys())}}var N$=Object.defineProperty,R$=Object.defineProperties,U$=Object.getOwnPropertyDescriptors,Hw=Object.getOwnPropertySymbols,k$=Object.prototype.hasOwnProperty,$$=Object.prototype.propertyIsEnumerable,kp=(r,e,t)=>e in r?N$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,xc=(r,e)=>{for(var t in e||(e={}))k$.call(e,t)&&kp(r,t,e[t]);if(Hw)for(var t of Hw(e))$$.call(e,t)&&kp(r,t,e[t]);return r},od=(r,e)=>R$(r,U$(e)),Ce=(r,e,t)=>kp(r,typeof e!="symbol"?e+"":e,t);class L$ extends DU{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,Ce(this,"subscriptions",new Map),Ce(this,"topicMap",new T$),Ce(this,"events",new hr.EventEmitter),Ce(this,"name",x5),Ce(this,"version",I5),Ce(this,"pending",new Map),Ce(this,"cached",[]),Ce(this,"initialized",!1),Ce(this,"storagePrefix",On),Ce(this,"subscribeTimeout",J.toMiliseconds(J.ONE_MINUTE)),Ce(this,"initialSubscribeTimeout",J.toMiliseconds(J.ONE_SECOND*15)),Ce(this,"clientId"),Ce(this,"batchSubscribeTopicsLimit",500),Ce(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),await this.restore()),this.initialized=!0}),Ce(this,"subscribe",async(n,s)=>{var i;this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:s}});try{const o=oh(s),a={topic:n,relay:o,transportType:s==null?void 0:s.transportType};(i=s==null?void 0:s.internal)!=null&&i.skipSubscribe||this.pending.set(n,a);const c=await this.rpcSubscribe(n,o,s);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:s}})),c}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}}),Ce(this,"unsubscribe",async(n,s)=>{this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(n,s.id,s):await this.unsubscribeByTopic(n,s)}),Ce(this,"isSubscribed",n=>new Promise(s=>{s(this.topicMap.topics.includes(n))})),Ce(this,"isKnownTopic",n=>new Promise(s=>{s(this.topicMap.topics.includes(n)||this.pending.has(n)||this.cached.some(i=>i.topic===n))})),Ce(this,"on",(n,s)=>{this.events.on(n,s)}),Ce(this,"once",(n,s)=>{this.events.once(n,s)}),Ce(this,"off",(n,s)=>{this.events.off(n,s)}),Ce(this,"removeListener",(n,s)=>{this.events.removeListener(n,s)}),Ce(this,"start",async()=>{await this.onConnect()}),Ce(this,"stop",async()=>{await this.onDisconnect()}),Ce(this,"restart",async()=>{await this.restore(),await this.onRestart()}),Ce(this,"checkPending",async()=>{if(this.pending.size===0&&(!this.initialized||!this.relayer.connected))return;const n=[];this.pending.forEach(s=>{n.push(s)}),await this.batchSubscribe(n)}),Ce(this,"registerEventListeners",()=>{this.relayer.core.heartbeat.on(yo.pulse,async()=>{await this.checkPending()}),this.events.on(rr.created,async n=>{const s=rr.created;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:n}),await this.persist()}),this.events.on(rr.deleted,async n=>{const s=rr.deleted;this.logger.info(`Emitting ${s}`),this.logger.debug({type:"event",event:s,data:n}),await this.persist()})}),this.relayer=e,this.logger=$t(t,this.name),this.clientId=""}get context(){return Zt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}get hasAnyTopics(){return this.topicMap.topics.length>0||this.pending.size>0||this.cached.length>0||this.subscriptions.size>0}hasSubscription(e,t){let n=!1;try{n=this.getSubscription(e).topic===t}catch{}return n}reset(){this.cached=[],this.initialized=!0}onDisable(){this.values.length>0&&(this.cached=this.values),this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){const n=this.topicMap.get(e);await Promise.all(n.map(async s=>await this.unsubscribeById(e,s,t)))}async unsubscribeById(e,t,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:n}});try{const s=oh(n);await this.restartToComplete({topic:e,id:t,relay:s}),await this.rpcUnsubscribe(e,t,s);const i=Ne("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,i),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:n}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,t,n){var s,i;const o=await this.getSubscriptionId(e);if((s=n==null?void 0:n.internal)!=null&&s.skipSubscribe)return o;(!n||(n==null?void 0:n.transportType)===Te.relay)&&await this.restartToComplete({topic:e,id:e,relay:t});const a={method:Mo(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a});const c=(i=n==null?void 0:n.internal)==null?void 0:i.throwOnFailedPublish;try{if((n==null?void 0:n.transportType)===Te.link_mode)return setTimeout(()=>{(this.relayer.connected||this.relayer.connecting)&&this.relayer.request(a).catch(h=>this.logger.warn(h))},J.toMiliseconds(J.ONE_SECOND)),o;const l=new Promise(async h=>{const f=d=>{d.topic===e&&(this.events.removeListener(rr.created,f),h(d.id))};this.events.on(rr.created,f);try{const d=await An(new Promise((p,g)=>{this.relayer.request(a).catch(m=>{this.logger.warn(m,m==null?void 0:m.message),g(m)}).then(p)}),this.initialSubscribeTimeout,`Subscribing to ${e} failed, please try again`);this.events.removeListener(rr.created,f),h(d)}catch{}}),u=await An(l,this.subscribeTimeout,`Subscribing to ${e} failed, please try again`);if(!u&&c)throw new Error(`Subscribing to ${e} failed, please try again`);return u?o:null}catch(l){if(this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Me.connection_stalled),c)throw l}return null}async rpcBatchSubscribe(e){if(!e.length)return;const t=e[0].relay,n={method:Mo(t.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await An(new Promise(s=>{this.relayer.request(n).catch(i=>this.logger.warn(i)).then(s)}),this.subscribeTimeout,"rpcBatchSubscribe failed, please try again")}catch{this.relayer.events.emit(Me.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const t=e[0].relay,n={method:Mo(t.protocol).batchFetchMessages,params:{topics:e.map(i=>i.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});let s;try{s=await await An(new Promise((i,o)=>{this.relayer.request(n).catch(a=>{this.logger.warn(a),o(a)}).then(i)}),this.subscribeTimeout,"rpcBatchFetchMessages failed, please try again")}catch{this.relayer.events.emit(Me.connection_stalled)}return s}rpcUnsubscribe(e,t,n){const s={method:Mo(n.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,t){this.setSubscription(e,od(xc({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(t=>{this.setSubscription(t.id,xc({},t)),this.pending.delete(t.topic)})}async onUnsubscribe(e,t,n){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,n),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t)}addSubscription(e,t){this.subscriptions.set(e,xc({},t)),this.topicMap.set(t.topic,e),this.events.emit(rr.created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:n}=W("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const n=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(n.topic,e),this.events.emit(rr.deleted,od(xc({},n),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(rr.sync)}async onRestart(){if(this.cached.length){const e=[...this.cached],t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let n=0;n<t;n++){const s=e.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(rr.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size&&!e.every(t=>{var n;return t.topic===((n=this.subscriptions.get(t.id))==null?void 0:n.topic)})){const{message:t}=W("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){e.length&&(await this.rpcBatchSubscribe(e),this.onBatchSubscribe(await Promise.all(e.map(async t=>od(xc({},t),{id:await this.getSubscriptionId(t.topic)})))))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const t=await this.rpcBatchFetchMessages(e);t&&t.messages&&(await xT(J.toMiliseconds(J.ONE_SECOND)),await this.relayer.handleBatchMessageEvents(t.messages))}async onConnect(){await this.restart(),this.reset()}onDisconnect(){this.onDisable()}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(e){!this.relayer.connected&&!this.relayer.connecting&&(this.cached.push(e),await this.relayer.transportOpen())}async getClientId(){return this.clientId||(this.clientId=await this.relayer.core.crypto.getClientId()),this.clientId}async getSubscriptionId(e){return Ir(e+await this.getClientId())}}var F$=Object.defineProperty,qw=Object.getOwnPropertySymbols,M$=Object.prototype.hasOwnProperty,j$=Object.prototype.propertyIsEnumerable,$p=(r,e,t)=>e in r?F$(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Vw=(r,e)=>{for(var t in e||(e={}))M$.call(e,t)&&$p(r,t,e[t]);if(qw)for(var t of qw(e))j$.call(e,t)&&$p(r,t,e[t]);return r},be=(r,e,t)=>$p(r,typeof e!="symbol"?e+"":e,t);class z$ extends PU{constructor(e){super(e),be(this,"protocol","wc"),be(this,"version",2),be(this,"core"),be(this,"logger"),be(this,"events",new hr.EventEmitter),be(this,"provider"),be(this,"messages"),be(this,"subscriber"),be(this,"publisher"),be(this,"name",w5),be(this,"transportExplicitlyClosed",!1),be(this,"initialized",!1),be(this,"connectionAttemptInProgress",!1),be(this,"relayUrl"),be(this,"projectId"),be(this,"packageName"),be(this,"bundleId"),be(this,"hasExperiencedNetworkDisruption",!1),be(this,"pingTimeout"),be(this,"heartBeatTimeout",J.toMiliseconds(J.THIRTY_SECONDS+J.FIVE_SECONDS)),be(this,"reconnectTimeout"),be(this,"connectPromise"),be(this,"reconnectInProgress",!1),be(this,"requestsInFlight",[]),be(this,"connectTimeout",J.toMiliseconds(J.ONE_SECOND*15)),be(this,"request",async t=>{var n,s;this.logger.debug("Publishing Request Payload");const i=t.id||Js().toString();await this.toEstablishConnection();try{this.logger.trace({id:i,method:t.method,topic:(n=t.params)==null?void 0:n.topic},"relayer.request - publishing...");const o=`${i}:${((s=t.params)==null?void 0:s.tag)||""}`;this.requestsInFlight.push(o);const a=await this.provider.request(t);return this.requestsInFlight=this.requestsInFlight.filter(c=>c!==o),a}catch(o){throw this.logger.debug(`Failed to Publish Request: ${i}`),o}}),be(this,"resetPingTimeout",()=>{eh()&&(clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var t,n,s,i;try{this.logger.debug({},"pingTimeout: Connection stalled, terminating..."),(i=(s=(n=(t=this.provider)==null?void 0:t.connection)==null?void 0:n.socket)==null?void 0:s.terminate)==null||i.call(s)}catch(o){this.logger.warn(o,o==null?void 0:o.message)}},this.heartBeatTimeout))}),be(this,"onPayloadHandler",t=>{this.onProviderPayload(t),this.resetPingTimeout()}),be(this,"onConnectHandler",()=>{this.logger.warn({},"Relayer connected 🛜"),this.startPingTimeout(),this.events.emit(Me.connect)}),be(this,"onDisconnectHandler",()=>{this.logger.warn({},"Relayer disconnected 🛑"),this.requestsInFlight=[],this.onProviderDisconnect()}),be(this,"onProviderErrorHandler",t=>{this.logger.fatal(`Fatal socket error: ${t.message}`),this.events.emit(Me.error,t),this.logger.fatal("Fatal socket error received, closing transport"),this.transportClose()}),be(this,"registerProviderListeners",()=>{this.provider.on(dr.payload,this.onPayloadHandler),this.provider.on(dr.connect,this.onConnectHandler),this.provider.on(dr.disconnect,this.onDisconnectHandler),this.provider.on(dr.error,this.onProviderErrorHandler)}),this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?$t(e.logger,this.name):Ul(Gh({level:e.logger||m5})),this.messages=new x$(this.logger,e.core),this.subscriber=new L$(this,this.logger),this.publisher=new C$(this,this.logger),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||rA,aT()?this.packageName=bm():cT()&&(this.bundleId=bm()),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]),this.initialized=!0,this.transportOpen().catch(e=>this.logger.warn(e,e==null?void 0:e.message))}get context(){return Zt(this.logger)}get connected(){var e,t,n;return((n=(t=(e=this.provider)==null?void 0:e.connection)==null?void 0:t.socket)==null?void 0:n.readyState)===1||!1}get connecting(){var e,t,n;return((n=(t=(e=this.provider)==null?void 0:e.connection)==null?void 0:t.socket)==null?void 0:n.readyState)===0||this.connectPromise!==void 0||!1}async publish(e,t,n){this.isInitialized(),await this.publisher.publish(e,t,n),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now(),transportType:Te.relay},Cu.outbound)}async publishCustom(e){this.isInitialized(),await this.publisher.publishCustom(e)}async subscribe(e,t){var n,s,i;this.isInitialized(),(!(t!=null&&t.transportType)||(t==null?void 0:t.transportType)==="relay")&&await this.toEstablishConnection();const o=typeof((n=t==null?void 0:t.internal)==null?void 0:n.throwOnFailedPublish)>"u"?!0:(s=t==null?void 0:t.internal)==null?void 0:s.throwOnFailedPublish;let a=((i=this.subscriber.topicMap.get(e))==null?void 0:i[0])||"",c;const l=u=>{u.topic===e&&(this.subscriber.off(rr.created,l),c())};return await Promise.all([new Promise(u=>{c=u,this.subscriber.on(rr.created,l)}),new Promise(async(u,h)=>{a=await this.subscriber.subscribe(e,Vw({internal:{throwOnFailedPublish:o}},t)).catch(f=>{o&&h(f)})||a,u()})]),a}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportDisconnect(){this.provider.disconnect&&(this.hasExperiencedNetworkDisruption||this.connected)?await An(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){if(!this.subscriber.hasAnyTopics){this.logger.info("Starting WS connection skipped because the client has no topics to work with.");return}if(this.connectPromise?(this.logger.debug({},"Waiting for existing connection attempt to resolve..."),await this.connectPromise,this.logger.debug({},"Existing connection attempt resolved")):(this.connectPromise=new Promise(async(t,n)=>{await this.connect(e).then(t).catch(n).finally(()=>{this.connectPromise=void 0})}),await this.connectPromise),!this.connected)throw new Error(`Couldn't establish socket connection to the relay server: ${this.relayUrl}`)}async restartTransport(e){this.logger.debug({},"Restarting transport..."),!this.connectionAttemptInProgress&&(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await hw())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if((e==null?void 0:e.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const t=e.sort((n,s)=>n.publishedAt-s.publishedAt);this.logger.debug(`Batch of ${t.length} message events sorted`);for(const n of t)try{await this.onMessageEvent(n)}catch(s){this.logger.warn(s,"Error while processing batch message event: "+(s==null?void 0:s.message))}this.logger.trace(`Batch of ${t.length} message events processed`)}async onLinkMessageEvent(e,t){const{topic:n}=e;if(!t.sessionExists){const s=Ke(J.FIVE_MINUTES),i={topic:n,expiry:s,relay:{protocol:"irn"},active:!1};await this.core.pairing.pairings.set(n,i)}this.events.emit(Me.message,e),await this.recordMessageEvent(e,Cu.inbound)}async connect(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;let t=1;for(;t<6;){try{if(this.transportExplicitlyClosed)break;this.logger.debug({},`Connecting to ${this.relayUrl}, attempt: ${t}...`),await this.createProvider(),await new Promise(async(n,s)=>{const i=()=>{s(new Error("Connection interrupted while trying to connect"))};this.provider.once(dr.disconnect,i),await An(new Promise((o,a)=>{this.provider.connect().then(o).catch(a)}),this.connectTimeout,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{s(o)}).finally(()=>{this.provider.off(dr.disconnect,i),clearTimeout(this.reconnectTimeout)}),await new Promise(async(o,a)=>{const c=()=>{s(new Error("Connection interrupted while trying to subscribe"))};this.provider.once(dr.disconnect,c),await this.subscriber.start().then(o).catch(a).finally(()=>{this.provider.off(dr.disconnect,c)})}),this.hasExperiencedNetworkDisruption=!1,n()})}catch(n){await this.subscriber.stop();const s=n;this.logger.warn({},s.message),this.hasExperiencedNetworkDisruption=!0}finally{this.connectionAttemptInProgress=!1}if(this.connected){this.logger.debug({},`Connected to ${this.relayUrl} successfully on attempt: ${t}`);break}await new Promise(n=>setTimeout(n,J.toMiliseconds(t*1))),t++}}startPingTimeout(){var e,t,n,s,i;if(eh())try{(t=(e=this.provider)==null?void 0:e.connection)!=null&&t.socket&&((i=(s=(n=this.provider)==null?void 0:n.connection)==null?void 0:s.socket)==null||i.on("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(o){this.logger.warn(o,o==null?void 0:o.message)}}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Mg(new i5(dT({sdkVersion:_p,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId,packageName:this.packageName}))),this.registerProviderListeners()}async recordMessageEvent(e,t){const{topic:n,message:s}=e;await this.messages.set(n,s,t)}async shouldIgnoreMessageEvent(e){const{topic:t,message:n}=e;if(!n||n.length===0)return this.logger.warn(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isKnownTopic(t))return this.logger.warn(`Ignoring message for unknown topic ${t}`),!0;const s=this.messages.has(t,n);return s&&this.logger.warn(`Ignoring duplicate message: ${n}`),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Fg(e)){if(!e.method.endsWith(b5))return;const t=e.params,{topic:n,message:s,publishedAt:i,attestation:o}=t.data,a={topic:n,message:s,publishedAt:i,transportType:Te.relay,attestation:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(Vw({type:"event",event:t.id},a)),this.events.emit(t.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else Wh(e)&&this.events.emit(Me.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(await this.recordMessageEvent(e,Cu.inbound),this.events.emit(Me.message,e))}async acknowledgePayload(e){const t=ol(e.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(dr.payload,this.onPayloadHandler),this.provider.off(dr.connect,this.onConnectHandler),this.provider.off(dr.disconnect,this.onDisconnectHandler),this.provider.off(dr.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await hw();o4(async t=>{e!==t&&(e=t,t?await this.transportOpen().catch(n=>this.logger.error(n,n==null?void 0:n.message)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))}),this.core.heartbeat.on(yo.pulse,async()=>{if(!this.transportExplicitlyClosed&&!this.connected&&l4())try{await this.confirmOnlineStateOrThrow(),await this.transportOpen()}catch(t){this.logger.warn(t,t==null?void 0:t.message)}})}async onProviderDisconnect(){clearTimeout(this.pingTimeout),this.events.emit(Me.disconnect),this.connectionAttemptInProgress=!1,!this.reconnectInProgress&&(this.reconnectInProgress=!0,await this.subscriber.stop(),this.subscriber.hasAnyTopics&&(this.transportExplicitlyClosed||(this.reconnectTimeout=setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e,e==null?void 0:e.message)),this.reconnectTimeout=void 0,this.reconnectInProgress=!1},J.toMiliseconds(v5)))))}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectPromise){await this.connectPromise;return}await this.connect()}}}function H$(r,e){return r===e||Number.isNaN(r)&&Number.isNaN(e)}function Kw(r){return Object.getOwnPropertySymbols(r).filter(e=>Object.prototype.propertyIsEnumerable.call(r,e))}function Gw(r){return r==null?r===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(r)}const q$="[object RegExp]",V$="[object String]",K$="[object Number]",G$="[object Boolean]",Qw="[object Arguments]",Q$="[object Symbol]",W$="[object Date]",J$="[object Map]",Y$="[object Set]",Z$="[object Array]",X$="[object Function]",eL="[object ArrayBuffer]",ad="[object Object]",tL="[object Error]",rL="[object DataView]",nL="[object Uint8Array]",sL="[object Uint8ClampedArray]",iL="[object Uint16Array]",oL="[object Uint32Array]",aL="[object BigUint64Array]",cL="[object Int8Array]",lL="[object Int16Array]",uL="[object Int32Array]",hL="[object BigInt64Array]",fL="[object Float32Array]",dL="[object Float64Array]";function pL(){}function Ww(r){if(!r||typeof r!="object")return!1;const e=Object.getPrototypeOf(r);return e===null||e===Object.prototype||Object.getPrototypeOf(e)===null?Object.prototype.toString.call(r)==="[object Object]":!1}function gL(r,e,t){return Rc(r,e,void 0,void 0,void 0,void 0,t)}function Rc(r,e,t,n,s,i,o){const a=o(r,e,t,n,s,i);if(a!==void 0)return a;if(typeof r==typeof e)switch(typeof r){case"bigint":case"string":case"boolean":case"symbol":case"undefined":return r===e;case"number":return r===e||Object.is(r,e);case"function":return r===e;case"object":return jc(r,e,i,o)}return jc(r,e,i,o)}function jc(r,e,t,n){if(Object.is(r,e))return!0;let s=Gw(r),i=Gw(e);if(s===Qw&&(s=ad),i===Qw&&(i=ad),s!==i)return!1;switch(s){case V$:return r.toString()===e.toString();case K$:{const c=r.valueOf(),l=e.valueOf();return H$(c,l)}case G$:case W$:case Q$:return Object.is(r.valueOf(),e.valueOf());case q$:return r.source===e.source&&r.flags===e.flags;case X$:return r===e}t=t??new Map;const o=t.get(r),a=t.get(e);if(o!=null&&a!=null)return o===e;t.set(r,e),t.set(e,r);try{switch(s){case J$:{if(r.size!==e.size)return!1;for(const[c,l]of r.entries())if(!e.has(c)||!Rc(l,e.get(c),c,r,e,t,n))return!1;return!0}case Y$:{if(r.size!==e.size)return!1;const c=Array.from(r.values()),l=Array.from(e.values());for(let u=0;u<c.length;u++){const h=c[u],f=l.findIndex(d=>Rc(h,d,void 0,r,e,t,n));if(f===-1)return!1;l.splice(f,1)}return!0}case Z$:case nL:case sL:case iL:case oL:case aL:case cL:case lL:case uL:case hL:case fL:case dL:{if(typeof Buffer<"u"&&Buffer.isBuffer(r)!==Buffer.isBuffer(e)||r.length!==e.length)return!1;for(let c=0;c<r.length;c++)if(!Rc(r[c],e[c],c,r,e,t,n))return!1;return!0}case eL:return r.byteLength!==e.byteLength?!1:jc(new Uint8Array(r),new Uint8Array(e),t,n);case rL:return r.byteLength!==e.byteLength||r.byteOffset!==e.byteOffset?!1:jc(new Uint8Array(r),new Uint8Array(e),t,n);case tL:return r.name===e.name&&r.message===e.message;case ad:{if(!(jc(r.constructor,e.constructor,t,n)||Ww(r)&&Ww(e)))return!1;const c=[...Object.keys(r),...Kw(r)],l=[...Object.keys(e),...Kw(e)];if(c.length!==l.length)return!1;for(let u=0;u<c.length;u++){const h=c[u],f=r[h];if(!Object.hasOwn(e,h))return!1;const d=e[h];if(!Rc(f,d,h,r,e,t,n))return!1}return!0}default:return!1}}finally{t.delete(r),t.delete(e)}}function yL(r,e){return gL(r,e,pL)}var mL=Object.defineProperty,Jw=Object.getOwnPropertySymbols,wL=Object.prototype.hasOwnProperty,bL=Object.prototype.propertyIsEnumerable,Lp=(r,e,t)=>e in r?mL(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Yw=(r,e)=>{for(var t in e||(e={}))wL.call(e,t)&&Lp(r,t,e[t]);if(Jw)for(var t of Jw(e))bL.call(e,t)&&Lp(r,t,e[t]);return r},Ft=(r,e,t)=>Lp(r,typeof e!="symbol"?e+"":e,t);class wo extends OU{constructor(e,t,n,s=On,i=void 0){super(e,t,n,s),this.core=e,this.logger=t,this.name=n,Ft(this,"map",new Map),Ft(this,"version",E5),Ft(this,"cached",[]),Ft(this,"initialized",!1),Ft(this,"getKey"),Ft(this,"storagePrefix",On),Ft(this,"recentlyDeleted",[]),Ft(this,"recentlyDeletedLimit",200),Ft(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(o=>{this.getKey&&o!==null&&!Ye(o)?this.map.set(this.getKey(o),o):$6(o)?this.map.set(o.id,o):L6(o)&&this.map.set(o.topic,o)}),this.cached=[],this.initialized=!0)}),Ft(this,"set",async(o,a)=>{this.isInitialized(),this.map.has(o)?await this.update(o,a):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:o,value:a}),this.map.set(o,a),await this.persist())}),Ft(this,"get",o=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:o}),this.getData(o))),Ft(this,"getAll",o=>(this.isInitialized(),o?this.values.filter(a=>Object.keys(o).every(c=>yL(a[c],o[c]))):this.values)),Ft(this,"update",async(o,a)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:o,update:a});const c=Yw(Yw({},this.getData(o)),a);this.map.set(o,c),await this.persist()}),Ft(this,"delete",async(o,a)=>{this.isInitialized(),this.map.has(o)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:o,reason:a}),this.map.delete(o),this.addToRecentlyDeleted(o),await this.persist())}),this.logger=$t(t,this.name),this.storagePrefix=s,this.getKey=i}get context(){return Zt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){if(this.recentlyDeleted.includes(e)){const{message:s}=W("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}const{message:n}=W("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:t}=W("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}}var vL=Object.defineProperty,EL=(r,e,t)=>e in r?vL(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,de=(r,e,t)=>EL(r,typeof e!="symbol"?e+"":e,t);class AL{constructor(e,t){this.core=e,this.logger=t,de(this,"name",S5),de(this,"version",P5),de(this,"events",new dg),de(this,"pairings"),de(this,"initialized",!1),de(this,"storagePrefix",On),de(this,"ignoredPayloadTypes",[is]),de(this,"registeredMethods",[]),de(this,"init",async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))}),de(this,"register",({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]}),de(this,"create",async n=>{this.isInitialized();const s=Op(),i=await this.core.crypto.setSymKey(s),o=Ke(J.FIVE_MINUTES),a={protocol:tA},c={topic:i,expiry:o,relay:a,active:!1,methods:n==null?void 0:n.methods},l=rw({protocol:this.core.protocol,version:this.core.version,topic:i,symKey:s,relay:a,expiryTimestamp:o,methods:n==null?void 0:n.methods});return this.events.emit(vi.create,c),this.core.expirer.set(i,o),await this.pairings.set(i,c),await this.core.relayer.subscribe(i,{transportType:n==null?void 0:n.transportType,internal:n==null?void 0:n.internal}),{topic:i,uri:l}}),de(this,"pair",async n=>{this.isInitialized();const s=this.core.eventClient.createEvent({properties:{topic:n==null?void 0:n.uri,trace:[nn.pairing_started]}});this.isValidPair(n,s);const{topic:i,symKey:o,relay:a,expiryTimestamp:c,methods:l}=tw(n.uri);s.props.properties.topic=i,s.addTrace(nn.pairing_uri_validation_success),s.addTrace(nn.pairing_uri_not_expired);let u;if(this.pairings.keys.includes(i)){if(u=this.pairings.get(i),s.addTrace(nn.existing_pairing),u.active)throw s.setError($n.active_pairing_already_exists),new Error(`Pairing already exists: ${i}. Please try again with a new connection URI.`);s.addTrace(nn.pairing_not_expired)}const h=c||Ke(J.FIVE_MINUTES),f={topic:i,relay:a,expiry:h,active:!1,methods:l};this.core.expirer.set(i,h),await this.pairings.set(i,f),s.addTrace(nn.store_new_pairing),n.activatePairing&&await this.activate({topic:i}),this.events.emit(vi.create,f),s.addTrace(nn.emit_inactive_pairing),this.core.crypto.keychain.has(i)||await this.core.crypto.setSymKey(o,i),s.addTrace(nn.subscribing_pairing_topic);try{await this.core.relayer.confirmOnlineStateOrThrow()}catch{s.setError($n.no_internet_connection)}try{await this.core.relayer.subscribe(i,{relay:a})}catch(d){throw s.setError($n.subscribe_pairing_topic_failure),d}return s.addTrace(nn.subscribe_pairing_topic_success),f}),de(this,"activate",async({topic:n})=>{this.isInitialized();const s=Ke(J.FIVE_MINUTES);this.core.expirer.set(n,s),await this.pairings.update(n,{active:!0,expiry:s})}),de(this,"ping",async n=>{this.isInitialized(),await this.isValidPing(n),this.logger.warn("ping() is deprecated and will be removed in the next major release.");const{topic:s}=n;if(this.pairings.keys.includes(s)){const i=await this.sendRequest(s,"wc_pairingPing",{}),{done:o,resolve:a,reject:c}=gi();this.events.once(Ee("pairing_ping",i),({error:l})=>{l?c(l):a()}),await o()}}),de(this,"updateExpiry",async({topic:n,expiry:s})=>{this.isInitialized(),await this.pairings.update(n,{expiry:s})}),de(this,"updateMetadata",async({topic:n,metadata:s})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:s})}),de(this,"getPairings",()=>(this.isInitialized(),this.pairings.values)),de(this,"disconnect",async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:s}=n;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",Ne("USER_DISCONNECTED")),await this.deletePairing(s))}),de(this,"formatUriFromPairing",n=>{this.isInitialized();const{topic:s,relay:i,expiry:o,methods:a}=n,c=this.core.crypto.keychain.get(s);return rw({protocol:this.core.protocol,version:this.core.version,topic:s,symKey:c,relay:i,expiryTimestamp:o,methods:a})}),de(this,"sendRequest",async(n,s,i)=>{const o=Vr(s,i),a=await this.core.crypto.encode(n,o),c=vc[s].req;return this.core.history.set(n,o),this.core.relayer.publish(n,a,c),o.id}),de(this,"sendResult",async(n,s,i)=>{const o=ol(n,i),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,n)).request.method,l=vc[c].res;await this.core.relayer.publish(s,a,l),await this.core.history.resolve(o)}),de(this,"sendError",async(n,s,i)=>{const o=Qh(n,i),a=await this.core.crypto.encode(s,o),c=(await this.core.history.get(s,n)).request.method,l=vc[c]?vc[c].res:vc.unregistered_method.res;await this.core.relayer.publish(s,a,l),await this.core.history.resolve(o)}),de(this,"deletePairing",async(n,s)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,Ne("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),s?Promise.resolve():this.core.expirer.del(n)])}),de(this,"cleanup",async()=>{const n=this.pairings.getAll().filter(s=>wn(s.expiry));await Promise.all(n.map(s=>this.deletePairing(s.topic)))}),de(this,"onRelayEventRequest",async n=>{const{topic:s,payload:i}=n;switch(i.method){case"wc_pairingPing":return await this.onPairingPingRequest(s,i);case"wc_pairingDelete":return await this.onPairingDeleteRequest(s,i);default:return await this.onUnknownRpcMethodRequest(s,i)}}),de(this,"onRelayEventResponse",async n=>{const{topic:s,payload:i}=n,o=(await this.core.history.get(s,i.id)).request.method;switch(o){case"wc_pairingPing":return this.onPairingPingResponse(s,i);default:return this.onUnknownRpcMethodResponse(o)}}),de(this,"onPairingPingRequest",async(n,s)=>{const{id:i}=s;try{this.isValidPing({topic:n}),await this.sendResult(i,n,!0),this.events.emit(vi.ping,{id:i,topic:n})}catch(o){await this.sendError(i,n,o),this.logger.error(o)}}),de(this,"onPairingPingResponse",(n,s)=>{const{id:i}=s;setTimeout(()=>{on(s)?this.events.emit(Ee("pairing_ping",i),{}):Sr(s)&&this.events.emit(Ee("pairing_ping",i),{error:s.error})},500)}),de(this,"onPairingDeleteRequest",async(n,s)=>{const{id:i}=s;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit(vi.delete,{id:i,topic:n})}catch(o){await this.sendError(i,n,o),this.logger.error(o)}}),de(this,"onUnknownRpcMethodRequest",async(n,s)=>{const{id:i,method:o}=s;try{if(this.registeredMethods.includes(o))return;const a=Ne("WC_METHOD_UNSUPPORTED",o);await this.sendError(i,n,a),this.logger.error(a)}catch(a){await this.sendError(i,n,a),this.logger.error(a)}}),de(this,"onUnknownRpcMethodResponse",n=>{this.registeredMethods.includes(n)||this.logger.error(Ne("WC_METHOD_UNSUPPORTED",n))}),de(this,"isValidPair",(n,s)=>{var i;if(!jt(n)){const{message:a}=W("MISSING_OR_INVALID",`pair() params: ${n}`);throw s.setError($n.malformed_pairing_uri),new Error(a)}if(!k6(n.uri)){const{message:a}=W("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw s.setError($n.malformed_pairing_uri),new Error(a)}const o=tw(n==null?void 0:n.uri);if(!((i=o==null?void 0:o.relay)!=null&&i.protocol)){const{message:a}=W("MISSING_OR_INVALID","pair() uri#relay-protocol");throw s.setError($n.malformed_pairing_uri),new Error(a)}if(!(o!=null&&o.symKey)){const{message:a}=W("MISSING_OR_INVALID","pair() uri#symKey");throw s.setError($n.malformed_pairing_uri),new Error(a)}if(o!=null&&o.expiryTimestamp&&J.toMiliseconds(o==null?void 0:o.expiryTimestamp)<Date.now()){s.setError($n.pairing_expired);const{message:a}=W("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}}),de(this,"isValidPing",async n=>{if(!jt(n)){const{message:i}=W("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(i)}const{topic:s}=n;await this.isValidPairingTopic(s)}),de(this,"isValidDisconnect",async n=>{if(!jt(n)){const{message:i}=W("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(i)}const{topic:s}=n;await this.isValidPairingTopic(s)}),de(this,"isValidPairingTopic",async n=>{if(!Ge(n,!1)){const{message:s}=W("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(s)}if(!this.pairings.keys.includes(n)){const{message:s}=W("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(s)}if(wn(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:s}=W("EXPIRED",`pairing topic: ${n}`);throw new Error(s)}}),this.core=e,this.logger=$t(t,this.name),this.pairings=new wo(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Zt(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(Me.message,async e=>{const{topic:t,message:n,transportType:s}=e;if(this.pairings.keys.includes(t)&&s!==Te.link_mode&&!this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))try{const i=await this.core.crypto.decode(t,n);Fg(i)?(this.core.history.set(t,i),await this.onRelayEventRequest({topic:t,payload:i})):Wh(i)&&(await this.core.history.resolve(i),await this.onRelayEventResponse({topic:t,payload:i}),this.core.history.delete(t,i.id)),await this.core.relayer.messages.ack(t,n)}catch(i){this.logger.error(i)}})}registerExpirerEvents(){this.core.expirer.on(yr.expired,async e=>{const{topic:t}=VE(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(vi.expire,{topic:t}))})}}var xL=Object.defineProperty,IL=(r,e,t)=>e in r?xL(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,at=(r,e,t)=>IL(r,typeof e!="symbol"?e+"":e,t);class SL extends xU{constructor(e,t){super(e,t),this.core=e,this.logger=t,at(this,"records",new Map),at(this,"events",new hr.EventEmitter),at(this,"name",O5),at(this,"version",D5),at(this,"cached",[]),at(this,"initialized",!1),at(this,"storagePrefix",On),at(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),at(this,"set",(n,s,i)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:s,chainId:i}),this.records.has(s.id))return;const o={id:s.id,topic:n,request:{method:s.method,params:s.params||null},chainId:i,expiry:Ke(J.THIRTY_DAYS)};this.records.set(o.id,o),this.persist(),this.events.emit(_r.created,o)}),at(this,"resolve",async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const s=await this.getRecord(n.id);typeof s.response>"u"&&(s.response=Sr(n)?{error:n.error}:{result:n.result},this.records.set(s.id,s),this.persist(),this.events.emit(_r.updated,s))}),at(this,"get",async(n,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:s}),await this.getRecord(s))),at(this,"delete",(n,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(i=>{if(i.topic===n){if(typeof s<"u"&&i.id!==s)return;this.records.delete(i.id),this.events.emit(_r.deleted,i)}}),this.persist()}),at(this,"exists",async(n,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===n:!1)),at(this,"on",(n,s)=>{this.events.on(n,s)}),at(this,"once",(n,s)=>{this.events.once(n,s)}),at(this,"off",(n,s)=>{this.events.off(n,s)}),at(this,"removeListener",(n,s)=>{this.events.removeListener(n,s)}),this.logger=$t(t,this.name)}get context(){return Zt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const n={topic:t.topic,request:Vr(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(n)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:n}=W("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(n)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(_r.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:t}=W("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(_r.created,e=>{const t=_r.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(_r.updated,e=>{const t=_r.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(_r.deleted,e=>{const t=_r.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.core.heartbeat.on(yo.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(t=>{J.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.records.delete(t.id),this.events.emit(_r.deleted,t,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}}var PL=Object.defineProperty,OL=(r,e,t)=>e in r?PL(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Et=(r,e,t)=>OL(r,typeof e!="symbol"?e+"":e,t);class DL extends CU{constructor(e,t){super(e,t),this.core=e,this.logger=t,Et(this,"expirations",new Map),Et(this,"events",new hr.EventEmitter),Et(this,"name",C5),Et(this,"version",B5),Et(this,"cached",[]),Et(this,"initialized",!1),Et(this,"storagePrefix",On),Et(this,"init",async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)}),Et(this,"has",n=>{try{const s=this.formatTarget(n);return typeof this.getExpiration(s)<"u"}catch{return!1}}),Et(this,"set",(n,s)=>{this.isInitialized();const i=this.formatTarget(n),o={target:i,expiry:s};this.expirations.set(i,o),this.checkExpiry(i,o),this.events.emit(yr.created,{target:i,expiration:o})}),Et(this,"get",n=>{this.isInitialized();const s=this.formatTarget(n);return this.getExpiration(s)}),Et(this,"del",n=>{if(this.isInitialized(),this.has(n)){const s=this.formatTarget(n),i=this.getExpiration(s);this.expirations.delete(s),this.events.emit(yr.deleted,{target:s,expiration:i})}}),Et(this,"on",(n,s)=>{this.events.on(n,s)}),Et(this,"once",(n,s)=>{this.events.once(n,s)}),Et(this,"off",(n,s)=>{this.events.off(n,s)}),Et(this,"removeListener",(n,s)=>{this.events.removeListener(n,s)}),this.logger=$t(t,this.name)}get context(){return Zt(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return pT(e);if(typeof e=="number")return gT(e);const{message:t}=W("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(yr.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:t}=W("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:n}=W("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(n),new Error(n)}return t}checkExpiry(e,t){const{expiry:n}=t;J.toMiliseconds(n)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(yr.expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(yo.pulse,()=>this.checkExpirations()),this.events.on(yr.created,e=>{const t=yr.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(yr.expired,e=>{const t=yr.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(yr.deleted,e=>{const t=yr.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}}var CL=Object.defineProperty,BL=(r,e,t)=>e in r?CL(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ve=(r,e,t)=>BL(r,typeof e!="symbol"?e+"":e,t);class _L extends BU{constructor(e,t,n){super(e,t,n),this.core=e,this.logger=t,this.store=n,Ve(this,"name",_5),Ve(this,"abortController"),Ve(this,"isDevEnv"),Ve(this,"verifyUrlV3",N5),Ve(this,"storagePrefix",On),Ve(this,"version",eA),Ve(this,"publicKey"),Ve(this,"fetchPromise"),Ve(this,"init",async()=>{var s;this.isDevEnv||(this.publicKey=await this.store.getItem(this.storeKey),this.publicKey&&J.toMiliseconds((s=this.publicKey)==null?void 0:s.expiresAt)<Date.now()&&(this.logger.debug("verify v2 public key expired"),await this.removePublicKey()))}),Ve(this,"register",async s=>{if(!nc()||this.isDevEnv)return;const i=window.location.origin,{id:o,decryptedId:a}=s,c=`${this.verifyUrlV3}/attestation?projectId=${this.core.projectId}&origin=${i}&id=${o}&decryptedId=${a}`;try{const l=ls.getDocument(),u=this.startAbortTimer(J.ONE_SECOND*5),h=await new Promise((f,d)=>{const p=()=>{window.removeEventListener("message",m),l.body.removeChild(g),d("attestation aborted")};this.abortController.signal.addEventListener("abort",p);const g=l.createElement("iframe");g.src=c,g.style.display="none",g.addEventListener("error",p,{signal:this.abortController.signal});const m=b=>{if(b.data&&typeof b.data=="string")try{const x=JSON.parse(b.data);if(x.type==="verify_attestation"){if(dp(x.attestation).payload.id!==o)return;clearInterval(u),l.body.removeChild(g),this.abortController.signal.removeEventListener("abort",p),window.removeEventListener("message",m),f(x.attestation===null?"":x.attestation)}}catch(x){this.logger.warn(x)}};l.body.appendChild(g),window.addEventListener("message",m,{signal:this.abortController.signal})});return this.logger.debug("jwt attestation",h),h}catch(l){this.logger.warn(l)}return""}),Ve(this,"resolve",async s=>{if(this.isDevEnv)return"";const{attestationId:i,hash:o,encryptedId:a}=s;if(i===""){this.logger.debug("resolve: attestationId is empty, skipping");return}if(i){if(dp(i).payload.id!==a)return;const l=await this.isValidJwtAttestation(i);if(l){if(!l.isVerified){this.logger.warn("resolve: jwt attestation: origin url not verified");return}return l}}if(!o)return;const c=this.getVerifyUrl(s==null?void 0:s.verifyUrl);return this.fetchAttestation(o,c)}),Ve(this,"fetchAttestation",async(s,i)=>{this.logger.debug(`resolving attestation: ${s} from url: ${i}`);const o=this.startAbortTimer(J.ONE_SECOND*5),a=await fetch(`${i}/attestation/${s}?v2Supported=true`,{signal:this.abortController.signal});return clearTimeout(o),a.status===200?await a.json():void 0}),Ve(this,"getVerifyUrl",s=>{let i=s||Mc;return R5.includes(i)||(this.logger.info(`verify url: ${i}, not included in trusted list, assigning default: ${Mc}`),i=Mc),i}),Ve(this,"fetchPublicKey",async()=>{try{this.logger.debug(`fetching public key from: ${this.verifyUrlV3}`);const s=this.startAbortTimer(J.FIVE_SECONDS),i=await fetch(`${this.verifyUrlV3}/public-key`,{signal:this.abortController.signal});return clearTimeout(s),await i.json()}catch(s){this.logger.warn(s)}}),Ve(this,"persistPublicKey",async s=>{this.logger.debug("persisting public key to local storage",s),await this.store.setItem(this.storeKey,s),this.publicKey=s}),Ve(this,"removePublicKey",async()=>{this.logger.debug("removing verify v2 public key from storage"),await this.store.removeItem(this.storeKey),this.publicKey=void 0}),Ve(this,"isValidJwtAttestation",async s=>{const i=await this.getPublicKey();try{if(i)return this.validateAttestation(s,i)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}const o=await this.fetchAndPersistPublicKey();try{if(o)return this.validateAttestation(s,o)}catch(a){this.logger.error(a),this.logger.warn("error validating attestation")}}),Ve(this,"getPublicKey",async()=>this.publicKey?this.publicKey:await this.fetchAndPersistPublicKey()),Ve(this,"fetchAndPersistPublicKey",async()=>{if(this.fetchPromise)return await this.fetchPromise,this.publicKey;this.fetchPromise=new Promise(async i=>{const o=await this.fetchPublicKey();o&&(await this.persistPublicKey(o),i(o))});const s=await this.fetchPromise;return this.fetchPromise=void 0,s}),Ve(this,"validateAttestation",(s,i)=>{const o=l6(s,i.publicKey),a={hasExpired:J.toMiliseconds(o.exp)<Date.now(),payload:o};if(a.hasExpired)throw this.logger.warn("resolve: jwt attestation expired"),new Error("JWT attestation expired");return{origin:a.payload.origin,isScam:a.payload.isScam,isVerified:a.payload.isVerified}}),this.logger=$t(t,this.name),this.abortController=new AbortController,this.isDevEnv=Sg(),this.init()}get storeKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//verify:public:key"}get context(){return Zt(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),J.toMiliseconds(e))}}var TL=Object.defineProperty,NL=(r,e,t)=>e in r?TL(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Zw=(r,e,t)=>NL(r,typeof e!="symbol"?e+"":e,t);class RL extends _U{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,Zw(this,"context",U5),Zw(this,"registerDeviceToken",async n=>{const{clientId:s,token:i,notificationType:o,enableEncrypted:a=!1}=n,c=`${k5}/${this.projectId}/clients`;await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:s,type:o,token:i,always_raw:a})})}),this.logger=$t(t,this.context)}}var UL=Object.defineProperty,Xw=Object.getOwnPropertySymbols,kL=Object.prototype.hasOwnProperty,$L=Object.prototype.propertyIsEnumerable,Fp=(r,e,t)=>e in r?UL(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Ic=(r,e)=>{for(var t in e||(e={}))kL.call(e,t)&&Fp(r,t,e[t]);if(Xw)for(var t of Xw(e))$L.call(e,t)&&Fp(r,t,e[t]);return r},Xe=(r,e,t)=>Fp(r,typeof e!="symbol"?e+"":e,t);class LL extends TU{constructor(e,t,n=!0){super(e,t,n),this.core=e,this.logger=t,Xe(this,"context",L5),Xe(this,"storagePrefix",On),Xe(this,"storageVersion",$5),Xe(this,"events",new Map),Xe(this,"shouldPersist",!1),Xe(this,"init",async()=>{if(!Sg())try{const s={eventId:Em(),timestamp:Date.now(),domain:this.getAppDomain(),props:{event:"INIT",type:"",properties:{client_id:await this.core.crypto.getClientId(),user_agent:HE(this.core.relayer.protocol,this.core.relayer.version,_p)}}};await this.sendEvent([s])}catch(s){this.logger.warn(s)}}),Xe(this,"createEvent",s=>{const{event:i="ERROR",type:o="",properties:{topic:a,trace:c}}=s,l=Em(),u=this.core.projectId||"",h=Date.now(),f=Ic({eventId:l,timestamp:h,props:{event:i,type:o,properties:{topic:a,trace:c}},bundleId:u,domain:this.getAppDomain()},this.setMethods(l));return this.telemetryEnabled&&(this.events.set(l,f),this.shouldPersist=!0),f}),Xe(this,"getEvent",s=>{const{eventId:i,topic:o}=s;if(i)return this.events.get(i);const a=Array.from(this.events.values()).find(c=>c.props.properties.topic===o);if(a)return Ic(Ic({},a),this.setMethods(a.eventId))}),Xe(this,"deleteEvent",s=>{const{eventId:i}=s;this.events.delete(i),this.shouldPersist=!0}),Xe(this,"setEventListeners",()=>{this.core.heartbeat.on(yo.pulse,async()=>{this.shouldPersist&&await this.persist(),this.events.forEach(s=>{J.fromMiliseconds(Date.now())-J.fromMiliseconds(s.timestamp)>F5&&(this.events.delete(s.eventId),this.shouldPersist=!0)})})}),Xe(this,"setMethods",s=>({addTrace:i=>this.addTrace(s,i),setError:i=>this.setError(s,i)})),Xe(this,"addTrace",(s,i)=>{const o=this.events.get(s);o&&(o.props.properties.trace.push(i),this.events.set(s,o),this.shouldPersist=!0)}),Xe(this,"setError",(s,i)=>{const o=this.events.get(s);o&&(o.props.type=i,o.timestamp=Date.now(),this.events.set(s,o),this.shouldPersist=!0)}),Xe(this,"persist",async()=>{await this.core.storage.setItem(this.storageKey,Array.from(this.events.values())),this.shouldPersist=!1}),Xe(this,"restore",async()=>{try{const s=await this.core.storage.getItem(this.storageKey)||[];if(!s.length)return;s.forEach(i=>{this.events.set(i.eventId,Ic(Ic({},i),this.setMethods(i.eventId)))})}catch(s){this.logger.warn(s)}}),Xe(this,"submit",async()=>{if(!this.telemetryEnabled||this.events.size===0)return;const s=[];for(const[i,o]of this.events)o.props.type&&s.push(o);if(s.length!==0)try{if((await this.sendEvent(s)).ok)for(const i of s)this.events.delete(i.eventId),this.shouldPersist=!0}catch(i){this.logger.warn(i)}}),Xe(this,"sendEvent",async s=>{const i=this.getAppDomain()?"":"&sp=desktop";return await fetch(`${M5}?projectId=${this.core.projectId}&st=events_sdk&sv=js-${_p}${i}`,{method:"POST",body:JSON.stringify(s)})}),Xe(this,"getAppDomain",()=>zE().url),this.logger=$t(t,this.context),this.telemetryEnabled=n,n?this.restore().then(async()=>{await this.submit(),this.setEventListeners()}):this.persist()}get storageKey(){return this.storagePrefix+this.storageVersion+this.core.customStoragePrefix+"//"+this.context}}var FL=Object.defineProperty,eb=Object.getOwnPropertySymbols,ML=Object.prototype.hasOwnProperty,jL=Object.prototype.propertyIsEnumerable,Mp=(r,e,t)=>e in r?FL(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,tb=(r,e)=>{for(var t in e||(e={}))ML.call(e,t)&&Mp(r,t,e[t]);if(eb)for(var t of eb(e))jL.call(e,t)&&Mp(r,t,e[t]);return r},Be=(r,e,t)=>Mp(r,typeof e!="symbol"?e+"":e,t);let zL=class gA extends bU{constructor(e){var t;super(e),Be(this,"protocol",X2),Be(this,"version",eA),Be(this,"name",Bp),Be(this,"relayUrl"),Be(this,"projectId"),Be(this,"customStoragePrefix"),Be(this,"events",new hr.EventEmitter),Be(this,"logger"),Be(this,"heartbeat"),Be(this,"relayer"),Be(this,"crypto"),Be(this,"storage"),Be(this,"history"),Be(this,"expirer"),Be(this,"pairing"),Be(this,"verify"),Be(this,"echoClient"),Be(this,"linkModeSupportedApps"),Be(this,"eventClient"),Be(this,"initialized",!1),Be(this,"logChunkController"),Be(this,"on",(a,c)=>this.events.on(a,c)),Be(this,"once",(a,c)=>this.events.once(a,c)),Be(this,"off",(a,c)=>this.events.off(a,c)),Be(this,"removeListener",(a,c)=>this.events.removeListener(a,c)),Be(this,"dispatchEnvelope",({topic:a,message:c,sessionExists:l})=>{if(!a||!c)return;const u={topic:a,message:c,publishedAt:Date.now(),transportType:Te.link_mode};this.relayer.onLinkMessageEvent(u,{sessionExists:l})});const n=this.getGlobalCore(e==null?void 0:e.customStoragePrefix);if(n)try{return this.customStoragePrefix=n.customStoragePrefix,this.logger=n.logger,this.heartbeat=n.heartbeat,this.crypto=n.crypto,this.history=n.history,this.expirer=n.expirer,this.storage=n.storage,this.relayer=n.relayer,this.pairing=n.pairing,this.verify=n.verify,this.echoClient=n.echoClient,this.linkModeSupportedApps=n.linkModeSupportedApps,this.eventClient=n.eventClient,this.initialized=n.initialized,this.logChunkController=n.logChunkController,n}catch(a){console.warn("Failed to copy global core",a)}this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||rA,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const s=Gh({level:typeof(e==null?void 0:e.logger)=="string"&&e.logger?e.logger:a5.logger,name:Bp}),{logger:i,chunkLoggerController:o}=yU({opts:s,maxSizeInBytes:e==null?void 0:e.maxLogBlobSizeInBytes,loggerOverride:e==null?void 0:e.logger});this.logChunkController=o,(t=this.logChunkController)!=null&&t.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var a,c;(a=this.logChunkController)!=null&&a.downloadLogsBlobInBrowser&&((c=this.logChunkController)==null||c.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=$t(i,this.name),this.heartbeat=new b4,this.crypto=new g$(this,this.logger,e==null?void 0:e.keychain),this.history=new SL(this,this.logger),this.expirer=new DL(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new X4(tb(tb({},c5),e==null?void 0:e.storageOptions)),this.relayer=new z$({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new AL(this,this.logger),this.verify=new _L(this,this.logger,this.storage),this.echoClient=new RL(this.projectId||"",this.logger),this.linkModeSupportedApps=[],this.eventClient=new LL(this,this.logger,e==null?void 0:e.telemetryEnabled),this.setGlobalCore(this)}static async init(e){const t=new gA(e);await t.initialize();const n=await t.crypto.getClientId();return await t.storage.setItem(A5,n),t}get context(){return Zt(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async addLinkModeSupportedApp(e){this.linkModeSupportedApps.includes(e)||(this.linkModeSupportedApps.push(e),await this.storage.setItem(Nw,this.linkModeSupportedApps))}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.linkModeSupportedApps=await this.storage.getItem(Nw)||[],this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}getGlobalCore(e=""){try{if(this.isGlobalCoreDisabled())return;const t=`_walletConnectCore_${e}`,n=`${t}_count`;return globalThis[n]=(globalThis[n]||0)+1,globalThis[n]>1&&console.warn(`WalletConnect Core is already initialized. This is probably a mistake and can lead to unexpected behavior. Init() was called ${globalThis[n]} times.`),globalThis[t]}catch(t){console.warn("Failed to get global WalletConnect core",t);return}}setGlobalCore(e){var t;try{if(this.isGlobalCoreDisabled())return;const n=`_walletConnectCore_${((t=e.opts)==null?void 0:t.customStoragePrefix)||""}`;globalThis[n]=e}catch(n){console.warn("Failed to set global WalletConnect core",n)}}isGlobalCoreDisabled(){try{return typeof process<"u"&&o5.DISABLE_GLOBAL_CORE==="true"}catch{return!0}}};const HL=zL,yA="wc",mA=2,wA="client",jg=`${yA}@${mA}:${wA}:`,cd={name:wA,logger:"error"},rb="WALLETCONNECT_DEEPLINK_CHOICE",qL="proposal",nb="Proposal expired",VL="session",Bo=J.SEVEN_DAYS,KL="engine",ct={wc_sessionPropose:{req:{ttl:J.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1101},reject:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1120},autoReject:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1121}},wc_sessionSettle:{req:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:J.ONE_DAY,prompt:!1,tag:1104},res:{ttl:J.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:J.ONE_DAY,prompt:!1,tag:1106},res:{ttl:J.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:J.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:J.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:J.ONE_DAY,prompt:!1,tag:1112},res:{ttl:J.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:J.ONE_DAY,prompt:!1,tag:1114},res:{ttl:J.ONE_DAY,prompt:!1,tag:1115}},wc_sessionAuthenticate:{req:{ttl:J.ONE_HOUR,prompt:!0,tag:1116},res:{ttl:J.ONE_HOUR,prompt:!1,tag:1117},reject:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1118},autoReject:{ttl:J.FIVE_MINUTES,prompt:!1,tag:1119}}},ld={min:J.FIVE_MINUTES,max:J.SEVEN_DAYS},rn={idle:"IDLE",active:"ACTIVE"},GL={eth_sendTransaction:{key:""},eth_sendRawTransaction:{key:""},wallet_sendCalls:{key:""},solana_signTransaction:{key:"signature"},solana_signAllTransactions:{key:"transactions"},solana_signAndSendTransaction:{key:"signature"},sui_signAndExecuteTransaction:{key:"digest"},sui_signTransaction:{key:""},hedera_signAndExecuteTransaction:{key:"transactionId"},hedera_executeTransaction:{key:"transactionId"},near_signTransaction:{key:""},near_signTransactions:{key:""},tron_signTransaction:{key:"txID"},xrpl_signTransaction:{key:""},xrpl_signTransactionFor:{key:""},algo_signTxn:{key:""},sendTransfer:{key:"txid"},stacks_stxTransfer:{key:"txId"},polkadot_signTransaction:{key:""},cosmos_signDirect:{key:""}},QL="request",WL=["wc_sessionPropose","wc_sessionRequest","wc_authRequest","wc_sessionAuthenticate"],JL="wc",YL="auth",ZL="authKeys",XL="pairingTopics",eF="requests",Yh=`${JL}@${1.5}:${YL}:`,Bu=`${Yh}:PUB_KEY`;var tF=Object.defineProperty,rF=Object.defineProperties,nF=Object.getOwnPropertyDescriptors,sb=Object.getOwnPropertySymbols,sF=Object.prototype.hasOwnProperty,iF=Object.prototype.propertyIsEnumerable,jp=(r,e,t)=>e in r?tF(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Se=(r,e)=>{for(var t in e||(e={}))sF.call(e,t)&&jp(r,t,e[t]);if(sb)for(var t of sb(e))iF.call(e,t)&&jp(r,t,e[t]);return r},At=(r,e)=>rF(r,nF(e)),V=(r,e,t)=>jp(r,typeof e!="symbol"?e+"":e,t);class oF extends kU{constructor(e){super(e),V(this,"name",KL),V(this,"events",new dg),V(this,"initialized",!1),V(this,"requestQueue",{state:rn.idle,queue:[]}),V(this,"sessionRequestQueue",{state:rn.idle,queue:[]}),V(this,"emittedSessionRequests",new IT({limit:500})),V(this,"requestQueueDelay",J.ONE_SECOND),V(this,"expectedPairingMethodMap",new Map),V(this,"recentlyDeletedMap",new Map),V(this,"recentlyDeletedLimit",200),V(this,"relayMessageCache",[]),V(this,"pendingSessions",new Map),V(this,"init",async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),await this.registerLinkModeListeners(),this.client.core.pairing.register({methods:Object.keys(ct)}),this.initialized=!0,setTimeout(async()=>{await this.processPendingMessageEvents(),this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},J.toMiliseconds(this.requestQueueDelay)))}),V(this,"connect",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();const n=At(Se({},t),{requiredNamespaces:t.requiredNamespaces||{},optionalNamespaces:t.optionalNamespaces||{}});await this.isValidConnect(n),n.optionalNamespaces=_6(n.requiredNamespaces,n.optionalNamespaces),n.requiredNamespaces={};const{pairingTopic:s,requiredNamespaces:i,optionalNamespaces:o,sessionProperties:a,scopedProperties:c,relays:l}=n;let u=s,h,f=!1;try{if(u){const E=this.client.core.pairing.pairings.get(u);this.client.logger.warn("connect() with existing pairing topic is deprecated and will be removed in the next major release."),f=E.active}}catch(E){throw this.client.logger.error(`connect() -> pairing.get(${u}) failed`),E}if(!u||!f){const{topic:E,uri:P}=await this.client.core.pairing.create({internal:{skipSubscribe:!0}});u=E,h=P}if(!u){const{message:E}=W("NO_MATCHING_KEY",`connect() pairing topic: ${u}`);throw new Error(E)}const d=await this.client.core.crypto.generateKeyPair(),p=ct.wc_sessionPropose.req.ttl||J.FIVE_MINUTES,g=Ke(p),m=At(Se(Se({requiredNamespaces:i,optionalNamespaces:o,relays:l??[{protocol:tA}],proposer:{publicKey:d,metadata:this.client.metadata},expiryTimestamp:g,pairingTopic:u},a&&{sessionProperties:a}),c&&{scopedProperties:c}),{id:sn()}),b=Ee("session_connect",m.id),{reject:x,resolve:v,done:I}=gi(p,nb),S=({id:E})=>{E===m.id&&(this.client.events.off("proposal_expire",S),this.pendingSessions.delete(m.id),this.events.emit(b,{error:{message:nb,code:0}}))};return this.client.events.on("proposal_expire",S),this.events.once(b,({error:E,session:P})=>{this.client.events.off("proposal_expire",S),E?x(E):P&&v(P)}),await this.sendProposeSession({proposal:m,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:m.id}}}),await this.setProposal(m.id,m),{uri:h,approval:I}}),V(this,"pair",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{return await this.client.core.pairing.pair(t)}catch(n){throw this.client.logger.error("pair() failed"),n}}),V(this,"approve",async t=>{var n,s,i;const o=this.client.core.eventClient.createEvent({properties:{topic:(n=t==null?void 0:t.id)==null?void 0:n.toString(),trace:[Ss.session_approve_started]}});try{this.isInitialized(),await this.confirmOnlineStateOrThrow()}catch(B){throw o.setError(Ec.no_internet_connection),B}try{await this.isValidProposalId(t==null?void 0:t.id)}catch(B){throw this.client.logger.error(`approve() -> proposal.get(${t==null?void 0:t.id}) failed`),o.setError(Ec.proposal_not_found),B}try{await this.isValidApprove(t)}catch(B){throw this.client.logger.error("approve() -> isValidApprove() failed"),o.setError(Ec.session_approve_namespace_validation_failure),B}const{id:a,relayProtocol:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:f}=t,d=this.client.proposal.get(a);this.client.core.eventClient.deleteEvent({eventId:o.eventId});const{pairingTopic:p,proposer:g,requiredNamespaces:m,optionalNamespaces:b}=d;let x=(s=this.client.core.eventClient)==null?void 0:s.getEvent({topic:p});x||(x=(i=this.client.core.eventClient)==null?void 0:i.createEvent({type:Ss.session_approve_started,properties:{topic:p,trace:[Ss.session_approve_started,Ss.session_namespaces_validation_success]}}));const v=await this.client.core.crypto.generateKeyPair(),I=g.publicKey,S=await this.client.core.crypto.generateSharedKey(v,I),E=Se(Se(Se({relay:{protocol:c??"irn"},namespaces:l,controller:{publicKey:v,metadata:this.client.metadata},expiry:Ke(Bo)},u&&{sessionProperties:u}),h&&{scopedProperties:h}),f&&{sessionConfig:f}),P=Te.relay;x.addTrace(Ss.subscribing_session_topic);try{await this.client.core.relayer.subscribe(S,{transportType:P,internal:{skipSubscribe:!0}})}catch(B){throw x.setError(Ec.subscribe_session_topic_failure),B}x.addTrace(Ss.subscribe_session_topic_success);const D=At(Se({},E),{topic:S,requiredNamespaces:m,optionalNamespaces:b,pairingTopic:p,acknowledged:!1,self:E.controller,peer:{publicKey:g.publicKey,metadata:g.metadata},controller:v,transportType:Te.relay});await this.client.session.set(S,D),x.addTrace(Ss.store_session);try{await this.sendApproveSession({sessionTopic:S,proposal:d,pairingProposalResponse:{relay:{protocol:c??"irn"},responderPublicKey:v},sessionSettleRequest:E,publishOpts:{internal:{throwOnFailedPublish:!0},tvf:{correlationId:a}}}),x.addTrace(Ss.session_approve_publish_success)}catch(B){throw this.client.logger.error(B),this.client.session.delete(S,Ne("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(S),B}return this.client.core.eventClient.deleteEvent({eventId:x.eventId}),await this.client.core.pairing.updateMetadata({topic:p,metadata:g.metadata}),await this.deleteProposal(a),await this.client.core.pairing.activate({topic:p}),await this.setExpiry(S,Ke(Bo)),{topic:S,acknowledged:()=>Promise.resolve(this.client.session.get(S))}}),V(this,"reject",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidReject(t)}catch(o){throw this.client.logger.error("reject() -> isValidReject() failed"),o}const{id:n,reason:s}=t;let i;try{i=this.client.proposal.get(n).pairingTopic}catch(o){throw this.client.logger.error(`reject() -> proposal.get(${n}) failed`),o}i&&await this.sendError({id:n,topic:i,error:s,rpcOpts:ct.wc_sessionPropose.reject}),await this.deleteProposal(n)}),V(this,"update",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidUpdate(t)}catch(h){throw this.client.logger.error("update() -> isValidUpdate() failed"),h}const{topic:n,namespaces:s}=t,{done:i,resolve:o,reject:a}=gi(),c=sn(),l=Js().toString(),u=this.client.session.get(n).namespaces;return this.events.once(Ee("session_update",c),({error:h})=>{h?a(h):o()}),await this.client.session.update(n,{namespaces:s}),await this.sendRequest({topic:n,method:"wc_sessionUpdate",params:{namespaces:s},throwOnFailedPublish:!0,clientRpcId:c,relayRpcId:l}).catch(h=>{this.client.logger.error(h),this.client.session.update(n,{namespaces:u}),a(h)}),{acknowledged:i}}),V(this,"extend",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidExtend(t)}catch(c){throw this.client.logger.error("extend() -> isValidExtend() failed"),c}const{topic:n}=t,s=sn(),{done:i,resolve:o,reject:a}=gi();return this.events.once(Ee("session_extend",s),({error:c})=>{c?a(c):o()}),await this.setExpiry(n,Ke(Bo)),this.sendRequest({topic:n,method:"wc_sessionExtend",params:{},clientRpcId:s,throwOnFailedPublish:!0}).catch(c=>{a(c)}),{acknowledged:i}}),V(this,"request",async t=>{this.isInitialized();try{await this.isValidRequest(t)}catch(m){throw this.client.logger.error("request() -> isValidRequest() failed"),m}const{chainId:n,request:s,topic:i,expiry:o=ct.wc_sessionRequest.req.ttl}=t,a=this.client.session.get(i);(a==null?void 0:a.transportType)===Te.relay&&await this.confirmOnlineStateOrThrow();const c=sn(),l=Js().toString(),{done:u,resolve:h,reject:f}=gi(o,"Request expired. Please try again.");this.events.once(Ee("session_request",c),({error:m,result:b})=>{m?f(m):h(b)});const d="wc_sessionRequest",p=this.getAppLinkIfEnabled(a.peer.metadata,a.transportType);if(p)return await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:i,method:d,params:{request:At(Se({},s),{expiryTimestamp:Ke(o)}),chainId:n},expiry:o,throwOnFailedPublish:!0,appLink:p}).catch(m=>f(m)),this.client.events.emit("session_request_sent",{topic:i,request:s,chainId:n,id:c}),await u();const g={request:At(Se({},s),{expiryTimestamp:Ke(o)}),chainId:n};return await Promise.all([new Promise(async m=>{await this.sendRequest({clientRpcId:c,relayRpcId:l,topic:i,method:d,params:g,expiry:o,throwOnFailedPublish:!0,tvf:this.getTVFParams(c,g)}).catch(b=>f(b)),this.client.events.emit("session_request_sent",{topic:i,request:s,chainId:n,id:c}),m()}),new Promise(async m=>{var b;if(!((b=a.sessionConfig)!=null&&b.disableDeepLink)){const x=await bT(this.client.core.storage,rb);await yT({id:c,topic:i,wcDeepLink:x})}m()}),u()]).then(m=>m[2])}),V(this,"respond",async t=>{this.isInitialized(),await this.isValidRespond(t);const{topic:n,response:s}=t,{id:i}=s,o=this.client.session.get(n);o.transportType===Te.relay&&await this.confirmOnlineStateOrThrow();const a=this.getAppLinkIfEnabled(o.peer.metadata,o.transportType);on(s)?await this.sendResult({id:i,topic:n,result:s.result,throwOnFailedPublish:!0,appLink:a}):Sr(s)&&await this.sendError({id:i,topic:n,error:s.error,appLink:a}),this.cleanupAfterResponse(t)}),V(this,"ping",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow();try{await this.isValidPing(t)}catch(s){throw this.client.logger.error("ping() -> isValidPing() failed"),s}const{topic:n}=t;if(this.client.session.keys.includes(n)){const s=sn(),i=Js().toString(),{done:o,resolve:a,reject:c}=gi();this.events.once(Ee("session_ping",s),({error:l})=>{l?c(l):a()}),await Promise.all([this.sendRequest({topic:n,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:s,relayRpcId:i}),o()])}else this.client.core.pairing.pairings.keys.includes(n)&&(this.client.logger.warn("ping() on pairing topic is deprecated and will be removed in the next major release."),await this.client.core.pairing.ping({topic:n}))}),V(this,"emit",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidEmit(t);const{topic:n,event:s,chainId:i}=t,o=Js().toString(),a=sn();await this.sendRequest({topic:n,method:"wc_sessionEvent",params:{event:s,chainId:i},throwOnFailedPublish:!0,relayRpcId:o,clientRpcId:a})}),V(this,"disconnect",async t=>{this.isInitialized(),await this.confirmOnlineStateOrThrow(),await this.isValidDisconnect(t);const{topic:n}=t;if(this.client.session.keys.includes(n))await this.sendRequest({topic:n,method:"wc_sessionDelete",params:Ne("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:n,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(n))await this.client.core.pairing.disconnect({topic:n});else{const{message:s}=W("MISMATCHED_TOPIC",`Session or pairing topic not found: ${n}`);throw new Error(s)}}),V(this,"find",t=>(this.isInitialized(),this.client.session.getAll().filter(n=>R6(n,t)))),V(this,"getPendingSessionRequests",()=>this.client.pendingRequest.getAll()),V(this,"authenticate",async(t,n)=>{var s;this.isInitialized(),this.isValidAuthenticate(t);const i=n&&this.client.core.linkModeSupportedApps.includes(n)&&((s=this.client.metadata.redirect)==null?void 0:s.linkMode),o=i?Te.link_mode:Te.relay;o===Te.relay&&await this.confirmOnlineStateOrThrow();const{chains:a,statement:c="",uri:l,domain:u,nonce:h,type:f,exp:d,nbf:p,methods:g=[],expiry:m}=t,b=[...t.resources||[]],{topic:x,uri:v}=await this.client.core.pairing.create({methods:["wc_sessionAuthenticate"],transportType:o});this.client.logger.info({message:"Generated new pairing",pairing:{topic:x,uri:v}});const I=await this.client.core.crypto.generateKeyPair(),S=Pu(I);if(await Promise.all([this.client.auth.authKeys.set(Bu,{responseTopic:S,publicKey:I}),this.client.auth.pairingTopics.set(S,{topic:S,pairingTopic:x})]),await this.client.core.relayer.subscribe(S,{transportType:o}),this.client.logger.info(`sending request to new pairing topic: ${x}`),g.length>0){const{namespace:_}=ss(a[0]);let N=UN(_,"request",g);Su(b)&&(N=$N(N,b.pop())),b.push(N)}const E=m&&m>ct.wc_sessionAuthenticate.req.ttl?m:ct.wc_sessionAuthenticate.req.ttl,P={authPayload:{type:f??"caip122",chains:a,statement:c,aud:l,domain:u,version:"1",nonce:h,iat:new Date().toISOString(),exp:d,nbf:p,resources:b},requester:{publicKey:I,metadata:this.client.metadata},expiryTimestamp:Ke(E)},D={eip155:{chains:a,methods:[...new Set(["personal_sign",...g])],events:["chainChanged","accountsChanged"]}},B={requiredNamespaces:{},optionalNamespaces:D,relays:[{protocol:"irn"}],pairingTopic:x,proposer:{publicKey:I,metadata:this.client.metadata},expiryTimestamp:Ke(ct.wc_sessionPropose.req.ttl),id:sn()},{done:L,resolve:j,reject:$}=gi(E,"Request expired"),U=sn(),T=Ee("session_connect",B.id),w=Ee("session_request",U),A=async({error:_,session:N})=>{this.events.off(w,C),_?$(_):N&&j({session:N})},C=async _=>{var N,z,H;if(await this.deletePendingAuthRequest(U,{message:"fulfilled",code:0}),_.error){const ne=Ne("WC_METHOD_UNSUPPORTED","wc_sessionAuthenticate");return _.error.code===ne.code?void 0:(this.events.off(T,A),$(_.error.message))}await this.deleteProposal(B.id),this.events.off(T,A);const{cacaos:Y,responder:G}=_.result,Q=[],ee=[];for(const ne of Y){await Tm({cacao:ne,projectId:this.client.core.projectId})||(this.client.logger.error(ne,"Signature verification failed"),$(Ne("SESSION_SETTLEMENT_FAILED","Signature verification failed")));const{p:fe}=ne,ke=Su(fe.resources),qe=[mp(fe.iss)],$e=rh(fe.iss);if(ke){const mt=Nm(ke),bo=Rm(ke);Q.push(...mt),qe.push(...bo)}for(const mt of qe)ee.push(`${mt}:${$e}`)}const se=await this.client.core.crypto.generateSharedKey(I,G.publicKey);let le;Q.length>0&&(le={topic:se,acknowledged:!0,self:{publicKey:I,metadata:this.client.metadata},peer:G,controller:G.publicKey,expiry:Ke(Bo),requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:x,namespaces:ow([...new Set(Q)],[...new Set(ee)]),transportType:o},await this.client.core.relayer.subscribe(se,{transportType:o}),await this.client.session.set(se,le),x&&await this.client.core.pairing.updateMetadata({topic:x,metadata:G.metadata}),le=this.client.session.get(se)),(N=this.client.metadata.redirect)!=null&&N.linkMode&&(z=G.metadata.redirect)!=null&&z.linkMode&&(H=G.metadata.redirect)!=null&&H.universal&&n&&(this.client.core.addLinkModeSupportedApp(G.metadata.redirect.universal),this.client.session.update(se,{transportType:Te.link_mode})),j({auths:Y,session:le})};this.events.once(T,A),this.events.once(w,C);let k;try{if(i){const _=Vr("wc_sessionAuthenticate",P,U);this.client.core.history.set(x,_);const N=await this.client.core.crypto.encode("",_,{type:Nl,encoding:Ts});k=iu(n,x,N)}else await Promise.all([this.sendRequest({topic:x,method:"wc_sessionAuthenticate",params:P,expiry:t.expiry,throwOnFailedPublish:!0,clientRpcId:U}),this.sendRequest({topic:x,method:"wc_sessionPropose",params:B,expiry:ct.wc_sessionPropose.req.ttl,throwOnFailedPublish:!0,clientRpcId:B.id})])}catch(_){throw this.events.off(T,A),this.events.off(w,C),_}return await this.setProposal(B.id,B),await this.setAuthRequest(U,{request:At(Se({},P),{verifyContext:{}}),pairingTopic:x,transportType:o}),{uri:k??v,response:L}}),V(this,"approveSessionAuthenticate",async t=>{const{id:n,auths:s}=t,i=this.client.core.eventClient.createEvent({properties:{topic:n.toString(),trace:[hi.authenticated_session_approve_started]}});try{this.isInitialized()}catch(m){throw i.setError(Ac.no_internet_connection),m}const o=this.getPendingAuthRequest(n);if(!o)throw i.setError(Ac.authenticated_session_pending_request_not_found),new Error(`Could not find pending auth request with id ${n}`);const a=o.transportType||Te.relay;a===Te.relay&&await this.confirmOnlineStateOrThrow();const c=o.requester.publicKey,l=await this.client.core.crypto.generateKeyPair(),u=Pu(c),h={type:is,receiverPublicKey:c,senderPublicKey:l},f=[],d=[];for(const m of s){if(!await Tm({cacao:m,projectId:this.client.core.projectId})){i.setError(Ac.invalid_cacao);const S=Ne("SESSION_SETTLEMENT_FAILED","Signature verification failed");throw await this.sendError({id:n,topic:u,error:S,encodeOpts:h}),new Error(S.message)}i.addTrace(hi.cacaos_verified);const{p:b}=m,x=Su(b.resources),v=[mp(b.iss)],I=rh(b.iss);if(x){const S=Nm(x),E=Rm(x);f.push(...S),v.push(...E)}for(const S of v)d.push(`${S}:${I}`)}const p=await this.client.core.crypto.generateSharedKey(l,c);i.addTrace(hi.create_authenticated_session_topic);let g;if((f==null?void 0:f.length)>0){g={topic:p,acknowledged:!0,self:{publicKey:l,metadata:this.client.metadata},peer:{publicKey:c,metadata:o.requester.metadata},controller:c,expiry:Ke(Bo),authentication:s,requiredNamespaces:{},optionalNamespaces:{},relay:{protocol:"irn"},pairingTopic:o.pairingTopic,namespaces:ow([...new Set(f)],[...new Set(d)]),transportType:a},i.addTrace(hi.subscribing_authenticated_session_topic);try{await this.client.core.relayer.subscribe(p,{transportType:a})}catch(m){throw i.setError(Ac.subscribe_authenticated_session_topic_failure),m}i.addTrace(hi.subscribe_authenticated_session_topic_success),await this.client.session.set(p,g),i.addTrace(hi.store_authenticated_session),await this.client.core.pairing.updateMetadata({topic:o.pairingTopic,metadata:o.requester.metadata})}i.addTrace(hi.publishing_authenticated_session_approve);try{await this.sendResult({topic:u,id:n,result:{cacaos:s,responder:{publicKey:l,metadata:this.client.metadata}},encodeOpts:h,throwOnFailedPublish:!0,appLink:this.getAppLinkIfEnabled(o.requester.metadata,a)})}catch(m){throw i.setError(Ac.authenticated_session_approve_publish_failure),m}return await this.client.auth.requests.delete(n,{message:"fulfilled",code:0}),await this.client.core.pairing.activate({topic:o.pairingTopic}),this.client.core.eventClient.deleteEvent({eventId:i.eventId}),{session:g}}),V(this,"rejectSessionAuthenticate",async t=>{this.isInitialized();const{id:n,reason:s}=t,i=this.getPendingAuthRequest(n);if(!i)throw new Error(`Could not find pending auth request with id ${n}`);i.transportType===Te.relay&&await this.confirmOnlineStateOrThrow();const o=i.requester.publicKey,a=await this.client.core.crypto.generateKeyPair(),c=Pu(o),l={type:is,receiverPublicKey:o,senderPublicKey:a};await this.sendError({id:n,topic:c,error:s,encodeOpts:l,rpcOpts:ct.wc_sessionAuthenticate.reject,appLink:this.getAppLinkIfEnabled(i.requester.metadata,i.transportType)}),await this.client.auth.requests.delete(n,{message:"rejected",code:0}),await this.deleteProposal(n)}),V(this,"formatAuthMessage",t=>{this.isInitialized();const{request:n,iss:s}=t;return a2(n,s)}),V(this,"processRelayMessageCache",()=>{setTimeout(async()=>{if(this.relayMessageCache.length!==0)for(;this.relayMessageCache.length>0;)try{const t=this.relayMessageCache.shift();t&&await this.onRelayMessage(t)}catch(t){this.client.logger.error(t)}},50)}),V(this,"cleanupDuplicatePairings",async t=>{if(t.pairingTopic)try{const n=this.client.core.pairing.pairings.get(t.pairingTopic),s=this.client.core.pairing.pairings.getAll().filter(i=>{var o,a;return((o=i.peerMetadata)==null?void 0:o.url)&&((a=i.peerMetadata)==null?void 0:a.url)===t.peer.metadata.url&&i.topic&&i.topic!==n.topic});if(s.length===0)return;this.client.logger.info(`Cleaning up ${s.length} duplicate pairing(s)`),await Promise.all(s.map(i=>this.client.core.pairing.disconnect({topic:i.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}}),V(this,"deleteSession",async t=>{var n;const{topic:s,expirerHasDeleted:i=!1,emitEvent:o=!0,id:a=0}=t,{self:c}=this.client.session.get(s);await this.client.core.relayer.unsubscribe(s),await this.client.session.delete(s,Ne("USER_DISCONNECTED")),this.addToRecentlyDeleted(s,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(s)&&await this.client.core.crypto.deleteSymKey(s),i||this.client.core.expirer.del(s),this.client.core.storage.removeItem(rb).catch(l=>this.client.logger.warn(l)),this.getPendingSessionRequests().forEach(l=>{l.topic===s&&this.deletePendingSessionRequest(l.id,Ne("USER_DISCONNECTED"))}),s===((n=this.sessionRequestQueue.queue[0])==null?void 0:n.topic)&&(this.sessionRequestQueue.state=rn.idle),o&&this.client.events.emit("session_delete",{id:a,topic:s})}),V(this,"deleteProposal",async(t,n)=>{if(n)try{const s=this.client.proposal.get(t),i=this.client.core.eventClient.getEvent({topic:s.pairingTopic});i==null||i.setError(Ec.proposal_expired)}catch{}await Promise.all([this.client.proposal.delete(t,Ne("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(t)]),this.addToRecentlyDeleted(t,"proposal")}),V(this,"deletePendingSessionRequest",async(t,n,s=!1)=>{await Promise.all([this.client.pendingRequest.delete(t,n),s?Promise.resolve():this.client.core.expirer.del(t)]),this.addToRecentlyDeleted(t,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(i=>i.id!==t),s&&(this.sessionRequestQueue.state=rn.idle,this.client.events.emit("session_request_expire",{id:t}))}),V(this,"deletePendingAuthRequest",async(t,n,s=!1)=>{await Promise.all([this.client.auth.requests.delete(t,n),s?Promise.resolve():this.client.core.expirer.del(t)])}),V(this,"setExpiry",async(t,n)=>{this.client.session.keys.includes(t)&&(this.client.core.expirer.set(t,n),await this.client.session.update(t,{expiry:n}))}),V(this,"setProposal",async(t,n)=>{this.client.core.expirer.set(t,Ke(ct.wc_sessionPropose.req.ttl)),await this.client.proposal.set(t,n)}),V(this,"setAuthRequest",async(t,n)=>{const{request:s,pairingTopic:i,transportType:o=Te.relay}=n;this.client.core.expirer.set(t,s.expiryTimestamp),await this.client.auth.requests.set(t,{authPayload:s.authPayload,requester:s.requester,expiryTimestamp:s.expiryTimestamp,id:t,pairingTopic:i,verifyContext:s.verifyContext,transportType:o})}),V(this,"setPendingSessionRequest",async t=>{const{id:n,topic:s,params:i,verifyContext:o}=t,a=i.request.expiryTimestamp||Ke(ct.wc_sessionRequest.req.ttl);this.client.core.expirer.set(n,a),await this.client.pendingRequest.set(n,{id:n,topic:s,params:i,verifyContext:o})}),V(this,"sendRequest",async t=>{const{topic:n,method:s,params:i,expiry:o,relayRpcId:a,clientRpcId:c,throwOnFailedPublish:l,appLink:u,tvf:h,publishOpts:f={}}=t,d=Vr(s,i,c);let p;const g=!!u;try{const x=g?Ts:Kt;p=await this.client.core.crypto.encode(n,d,{encoding:x})}catch(x){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${n} failed`),x}let m;if(WL.includes(s)){const x=Ir(JSON.stringify(d)),v=Ir(p);m=await this.client.core.verify.register({id:v,decryptedId:x})}const b=Se(Se({},ct[s].req),f);if(b.attestation=m,o&&(b.ttl=o),a&&(b.id=a),this.client.core.history.set(n,d),g){const x=iu(u,n,p);await global.Linking.openURL(x,this.client.name)}else b.tvf=At(Se({},h),{correlationId:d.id}),l?(b.internal=At(Se({},b.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,p,b)):this.client.core.relayer.publish(n,p,b).catch(x=>this.client.logger.error(x));return d.id}),V(this,"sendProposeSession",async t=>{const{proposal:n,publishOpts:s}=t,i=Vr("wc_sessionPropose",n,n.id);this.client.core.history.set(n.pairingTopic,i);const o=await this.client.core.crypto.encode(n.pairingTopic,i,{encoding:Kt}),a=Ir(JSON.stringify(i)),c=Ir(o),l=await this.client.core.verify.register({id:c,decryptedId:a});await this.client.core.relayer.publishCustom({payload:{pairingTopic:n.pairingTopic,sessionProposal:o},opts:At(Se({},s),{publishMethod:"wc_proposeSession",attestation:l})})}),V(this,"sendApproveSession",async t=>{const{sessionTopic:n,pairingProposalResponse:s,proposal:i,sessionSettleRequest:o,publishOpts:a}=t,c=ol(i.id,s),l=await this.client.core.crypto.encode(i.pairingTopic,c,{encoding:Kt}),u=Vr("wc_sessionSettle",o,a==null?void 0:a.id),h=await this.client.core.crypto.encode(n,u,{encoding:Kt});this.client.core.history.set(n,u),await this.client.core.relayer.publishCustom({payload:{sessionTopic:n,pairingTopic:i.pairingTopic,sessionProposalResponse:l,sessionSettlementRequest:h},opts:At(Se({},a),{publishMethod:"wc_approveSession"})})}),V(this,"sendResult",async t=>{const{id:n,topic:s,result:i,throwOnFailedPublish:o,encodeOpts:a,appLink:c}=t,l=ol(n,i);let u;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const p=h?Ts:Kt;u=await this.client.core.crypto.encode(s,l,At(Se({},a||{}),{encoding:p}))}catch(p){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${s} failed`),p}let f,d;try{f=await this.client.core.history.get(s,n);const p=f.request;try{d=this.getTVFParams(n,p.params,i)}catch(g){this.client.logger.warn(`sendResult() -> getTVFParams() failed: ${g==null?void 0:g.message}`)}}catch(p){throw this.client.logger.error(`sendResult() -> history.get(${s}, ${n}) failed`),p}if(h){const p=iu(c,s,u);await global.Linking.openURL(p,this.client.name)}else{const p=f.request.method,g=ct[p].res;g.tvf=At(Se({},d),{correlationId:n}),o?(g.internal=At(Se({},g.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,u,g)):this.client.core.relayer.publish(s,u,g).catch(m=>this.client.logger.error(m))}await this.client.core.history.resolve(l)}),V(this,"sendError",async t=>{const{id:n,topic:s,error:i,encodeOpts:o,rpcOpts:a,appLink:c}=t,l=Qh(n,i);let u;const h=c&&typeof(global==null?void 0:global.Linking)<"u";try{const d=h?Ts:Kt;u=await this.client.core.crypto.encode(s,l,At(Se({},o||{}),{encoding:d}))}catch(d){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${s} failed`),d}let f;try{f=await this.client.core.history.get(s,n)}catch(d){throw this.client.logger.error(`sendError() -> history.get(${s}, ${n}) failed`),d}if(h){const d=iu(c,s,u);await global.Linking.openURL(d,this.client.name)}else{const d=f.request.method,p=a||ct[d].res;this.client.core.relayer.publish(s,u,p)}await this.client.core.history.resolve(l)}),V(this,"cleanup",async()=>{const t=[],n=[];this.client.session.getAll().forEach(s=>{let i=!1;wn(s.expiry)&&(i=!0),this.client.core.crypto.keychain.has(s.topic)||(i=!0),i&&t.push(s.topic)}),this.client.proposal.getAll().forEach(s=>{wn(s.expiryTimestamp)&&n.push(s.id)}),await Promise.all([...t.map(s=>this.deleteSession({topic:s})),...n.map(s=>this.deleteProposal(s))])}),V(this,"onProviderMessageEvent",async t=>{!this.initialized||this.relayMessageCache.length>0?this.relayMessageCache.push(t):await this.onRelayMessage(t)}),V(this,"onRelayEventRequest",async t=>{this.requestQueue.queue.push(t),await this.processRequestsQueue()}),V(this,"processRequestsQueue",async()=>{if(this.requestQueue.state===rn.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=rn.active;const t=this.requestQueue.queue.shift();if(t)try{await this.processRequest(t)}catch(n){this.client.logger.warn(n)}}this.requestQueue.state=rn.idle}),V(this,"processRequest",async t=>{const{topic:n,payload:s,attestation:i,transportType:o,encryptedId:a}=t,c=s.method;if(!this.shouldIgnorePairingRequest({topic:n,requestMethod:c}))switch(c){case"wc_sessionPropose":return await this.onSessionProposeRequest({topic:n,payload:s,attestation:i,encryptedId:a});case"wc_sessionSettle":return await this.onSessionSettleRequest(n,s);case"wc_sessionUpdate":return await this.onSessionUpdateRequest(n,s);case"wc_sessionExtend":return await this.onSessionExtendRequest(n,s);case"wc_sessionPing":return await this.onSessionPingRequest(n,s);case"wc_sessionDelete":return await this.onSessionDeleteRequest(n,s);case"wc_sessionRequest":return await this.onSessionRequest({topic:n,payload:s,attestation:i,encryptedId:a,transportType:o});case"wc_sessionEvent":return await this.onSessionEventRequest(n,s);case"wc_sessionAuthenticate":return await this.onSessionAuthenticateRequest({topic:n,payload:s,attestation:i,encryptedId:a,transportType:o});default:return this.client.logger.info(`Unsupported request method ${c}`)}}),V(this,"onRelayEventResponse",async t=>{const{topic:n,payload:s,transportType:i}=t,o=(await this.client.core.history.get(n,s.id)).request.method;switch(o){case"wc_sessionPropose":return this.onSessionProposeResponse(n,s,i);case"wc_sessionSettle":return this.onSessionSettleResponse(n,s);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,s);case"wc_sessionExtend":return this.onSessionExtendResponse(n,s);case"wc_sessionPing":return this.onSessionPingResponse(n,s);case"wc_sessionRequest":return this.onSessionRequestResponse(n,s);case"wc_sessionAuthenticate":return this.onSessionAuthenticateResponse(n,s);default:return this.client.logger.info(`Unsupported response method ${o}`)}}),V(this,"onRelayEventUnknownPayload",t=>{const{topic:n}=t,{message:s}=W("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(s)}),V(this,"shouldIgnorePairingRequest",t=>{const{topic:n,requestMethod:s}=t,i=this.expectedPairingMethodMap.get(n);return!i||i.includes(s)?!1:!!(i.includes("wc_sessionAuthenticate")&&this.client.events.listenerCount("session_authenticate")>0)}),V(this,"onSessionProposeRequest",async t=>{const{topic:n,payload:s,attestation:i,encryptedId:o}=t,{params:a,id:c}=s;try{const l=this.client.core.eventClient.getEvent({topic:n});this.client.events.listenerCount("session_proposal")===0&&(console.warn("No listener for session_proposal event"),l==null||l.setError($n.proposal_listener_not_found)),this.isValidConnect(Se({},s.params));const u=a.expiryTimestamp||Ke(ct.wc_sessionPropose.req.ttl),h=Se({id:c,pairingTopic:n,expiryTimestamp:u,attestation:i,encryptedId:o},a);await this.setProposal(c,h);const f=await this.getVerifyContext({attestationId:i,hash:Ir(JSON.stringify(s)),encryptedId:o,metadata:h.proposer.metadata});l==null||l.addTrace(nn.emit_session_proposal),this.client.events.emit("session_proposal",{id:c,params:h,verifyContext:f})}catch(l){await this.sendError({id:c,topic:n,error:l,rpcOpts:ct.wc_sessionPropose.autoReject}),this.client.logger.error(l)}}),V(this,"onSessionProposeResponse",async(t,n,s)=>{const{id:i}=n;if(on(n)){const{result:o}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:o});const a=this.client.proposal.get(i);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const l=o.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:l});const u=await this.client.core.crypto.generateSharedKey(c,l);this.pendingSessions.set(i,{sessionTopic:u,pairingTopic:t,proposalId:i,publicKey:c});const h=await this.client.core.relayer.subscribe(u,{transportType:s});this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:h}),await this.client.core.pairing.activate({topic:t})}else if(Sr(n)){await this.deleteProposal(i);const o=Ee("session_connect",i);if(this.events.listenerCount(o)===0)throw new Error(`emitting ${o} without any listeners, 954`);this.events.emit(o,{error:n.error})}}),V(this,"onSessionSettleRequest",async(t,n)=>{const{id:s,params:i}=n;try{this.isValidSessionSettleRequest(i);const{relay:o,controller:a,expiry:c,namespaces:l,sessionProperties:u,scopedProperties:h,sessionConfig:f}=n.params,d=[...this.pendingSessions.values()].find(m=>m.sessionTopic===t);if(!d)return this.client.logger.error(`Pending session not found for topic ${t}`);const p=this.client.proposal.get(d.proposalId),g=At(Se(Se(Se({topic:t,relay:o,expiry:c,namespaces:l,acknowledged:!0,pairingTopic:d.pairingTopic,requiredNamespaces:p.requiredNamespaces,optionalNamespaces:p.optionalNamespaces,controller:a.publicKey,self:{publicKey:d.publicKey,metadata:this.client.metadata},peer:{publicKey:a.publicKey,metadata:a.metadata}},u&&{sessionProperties:u}),h&&{scopedProperties:h}),f&&{sessionConfig:f}),{transportType:Te.relay});await this.client.session.set(g.topic,g),await this.setExpiry(g.topic,g.expiry),await this.client.core.pairing.updateMetadata({topic:d.pairingTopic,metadata:g.peer.metadata}),this.client.events.emit("session_connect",{session:g}),this.events.emit(Ee("session_connect",d.proposalId),{session:g}),this.pendingSessions.delete(d.proposalId),this.deleteProposal(d.proposalId,!1),this.cleanupDuplicatePairings(g),await this.sendResult({id:n.id,topic:t,result:!0})}catch(o){await this.sendError({id:s,topic:t,error:o}),this.client.logger.error(o)}}),V(this,"onSessionSettleResponse",async(t,n)=>{const{id:s}=n;on(n)?(await this.client.session.update(t,{acknowledged:!0}),this.events.emit(Ee("session_approve",s),{})):Sr(n)&&(await this.client.session.delete(t,Ne("USER_DISCONNECTED")),this.events.emit(Ee("session_approve",s),{error:n.error}))}),V(this,"onSessionUpdateRequest",async(t,n)=>{const{params:s,id:i}=n;try{const o=`${t}_session_update`,a=bc.get(o);if(a&&this.isRequestOutOfSync(a,i)){this.client.logger.warn(`Discarding out of sync request - ${i}`),this.sendError({id:i,topic:t,error:Ne("INVALID_UPDATE_REQUEST")});return}this.isValidUpdate(Se({topic:t},s));try{bc.set(o,i),await this.client.session.update(t,{namespaces:s.namespaces}),await this.sendResult({id:i,topic:t,result:!0})}catch(c){throw bc.delete(o),c}this.client.events.emit("session_update",{id:i,topic:t,params:s})}catch(o){await this.sendError({id:i,topic:t,error:o}),this.client.logger.error(o)}}),V(this,"isRequestOutOfSync",(t,n)=>n.toString().slice(0,-3)<t.toString().slice(0,-3)),V(this,"onSessionUpdateResponse",(t,n)=>{const{id:s}=n,i=Ee("session_update",s);if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners`);on(n)?this.events.emit(Ee("session_update",s),{}):Sr(n)&&this.events.emit(Ee("session_update",s),{error:n.error})}),V(this,"onSessionExtendRequest",async(t,n)=>{const{id:s}=n;try{this.isValidExtend({topic:t}),await this.setExpiry(t,Ke(Bo)),await this.sendResult({id:s,topic:t,result:!0}),this.client.events.emit("session_extend",{id:s,topic:t})}catch(i){await this.sendError({id:s,topic:t,error:i}),this.client.logger.error(i)}}),V(this,"onSessionExtendResponse",(t,n)=>{const{id:s}=n,i=Ee("session_extend",s);if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners`);on(n)?this.events.emit(Ee("session_extend",s),{}):Sr(n)&&this.events.emit(Ee("session_extend",s),{error:n.error})}),V(this,"onSessionPingRequest",async(t,n)=>{const{id:s}=n;try{this.isValidPing({topic:t}),await this.sendResult({id:s,topic:t,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:s,topic:t})}catch(i){await this.sendError({id:s,topic:t,error:i}),this.client.logger.error(i)}}),V(this,"onSessionPingResponse",(t,n)=>{const{id:s}=n,i=Ee("session_ping",s);setTimeout(()=>{if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners 2176`);on(n)?this.events.emit(Ee("session_ping",s),{}):Sr(n)&&this.events.emit(Ee("session_ping",s),{error:n.error})},500)}),V(this,"onSessionDeleteRequest",async(t,n)=>{const{id:s}=n;try{this.isValidDisconnect({topic:t,reason:n.params}),await Promise.all([new Promise(i=>{this.client.core.relayer.once(Me.publish,async()=>{i(await this.deleteSession({topic:t,id:s}))})}),this.sendResult({id:s,topic:t,result:!0}),this.cleanupPendingSentRequestsForTopic({topic:t,error:Ne("USER_DISCONNECTED")})]).catch(i=>this.client.logger.error(i))}catch(i){this.client.logger.error(i)}}),V(this,"onSessionRequest",async t=>{var n,s,i;const{topic:o,payload:a,attestation:c,encryptedId:l,transportType:u}=t,{id:h,params:f}=a;try{await this.isValidRequest(Se({topic:o},f));const d=this.client.session.get(o),p=await this.getVerifyContext({attestationId:c,hash:Ir(JSON.stringify(Vr("wc_sessionRequest",f,h))),encryptedId:l,metadata:d.peer.metadata,transportType:u}),g={id:h,topic:o,params:f,verifyContext:p};await this.setPendingSessionRequest(g),u===Te.link_mode&&(n=d.peer.metadata.redirect)!=null&&n.universal&&this.client.core.addLinkModeSupportedApp((s=d.peer.metadata.redirect)==null?void 0:s.universal),(i=this.client.signConfig)!=null&&i.disableRequestQueue?this.emitSessionRequest(g):(this.addSessionRequestToSessionRequestQueue(g),this.processSessionRequestQueue())}catch(d){await this.sendError({id:h,topic:o,error:d}),this.client.logger.error(d)}}),V(this,"onSessionRequestResponse",(t,n)=>{const{id:s}=n,i=Ee("session_request",s);if(this.events.listenerCount(i)===0)throw new Error(`emitting ${i} without any listeners`);on(n)?this.events.emit(Ee("session_request",s),{result:n.result}):Sr(n)&&this.events.emit(Ee("session_request",s),{error:n.error})}),V(this,"onSessionEventRequest",async(t,n)=>{const{id:s,params:i}=n;try{const o=`${t}_session_event_${i.event.name}`,a=bc.get(o);if(a&&this.isRequestOutOfSync(a,s)){this.client.logger.info(`Discarding out of sync request - ${s}`);return}this.isValidEmit(Se({topic:t},i)),this.client.events.emit("session_event",{id:s,topic:t,params:i}),bc.set(o,s)}catch(o){await this.sendError({id:s,topic:t,error:o}),this.client.logger.error(o)}}),V(this,"onSessionAuthenticateResponse",(t,n)=>{const{id:s}=n;this.client.logger.trace({type:"method",method:"onSessionAuthenticateResponse",topic:t,payload:n}),on(n)?this.events.emit(Ee("session_request",s),{result:n.result}):Sr(n)&&this.events.emit(Ee("session_request",s),{error:n.error})}),V(this,"onSessionAuthenticateRequest",async t=>{var n;const{topic:s,payload:i,attestation:o,encryptedId:a,transportType:c}=t;try{const{requester:l,authPayload:u,expiryTimestamp:h}=i.params,f=await this.getVerifyContext({attestationId:o,hash:Ir(JSON.stringify(i)),encryptedId:a,metadata:l.metadata,transportType:c}),d={requester:l,pairingTopic:s,id:i.id,authPayload:u,verifyContext:f,expiryTimestamp:h};await this.setAuthRequest(i.id,{request:d,pairingTopic:s,transportType:c}),c===Te.link_mode&&(n=l.metadata.redirect)!=null&&n.universal&&this.client.core.addLinkModeSupportedApp(l.metadata.redirect.universal),this.client.events.emit("session_authenticate",{topic:s,params:i.params,id:i.id,verifyContext:f})}catch(l){this.client.logger.error(l);const u=i.params.requester.publicKey,h=await this.client.core.crypto.generateKeyPair(),f=this.getAppLinkIfEnabled(i.params.requester.metadata,c),d={type:is,receiverPublicKey:u,senderPublicKey:h};await this.sendError({id:i.id,topic:s,error:l,encodeOpts:d,rpcOpts:ct.wc_sessionAuthenticate.autoReject,appLink:f})}}),V(this,"addSessionRequestToSessionRequestQueue",t=>{this.sessionRequestQueue.queue.push(t)}),V(this,"cleanupAfterResponse",t=>{this.deletePendingSessionRequest(t.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=rn.idle,this.processSessionRequestQueue()},J.toMiliseconds(this.requestQueueDelay))}),V(this,"cleanupPendingSentRequestsForTopic",({topic:t,error:n})=>{const s=this.client.core.history.pending;s.length>0&&s.filter(i=>i.topic===t&&i.request.method==="wc_sessionRequest").forEach(i=>{const o=i.request.id,a=Ee("session_request",o);if(this.events.listenerCount(a)===0)throw new Error(`emitting ${a} without any listeners`);this.events.emit(Ee("session_request",i.request.id),{error:n})})}),V(this,"processSessionRequestQueue",()=>{if(this.sessionRequestQueue.state===rn.active){this.client.logger.info("session request queue is already active.");return}const t=this.sessionRequestQueue.queue[0];if(!t){this.client.logger.info("session request queue is empty.");return}try{this.emitSessionRequest(t)}catch(n){this.client.logger.error(n)}}),V(this,"emitSessionRequest",t=>{if(this.emittedSessionRequests.has(t.id)){this.client.logger.warn({id:t.id},`Skipping emitting \`session_request\` event for duplicate request. id: ${t.id}`);return}this.sessionRequestQueue.state=rn.active,this.emittedSessionRequests.add(t.id),this.client.events.emit("session_request",t)}),V(this,"onPairingCreated",t=>{if(t.methods&&this.expectedPairingMethodMap.set(t.topic,t.methods),t.active)return;const n=this.client.proposal.getAll().find(s=>s.pairingTopic===t.topic);n&&this.onSessionProposeRequest({topic:t.topic,payload:Vr("wc_sessionPropose",At(Se({},n),{requiredNamespaces:n.requiredNamespaces,optionalNamespaces:n.optionalNamespaces,relays:n.relays,proposer:n.proposer,sessionProperties:n.sessionProperties,scopedProperties:n.scopedProperties}),n.id),attestation:n.attestation,encryptedId:n.encryptedId})}),V(this,"isValidConnect",async t=>{if(!jt(t)){const{message:l}=W("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(t)}`);throw new Error(l)}const{pairingTopic:n,requiredNamespaces:s,optionalNamespaces:i,sessionProperties:o,scopedProperties:a,relays:c}=t;if(Ye(n)||await this.isValidPairingTopic(n),!K6(c)){const{message:l}=W("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(l)}if(!Ye(s)&&Sn(s)!==0){const l="requiredNamespaces are deprecated and are automatically assigned to optionalNamespaces";["fatal","error","silent"].includes(this.client.logger.level)?console.warn(l):this.client.logger.warn(l),this.validateNamespaces(s,"requiredNamespaces")}if(!Ye(i)&&Sn(i)!==0&&this.validateNamespaces(i,"optionalNamespaces"),Ye(o)||this.validateSessionProps(o,"sessionProperties"),!Ye(a)){this.validateSessionProps(a,"scopedProperties");const l=Object.keys(s||{}).concat(Object.keys(i||{}));if(!Object.keys(a).every(u=>l.includes(u.split(":")[0])))throw new Error(`Scoped properties must be a subset of required/optional namespaces, received: ${JSON.stringify(a)}, required/optional namespaces: ${JSON.stringify(l)}`)}}),V(this,"validateNamespaces",(t,n)=>{const s=V6(t,"connect()",n);if(s)throw new Error(s.message)}),V(this,"isValidApprove",async t=>{if(!jt(t))throw new Error(W("MISSING_OR_INVALID",`approve() params: ${t}`).message);const{id:n,namespaces:s,relayProtocol:i,sessionProperties:o,scopedProperties:a}=t;this.checkRecentlyDeleted(n),await this.isValidProposalId(n);const c=this.client.proposal.get(n),l=Zf(s,"approve()");if(l)throw new Error(l.message);const u=lw(c.requiredNamespaces,s,"approve()");if(u)throw new Error(u.message);if(!Ge(i,!0)){const{message:h}=W("MISSING_OR_INVALID",`approve() relayProtocol: ${i}`);throw new Error(h)}if(Ye(o)||this.validateSessionProps(o,"sessionProperties"),!Ye(a)){this.validateSessionProps(a,"scopedProperties");const h=new Set(Object.keys(s));if(!Object.keys(a).every(f=>h.has(f.split(":")[0])))throw new Error(`Scoped properties must be a subset of approved namespaces, received: ${JSON.stringify(a)}, approved namespaces: ${Array.from(h).join(", ")}`)}}),V(this,"isValidReject",async t=>{if(!jt(t)){const{message:i}=W("MISSING_OR_INVALID",`reject() params: ${t}`);throw new Error(i)}const{id:n,reason:s}=t;if(this.checkRecentlyDeleted(n),await this.isValidProposalId(n),!Q6(s)){const{message:i}=W("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(s)}`);throw new Error(i)}}),V(this,"isValidSessionSettleRequest",t=>{if(!jt(t)){const{message:l}=W("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${t}`);throw new Error(l)}const{relay:n,controller:s,namespaces:i,expiry:o}=t;if(!q2(n)){const{message:l}=W("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const a=F6(s,"onSessionSettleRequest()");if(a)throw new Error(a.message);const c=Zf(i,"onSessionSettleRequest()");if(c)throw new Error(c.message);if(wn(o)){const{message:l}=W("EXPIRED","onSessionSettleRequest()");throw new Error(l)}}),V(this,"isValidUpdate",async t=>{if(!jt(t)){const{message:c}=W("MISSING_OR_INVALID",`update() params: ${t}`);throw new Error(c)}const{topic:n,namespaces:s}=t;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n);const i=this.client.session.get(n),o=Zf(s,"update()");if(o)throw new Error(o.message);const a=lw(i.requiredNamespaces,s,"update()");if(a)throw new Error(a.message)}),V(this,"isValidExtend",async t=>{if(!jt(t)){const{message:s}=W("MISSING_OR_INVALID",`extend() params: ${t}`);throw new Error(s)}const{topic:n}=t;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n)}),V(this,"isValidRequest",async t=>{if(!jt(t)){const{message:c}=W("MISSING_OR_INVALID",`request() params: ${t}`);throw new Error(c)}const{topic:n,request:s,chainId:i,expiry:o}=t;this.checkRecentlyDeleted(n),await this.isValidSessionTopic(n);const{namespaces:a}=this.client.session.get(n);if(!cw(a,i)){const{message:c}=W("MISSING_OR_INVALID",`request() chainId: ${i}`);throw new Error(c)}if(!W6(s)){const{message:c}=W("MISSING_OR_INVALID",`request() ${JSON.stringify(s)}`);throw new Error(c)}if(!Z6(a,i,s.method)){const{message:c}=W("MISSING_OR_INVALID",`request() method: ${s.method}`);throw new Error(c)}if(o&&!r4(o,ld)){const{message:c}=W("MISSING_OR_INVALID",`request() expiry: ${o}. Expiry must be a number (in seconds) between ${ld.min} and ${ld.max}`);throw new Error(c)}}),V(this,"isValidRespond",async t=>{var n;if(!jt(t)){const{message:o}=W("MISSING_OR_INVALID",`respond() params: ${t}`);throw new Error(o)}const{topic:s,response:i}=t;try{await this.isValidSessionTopic(s)}catch(o){throw(n=t==null?void 0:t.response)!=null&&n.id&&this.cleanupAfterResponse(t),o}if(!J6(i)){const{message:o}=W("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(i)}`);throw new Error(o)}}),V(this,"isValidPing",async t=>{if(!jt(t)){const{message:s}=W("MISSING_OR_INVALID",`ping() params: ${t}`);throw new Error(s)}const{topic:n}=t;await this.isValidSessionOrPairingTopic(n)}),V(this,"isValidEmit",async t=>{if(!jt(t)){const{message:a}=W("MISSING_OR_INVALID",`emit() params: ${t}`);throw new Error(a)}const{topic:n,event:s,chainId:i}=t;await this.isValidSessionTopic(n);const{namespaces:o}=this.client.session.get(n);if(!cw(o,i)){const{message:a}=W("MISSING_OR_INVALID",`emit() chainId: ${i}`);throw new Error(a)}if(!Y6(s)){const{message:a}=W("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}if(!X6(o,i,s.name)){const{message:a}=W("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(s)}`);throw new Error(a)}}),V(this,"isValidDisconnect",async t=>{if(!jt(t)){const{message:s}=W("MISSING_OR_INVALID",`disconnect() params: ${t}`);throw new Error(s)}const{topic:n}=t;await this.isValidSessionOrPairingTopic(n)}),V(this,"isValidAuthenticate",t=>{const{chains:n,uri:s,domain:i,nonce:o}=t;if(!Array.isArray(n)||n.length===0)throw new Error("chains is required and must be a non-empty array");if(!Ge(s,!1))throw new Error("uri is required parameter");if(!Ge(i,!1))throw new Error("domain is required parameter");if(!Ge(o,!1))throw new Error("nonce is required parameter");if([...new Set(n.map(c=>ss(c).namespace))].length>1)throw new Error("Multi-namespace requests are not supported. Please request single namespace only.");const{namespace:a}=ss(n[0]);if(a!=="eip155")throw new Error("Only eip155 namespace is supported for authenticated sessions. Please use .connect() for non-eip155 chains.")}),V(this,"getVerifyContext",async t=>{const{attestationId:n,hash:s,encryptedId:i,metadata:o,transportType:a}=t,c={verified:{verifyUrl:o.verifyUrl||Mc,validation:"UNKNOWN",origin:o.url||""}};try{if(a===Te.link_mode){const u=this.getAppLinkIfEnabled(o,a);return c.verified.validation=u&&new URL(u).origin===new URL(o.url).origin?"VALID":"INVALID",c}const l=await this.client.core.verify.resolve({attestationId:n,hash:s,encryptedId:i,verifyUrl:o.verifyUrl});l&&(c.verified.origin=l.origin,c.verified.isScam=l.isScam,c.verified.validation=l.origin===new URL(o.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.warn(l)}return this.client.logger.debug(`Verify context: ${JSON.stringify(c)}`),c}),V(this,"validateSessionProps",(t,n)=>{Object.values(t).forEach((s,i)=>{if(s==null){const{message:o}=W("MISSING_OR_INVALID",`${n} must contain an existing value for each key. Received: ${s} for key ${Object.keys(t)[i]}`);throw new Error(o)}})}),V(this,"getPendingAuthRequest",t=>{const n=this.client.auth.requests.get(t);return typeof n=="object"?n:void 0}),V(this,"addToRecentlyDeleted",(t,n)=>{if(this.recentlyDeletedMap.set(t,n),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let s=0;const i=this.recentlyDeletedLimit/2;for(const o of this.recentlyDeletedMap.keys()){if(s++>=i)break;this.recentlyDeletedMap.delete(o)}}}),V(this,"checkRecentlyDeleted",t=>{const n=this.recentlyDeletedMap.get(t);if(n){const{message:s}=W("MISSING_OR_INVALID",`Record was recently deleted - ${n}: ${t}`);throw new Error(s)}}),V(this,"isLinkModeEnabled",(t,n)=>{var s,i,o,a,c,l,u,h,f;return!t||n!==Te.link_mode?!1:((i=(s=this.client.metadata)==null?void 0:s.redirect)==null?void 0:i.linkMode)===!0&&((a=(o=this.client.metadata)==null?void 0:o.redirect)==null?void 0:a.universal)!==void 0&&((l=(c=this.client.metadata)==null?void 0:c.redirect)==null?void 0:l.universal)!==""&&((u=t==null?void 0:t.redirect)==null?void 0:u.universal)!==void 0&&((h=t==null?void 0:t.redirect)==null?void 0:h.universal)!==""&&((f=t==null?void 0:t.redirect)==null?void 0:f.linkMode)===!0&&this.client.core.linkModeSupportedApps.includes(t.redirect.universal)&&typeof(global==null?void 0:global.Linking)<"u"}),V(this,"getAppLinkIfEnabled",(t,n)=>{var s;return this.isLinkModeEnabled(t,n)?(s=t==null?void 0:t.redirect)==null?void 0:s.universal:void 0}),V(this,"handleLinkModeMessage",({url:t})=>{if(!t||!t.includes("wc_ev")||!t.includes("topic"))return;const n=vm(t,"topic")||"",s=decodeURIComponent(vm(t,"wc_ev")||""),i=this.client.session.keys.includes(n);i&&this.client.session.update(n,{transportType:Te.link_mode}),this.client.core.dispatchEnvelope({topic:n,message:s,sessionExists:i})}),V(this,"registerLinkModeListeners",async()=>{var t;if(Sg()||ii()&&(t=this.client.metadata.redirect)!=null&&t.linkMode){const n=global==null?void 0:global.Linking;if(typeof n<"u"){n.addEventListener("url",this.handleLinkModeMessage,this.client.name);const s=await n.getInitialURL();s&&setTimeout(()=>{this.handleLinkModeMessage({url:s})},50)}}}),V(this,"getTVFParams",(t,n,s)=>{var i,o,a;if(!((i=n.request)!=null&&i.method))return{};const c={correlationId:t,rpcMethods:[n.request.method],chainId:n.chainId};try{const l=this.extractTxHashesFromResult(n.request,s);c.txHashes=l,c.contractAddresses=this.isValidContractData(n.request.params)?[(a=(o=n.request.params)==null?void 0:o[0])==null?void 0:a.to]:[]}catch(l){this.client.logger.warn("Error getting TVF params",l)}return c}),V(this,"isValidContractData",t=>{var n;if(!t)return!1;try{const s=(t==null?void 0:t.data)||((n=t==null?void 0:t[0])==null?void 0:n.data);if(!s.startsWith("0x"))return!1;const i=s.slice(2);return/^[0-9a-fA-F]*$/.test(i)?i.length%2===0:!1}catch{}return!1}),V(this,"extractTxHashesFromResult",(t,n)=>{var s;try{if(!n)return[];const i=t.method,o=GL[i];if(i==="sui_signTransaction")return[wN(n.transactionBytes)];if(i==="near_signTransaction")return[Dm(n)];if(i==="near_signTransactions")return n.map(c=>Dm(c));if(i==="xrpl_signTransactionFor"||i==="xrpl_signTransaction")return[(s=n.tx_json)==null?void 0:s.hash];if(i==="polkadot_signTransaction")return[m4({transaction:t.params.transactionPayload,signature:n.signature})];if(i==="algo_signTxn")return Dr(n)?n.map(c=>Cm(c)):[Cm(n)];if(i==="cosmos_signDirect")return[vN(n)];if(i==="wallet_sendCalls")return EN(n);if(typeof n=="string")return[n];const a=n[o.key];if(Dr(a))return i==="solana_signAllTransactions"?a.map(c=>mN(c)):a;if(typeof a=="string")return[a]}catch(i){this.client.logger.warn("Error extracting tx hashes from result",i)}return[]})}async processPendingMessageEvents(){try{const e=this.client.session.keys,t=this.client.core.relayer.messages.getWithoutAck(e);for(const[n,s]of Object.entries(t))for(const i of s)try{await this.onProviderMessageEvent({topic:n,message:i,publishedAt:Date.now()})}catch{this.client.logger.warn(`Error processing pending message event for topic: ${n}, message: ${i}`)}}catch(e){this.client.logger.warn("processPendingMessageEvents failed",e)}}isInitialized(){if(!this.initialized){const{message:e}=W("NOT_INITIALIZED",this.name);throw new Error(e)}}async confirmOnlineStateOrThrow(){await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Me.message,e=>{this.onProviderMessageEvent(e)})}async onRelayMessage(e){const{topic:t,message:n,attestation:s,transportType:i}=e,{publicKey:o}=this.client.auth.authKeys.keys.includes(Bu)?this.client.auth.authKeys.get(Bu):{publicKey:void 0};try{const a=await this.client.core.crypto.decode(t,n,{receiverPublicKey:o,encoding:i===Te.link_mode?Ts:Kt});Fg(a)?(this.client.core.history.set(t,a),await this.onRelayEventRequest({topic:t,payload:a,attestation:s,transportType:i,encryptedId:Ir(n)})):Wh(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:t,payload:a,transportType:i}),this.client.core.history.delete(t,a.id)):await this.onRelayEventUnknownPayload({topic:t,payload:a,transportType:i}),await this.client.core.relayer.messages.ack(t,n)}catch(a){this.client.logger.error(a)}}registerExpirerEvents(){this.client.core.expirer.on(yr.expired,async e=>{const{topic:t,id:n}=VE(e.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,W("EXPIRED"),!0);if(n&&this.client.auth.requests.keys.includes(n))return await this.deletePendingAuthRequest(n,W("EXPIRED"),!0);t?this.client.session.keys.includes(t)&&(await this.deleteSession({topic:t,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:t})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}registerPairingEvents(){this.client.core.pairing.events.on(vi.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(vi.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!Ge(e,!1)){const{message:t}=W("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(t)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:t}=W("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(t)}if(wn(this.client.core.pairing.pairings.get(e).expiry)){const{message:t}=W("EXPIRED",`pairing topic: ${e}`);throw new Error(t)}}async isValidSessionTopic(e){if(!Ge(e,!1)){const{message:t}=W("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(t)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:t}=W("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(t)}if(wn(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:t}=W("EXPIRED",`session topic: ${e}`);throw new Error(t)}if(!this.client.core.crypto.keychain.has(e)){const{message:t}=W("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(t)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Ge(e,!1)){const{message:t}=W("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(t)}else{const{message:t}=W("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(t)}}async isValidProposalId(e){if(!G6(e)){const{message:t}=W("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(t)}if(!this.client.proposal.keys.includes(e)){const{message:t}=W("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(t)}if(wn(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:t}=W("EXPIRED",`proposal id: ${e}`);throw new Error(t)}}}class aF extends wo{constructor(e,t){super(e,t,qL,jg),this.core=e,this.logger=t}}let cF=class extends wo{constructor(e,t){super(e,t,VL,jg),this.core=e,this.logger=t}};class lF extends wo{constructor(e,t){super(e,t,QL,jg,n=>n.id),this.core=e,this.logger=t}}class uF extends wo{constructor(e,t){super(e,t,ZL,Yh,()=>Bu),this.core=e,this.logger=t}}class hF extends wo{constructor(e,t){super(e,t,XL,Yh),this.core=e,this.logger=t}}class fF extends wo{constructor(e,t){super(e,t,eF,Yh,n=>n.id),this.core=e,this.logger=t}}var dF=Object.defineProperty,pF=(r,e,t)=>e in r?dF(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ud=(r,e,t)=>pF(r,typeof e!="symbol"?e+"":e,t);class gF{constructor(e,t){this.core=e,this.logger=t,ud(this,"authKeys"),ud(this,"pairingTopics"),ud(this,"requests"),this.authKeys=new uF(this.core,this.logger),this.pairingTopics=new hF(this.core,this.logger),this.requests=new fF(this.core,this.logger)}async init(){await this.authKeys.init(),await this.pairingTopics.init(),await this.requests.init()}}var yF=Object.defineProperty,mF=(r,e,t)=>e in r?yF(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,pe=(r,e,t)=>mF(r,typeof e!="symbol"?e+"":e,t);let wF=class bA extends UU{constructor(e){super(e),pe(this,"protocol",yA),pe(this,"version",mA),pe(this,"name",cd.name),pe(this,"metadata"),pe(this,"core"),pe(this,"logger"),pe(this,"events",new hr.EventEmitter),pe(this,"engine"),pe(this,"session"),pe(this,"proposal"),pe(this,"pendingRequest"),pe(this,"auth"),pe(this,"signConfig"),pe(this,"on",(n,s)=>this.events.on(n,s)),pe(this,"once",(n,s)=>this.events.once(n,s)),pe(this,"off",(n,s)=>this.events.off(n,s)),pe(this,"removeListener",(n,s)=>this.events.removeListener(n,s)),pe(this,"removeAllListeners",n=>this.events.removeAllListeners(n)),pe(this,"connect",async n=>{try{return await this.engine.connect(n)}catch(s){throw this.logger.error(s.message),s}}),pe(this,"pair",async n=>{try{return await this.engine.pair(n)}catch(s){throw this.logger.error(s.message),s}}),pe(this,"approve",async n=>{try{return await this.engine.approve(n)}catch(s){throw this.logger.error(s.message),s}}),pe(this,"reject",async n=>{try{return await this.engine.reject(n)}catch(s){throw this.logger.error(s.message),s}}),pe(this,"update",async n=>{try{return await this.engine.update(n)}catch(s){throw this.logger.error(s.message),s}}),pe(this,"extend",async n=>{try{return await this.engine.extend(n)}catch(s){throw this.logger.error(s.message),s}}),pe(this,"request",async n=>{try{return await this.engine.request(n)}catch(s){throw this.logger.error(s.message),s}}),pe(this,"respond",async n=>{try{return await this.engine.respond(n)}catch(s){throw this.logger.error(s.message),s}}),pe(this,"ping",async n=>{try{return await this.engine.ping(n)}catch(s){throw this.logger.error(s.message),s}}),pe(this,"emit",async n=>{try{return await this.engine.emit(n)}catch(s){throw this.logger.error(s.message),s}}),pe(this,"disconnect",async n=>{try{return await this.engine.disconnect(n)}catch(s){throw this.logger.error(s.message),s}}),pe(this,"find",n=>{try{return this.engine.find(n)}catch(s){throw this.logger.error(s.message),s}}),pe(this,"getPendingSessionRequests",()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}}),pe(this,"authenticate",async(n,s)=>{try{return await this.engine.authenticate(n,s)}catch(i){throw this.logger.error(i.message),i}}),pe(this,"formatAuthMessage",n=>{try{return this.engine.formatAuthMessage(n)}catch(s){throw this.logger.error(s.message),s}}),pe(this,"approveSessionAuthenticate",async n=>{try{return await this.engine.approveSessionAuthenticate(n)}catch(s){throw this.logger.error(s.message),s}}),pe(this,"rejectSessionAuthenticate",async n=>{try{return await this.engine.rejectSessionAuthenticate(n)}catch(s){throw this.logger.error(s.message),s}}),this.name=(e==null?void 0:e.name)||cd.name,this.metadata=uT(e==null?void 0:e.metadata),this.signConfig=e==null?void 0:e.signConfig;const t=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Ul(Gh({level:(e==null?void 0:e.logger)||cd.logger}));this.core=(e==null?void 0:e.core)||new HL(e),this.logger=$t(t,this.name),this.session=new cF(this.core,this.logger),this.proposal=new aF(this.core,this.logger),this.pendingRequest=new lF(this.core,this.logger),this.engine=new oF(this),this.auth=new gF(this.core,this.logger)}static async init(e){const t=new bA(e);return await t.initialize(),t}get context(){return Zt(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.auth.init(),await this.engine.init(),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}};var cu={exports:{}},ib;function bF(){return ib||(ib=1,(function(r,e){var t=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof mn<"u"&&mn,n=(function(){function i(){this.fetch=!1,this.DOMException=t.DOMException}return i.prototype=t,new i})();(function(i){(function(o){var a=typeof i<"u"&&i||typeof self<"u"&&self||typeof mn<"u"&&mn||{},c={searchParams:"URLSearchParams"in a,iterable:"Symbol"in a&&"iterator"in Symbol,blob:"FileReader"in a&&"Blob"in a&&(function(){try{return new Blob,!0}catch{return!1}})(),formData:"FormData"in a,arrayBuffer:"ArrayBuffer"in a};function l(w){return w&&DataView.prototype.isPrototypeOf(w)}if(c.arrayBuffer)var u=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],h=ArrayBuffer.isView||function(w){return w&&u.indexOf(Object.prototype.toString.call(w))>-1};function f(w){if(typeof w!="string"&&(w=String(w)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(w)||w==="")throw new TypeError('Invalid character in header field name: "'+w+'"');return w.toLowerCase()}function d(w){return typeof w!="string"&&(w=String(w)),w}function p(w){var A={next:function(){var C=w.shift();return{done:C===void 0,value:C}}};return c.iterable&&(A[Symbol.iterator]=function(){return A}),A}function g(w){this.map={},w instanceof g?w.forEach(function(A,C){this.append(C,A)},this):Array.isArray(w)?w.forEach(function(A){if(A.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+A.length);this.append(A[0],A[1])},this):w&&Object.getOwnPropertyNames(w).forEach(function(A){this.append(A,w[A])},this)}g.prototype.append=function(w,A){w=f(w),A=d(A);var C=this.map[w];this.map[w]=C?C+", "+A:A},g.prototype.delete=function(w){delete this.map[f(w)]},g.prototype.get=function(w){return w=f(w),this.has(w)?this.map[w]:null},g.prototype.has=function(w){return this.map.hasOwnProperty(f(w))},g.prototype.set=function(w,A){this.map[f(w)]=d(A)},g.prototype.forEach=function(w,A){for(var C in this.map)this.map.hasOwnProperty(C)&&w.call(A,this.map[C],C,this)},g.prototype.keys=function(){var w=[];return this.forEach(function(A,C){w.push(C)}),p(w)},g.prototype.values=function(){var w=[];return this.forEach(function(A){w.push(A)}),p(w)},g.prototype.entries=function(){var w=[];return this.forEach(function(A,C){w.push([C,A])}),p(w)},c.iterable&&(g.prototype[Symbol.iterator]=g.prototype.entries);function m(w){if(!w._noBody){if(w.bodyUsed)return Promise.reject(new TypeError("Already read"));w.bodyUsed=!0}}function b(w){return new Promise(function(A,C){w.onload=function(){A(w.result)},w.onerror=function(){C(w.error)}})}function x(w){var A=new FileReader,C=b(A);return A.readAsArrayBuffer(w),C}function v(w){var A=new FileReader,C=b(A),k=/charset=([A-Za-z0-9_-]+)/.exec(w.type),_=k?k[1]:"utf-8";return A.readAsText(w,_),C}function I(w){for(var A=new Uint8Array(w),C=new Array(A.length),k=0;k<A.length;k++)C[k]=String.fromCharCode(A[k]);return C.join("")}function S(w){if(w.slice)return w.slice(0);var A=new Uint8Array(w.byteLength);return A.set(new Uint8Array(w)),A.buffer}function E(){return this.bodyUsed=!1,this._initBody=function(w){this.bodyUsed=this.bodyUsed,this._bodyInit=w,w?typeof w=="string"?this._bodyText=w:c.blob&&Blob.prototype.isPrototypeOf(w)?this._bodyBlob=w:c.formData&&FormData.prototype.isPrototypeOf(w)?this._bodyFormData=w:c.searchParams&&URLSearchParams.prototype.isPrototypeOf(w)?this._bodyText=w.toString():c.arrayBuffer&&c.blob&&l(w)?(this._bodyArrayBuffer=S(w.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):c.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(w)||h(w))?this._bodyArrayBuffer=S(w):this._bodyText=w=Object.prototype.toString.call(w):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof w=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):c.searchParams&&URLSearchParams.prototype.isPrototypeOf(w)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"))},c.blob&&(this.blob=function(){var w=m(this);if(w)return w;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var w=m(this);return w||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else{if(c.blob)return this.blob().then(x);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var w=m(this);if(w)return w;if(this._bodyBlob)return v(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(I(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},c.formData&&(this.formData=function(){return this.text().then(L)}),this.json=function(){return this.text().then(JSON.parse)},this}var P=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];function D(w){var A=w.toUpperCase();return P.indexOf(A)>-1?A:w}function B(w,A){if(!(this instanceof B))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');A=A||{};var C=A.body;if(w instanceof B){if(w.bodyUsed)throw new TypeError("Already read");this.url=w.url,this.credentials=w.credentials,A.headers||(this.headers=new g(w.headers)),this.method=w.method,this.mode=w.mode,this.signal=w.signal,!C&&w._bodyInit!=null&&(C=w._bodyInit,w.bodyUsed=!0)}else this.url=String(w);if(this.credentials=A.credentials||this.credentials||"same-origin",(A.headers||!this.headers)&&(this.headers=new g(A.headers)),this.method=D(A.method||this.method||"GET"),this.mode=A.mode||this.mode||null,this.signal=A.signal||this.signal||(function(){if("AbortController"in a){var N=new AbortController;return N.signal}})(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&C)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(C),(this.method==="GET"||this.method==="HEAD")&&(A.cache==="no-store"||A.cache==="no-cache")){var k=/([?&])_=[^&]*/;if(k.test(this.url))this.url=this.url.replace(k,"$1_="+new Date().getTime());else{var _=/\?/;this.url+=(_.test(this.url)?"&":"?")+"_="+new Date().getTime()}}}B.prototype.clone=function(){return new B(this,{body:this._bodyInit})};function L(w){var A=new FormData;return w.trim().split("&").forEach(function(C){if(C){var k=C.split("="),_=k.shift().replace(/\+/g," "),N=k.join("=").replace(/\+/g," ");A.append(decodeURIComponent(_),decodeURIComponent(N))}}),A}function j(w){var A=new g,C=w.replace(/\r?\n[\t ]+/g," ");return C.split("\r").map(function(k){return k.indexOf(`
`)===0?k.substr(1,k.length):k}).forEach(function(k){var _=k.split(":"),N=_.shift().trim();if(N){var z=_.join(":").trim();try{A.append(N,z)}catch(H){console.warn("Response "+H.message)}}}),A}E.call(B.prototype);function $(w,A){if(!(this instanceof $))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(A||(A={}),this.type="default",this.status=A.status===void 0?200:A.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=A.statusText===void 0?"":""+A.statusText,this.headers=new g(A.headers),this.url=A.url||"",this._initBody(w)}E.call($.prototype),$.prototype.clone=function(){return new $(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new g(this.headers),url:this.url})},$.error=function(){var w=new $(null,{status:200,statusText:""});return w.ok=!1,w.status=0,w.type="error",w};var U=[301,302,303,307,308];$.redirect=function(w,A){if(U.indexOf(A)===-1)throw new RangeError("Invalid status code");return new $(null,{status:A,headers:{location:w}})},o.DOMException=a.DOMException;try{new o.DOMException}catch{o.DOMException=function(A,C){this.message=A,this.name=C;var k=Error(A);this.stack=k.stack},o.DOMException.prototype=Object.create(Error.prototype),o.DOMException.prototype.constructor=o.DOMException}function T(w,A){return new Promise(function(C,k){var _=new B(w,A);if(_.signal&&_.signal.aborted)return k(new o.DOMException("Aborted","AbortError"));var N=new XMLHttpRequest;function z(){N.abort()}N.onload=function(){var G={statusText:N.statusText,headers:j(N.getAllResponseHeaders()||"")};_.url.indexOf("file://")===0&&(N.status<200||N.status>599)?G.status=200:G.status=N.status,G.url="responseURL"in N?N.responseURL:G.headers.get("X-Request-URL");var Q="response"in N?N.response:N.responseText;setTimeout(function(){C(new $(Q,G))},0)},N.onerror=function(){setTimeout(function(){k(new TypeError("Network request failed"))},0)},N.ontimeout=function(){setTimeout(function(){k(new TypeError("Network request timed out"))},0)},N.onabort=function(){setTimeout(function(){k(new o.DOMException("Aborted","AbortError"))},0)};function H(G){try{return G===""&&a.location.href?a.location.href:G}catch{return G}}if(N.open(_.method,H(_.url),!0),_.credentials==="include"?N.withCredentials=!0:_.credentials==="omit"&&(N.withCredentials=!1),"responseType"in N&&(c.blob?N.responseType="blob":c.arrayBuffer&&(N.responseType="arraybuffer")),A&&typeof A.headers=="object"&&!(A.headers instanceof g||a.Headers&&A.headers instanceof a.Headers)){var Y=[];Object.getOwnPropertyNames(A.headers).forEach(function(G){Y.push(f(G)),N.setRequestHeader(G,d(A.headers[G]))}),_.headers.forEach(function(G,Q){Y.indexOf(Q)===-1&&N.setRequestHeader(Q,G)})}else _.headers.forEach(function(G,Q){N.setRequestHeader(Q,G)});_.signal&&(_.signal.addEventListener("abort",z),N.onreadystatechange=function(){N.readyState===4&&_.signal.removeEventListener("abort",z)}),N.send(typeof _._bodyInit>"u"?null:_._bodyInit)})}return T.polyfill=!0,a.fetch||(a.fetch=T,a.Headers=g,a.Request=B,a.Response=$),o.Headers=g,o.Request=B,o.Response=$,o.fetch=T,Object.defineProperty(o,"__esModule",{value:!0}),o})({})})(n),n.fetch.ponyfill=!0,delete n.fetch.polyfill;var s=t.fetch?t:n;e=s.fetch,e.default=s.fetch,e.fetch=s.fetch,e.Headers=s.Headers,e.Request=s.Request,e.Response=s.Response,r.exports=e})(cu,cu.exports)),cu.exports}var vF=bF();const ob=fg(vF);var EF=Object.defineProperty,AF=Object.defineProperties,xF=Object.getOwnPropertyDescriptors,ab=Object.getOwnPropertySymbols,IF=Object.prototype.hasOwnProperty,SF=Object.prototype.propertyIsEnumerable,cb=(r,e,t)=>e in r?EF(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,lb=(r,e)=>{for(var t in e||(e={}))IF.call(e,t)&&cb(r,t,e[t]);if(ab)for(var t of ab(e))SF.call(e,t)&&cb(r,t,e[t]);return r},ub=(r,e)=>AF(r,xF(e));const PF={Accept:"application/json","Content-Type":"application/json"},OF="POST",hb={headers:PF,method:OF},fb=10;let vA=class{constructor(e,t=!1){if(this.url=e,this.disableProviderPing=t,this.events=new hr.EventEmitter,this.isAvailable=!1,this.registering=!1,!Dw(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);this.url=e,this.disableProviderPing=t}get connected(){return this.isAvailable}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(e){this.isAvailable||await this.register();try{const t=us(e),n=await(await ob(this.url,ub(lb({},hb),{body:t}))).json();this.onPayload({data:n})}catch(t){this.onError(e.id,t)}}async register(e=this.url){if(!Dw(e))throw new Error(`Provided URL is not compatible with HTTP connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((n,s)=>{this.events.once("register_error",i=>{this.resetMaxListeners(),s(i)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return s(new Error("HTTP connection is missing or invalid"));n()})})}this.url=e,this.registering=!0;try{if(!this.disableProviderPing){const t=us({id:1,jsonrpc:"2.0",method:"test",params:[]});await ob(e,ub(lb({},hb),{body:t}))}this.onOpen()}catch(t){const n=this.parseError(t);throw this.events.emit("register_error",n),this.onClose(),n}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(e){if(typeof e.data>"u")return;const t=typeof e.data=="string"?oo(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const n=this.parseError(t),s=n.message||n.toString(),i=Qh(e,s);this.events.emit("payload",i)}parseError(e,t=this.url){return J2(e,t,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>fb&&this.events.setMaxListeners(fb)}};const db="error",DF="wss://relay.walletconnect.org",CF="wc",BF="universal_provider",lu=`${CF}@2:${BF}:`,EA="https://rpc.walletconnect.org/v1/",AA="generic",_F=`${EA}bundler`,Xo="call_status",TF=86400,zg={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};function Hg(r){return r==null||typeof r!="object"&&typeof r!="function"}function xA(r){return Object.getOwnPropertySymbols(r).filter(e=>Object.prototype.propertyIsEnumerable.call(r,e))}function IA(r){return r==null?r===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(r)}const NF="[object RegExp]",SA="[object String]",PA="[object Number]",OA="[object Boolean]",DA="[object Arguments]",RF="[object Symbol]",UF="[object Date]",kF="[object Map]",$F="[object Set]",LF="[object Array]",FF="[object ArrayBuffer]",MF="[object Object]",jF="[object DataView]",zF="[object Uint8Array]",HF="[object Uint8ClampedArray]",qF="[object Uint16Array]",VF="[object Uint32Array]",KF="[object Int8Array]",GF="[object Int16Array]",QF="[object Int32Array]",WF="[object Float32Array]",JF="[object Float64Array]";function qg(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function YF(r,e){return zo(r,void 0,r,new Map,e)}function zo(r,e,t,n=new Map,s=void 0){const i=s==null?void 0:s(r,e,t,n);if(i!=null)return i;if(Hg(r))return r;if(n.has(r))return n.get(r);if(Array.isArray(r)){const o=new Array(r.length);n.set(r,o);for(let a=0;a<r.length;a++)o[a]=zo(r[a],a,t,n,s);return Object.hasOwn(r,"index")&&(o.index=r.index),Object.hasOwn(r,"input")&&(o.input=r.input),o}if(r instanceof Date)return new Date(r.getTime());if(r instanceof RegExp){const o=new RegExp(r.source,r.flags);return o.lastIndex=r.lastIndex,o}if(r instanceof Map){const o=new Map;n.set(r,o);for(const[a,c]of r)o.set(a,zo(c,a,t,n,s));return o}if(r instanceof Set){const o=new Set;n.set(r,o);for(const a of r)o.add(zo(a,void 0,t,n,s));return o}if(typeof Buffer<"u"&&Buffer.isBuffer(r))return r.subarray();if(qg(r)){const o=new(Object.getPrototypeOf(r)).constructor(r.length);n.set(r,o);for(let a=0;a<r.length;a++)o[a]=zo(r[a],a,t,n,s);return o}if(r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer)return r.slice(0);if(r instanceof DataView){const o=new DataView(r.buffer.slice(0),r.byteOffset,r.byteLength);return n.set(r,o),Ei(o,r,t,n,s),o}if(typeof File<"u"&&r instanceof File){const o=new File([r],r.name,{type:r.type});return n.set(r,o),Ei(o,r,t,n,s),o}if(r instanceof Blob){const o=new Blob([r],{type:r.type});return n.set(r,o),Ei(o,r,t,n,s),o}if(r instanceof Error){const o=new r.constructor;return n.set(r,o),o.message=r.message,o.name=r.name,o.stack=r.stack,o.cause=r.cause,Ei(o,r,t,n,s),o}if(typeof r=="object"&&ZF(r)){const o=Object.create(Object.getPrototypeOf(r));return n.set(r,o),Ei(o,r,t,n,s),o}return r}function Ei(r,e,t=r,n,s){const i=[...Object.keys(e),...xA(e)];for(let o=0;o<i.length;o++){const a=i[o],c=Object.getOwnPropertyDescriptor(r,a);(c==null||c.writable)&&(r[a]=zo(e[a],a,t,n,s))}}function ZF(r){switch(IA(r)){case DA:case LF:case FF:case jF:case OA:case UF:case WF:case JF:case KF:case GF:case QF:case kF:case PA:case MF:case NF:case $F:case SA:case RF:case zF:case HF:case qF:case VF:return!0;default:return!1}}function XF(r,e){return YF(r,(t,n,s,i)=>{if(typeof r=="object")switch(Object.prototype.toString.call(r)){case PA:case SA:case OA:{const o=new r.constructor(r==null?void 0:r.valueOf());return Ei(o,r),o}case DA:{const o={};return Ei(o,r),o.length=r.length,o[Symbol.iterator]=r[Symbol.iterator],o}default:return}})}function pb(r){return XF(r)}function gb(r){return r!==null&&typeof r=="object"&&IA(r)==="[object Arguments]"}function yb(r){return typeof r=="object"&&r!==null}function e9(){}function t9(r){return qg(r)}function r9(r){var t;if(typeof r!="object"||r==null)return!1;if(Object.getPrototypeOf(r)===null)return!0;if(Object.prototype.toString.call(r)!=="[object Object]"){const n=r[Symbol.toStringTag];return n==null||!((t=Object.getOwnPropertyDescriptor(r,Symbol.toStringTag))!=null&&t.writable)?!1:r.toString()===`[object ${n}]`}let e=r;for(;Object.getPrototypeOf(e)!==null;)e=Object.getPrototypeOf(e);return Object.getPrototypeOf(r)===e}function n9(r){if(Hg(r))return r;if(Array.isArray(r)||qg(r)||r instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&r instanceof SharedArrayBuffer)return r.slice(0);const e=Object.getPrototypeOf(r),t=e.constructor;if(r instanceof Date||r instanceof Map||r instanceof Set)return new t(r);if(r instanceof RegExp){const n=new t(r);return n.lastIndex=r.lastIndex,n}if(r instanceof DataView)return new t(r.buffer.slice(0));if(r instanceof Error){const n=new t(r.message);return n.stack=r.stack,n.name=r.name,n.cause=r.cause,n}if(typeof File<"u"&&r instanceof File)return new t([r],r.name,{type:r.type,lastModified:r.lastModified});if(typeof r=="object"){const n=Object.create(e);return Object.assign(n,r)}return r}function s9(r,...e){const t=e.slice(0,-1),n=e[e.length-1];let s=r;for(let i=0;i<t.length;i++){const o=t[i];s=zp(s,o,n,new Map)}return s}function zp(r,e,t,n){if(Hg(r)&&(r=Object(r)),e==null||typeof e!="object")return r;if(n.has(e))return n9(n.get(e));if(n.set(e,r),Array.isArray(e)){e=e.slice();for(let i=0;i<e.length;i++)e[i]=e[i]??void 0}const s=[...Object.keys(e),...xA(e)];for(let i=0;i<s.length;i++){const o=s[i];let a=e[o],c=r[o];if(gb(a)&&(a={...a}),gb(c)&&(c={...c}),typeof Buffer<"u"&&Buffer.isBuffer(a)&&(a=pb(a)),Array.isArray(a))if(typeof c=="object"&&c!=null){const u=[],h=Reflect.ownKeys(c);for(let f=0;f<h.length;f++){const d=h[f];u[d]=c[d]}c=u}else c=[];const l=t(c,a,o,r,e,n);l!=null?r[o]=l:Array.isArray(a)||yb(c)&&yb(a)?r[o]=zp(c,a,t,n):c==null&&r9(a)?r[o]=zp({},a,t,n):c==null&&t9(a)?r[o]=pb(a):(c===void 0||a!==void 0)&&(r[o]=a)}return r}function i9(r,...e){return s9(r,...e,e9)}var o9=Object.defineProperty,a9=Object.defineProperties,c9=Object.getOwnPropertyDescriptors,mb=Object.getOwnPropertySymbols,l9=Object.prototype.hasOwnProperty,u9=Object.prototype.propertyIsEnumerable,wb=(r,e,t)=>e in r?o9(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,uu=(r,e)=>{for(var t in e||(e={}))l9.call(e,t)&&wb(r,t,e[t]);if(mb)for(var t of mb(e))u9.call(e,t)&&wb(r,t,e[t]);return r},h9=(r,e)=>a9(r,c9(e));function CA(r,e,t){var n;const s=ss(r);return((n=e.rpcMap)==null?void 0:n[s.reference])||`${EA}?chainId=${s.namespace}:${s.reference}&projectId=${t}`}function f9(r){return r.includes(":")?r.split(":")[1]:r}function BA(r){return r.map(e=>`${e.split(":")[0]}:${e.split(":")[1]}`)}function d9(r,e){const t=Object.keys(e.namespaces).filter(s=>s.includes(r));if(!t.length)return[];const n=[];return t.forEach(s=>{const i=e.namespaces[s].accounts;n.push(...i)}),n}function bb(r){return Object.fromEntries(Object.entries(r).filter(([e,t])=>{var n,s;return((n=t==null?void 0:t.chains)==null?void 0:n.length)&&((s=t==null?void 0:t.chains)==null?void 0:s.length)>0}))}function hu(r={},e={}){const t=bb(vb(r)),n=bb(vb(e));return i9(t,n)}function vb(r){var e,t,n,s,i;const o={};if(!Sn(r))return o;for(const[a,c]of Object.entries(r)){const l=Kh(a)?[a]:c.chains,u=c.methods||[],h=c.events||[],f=c.rpcMap||{},d=jo(a);o[d]=h9(uu(uu({},o[d]),c),{chains:In(l,(e=o[d])==null?void 0:e.chains),methods:In(u,(t=o[d])==null?void 0:t.methods),events:In(h,(n=o[d])==null?void 0:n.events)}),(Sn(f)||Sn(((s=o[d])==null?void 0:s.rpcMap)||{}))&&(o[d].rpcMap=uu(uu({},f),(i=o[d])==null?void 0:i.rpcMap))}return o}function Eb(r){return r.includes(":")?r.split(":")[2]:r}function Ab(r){const e={};for(const[t,n]of Object.entries(r)){const s=n.methods||[],i=n.events||[],o=n.accounts||[],a=Kh(t)?[t]:n.chains?n.chains:BA(n.accounts);e[t]={chains:a,methods:s,events:i,accounts:o}}return e}function hd(r){return typeof r=="number"?r:r.includes("0x")?parseInt(r,16):(r=r.includes(":")?r.split(":")[1]:r,isNaN(Number(r))?r:Number(r))}function p9(r){try{const e=JSON.parse(r);return typeof e=="object"&&e!==null&&!Array.isArray(e)}catch{return!1}}const _A={},ea=r=>_A[r],fd=(r,e)=>{_A[r]=e};var g9=Object.defineProperty,xb=Object.getOwnPropertySymbols,y9=Object.prototype.hasOwnProperty,m9=Object.prototype.propertyIsEnumerable,Ib=(r,e,t)=>e in r?g9(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Sb=(r,e)=>{for(var t in e||(e={}))y9.call(e,t)&&Ib(r,t,e[t]);if(xb)for(var t of xb(e))m9.call(e,t)&&Ib(r,t,e[t]);return r};const Pb="eip155",w9=["atomic","flow-control","paymasterService","sessionKeys","auxiliaryFunds"],b9=r=>r&&r.startsWith("0x")?BigInt(r).toString(10):r,dd=r=>r&&r.startsWith("0x")?r:`0x${BigInt(r).toString(16)}`,Ob=r=>Object.keys(r).filter(e=>w9.includes(e)).reduce((e,t)=>(e[t]=v9(r[t]),e),{}),v9=r=>typeof r=="string"&&p9(r)?JSON.parse(r):r,E9=(r,e,t)=>{const{sessionProperties:n={},scopedProperties:s={}}=r,i={};if(!Sn(s)&&!Sn(n))return;const o=Ob(n);for(const a of t){const c=b9(a);if(!c)continue;i[dd(c)]=o;const l=s==null?void 0:s[`${Pb}:${c}`];if(l){const u=l==null?void 0:l[`${Pb}:${c}:${e}`];i[dd(c)]=Sb(Sb({},i[dd(c)]),Ob(u||l))}}for(const[a,c]of Object.entries(i))Object.keys(c).length===0&&delete i[a];return Object.keys(i).length>0?i:void 0};var A9=Object.defineProperty,x9=(r,e,t)=>e in r?A9(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,I9=(r,e,t)=>x9(r,e+"",t);let pd,S9=class TA{constructor(e){I9(this,"storage"),this.storage=e}async getItem(e){return await this.storage.getItem(e)}async setItem(e,t){return await this.storage.setItem(e,t)}async removeItem(e){return await this.storage.removeItem(e)}static getStorage(e){return pd||(pd=new TA(e)),pd}};var P9=Object.defineProperty,O9=Object.defineProperties,D9=Object.getOwnPropertyDescriptors,Db=Object.getOwnPropertySymbols,C9=Object.prototype.hasOwnProperty,B9=Object.prototype.propertyIsEnumerable,Cb=(r,e,t)=>e in r?P9(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,_9=(r,e)=>{for(var t in e||(e={}))C9.call(e,t)&&Cb(r,t,e[t]);if(Db)for(var t of Db(e))B9.call(e,t)&&Cb(r,t,e[t]);return r},T9=(r,e)=>O9(r,D9(e));async function N9(r,e){const t=ss(r.result.capabilities.caip345.caip2),n=r.result.capabilities.caip345.transactionHashes,s=await Promise.allSettled(n.map(h=>R9(t.reference,h,e))),i=s.filter(h=>h.status==="fulfilled").map(h=>h.value).filter(h=>h);s.filter(h=>h.status==="rejected").forEach(h=>console.warn("Failed to fetch transaction receipt:",h.reason));const o=!i.length||i.some(h=>!h),a=i.every(h=>(h==null?void 0:h.status)==="0x1"),c=i.every(h=>(h==null?void 0:h.status)==="0x0"),l=i.some(h=>(h==null?void 0:h.status)==="0x0");let u;return o?u=100:a?u=200:c?u=500:l&&(u=600),{id:r.result.id,version:r.request.version,atomic:r.request.atomicRequired,chainId:r.request.chainId,capabilities:r.result.capabilities,receipts:i,status:u}}async function R9(r,e,t){return await t(parseInt(r)).request(Vr("eth_getTransactionReceipt",[e]))}async function U9({sendCalls:r,storage:e}){const t=await e.getItem(Xo);await e.setItem(Xo,T9(_9({},t),{[r.result.id]:{request:r.request,result:r.result,expiry:Ke(TF)}}))}async function k9({resultId:r,storage:e}){const t=await e.getItem(Xo);if(t){delete t[r],await e.setItem(Xo,t);for(const n in t)wn(t[n].expiry)&&delete t[n];await e.setItem(Xo,t)}}async function $9({resultId:r,storage:e}){const t=await e.getItem(Xo),n=t==null?void 0:t[r];if(n&&!wn(n.expiry))return n;await k9({resultId:r,storage:e})}var L9=Object.defineProperty,F9=Object.defineProperties,M9=Object.getOwnPropertyDescriptors,Bb=Object.getOwnPropertySymbols,j9=Object.prototype.hasOwnProperty,z9=Object.prototype.propertyIsEnumerable,Hp=(r,e,t)=>e in r?L9(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,gd=(r,e)=>{for(var t in e||(e={}))j9.call(e,t)&&Hp(r,t,e[t]);if(Bb)for(var t of Bb(e))z9.call(e,t)&&Hp(r,t,e[t]);return r},yd=(r,e)=>F9(r,M9(e)),fi=(r,e,t)=>Hp(r,typeof e!="symbol"?e+"":e,t);class H9{constructor(e){fi(this,"name","eip155"),fi(this,"client"),fi(this,"chainId"),fi(this,"namespace"),fi(this,"httpProviders"),fi(this,"events"),fi(this,"storage"),this.namespace=e.namespace,this.events=ea("events"),this.client=ea("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain()),this.storage=S9.getStorage(this.client.core.storage)}async request(e){switch(e.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(e);case"eth_chainId":return parseInt(this.getDefaultChain());case"wallet_getCapabilities":return await this.getCapabilities(e);case"wallet_getCallsStatus":return await this.getCallStatus(e);case"wallet_sendCalls":return await this.sendCalls(e)}return this.namespace.methods.includes(e.request.method)?await this.client.request(e):this.getHttpProvider().request(e.request)}updateNamespace(e){this.namespace=Object.assign(this.namespace,e)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(parseInt(e),t);const n=this.chainId;this.chainId=parseInt(e),this.events.emit(zg.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${n}`})}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}createHttpProvider(e,t){const n=t||CA(`${this.name}:${e}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${e}`);return new Mg(new vA(n,ea("disableProviderPing")))}setHttpProvider(e,t){const n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}createHttpProviders(){const e={};return this.namespace.chains.forEach(t=>{var n;const s=parseInt(f9(t));e[s]=this.createHttpProvider(s,(n=this.namespace.rpcMap)==null?void 0:n[t])}),e}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}getHttpProvider(e){const t=e||this.chainId;return this.httpProviders[t]||(this.httpProviders=yd(gd({},this.httpProviders),{[t]:this.createHttpProvider(t)}),this.httpProviders[t])}async handleSwitchChain(e){var t,n;let s=e.request.params?(t=e.request.params[0])==null?void 0:t.chainId:"0x0";s=s.startsWith("0x")?s:`0x${s}`;const i=parseInt(s,16);if(this.isChainApproved(i))this.setDefaultChain(`${i}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:e.topic,request:{method:e.request.method,params:[{chainId:s}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${i}`);else throw new Error(`Failed to switch to chain 'eip155:${i}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(e){return this.namespace.chains.includes(`${this.name}:${e}`)}async getCapabilities(e){var t,n,s,i,o;const a=(n=(t=e.request)==null?void 0:t.params)==null?void 0:n[0],c=((i=(s=e.request)==null?void 0:s.params)==null?void 0:i[1])||[];if(!a)throw new Error("Missing address parameter in `wallet_getCapabilities` request");const l=this.client.session.get(e.topic),u=((o=l==null?void 0:l.sessionProperties)==null?void 0:o.capabilities)||{},h=`${a}${c.join(",")}`,f=u==null?void 0:u[h];if(f)return f;let d;try{d=E9(l,a,c)}catch(g){console.warn("Failed to extract capabilities from session",g)}if(d)return d;const p=await this.client.request(e);try{await this.client.session.update(e.topic,{sessionProperties:yd(gd({},l.sessionProperties||{}),{capabilities:yd(gd({},u||{}),{[h]:p})})})}catch(g){console.warn("Failed to update session with capabilities",g)}return p}async getCallStatus(e){var t,n,s;const i=this.client.session.get(e.topic),o=(t=i.sessionProperties)==null?void 0:t.bundler_name;if(o){const l=this.getBundlerUrl(e.chainId,o);try{return await this.getUserOperationReceipt(l,e)}catch(u){console.warn("Failed to fetch call status from bundler",u,l)}}const a=(n=i.sessionProperties)==null?void 0:n.bundler_url;if(a)try{return await this.getUserOperationReceipt(a,e)}catch(l){console.warn("Failed to fetch call status from custom bundler",l,a)}const c=await $9({resultId:(s=e.request.params)==null?void 0:s[0],storage:this.storage});if(c)try{return await N9(c,this.getHttpProvider.bind(this))}catch(l){console.warn("Failed to fetch call status from stored send calls",l,c)}if(this.namespace.methods.includes(e.request.method))return await this.client.request(e);throw new Error("Fetching call status not approved by the wallet.")}async getUserOperationReceipt(e,t){var n;const s=new URL(e),i=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Vr("eth_getUserOperationReceipt",[(n=t.request.params)==null?void 0:n[0]]))});if(!i.ok)throw new Error(`Failed to fetch user operation receipt - ${i.status}`);return await i.json()}getBundlerUrl(e,t){return`${_F}?projectId=${this.client.core.projectId}&chainId=${e}&bundler=${t}`}async sendCalls(e){var t,n,s;const i=await this.client.request(e),o=(t=e.request.params)==null?void 0:t[0],a=i==null?void 0:i.id,c=(i==null?void 0:i.capabilities)||{},l=(n=c==null?void 0:c.caip345)==null?void 0:n.caip2,u=(s=c==null?void 0:c.caip345)==null?void 0:s.transactionHashes;return!a||!l||!(u!=null&&u.length)||await U9({sendCalls:{request:o,result:i},storage:this.storage}),i}}var q9=Object.defineProperty,V9=(r,e,t)=>e in r?q9(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,_o=(r,e,t)=>V9(r,typeof e!="symbol"?e+"":e,t);class K9{constructor(e){_o(this,"name",AA),_o(this,"client"),_o(this,"httpProviders"),_o(this,"events"),_o(this,"namespace"),_o(this,"chainId"),this.namespace=e.namespace,this.events=ea("events"),this.client=ea("client"),this.chainId=this.getDefaultChain(),this.name=this.getNamespaceName(),this.httpProviders=this.createHttpProviders()}updateNamespace(e){this.namespace.chains=[...new Set((this.namespace.chains||[]).concat(e.chains||[]))],this.namespace.accounts=[...new Set((this.namespace.accounts||[]).concat(e.accounts||[]))],this.namespace.methods=[...new Set((this.namespace.methods||[]).concat(e.methods||[]))],this.namespace.events=[...new Set((this.namespace.events||[]).concat(e.events||[]))],this.httpProviders=this.createHttpProviders()}requestAccounts(){return this.getAccounts()}request(e){return this.namespace.methods.includes(e.request.method)?this.client.request(e):this.getHttpProvider(e.chainId).request(e.request)}setDefaultChain(e,t){this.httpProviders[e]||this.setHttpProvider(e,t);const n=this.chainId;this.chainId=e,this.events.emit(zg.DEFAULT_CHAIN_CHANGED,{currentCaipChainId:`${this.name}:${e}`,previousCaipChainId:`${this.name}:${n}`})}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return e.split(":")[1]}getNamespaceName(){const e=this.namespace.chains[0];if(!e)throw new Error("ChainId not found");return ss(e).namespace}getAccounts(){const e=this.namespace.accounts;return e?[...new Set(e.filter(t=>t.split(":")[1]===this.chainId.toString()).map(t=>t.split(":")[2]))]:[]}createHttpProviders(){var e,t;const n={};return(t=(e=this.namespace)==null?void 0:e.accounts)==null||t.forEach(s=>{var i,o;const a=ss(s),c=(o=(i=this.namespace)==null?void 0:i.rpcMap)==null?void 0:o[`${a.namespace}:${a.reference}`];n[a.reference]=this.createHttpProvider(s,c)}),n}getHttpProvider(e){const t=ss(e).reference,n=this.httpProviders[t];if(typeof n>"u")throw new Error(`JSON-RPC provider for ${e} not found`);return n}setHttpProvider(e,t){const n=this.createHttpProvider(e,t);n&&(this.httpProviders[e]=n)}createHttpProvider(e,t){const n=t||CA(e,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${e}`);return new Mg(new vA(n,ea("disableProviderPing")))}}var G9=Object.defineProperty,Q9=Object.defineProperties,W9=Object.getOwnPropertyDescriptors,_b=Object.getOwnPropertySymbols,J9=Object.prototype.hasOwnProperty,Y9=Object.prototype.propertyIsEnumerable,qp=(r,e,t)=>e in r?G9(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Sc=(r,e)=>{for(var t in e||(e={}))J9.call(e,t)&&qp(r,t,e[t]);if(_b)for(var t of _b(e))Y9.call(e,t)&&qp(r,t,e[t]);return r},fu=(r,e)=>Q9(r,W9(e)),gr=(r,e,t)=>qp(r,typeof e!="symbol"?e+"":e,t);class Vg{constructor(e){gr(this,"client"),gr(this,"namespaces"),gr(this,"optionalNamespaces"),gr(this,"sessionProperties"),gr(this,"scopedProperties"),gr(this,"events",new dg),gr(this,"rpcProviders",{}),gr(this,"session"),gr(this,"providerOpts"),gr(this,"logger"),gr(this,"uri"),gr(this,"disableProviderPing",!1),this.providerOpts=e,this.logger=typeof(e==null?void 0:e.logger)<"u"&&typeof(e==null?void 0:e.logger)!="string"?e.logger:Ul(Gh({level:(e==null?void 0:e.logger)||db})),this.disableProviderPing=(e==null?void 0:e.disableProviderPing)||!1}static async init(e){const t=new Vg(e);return await t.initialize(),t}async request(e,t,n){const[s,i]=this.validateChain(t);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:Sc({},e),chainId:`${s}:${i}`,topic:this.session.topic,expiry:n})}sendAsync(e,t,n,s){const i=new Date().getTime();this.request(e,n,s).then(o=>t(null,ol(i,o))).catch(o=>t(o,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties}),await this.requestAccounts()}async disconnect(){var e;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(e=this.session)==null?void 0:e.topic,reason:Ne("USER_DISCONNECTED")}),await this.cleanup()}async connect(e){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(e),this.cleanupPendingPairings(),!e.skipPairing)return await this.pair(e.pairingTopic)}async authenticate(e,t){if(!this.client)throw new Error("Sign Client not initialized");this.setNamespaces(e),await this.cleanupPendingPairings();const{uri:n,response:s}=await this.client.authenticate(e,t);n&&(this.uri=n,this.events.emit("display_uri",n));const i=await s();if(this.session=i.session,this.session){const o=Ab(this.session.namespaces);this.namespaces=hu(this.namespaces,o),await this.persist("namespaces",this.namespaces),this.onConnect()}return i}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}removeListener(e,t){this.events.removeListener(e,t)}off(e,t){this.events.off(e,t)}get isWalletConnect(){return!0}async pair(e){const{uri:t,approval:n}=await this.client.connect({pairingTopic:e,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties,scopedProperties:this.scopedProperties});t&&(this.uri=t,this.events.emit("display_uri",t));const s=await n();this.session=s;const i=Ab(s.namespaces);return this.namespaces=hu(this.namespaces,i),await this.persist("namespaces",this.namespaces),await this.persist("optionalNamespaces",this.optionalNamespaces),this.onConnect(),this.session}setDefaultChain(e,t){try{if(!this.session)return;const[n,s]=this.validateChain(e);this.getProvider(n).setDefaultChain(s,t)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(e={}){try{this.logger.info("Cleaning up inactive pairings...");const t=this.client.pairing.getAll();if(!Dr(t))return;for(const n of t)e.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${t.length}`)}catch(t){this.logger.warn("Failed to cleanup pending pairings",t)}}abortPairingAttempt(){this.logger.warn("abortPairingAttempt is deprecated. This is now a no-op.")}async checkStorage(){this.namespaces=await this.getFromStore("namespaces")||{},this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.session&&this.createProviders()}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){var e,t;if(this.client=this.providerOpts.client||await wF.init({core:this.providerOpts.core,logger:this.providerOpts.logger||db,relayUrl:this.providerOpts.relayUrl||DF,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name,customStoragePrefix:this.providerOpts.customStoragePrefix,telemetryEnabled:this.providerOpts.telemetryEnabled}),this.providerOpts.session)try{this.session=this.client.session.get(this.providerOpts.session.topic)}catch(n){throw this.logger.error("Failed to get session",n),new Error(`The provided session: ${(t=(e=this.providerOpts)==null?void 0:e.session)==null?void 0:t.topic} doesn't exist in the Sign client`)}else{const n=this.client.session.getAll();this.session=n[0]}this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const e=[...new Set(Object.keys(this.session.namespaces).map(t=>jo(t)))];fd("client",this.client),fd("events",this.events),fd("disableProviderPing",this.disableProviderPing),e.forEach(t=>{if(!this.session)return;const n=d9(t,this.session);if((n==null?void 0:n.length)===0)return;const s=BA(n),i=hu(this.namespaces,this.optionalNamespaces),o=fu(Sc({},i[t]),{accounts:n,chains:s});switch(t){case"eip155":this.rpcProviders[t]=new H9({namespace:o});break;default:this.rpcProviders[t]=new K9({namespace:o})}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",e=>{var t;const{topic:n}=e;n===((t=this.session)==null?void 0:t.topic)&&this.events.emit("session_ping",e)}),this.client.on("session_event",e=>{var t;const{params:n,topic:s}=e;if(s!==((t=this.session)==null?void 0:t.topic))return;const{event:i}=n;if(i.name==="accountsChanged"){const o=i.data;o&&Dr(o)&&this.events.emit("accountsChanged",o.map(Eb))}else if(i.name==="chainChanged"){const o=n.chainId,a=n.event.data,c=jo(o),l=hd(o)!==hd(a)?`${c}:${hd(a)}`:o;this.onChainChanged({currentCaipChainId:l})}else this.events.emit(i.name,i.data);this.events.emit("session_event",e)}),this.client.on("session_update",({topic:e,params:t})=>{var n,s;if(e!==((n=this.session)==null?void 0:n.topic))return;const{namespaces:i}=t,o=(s=this.client)==null?void 0:s.session.get(e);this.session=fu(Sc({},o),{namespaces:i}),this.onSessionUpdate(),this.events.emit("session_update",{topic:e,params:t})}),this.client.on("session_delete",async e=>{var t;e.topic===((t=this.session)==null?void 0:t.topic)&&(await this.cleanup(),this.events.emit("session_delete",e),this.events.emit("disconnect",fu(Sc({},Ne("USER_DISCONNECTED")),{data:e.topic})))}),this.on(zg.DEFAULT_CHAIN_CHANGED,e=>{this.onChainChanged(fu(Sc({},e),{internal:!0}))})}getProvider(e){return this.rpcProviders[e]||this.rpcProviders[AA]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(e=>{var t;this.getProvider(e).updateNamespace((t=this.session)==null?void 0:t.namespaces[e])})}setNamespaces(e){const{namespaces:t={},optionalNamespaces:n={},sessionProperties:s,scopedProperties:i}=e;this.optionalNamespaces=hu(t,n),this.sessionProperties=s,this.scopedProperties=i}validateChain(e){const[t,n]=(e==null?void 0:e.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[t,n];if(t&&!Object.keys(this.namespaces||{}).map(o=>jo(o)).includes(t))throw new Error(`Namespace '${t}' is not configured. Please call connect() first with namespace config.`);if(t&&n)return[t,n];const s=jo(Object.keys(this.namespaces)[0]),i=this.rpcProviders[s].getDefaultChain();return[s,i]}async requestAccounts(){const[e]=this.validateChain();return await this.getProvider(e).requestAccounts()}async onChainChanged({currentCaipChainId:e,previousCaipChainId:t,internal:n=!1}){if(!this.namespaces)return;const[s,i]=this.validateChain(e);i&&(this.updateNamespaceChain(s,i),n?(this.events.emit("chainChanged",i),this.emitAccountsChangedOnChainChange({namespace:s,currentCaipChainId:e,previousCaipChainId:t})):this.getProvider(s).setDefaultChain(i),await this.persist("namespaces",this.namespaces))}emitAccountsChangedOnChainChange({namespace:e,currentCaipChainId:t,previousCaipChainId:n}){var s,i;try{if(n===t)return;const o=(i=(s=this.session)==null?void 0:s.namespaces[e])==null?void 0:i.accounts;if(!o)return;const a=o.filter(c=>c.includes(`${t}:`)).map(Eb);if(!Dr(a))return;this.events.emit("accountsChanged",a)}catch(o){this.logger.warn("Failed to emit accountsChanged on chain change",o)}}updateNamespaceChain(e,t){if(!this.namespaces)return;const n=this.namespaces[e]?e:`${e}:${t}`,s={chains:[],methods:[],events:[],defaultChain:t};this.namespaces[n]?this.namespaces[n]&&(this.namespaces[n].defaultChain=t):this.namespaces[n]=s}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,await this.deleteFromStore("namespaces"),await this.deleteFromStore("optionalNamespaces"),await this.deleteFromStore("sessionProperties"),this.session=void 0,this.cleanupPendingPairings({deletePairings:!0}),await this.cleanupStorage()}async persist(e,t){var n;const s=((n=this.session)==null?void 0:n.topic)||"";await this.client.core.storage.setItem(`${lu}/${e}${s}`,t)}async getFromStore(e){var t;const n=((t=this.session)==null?void 0:t.topic)||"";return await this.client.core.storage.getItem(`${lu}/${e}${n}`)}async deleteFromStore(e){var t;const n=((t=this.session)==null?void 0:t.topic)||"";await this.client.core.storage.removeItem(`${lu}/${e}${n}`)}async cleanupStorage(){var e;try{if(((e=this.client)==null?void 0:e.session.length)>0)return;const t=await this.client.core.storage.getKeys();for(const n of t)n.startsWith(lu)&&await this.client.core.storage.removeItem(n)}catch(t){this.logger.warn("Failed to cleanup storage",t)}}}const Z9=Vg,X9="wc",eM="ethereum_provider",tM=`${X9}@2:${eM}:`,rM="https://rpc.walletconnect.org/v1/",Vp=["eth_sendTransaction","personal_sign"],nM=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","eth_sendTransaction","personal_sign","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode","wallet_sendCalls","wallet_getCapabilities","wallet_getCallsStatus","wallet_showCallsStatus"],Kp=["chainChanged","accountsChanged"],sM=["chainChanged","accountsChanged","message","disconnect","connect"],iM=async()=>{const{createAppKit:r}=await Nv(()=>import("./core-yKEjwig6.js").then(e=>e.ac),[]);return r};var oM=Object.defineProperty,aM=Object.defineProperties,cM=Object.getOwnPropertyDescriptors,Tb=Object.getOwnPropertySymbols,lM=Object.prototype.hasOwnProperty,uM=Object.prototype.propertyIsEnumerable,Gp=(r,e,t)=>e in r?oM(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,yi=(r,e)=>{for(var t in e||(e={}))lM.call(e,t)&&Gp(r,t,e[t]);if(Tb)for(var t of Tb(e))uM.call(e,t)&&Gp(r,t,e[t]);return r},Pc=(r,e)=>aM(r,cM(e)),er=(r,e,t)=>Gp(r,typeof e!="symbol"?e+"":e,t);function uh(r){return Number(r[0].split(":")[1])}function du(r){return`0x${r.toString(16)}`}function hM(r){const{chains:e,optionalChains:t,methods:n,optionalMethods:s,events:i,optionalEvents:o,rpcMap:a}=r;if(!Dr(e))throw new Error("Invalid chains");const c={chains:e,methods:n||Vp,events:i||Kp,rpcMap:yi({},e.length?{[uh(e)]:a[uh(e)]}:{})},l=i==null?void 0:i.filter(d=>!Kp.includes(d)),u=n==null?void 0:n.filter(d=>!Vp.includes(d));if(!t&&!o&&!s&&!(l!=null&&l.length)&&!(u!=null&&u.length))return{required:e.length?c:void 0};const h=(l==null?void 0:l.length)&&(u==null?void 0:u.length)||!t,f={chains:[...new Set(h?c.chains.concat(t||[]):t)],methods:[...new Set(c.methods.concat(s!=null&&s.length?s:nM))],events:[...new Set(c.events.concat(o!=null&&o.length?o:sM))],rpcMap:a};return{required:e.length?c:void 0,optional:t.length?f:void 0}}class Kg{constructor(){er(this,"events",new hr.EventEmitter),er(this,"namespace","eip155"),er(this,"accounts",[]),er(this,"signer"),er(this,"chainId",1),er(this,"modal"),er(this,"rpc"),er(this,"STORAGE_KEY",tM),er(this,"on",(e,t)=>(this.events.on(e,t),this)),er(this,"once",(e,t)=>(this.events.once(e,t),this)),er(this,"removeListener",(e,t)=>(this.events.removeListener(e,t),this)),er(this,"off",(e,t)=>(this.events.off(e,t),this)),er(this,"parseAccount",e=>this.isCompatibleChainId(e)?this.parseAccountId(e).address:e),this.signer={},this.rpc={}}static async init(e){const t=new Kg;return await t.initialize(e),t}async request(e,t){return await this.signer.request(e,this.formatChainId(this.chainId),t)}sendAsync(e,t,n){this.signer.sendAsync(e,t,this.formatChainId(this.chainId),n)}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(e){var t;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(e);const{required:n,optional:s}=hM(this.rpc);try{const i=await new Promise(async(a,c)=>{var l,u;this.rpc.showQrModal&&((l=this.modal)==null||l.open(),(u=this.modal)==null||u.subscribeState(f=>{!f.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),c(new Error("Connection request reset. Please try again.")))}));const h=e!=null&&e.scopedProperties?{[this.namespace]:e.scopedProperties}:void 0;await this.signer.connect(Pc(yi({namespaces:yi({},n&&{[this.namespace]:n})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:e==null?void 0:e.pairingTopic,scopedProperties:h})).then(f=>{a(f)}).catch(f=>{var d;(d=this.modal)==null||d.showErrorMessage("Unable to connect"),c(new Error(f.message))})});if(!i)return;const o=gm(i.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:du(this.chainId)})}catch(i){throw this.signer.logger.error(i),i}finally{(t=this.modal)==null||t.close()}}async authenticate(e,t){var n;if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts({chains:e==null?void 0:e.chains});try{const s=await new Promise(async(o,a)=>{var c,l;this.rpc.showQrModal&&((c=this.modal)==null||c.open(),(l=this.modal)==null||l.subscribeState(u=>{!u.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),a(new Error("Connection request reset. Please try again.")))})),await this.signer.authenticate(Pc(yi({},e),{chains:this.rpc.chains}),t).then(u=>{o(u)}).catch(u=>{var h;(h=this.modal)==null||h.showErrorMessage("Unable to connect"),a(new Error(u.message))})}),i=s.session;if(i){const o=gm(i.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:o),this.setAccounts(o),this.events.emit("connect",{chainId:du(this.chainId)})}return s}catch(s){throw this.signer.logger.error(s),s}finally{(n=this.modal)==null||n.close()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",e=>{const{params:t}=e,{event:n}=t;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",e)}),this.signer.on("accountsChanged",e=>{this.accounts=this.parseAccounts(e),this.events.emit("accountsChanged",this.accounts)}),this.signer.on("chainChanged",e=>{const t=parseInt(e);this.chainId=t,this.events.emit("chainChanged",du(this.chainId)),this.persist()}),this.signer.on("session_update",e=>{this.events.emit("session_update",e)}),this.signer.on("session_delete",e=>{this.reset(),this.events.emit("session_delete",e),this.events.emit("disconnect",Pc(yi({},Ne("USER_DISCONNECTED")),{data:e.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",e=>{this.events.emit("display_uri",e)})}switchEthereumChain(e){this.request({method:"wallet_switchEthereumChain",params:[{chainId:e.toString(16)}]})}isCompatibleChainId(e){return typeof e=="string"?e.startsWith(`${this.namespace}:`):!1}formatChainId(e){return`${this.namespace}:${e}`}parseChainId(e){return Number(e.split(":")[1])}setChainIds(e){const t=e.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));t.length&&(this.chainId=t[0],this.events.emit("chainChanged",du(this.chainId)),this.persist())}setChainId(e){if(this.isCompatibleChainId(e)){const t=this.parseChainId(e);this.chainId=t,this.switchEthereumChain(t)}}parseAccountId(e){const[t,n,s]=e.split(":");return{chainId:`${t}:${n}`,address:s}}setAccounts(e){this.accounts=e.filter(t=>this.parseChainId(this.parseAccountId(t).chainId)===this.chainId).map(t=>this.parseAccountId(t).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(e){var t,n;const s=(t=e==null?void 0:e.chains)!=null?t:[],i=(n=e==null?void 0:e.optionalChains)!=null?n:[],o=s.concat(i);if(!o.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const a=s.length?(e==null?void 0:e.methods)||Vp:[],c=s.length?(e==null?void 0:e.events)||Kp:[],l=(e==null?void 0:e.optionalMethods)||[],u=(e==null?void 0:e.optionalEvents)||[],h=(e==null?void 0:e.rpcMap)||this.buildRpcMap(o,e.projectId),f=(e==null?void 0:e.qrModalOptions)||void 0;return{chains:s==null?void 0:s.map(d=>this.formatChainId(d)),optionalChains:i.map(d=>this.formatChainId(d)),methods:a,events:c,optionalMethods:l,optionalEvents:u,rpcMap:h,showQrModal:!!(e!=null&&e.showQrModal),qrModalOptions:f,projectId:e.projectId,metadata:e.metadata}}buildRpcMap(e,t){const n={};return e.forEach(s=>{n[s]=this.getRpcUrl(s,t)}),n}async initialize(e){if(this.rpc=this.getRpcConfig(e),this.chainId=this.rpc.chains.length?uh(this.rpc.chains):uh(this.rpc.optionalChains),this.signer=await Z9.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:e.disableProviderPing,relayUrl:e.relayUrl,storage:e.storage,storageOptions:e.storageOptions,customStoragePrefix:e.customStoragePrefix,telemetryEnabled:e.telemetryEnabled,logger:e.logger}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let t;try{const n=await iM(),{convertWCMToAppKitOptions:s}=await Promise.resolve().then(function(){return EM}),i=s(Pc(yi({},this.rpc.qrModalOptions),{chains:[...new Set([...this.rpc.chains,...this.rpc.optionalChains])],metadata:this.rpc.metadata,projectId:this.rpc.projectId}));if(!i.networks.length)throw new Error("No networks found for WalletConnect·");t=n(Pc(yi({},i),{universalProvider:this.signer,manualWCControl:!0}))}catch(n){throw console.warn(n),new Error("To use QR modal, please install @reown/appkit package")}if(t)try{this.modal=t}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(e){if(!e)return;const{chains:t,optionalChains:n,rpcMap:s}=e;t&&Dr(t)&&(this.rpc.chains=t.map(i=>this.formatChainId(i)),t.forEach(i=>{this.rpc.rpcMap[i]=(s==null?void 0:s[i])||this.getRpcUrl(i)})),n&&Dr(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n==null?void 0:n.map(i=>this.formatChainId(i)),n.forEach(i=>{this.rpc.rpcMap[i]=(s==null?void 0:s[i])||this.getRpcUrl(i)}))}getRpcUrl(e,t){var n;return((n=this.rpc.rpcMap)==null?void 0:n[e])||`${rM}?chainId=eip155:${e}&projectId=${t||this.rpc.projectId}`}async loadPersistedSession(){if(this.session)try{const e=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),t=this.session.namespaces[`${this.namespace}:${e}`]?this.session.namespaces[`${this.namespace}:${e}`]:this.session.namespaces[this.namespace];this.setChainIds(e?[this.formatChainId(e)]:t==null?void 0:t.accounts),this.setAccounts(t==null?void 0:t.accounts)}catch(e){this.signer.logger.error("Failed to load persisted session, clearing state..."),this.signer.logger.error(e),await this.disconnect().catch(t=>this.signer.logger.warn(t))}}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(e){return typeof e=="string"||e instanceof String?[this.parseAccount(e)]:e.map(t=>this.parseAccount(t))}}var fM=Object.defineProperty,dM=Object.defineProperties,pM=Object.getOwnPropertyDescriptors,Nb=Object.getOwnPropertySymbols,gM=Object.prototype.hasOwnProperty,yM=Object.prototype.propertyIsEnumerable,Rb=(r,e,t)=>e in r?fM(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,NA=(r,e)=>{for(var t in e||(e={}))gM.call(e,t)&&Rb(r,t,e[t]);if(Nb)for(var t of Nb(e))yM.call(e,t)&&Rb(r,t,e[t]);return r},mM=(r,e)=>dM(r,pM(e));function wM(r){if(r)return{"--w3m-font-family":r["--wcm-font-family"],"--w3m-accent":r["--wcm-accent-color"],"--w3m-color-mix":r["--wcm-background-color"],"--w3m-z-index":r["--wcm-z-index"]?Number(r["--wcm-z-index"]):void 0,"--w3m-qr-color":r["--wcm-accent-color"],"--w3m-font-size-master":r["--wcm-text-medium-regular-size"],"--w3m-border-radius-master":r["--wcm-container-border-radius"],"--w3m-color-mix-strength":0}}const bM=r=>{const[e,t]=r.split(":");return RA({id:t,caipNetworkId:r,chainNamespace:e,name:"",nativeCurrency:{name:"",symbol:"",decimals:8},rpcUrls:{default:{http:["https://rpc.walletconnect.org/v1"]}}})};function vM(r){var e,t,n,s,i,o,a;const c=(e=r.chains)==null?void 0:e.map(bM).filter(Boolean);if(c.length===0)throw new Error("At least one chain must be specified");const l=c.find(h=>{var f;return h.id===((f=r.defaultChain)==null?void 0:f.id)}),u={projectId:r.projectId,networks:c,themeMode:r.themeMode,themeVariables:wM(r.themeVariables),chainImages:r.chainImages,connectorImages:r.walletImages,defaultNetwork:l,metadata:mM(NA({},r.metadata),{name:((t=r.metadata)==null?void 0:t.name)||"WalletConnect",description:((n=r.metadata)==null?void 0:n.description)||"Connect to WalletConnect-compatible wallets",url:((s=r.metadata)==null?void 0:s.url)||"https://walletconnect.org",icons:((i=r.metadata)==null?void 0:i.icons)||["https://walletconnect.org/walletconnect-logo.png"]}),showWallets:!0,featuredWalletIds:r.explorerRecommendedWalletIds==="NONE"?[]:Array.isArray(r.explorerRecommendedWalletIds)?r.explorerRecommendedWalletIds:[],excludeWalletIds:r.explorerExcludedWalletIds==="ALL"?[]:Array.isArray(r.explorerExcludedWalletIds)?r.explorerExcludedWalletIds:[],enableEIP6963:!1,enableInjected:!1,enableCoinbase:!0,enableWalletConnect:!0,features:{email:!1,socials:!1}};if((o=r.mobileWallets)!=null&&o.length||(a=r.desktopWallets)!=null&&a.length){const h=[...(r.mobileWallets||[]).map(p=>({id:p.id,name:p.name,links:p.links})),...(r.desktopWallets||[]).map(p=>({id:p.id,name:p.name,links:{native:p.links.native,universal:p.links.universal}}))],f=[...u.featuredWalletIds||[],...u.excludeWalletIds||[]],d=h.filter(p=>!f.includes(p.id));d.length&&(u.customWallets=d)}return u}function RA(r){return NA({formatters:void 0,fees:void 0,serializers:void 0},r)}var EM=Object.freeze({__proto__:null,convertWCMToAppKitOptions:vM,defineChain:RA});const AM="611536788e4297012ef34993004d5565",zc=56,xM={56:"https://bsc-dataseed.binance.org/",137:"https://polygon-rpc.com",1:"https://eth.llamarpc.com"},IM="0x55d398326f99059fF775485246999027B3197955",SM=["function balanceOf(address) view returns (uint256)","function decimals() view returns (uint8)","function symbol() view returns (string)","function transfer(address to, uint256 value) returns (bool)"];let xn=null,ft=null,os=null,Pr=null,lo,Nr,_u,ve,Gr;function PM(){lo=document.getElementById("walletAddr"),Nr=document.getElementById("walletBalance"),_u=document.getElementById("status"),ve=document.getElementById("payBtn"),Gr=document.getElementById("reconnectBtn")}function Ae(r,e=!1){_u&&(_u.innerText=`Status: ${r}`,_u.style.color=e?"crimson":"")}async function UA({showQrModal:r=!1}={}){return await Kg.init({projectId:AM,chains:[zc],showQrModal:r,rpcMap:{[zc]:xM[zc]},optionalChains:[]})}async function OM(r,e=zc){const t="0x"+Number(e).toString(16);async function n(i){if(!i)return!1;try{if(typeof i.request=="function")return await i.request({method:"wallet_switchEthereumChain",params:[{chainId:t}]}),!0;if(typeof i.send=="function")return await i.send("wallet_switchEthereumChain",[{chainId:t}]),!0;if(typeof i.sendAsync=="function")return await new Promise((o,a)=>i.sendAsync({jsonrpc:"2.0",id:Date.now(),method:"wallet_switchEthereumChain",params:[{chainId:t}]},(c,l)=>c?a(c):o(l))),!0}catch{return!1}return!1}const s=[r,xn,ft&&ft.provider,ft];for(const i of s)if(i)try{if(await n(i))return!0}catch{}return!1}async function kA(){return await OM(xn||ft&&ft.provider||ft,zc)?(await new Promise(e=>setTimeout(e,700)),Ae("Switched to BSC"),!0):(Ae("Switch wallet to BSC (BNB Smart Chain) and reconnect.",!0),Gr&&(Gr.style.display="inline-block"),!1)}async function Ub(){Ae("restoring session...");try{return xn=await UA({showQrModal:!1}),await xn.enable(),ft=new Ku(xn),os=await ft.getSigner(),Pr=await os.getAddress(),window.__wcProvider=xn,window.__provider=ft,window.__signer=os,lo&&(lo.innerText=Pr),Ae("connected: "+Pr),ve&&(ve.disabled=!1),Gr&&(Gr.style.display="none"),await kA(),await hh(Pr),Pr}catch(r){return console.warn("restoreSession failed:",r),Ae("no active wallet session"),Gr&&(Gr.style.display="inline-block"),ve&&(ve.disabled=!0),null}}async function kb(){Ae("opening WalletConnect QR...");try{xn=await UA({showQrModal:!0}),await xn.enable(),ft=new Ku(xn),os=await ft.getSigner(),Pr=await os.getAddress(),window.__wcProvider=xn,window.__provider=ft,window.__signer=os,lo&&(lo.innerText=Pr),Ae("connected: "+Pr),ve&&(ve.disabled=!1),Gr&&(Gr.style.display="none"),await kA();try{if(window.USER_ID){const r=document.querySelector('meta[name="csrf-token"]'),e=r?r.getAttribute("content"):null;await fetch("/customer/wallet/save",{method:"POST",headers:{"Content-Type":"application/json",...e?{"X-CSRF-TOKEN":e}:{}},body:JSON.stringify({wallet_address:Pr,user_id:window.USER_ID})})}}catch(r){console.warn("save wallet failed:",r)}return await hh(Pr),Pr}catch(r){throw console.error("openConnectQr failed:",r),Ae("connect failed: "+(r.message||r),!0),r}}async function hh(r=null){var e,t;try{const n=r||Pr||(lo?lo.innerText.trim():null);if(!n)return Nr&&(Nr.innerText="Not connected"),null;Ae("fetching balance...");const s=window.USDT_CONTRACT||IM,i=`/wallet/balance/${encodeURIComponent(n)}?token=${encodeURIComponent(s)}`,o=await fetch(i,{headers:{Accept:"application/json"}});if(!o.ok)return console.error("Balance API error:",o.status,await o.text()),Nr&&(Nr.innerText="Error"),Ae("balance fetch failed",!0),null;const a=await o.json();if(!a.ok)return console.error("Balance API returned error",a),Nr&&(Nr.innerText="Error"),Ae("balance API error",!0),null;const c=((e=a.native)==null?void 0:e.balance)??"0",l=((t=a.native)==null?void 0:t.symbol)??"NATIVE";let u="0.00 USDT";return a.token&&a.token.balance!==void 0&&(u=parseFloat(a.token.balance).toFixed((a.token.decimals===6,2))+" USDT"),Nr&&(Nr.innerText=`${c} ${l} | ${u}`),Ae("balance updated"),a}catch(n){return console.error("fetchBalanceFromServer error:",n),Nr&&(Nr.innerText="Error"),Ae("fetch error",!0),null}}async function DM(){try{if(!ft||!os){alert("Please connect your wallet first.");return}const r=(await os.getAddress()).toLowerCase(),e=(window.SAVED_WALLET||"").toLowerCase();if(e&&e!==""&&r!==e&&!confirm("Connected wallet differs from saved wallet. Continue with connected wallet?"))return;const t=(window.USDT_CONTRACT||"").trim(),n=(window.RECEIVER||"").trim(),s=String(window.AMOUNT||"0").trim();if(!t){alert("Token contract not configured (USDT).");return}if(!n){alert("Receiver wallet not configured.");return}if(!s||Number(s)<=0){alert("Payment amount invalid.");return}ve&&(ve.disabled=!0,ve.classList.add("disabled")),Ae("Preparing payment...");const i=await ft.getCode(t).catch(()=>"0x");if(!i||i==="0x"||i==="0x0"){alert("Token contract not found on current network. Switch network and reconnect."),Ae("Token not on chain",!0),ve&&(ve.disabled=!1,ve.classList.remove("disabled"));return}const o=new Jo(t,SM,ft),a=o.connect(os);let c=18;try{c=Number(await o.decimals())}catch{}let l="TOKEN";try{l=await o.symbol()}catch{}const u=rf(s,c);Ae("Checking token balance...");let h;try{h=await o.balanceOf(r)}catch(P){console.error("balanceOf failed:",P),alert("Could not read token balance. Try reconnecting."),Ae("Balance read failed",!0),ve&&(ve.disabled=!1,ve.classList.remove("disabled"));return}if(BigInt(h.toString())<BigInt(u.toString())){alert(`Insufficient ${l}. Have ${Yb(h,c)}, need ${s}`),Ae("Insufficient token balance",!0),ve&&(ve.disabled=!1,ve.classList.remove("disabled"));return}Ae("Checking native balance for gas...");const f=await ft.getBalance(r);let d;try{d=await a.estimateGas.transfer(n,u),d=BigInt(d.toString())}catch(P){console.warn("estimateGas failed, fallback to 150000",P),d=150000n}const p=await ft.getFeeData();let g=p.maxFeePerGas??p.gasPrice??rf("5","gwei");g=BigInt(g.toString());const m=g*d,b=BigInt(rf("0.0005","ether").toString());if(BigInt(f.toString())<m+b){const P=parseFloat(py(f||0n)).toFixed(6),D=parseFloat(py(m+b)).toFixed(6);alert(`Insufficient native token (for gas).
You have: ${P}
Required (approx): ${D}
Please top up and try again.`),Ae("Insufficient native for gas",!0),ve&&(ve.disabled=!1,ve.classList.remove("disabled"));return}Ae("Please approve the transaction in your wallet app…");let x;try{x=await a.transfer(n,u)}catch(P){console.error("transfer() failed:",P);const D=P&&P.message?P.message.toLowerCase():"";D.includes("user rejected")||D.includes("rejected")||P.code===4001?(Ae("Transaction rejected by user",!0),alert("You rejected the transaction in your wallet.")):(Ae("Transaction send failed",!0),alert("Transaction failed to send: "+(P.message||P))),ve&&(ve.disabled=!1,ve.classList.remove("disabled"));return}Ae("Transaction submitted — waiting for confirmation...");try{await x.wait(1)}catch(P){console.warn("tx.wait failed:",P),Ae("Transaction submitted (no confirmation yet). Verifying...",!0)}Ae("Verifying with server...");const v=document.querySelector('meta[name="csrf-token"]'),I=v?v.getAttribute("content"):null,E=await(await fetch("/api/payment/verify",{method:"POST",headers:{"Content-Type":"application/json",...I?{"X-CSRF-TOKEN":I}:{}},body:JSON.stringify({user_id:window.USER_ID,token_contract:t,amount:s,tx_hash:x.hash,from_address:r,receiver:n})})).json();if(E.ok)if(Ae("Payment verified ✔"),window.RETURN_URL){const P=new URL(window.RETURN_URL);P.searchParams.set("user_id",window.USER_ID),P.searchParams.set("plan_id",window.PLAN_ID),P.searchParams.set("tx",x.hash),window.location.href=P.toString()}else alert("Payment successful: "+x.hash);else Ae("Server verification failed",!0),console.error("verify response:",E),alert("Verify failed: "+(E.error||JSON.stringify(E)));ve&&(ve.disabled=!1,ve.classList.remove("disabled"))}catch(r){console.error("payWithToken outer error:",r),Ae("payment error: "+(r.message||r),!0),alert("Payment error: "+(r.message||r)),ve&&(ve.disabled=!1,ve.classList.remove("disabled"))}}document.addEventListener("DOMContentLoaded",async()=>{if(PM(),window.connectWalletConnect=kb,window.openConnectQr=kb,window.restoreSession=Ub,window.refreshBalance=()=>hh(),window.payWithToken=DM,window.SAVED_WALLET)try{await Ub()}catch(r){console.warn("silent restore failed",r)}else Ae("no saved wallet");Gr&&(Gr.onclick=()=>{window.openConnectQr?window.openConnectQr():location.reload()}),setInterval(()=>{hh()},15e3)});export{UM as $,yU as A,dg as B,K_ as C,WB as D,$t as E,us as F,oo as G,Js as H,go as I,Qh as J,on as K,Sr as L,sn as M,vA as N,WO as O,cm as P,RE as Q,NM as R,k0 as S,Kv as T,Wa as U,zO as V,qv as W,JO as X,RM as Y,TM as Z,Nv as _,J as a,jO as a0,kM as a1,$M as a2,Gu as a3,LM as a4,fg as a5,ls as b,EO as c,FP as d,$c as e,Or as f,Pl as g,W8 as h,M8 as i,nD as j,J_ as k,hr as l,Gh as m,b4 as n,X4 as o,Vr as p,Ul as q,yo as r,dp as s,Jt as t,Mg as u,i5 as v,Fg as w,Wh as x,Zt as y,ol as z};
